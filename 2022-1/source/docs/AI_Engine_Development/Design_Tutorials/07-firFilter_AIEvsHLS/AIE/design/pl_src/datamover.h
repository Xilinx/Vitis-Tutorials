// Â© Copyright 2021 Xilinx, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

#pragma once

#include <ap_int.h>
#include <hls_stream.h>
#include <ap_axi_sdata.h>
#include <stdint.h>

/////////////////////////////////////////////////////////////
// INP_DATA is 16383(real) and 16383(imaginary)
////////////////////////////////////////////////////////////
#define INP_DATA 0x3FFF3FFF
//ap_uint<16> golden_16b[16]={254,510,766,1022,1278,1534,1790,2046,1790,1534,1278,1022,766,510,254};  //remaining golden are 0 by default

#if N_FIR_TAPS == 15
   #define CHK_CTR 8 // (15 + 1) * 2 / 4
   
   uint16_t golden_16b[32] = {254,254,510,510,766,766,1022,1022,1278,1278,1534,1534,1790,1790,2046,2046,1790,1790,1534,1534,1278,1278,1022,1022,766,766,510,510,254,254,0,0};  //remaining golden are 0 by default

#elif N_FIR_TAPS == 64
   #define CHK_CTR 32 // (64 * 2) / 4
   
   uint16_t golden_16b[128] = {15, 15,
                               31, 31,
                               46, 46,
                               62, 62,
                               77, 77,
                               93, 93,
                               108, 108,
                               124, 124,
                               139, 139,
                               155, 155,
                               170, 170,
                               186, 186,
                               201, 201,
                               217, 217,
                               232, 232,
                               248, 248,
                               263, 263,
                               279, 279,
                               294, 294,
                               310, 310,
                               325, 325,
                               341, 341,
                               356, 356,
                               372, 372,
                               387, 387,
                               403, 403,
                               418, 418,
                               434, 434,
                               449, 449,
                               465, 465,
                               480, 480,
                               496, 496,
                               496, 496,
                               480, 480,
                               465, 465,
                               449, 449,
                               434, 434,
                               418, 418,
                               403, 403,
                               387, 387,
                               372, 372,
                               356, 356,
                               341, 341,
                               325, 325,
                               310, 310,
                               294, 294,
                               279, 279,
                               263, 263,
                               248, 248,
                               232, 232,
                               217, 217,
                               201, 201,
                               186, 186,
                               170, 170,
                               155, 155,
                               139, 139,
                               124, 124,
                               108, 108,
                               93, 93,
                               77, 77,
                               62, 62,
                               46, 46,
                               31, 31,
                               15, 15};

#elif N_FIR_TAPS == 129
   #define CHK_CTR 65 // ((129 + 1) * 2) / 4
   
   uint16_t golden_16b[480] = {1, 1,
                               2, 2,
                               3, 3,
                               4, 4,
                               5, 5,
                               6, 6,
                               7, 7,
                               9, 9,
                               10, 10,
                               11, 11,
                               12, 12,
                               13, 13,
                               14, 14,
                               15, 15,
                               16, 16,
                               18, 18,
                               19, 19,
                               20, 20,
                               21, 21,
                               22, 22,
                               23, 23,
                               24, 24,
                               25, 25,
                               27, 27,
                               28, 28,
                               29, 29,
                               30, 30,
                               31, 31,
                               32, 32,
                               33, 33,
                               34, 34,
                               36, 36,
                               37, 37,
                               38, 38,
                               39, 39,
                               40, 40,
                               41, 41,
                               42, 42,
                               44, 44,
                               45, 45,
                               46, 46,
                               47, 47,
                               48, 48,
                               49, 49,
                               50, 50,
                               51, 51,
                               53, 53,
                               54, 54,
                               55, 55,
                               56, 56,
                               57, 57,
                               58, 58,
                               59, 59,
                               60, 60,
                               62, 62,
                               63, 63,
                               64, 64,
                               65, 65,
                               66, 66,
                               67, 67,
                               68, 68,
                               69, 69,
                               71, 71,
                               72, 72,
                               73, 73,
                               74, 74,
                               75, 75,
                               76, 76,
                               77, 77,
                               78, 78,
                               80, 80,
                               81, 81,
                               82, 82,
                               83, 83,
                               84, 84,
                               85, 85,
                               86, 86,
                               88, 88,
                               89, 89,
                               90, 90,
                               91, 91,
                               92, 92,
                               93, 93,
                               94, 94,
                               95, 95,
                               97, 97,
                               98, 98,
                               99, 99,
                               100, 100,
                               101, 101,
                               102, 102,
                               103, 103,
                               104, 104,
                               106, 106,
                               107, 107,
                               108, 108,
                               109, 109,
                               110, 110,
                               111, 111,
                               112, 112,
                               113, 113,
                               115, 115,
                               116, 116,
                               117, 117,
                               118, 118,
                               119, 119,
                               120, 120,
                               121, 121,
                               122, 122,
                               124, 124,
                               125, 125,
                               126, 126,
                               127, 127,
                               128, 128,
                               129, 129,
                               130, 130,
                               132, 132,
                               133, 133,
                               134, 134,
                               135, 135,
                               135, 135,
                               134, 134,
                               133, 133,
                               132, 132,
                               130, 130,
                               129, 129,
                               128, 128,
                               127, 127,
                               126, 126,
                               125, 125,
                               124, 124,
                               122, 122,
                               121, 121,
                               120, 120,
                               119, 119,
                               118, 118,
                               117, 117,
                               116, 116,
                               115, 115,
                               113, 113,
                               112, 112,
                               111, 111,
                               110, 110,
                               109, 109,
                               108, 108,
                               107, 107,
                               106, 106,
                               104, 104,
                               103, 103,
                               102, 102,
                               101, 101,
                               100, 100,
                               99, 99,
                               98, 98,
                               97, 97,
                               95, 95,
                               94, 94,
                               93, 93,
                               92, 92,
                               91, 91,
                               90, 90,
                               89, 89,
                               88, 88,
                               86, 86,
                               85, 85,
                               84, 84,
                               83, 83,
                               82, 82,
                               81, 81,
                               80, 80,
                               78, 78,
                               77, 77,
                               76, 76,
                               75, 75,
                               74, 74,
                               73, 73,
                               72, 72,
                               71, 71,
                               69, 69,
                               68, 68,
                               67, 67,
                               66, 66,
                               65, 65,
                               64, 64,
                               63, 63,
                               62, 62,
                               60, 60,
                               59, 59,
                               58, 58,
                               57, 57,
                               56, 56,
                               55, 55,
                               54, 54,
                               53, 53,
                               51, 51,
                               50, 50,
                               49, 49,
                               48, 48,
                               47, 47,
                               46, 46,
                               45, 45,
                               44, 44,
                               42, 42,
                               41, 41,
                               40, 40,
                               39, 39,
                               38, 38,
                               37, 37,
                               36, 36,
                               34, 34,
                               33, 33,
                               32, 32,
                               31, 31,
                               30, 30,
                               29, 29,
                               28, 28,
                               27, 27,
                               25, 25,
                               24, 24,
                               23, 23,
                               22, 22,
                               21, 21,
                               20, 20,
                               19, 19,
                               18, 18,
                               16, 16,
                               15, 15,
                               14, 14,
                               13, 13,
                               12, 12,
                               11, 11,
                               10, 10,
                               9, 9,
                               7, 7,
                               6, 6,
                               5, 5,
                               4, 4,
                               3, 3,
                               2, 2,
                               1, 1};

#elif N_FIR_TAPS == 240
   #define CHK_CTR 120 // (240 * 2) / 4
   
   uint16_t golden_16b[480] = {1, 1,
                               2, 2,
                               3, 3,
                               4, 4,
                               5, 5,
                               6, 6,
                               7, 7,
                               9, 9,
                               10, 10,
                               11, 11,
                               12, 12,
                               13, 13,
                               14, 14,
                               15, 15,
                               16, 16,
                               18, 18,
                               19, 19,
                               20, 20,
                               21, 21,
                               22, 22,
                               23, 23,
                               24, 24,
                               25, 25,
                               27, 27,
                               28, 28,
                               29, 29,
                               30, 30,
                               31, 31,
                               32, 32,
                               33, 33,
                               34, 34,
                               36, 36,
                               37, 37,
                               38, 38,
                               39, 39,
                               40, 40,
                               41, 41,
                               42, 42,
                               44, 44,
                               45, 45,
                               46, 46,
                               47, 47,
                               48, 48,
                               49, 49,
                               50, 50,
                               51, 51,
                               53, 53,
                               54, 54,
                               55, 55,
                               56, 56,
                               57, 57,
                               58, 58,
                               59, 59,
                               60, 60,
                               62, 62,
                               63, 63,
                               64, 64,
                               65, 65,
                               66, 66,
                               67, 67,
                               68, 68,
                               69, 69,
                               71, 71,
                               72, 72,
                               73, 73,
                               74, 74,
                               75, 75,
                               76, 76,
                               77, 77,
                               78, 78,
                               80, 80,
                               81, 81,
                               82, 82,
                               83, 83,
                               84, 84,
                               85, 85,
                               86, 86,
                               88, 88,
                               89, 89,
                               90, 90,
                               91, 91,
                               92, 92,
                               93, 93,
                               94, 94,
                               95, 95,
                               97, 97,
                               98, 98,
                               99, 99,
                               100, 100,
                               101, 101,
                               102, 102,
                               103, 103,
                               104, 104,
                               106, 106,
                               107, 107,
                               108, 108,
                               109, 109,
                               110, 110,
                               111, 111,
                               112, 112,
                               113, 113,
                               115, 115,
                               116, 116,
                               117, 117,
                               118, 118,
                               119, 119,
                               120, 120,
                               121, 121,
                               122, 122,
                               124, 124,
                               125, 125,
                               126, 126,
                               127, 127,
                               128, 128,
                               129, 129,
                               130, 130,
                               132, 132,
                               133, 133,
                               134, 134,
                               135, 135,
                               135, 135,
                               134, 134,
                               133, 133,
                               132, 132,
                               130, 130,
                               129, 129,
                               128, 128,
                               127, 127,
                               126, 126,
                               125, 125,
                               124, 124,
                               122, 122,
                               121, 121,
                               120, 120,
                               119, 119,
                               118, 118,
                               117, 117,
                               116, 116,
                               115, 115,
                               113, 113,
                               112, 112,
                               111, 111,
                               110, 110,
                               109, 109,
                               108, 108,
                               107, 107,
                               106, 106,
                               104, 104,
                               103, 103,
                               102, 102,
                               101, 101,
                               100, 100,
                               99, 99,
                               98, 98,
                               97, 97,
                               95, 95,
                               94, 94,
                               93, 93,
                               92, 92,
                               91, 91,
                               90, 90,
                               89, 89,
                               88, 88,
                               86, 86,
                               85, 85,
                               84, 84,
                               83, 83,
                               82, 82,
                               81, 81,
                               80, 80,
                               78, 78,
                               77, 77,
                               76, 76,
                               75, 75,
                               74, 74,
                               73, 73,
                               72, 72,
                               71, 71,
                               69, 69,
                               68, 68,
                               67, 67,
                               66, 66,
                               65, 65,
                               64, 64,
                               63, 63,
                               62, 62,
                               60, 60,
                               59, 59,
                               58, 58,
                               57, 57,
                               56, 56,
                               55, 55,
                               54, 54,
                               53, 53,
                               51, 51,
                               50, 50,
                               49, 49,
                               48, 48,
                               47, 47,
                               46, 46,
                               45, 45,
                               44, 44,
                               42, 42,
                               41, 41,
                               40, 40,
                               39, 39,
                               38, 38,
                               37, 37,
                               36, 36,
                               34, 34,
                               33, 33,
                               32, 32,
                               31, 31,
                               30, 30,
                               29, 29,
                               28, 28,
                               27, 27,
                               25, 25,
                               24, 24,
                               23, 23,
                               22, 22,
                               21, 21,
                               20, 20,
                               19, 19,
                               18, 18,
                               16, 16,
                               15, 15,
                               14, 14,
                               13, 13,
                               12, 12,
                               11, 11,
                               10, 10,
                               9, 9,
                               7, 7,
                               6, 6,
                               5, 5,
                               4, 4,
                               3, 3,
                               2, 2,
                               1, 1};

#endif

ap_uint<128> *golden_128b = (ap_uint<128> *) golden_16b;

////////////////////////////////////////////////////////////
// Input to FIR...
////////////////////////////////////////////////////////////
void mm2s(
   hls::stream<ap_axiu<128, 0, 0, 0>> &strmOutToFIR,
   int size
  );

////////////////////////////////////////////////////////////
// Output from FIR...
////////////////////////////////////////////////////////////
void s2mm(
      hls::stream<ap_axiu<128, 0, 0, 0>> &strmInpFromFIR,
      int size, int &errCnt
      );

////////////////////////////////////////////////////////////
// Top Function of Final Datamover unit for design without
// ddr, it provides impulse input and checks for the output
// in pl itself. Done to see the max FIR throughput
// without any NoC/DDR bandwidth bottlenecks...
////////////////////////////////////////////////////////////
int datamover(
      hls::stream<ap_axiu<128, 0, 0, 0>> &strmOutToFIR,
      hls::stream<ap_axiu<128, 0, 0, 0>> &strmInpFromFIR,
      int size, int iterCnt
     );
