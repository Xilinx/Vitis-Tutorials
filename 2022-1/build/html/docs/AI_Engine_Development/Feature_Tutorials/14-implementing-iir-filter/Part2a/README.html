<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Implementing an IIR Filter on the AI Engine - Part 2a &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Main</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Implementing an IIR Filter on the AI Engine - Part 2a</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/14-implementing-iir-filter/Part2a/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Development</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-ai.html">See Vitis-AI™ Development Environment on xilinx.com</a>
    </td>
 </tr>
</table><div class="section" id="implementing-an-iir-filter-on-the-ai-engine-part-2a">
<h1>Implementing an IIR Filter on the AI Engine - Part 2a<a class="headerlink" href="#implementing-an-iir-filter-on-the-ai-engine-part-2a" title="Permalink to this heading">¶</a></h1>
<p><em><strong>Version: Vitis 2022.1</strong></em></p>
<div class="section" id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this heading">¶</a></h2>
<p>In Part 1a, we focused on vectorizing the calculation for a second order section of an IIR filter using Emulation-SW mode. Using eqn. (4) in Part 1a, we saw that we can calculate 8 consecutive outputs by multiplying an 8x12 matrix of constants with a 12x1 vector (composed of 8 consecutive inputs and 4 states).</p>
<p><img alt="Fig. 1" src="../../../../../_images/eqn41.PNG" /></p>
<p>From Fig. 26 of <a class="reference external" href="https://www.xilinx.com/support/documentation/architecture-manuals/am009-versal-ai-engine.pdf">AM009</a>, we can see that the floating-point vector processor can perform 8 multiply-accumulate operations on floating-point operands in 2 cycles, in E6 and E7. Note that the red dashed arrow in the figure indicates the feedback path for the accumulator. Thus, <em>ideally</em>, 12*2=24 cycles would be the minimum required to calculate 8 floating-point outputs.</p>
<p><img alt="Fig. 2" src="../../../../../_images/vfp_pipeline.PNG" /></p>
<p>In this and succeeding sections, we will <em>attempt</em> to minimize latency and maximize throughput while showing the typical steps to analyze and optimize a design.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>The Julia scipt <code class="docutils literal notranslate"><span class="pre">aie_iir_2a.jl</span></code> generates the coefficients for the specified IIR filter, as well as the header file required by the program. It also generates an <a class="reference external" href="https://www.dsprelated.com/freebooks/filters/Impulse_Response_Representation.html">impulse signal</a> and the filter’s response.</p>
<ul>
<li><p>The generated header file should be moved to the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory</p></li>
<li><p>The generated <code class="docutils literal notranslate"><span class="pre">*.dat</span></code> files should be moved to the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory</p></li>
</ul>
</li>
<li><p>The Julia script <code class="docutils literal notranslate"><span class="pre">check.jl</span></code> calculates the difference between the golden impulse response generated by <code class="docutils literal notranslate"><span class="pre">aie_iir_2a.jl</span></code> and the output of the AI engine.</p></li>
</ul>
</div>
<div class="section" id="kernel-code">
<h2>Kernel Code<a class="headerlink" href="#kernel-code" title="Permalink to this heading">¶</a></h2>
<p>As a first step, we use the kernel code shown below.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">id</span><span class="o">&gt;</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="n">SecondOrderSection</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">input_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">idata</span><span class="p">,</span><span class="w">		</span><span class="c1">// 8 input samples per iteration</span>
<span class="w">    </span><span class="n">output_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">odata</span><span class="p">,</span><span class="w"> 	</span><span class="c1">// 8 output samples per iteration</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">)[</span><span class="mi">96</span><span class="p">]</span><span class="w">		</span><span class="c1">// RTP port for coefficient matrix</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">	</span><span class="k">static</span><span class="w"> </span><span class="n">Vector8f</span><span class="w"> </span><span class="n">state_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">zeros</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="o">&gt;</span><span class="p">();</span><span class="w">	</span><span class="c1">// clear states on 1st call</span>

<span class="w">    </span><span class="n">Vector8f</span><span class="w"> </span><span class="n">xreg_hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window_readincr_v</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idata</span><span class="p">);</span><span class="w">		</span><span class="c1">// fetch 8 input samples</span>
<span class="w">	</span><span class="n">Vector16f</span><span class="w"> </span><span class="n">xreg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">concat</span><span class="p">(</span><span class="n">state_reg</span><span class="p">,</span><span class="w"> </span><span class="n">xreg_hi</span><span class="p">);</span><span class="w">	</span><span class="c1">// xreg[4]: ym2; xreg[5]: ym1; xreg[6]: xm2; xreg[7]: xm1; xreg[8:15]: x0:x7</span>
<span class="w">	</span><span class="n">Vector8f</span><span class="w"> </span><span class="n">coeff</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">VAcc8f</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">zeros</span><span class="o">&lt;</span><span class="n">accfloat</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// acc[] = 0</span>

<span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">coeff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">load_v</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">[</span><span class="mi">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">]);</span><span class="w">  </span><span class="c1">// get a column </span>
<span class="w">		</span><span class="kt">float</span><span class="w"> </span><span class="n">xval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">];</span><span class="w">           </span><span class="c1">// aie::mac() requires compile-time constant arguments</span>
<span class="w">		</span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">mac</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">,</span><span class="w"> </span><span class="n">xval</span><span class="p">);</span><span class="w">   </span><span class="c1">// acc[] += coeff[] * xval</span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">Vector8f</span><span class="w"> </span><span class="n">yout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acc</span><span class="p">;</span><span class="w">	</span><span class="c1">// transfer accumulator register to vector register to update states</span>

<span class="w">	</span><span class="c1">// update states</span>
<span class="w">    	</span><span class="n">state_reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xreg_hi</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="n">state_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yout</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span><span class="w"></span>
<span class="w">	</span><span class="n">state_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yout</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="w"></span>

<span class="w">	</span><span class="n">window_writeincr</span><span class="p">(</span><span class="n">odata</span><span class="p">,</span><span class="w"> </span><span class="n">yout</span><span class="p">);</span><span class="w">  </span><span class="c1">// write out 8 samples</span>

<span class="p">}</span><span class="w"> </span><span class="c1">// end SecondOrderSection()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">for</span></code> loop scales each column of the coefficient matrix with an element in <code class="docutils literal notranslate"><span class="pre">xreg</span></code> and accumulates the result. This performs the matrix and vector multiplication in eqn. (4).</p>
</div>
<div class="section" id="testbench-code">
<h2>Testbench Code<a class="headerlink" href="#testbench-code" title="Permalink to this heading">¶</a></h2>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;kernel.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;graph.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;C1.h&quot;</span><span class="cp"></span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">adf</span><span class="p">;</span><span class="w"></span>

<span class="c1">// specify the dataflow graph (DFG)</span>
<span class="n">the_graph</span><span class="w"> </span><span class="n">my_graph</span><span class="p">;</span><span class="w"></span>

<span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">num_pts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">;</span><span class="w">			</span><span class="c1">// number of sample points in &quot;input.dat&quot;</span>
<span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">num_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_pts</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span><span class="w">	</span><span class="c1">// number of iterations to run</span>

<span class="c1">// main simulation program</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">	</span><span class="n">my_graph</span><span class="p">.</span><span class="n">init</span><span class="p">();</span><span class="w">				</span><span class="c1">// load the DFG into the AI engine array, establish     connectivity, etc.</span>

<span class="w">	</span><span class="n">my_graph</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_graph</span><span class="p">.</span><span class="n">cmtx1</span><span class="p">,</span><span class="w"> </span><span class="n">C1</span><span class="p">,</span><span class="w"> </span><span class="mi">96</span><span class="p">);</span><span class="w">	</span><span class="c1">// transfer coefficients</span>

<span class="w">	</span><span class="n">my_graph</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">);</span><span class="w">	</span><span class="c1">// run the DFG for the specified number of iterations</span>

<span class="w">	</span><span class="n">my_graph</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w">					</span><span class="c1">// terminate AI engine processing</span>

<span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// end main()</span>
</pre></div>
</div>
<p>The testbench</p>
<ul class="simple">
<li><p>initializes the graph</p></li>
<li><p>loads the filter coefficients</p></li>
<li><p>runs the graph 32 times</p></li>
<li><p>terminates all processing</p></li>
</ul>
</div>
<div class="section" id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this heading">¶</a></h2>
<p>We begin by setting the <code class="docutils literal notranslate"><span class="pre">Active</span> <span class="pre">build</span> <span class="pre">configuration</span></code> to <code class="docutils literal notranslate"><span class="pre">Emulation-AIE</span></code> and building the design with the default optimization level (xlopt = 1). After a successful build, right-click on <code class="docutils literal notranslate"><span class="pre">aie_iir_2a</span> <span class="pre">[aiengine]</span></code> and select <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">As</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">Launch</span> <span class="pre">AIE</span> <span class="pre">Emulator</span></code>. After a successful simulation, we can now enable profiling. Right-click on <code class="docutils literal notranslate"><span class="pre">aie_iir_2a</span> <span class="pre">[aiengine]</span></code>, select <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">Configurations...</span></code>, and click on <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Profile</span></code> in the <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">Configurations</span></code> window [Note: it may be necessary to increase the height of the <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">Configurations</span></code> window to see the <code class="docutils literal notranslate"><span class="pre">Generate</span> <span class="pre">Profile</span></code> section].</p>
<p><img alt="Fig. 3" src="../../../../../_images/enable_profiling.PNG" /></p>
<p>Click the <code class="docutils literal notranslate"><span class="pre">Run</span></code> button to re-run with profiling enabled.</p>
<p>After the simulation completes, the “goodness” of the result can be checked by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ julia check.jl aie
</pre></div>
</div>
<p>The result is “good” when the <code class="docutils literal notranslate"><span class="pre">maximum(abs.(err))</span></code> is less than <code class="docutils literal notranslate"><span class="pre">eps(Float32)</span></code>.</p>
<p>To view the profiler result, in the <code class="docutils literal notranslate"><span class="pre">Explorer</span></code> pane, expand <code class="docutils literal notranslate"><span class="pre">Emulation-AIE</span></code> and <code class="docutils literal notranslate"><span class="pre">aiesimulator_output</span></code>.</p>
<p><img alt="Fig. 4" src="../../../../../_images/default.aierun_summary.PNG" /></p>
<p>Double-click on <code class="docutils literal notranslate"><span class="pre">default.aierun_summary</span></code> to open the report in <code class="docutils literal notranslate"><span class="pre">Vitis</span> <span class="pre">Analyzer</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">Vitis</span> <span class="pre">Analyzer</span></code> window, click on <code class="docutils literal notranslate"><span class="pre">Profile</span></code> in the browser pane (leftmost pane), then <code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">Function</span> <span class="pre">Time</span></code> to show the number of cycles consumed by each function.</p>
<p><img alt="Fig. 5" src="../../../../../_images/va_fntime.PNG" /></p>
<p>Note that the kernel function, <code class="docutils literal notranslate"><span class="pre">SecondOrderSection&lt;1&gt;</span></code> was executed 32 times and ran for a total of 2,569 cycles. Each function call consumed 2,569/32 = 80.28 cycles. The minimum function time is 80 cycles and the maximum is 89 cycles. This implies that the first call consumed an additional 9 cycles (89 + 31 * 80 = 2,569).</p>
<p>Another item of interest is the top-level <code class="docutils literal notranslate"><span class="pre">main</span></code> function which calls <code class="docutils literal notranslate"><span class="pre">my_graph.run()</span></code>, which in turn, calls <code class="docutils literal notranslate"><span class="pre">SecondOrderSection&lt;1&gt;</span></code>. The <code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">Function</span> <span class="pre">+</span> <span class="pre">Descendants</span> <span class="pre">Time</span> <span class="pre">(cycles)</span></code> column shows the number of cycles consumed by that function, including all other routines called within it. This includes setting up the heap and stack, initialization, actual processing, etc. For this implementation, 4,657 cycles were used to process 256 samples, or 4657/256 = 18.2 cycles/sample. Assuming that the AI engine runs with a 1GHz clock, the throughput is then 1e9 cycles/sec / 18.2 cycles/sample =  54.945Msamples/sec.</p>
<p>Note that the main processing occurs in <code class="docutils literal notranslate"><span class="pre">SecondOrderSection&lt;1&gt;</span></code>, which consumes 2,569 cycles. Thus, there are 4,657 - 2,569 = 2,088 unavoidable “overhead” cycles which are not used for sample processing.</p>
<p>Click on <code class="docutils literal notranslate"><span class="pre">Profile</span> <span class="pre">Details</span></code> to view the generated assembly code.</p>
<p><img alt="Fig. 6" src="../../../../../_images/profile_details.PNG" /></p>
<p>Scroll down to where the <code class="docutils literal notranslate"><span class="pre">VFPMAC</span></code> assembler mnemonics become visible.</p>
<p><img alt="Fig. 7" src="../../../../../_images/vfpmac.PNG" /></p>
<p>From the kernel code, note that the statement:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aie</span><span class="o">::</span><span class="n">mac</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">,</span><span class="w"> </span><span class="n">xval</span><span class="p">);</span><span class="w">   </span><span class="c1">// acc[] += coeff[] * xval</span>
</pre></div>
</div>
<p>generates the <code class="docutils literal notranslate"><span class="pre">VFPMAC</span></code> mnemonic (vector floating-point multiply-accumulate). Also note that the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop has been unrolled, and that there is a <code class="docutils literal notranslate"><span class="pre">NOP</span></code> (no operation) between each <code class="docutils literal notranslate"><span class="pre">VFPMAC</span></code> to account for the 2-cycle floating-point accumulation latency.</p>
<p><code class="docutils literal notranslate"><span class="pre">VFPMAC</span></code> uses a 1024-bit <code class="docutils literal notranslate"><span class="pre">y</span></code> register as an input buffer (see Table 9 of <a class="reference external" href="https://www.xilinx.com/support/documentation/architecture-manuals/am009-versal-ai-engine.pdf">AM009</a>).</p>
<p><img alt="Fig. 8" src="../../../../../_images/vector_regs.PNG" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">ya</span></code> register is composed of the 256-bit <code class="docutils literal notranslate"><span class="pre">wr[0:3]</span></code> registers. For this example, the <code class="docutils literal notranslate"><span class="pre">wr0</span></code> register is updated with the columns of the coefficient matrix using the <code class="docutils literal notranslate"><span class="pre">VLDA</span></code> (vector load A) mnemonic. The <code class="docutils literal notranslate"><span class="pre">VLDA</span></code> mnemonic transfers 8 floating-point values from data memory to a vector register. In this example, there is a 7 cycle latency from the <code class="docutils literal notranslate"><span class="pre">VLDA</span></code> mnemonic (loading data into <code class="docutils literal notranslate"><span class="pre">wr0</span></code>) to the time the data is used for computation with <code class="docutils literal notranslate"><span class="pre">VFPMAC</span></code>.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>We showed how to calculate a floating-point 8x12 matrix and 12x1 vector multiplication using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and some high-level intrinsics (AI engine APIs) in 80 cycles. We also showed how to use Vitis Analyzer to view some statistics of the generated program (e.g. cycles consumed) as well as examine the generated assembler code.</p>
<p>In Part 2b, we will attempt to further optimize the program to achieve a multiply-accumulate operation on every cycle.</p>
</div>
</div>
<div class="section" id="support">
<h1>Support<a class="headerlink" href="#support" title="Permalink to this heading">¶</a></h1>
<p>GitHub issues will be used for tracking requests and bugs. For questions go to <a class="reference external" href="http://forums.xilinx.com/">forums.xilinx.com</a>.</p>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"><sup>&copy; Copyright 2021 Xilinx, Inc.</sup></p></div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc..
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>