<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Initialization &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Main</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Initialization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/15-post-link-recompile/VitisMakefile_Flow.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table>
 <tr>
   <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>Post-Link Recompile of an AI Engine Application</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h1>Lab 2: Vitis Makefile Flow</h1>
 </td>
 </tr></table><div class="section" id="initialization">
<h1>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading">¶</a></h1>
<p>All labs rely on a set of source files that are available in the <code class="docutils literal notranslate"><span class="pre">Files</span></code> sub-directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AIE</span></code> contains the source files for the AI Engine application.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AIE2</span></code> contains the source files for the AI Engine application with location constraints for one of the AI Engine kernels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Constraints</span></code> contains the PLIO constraints file for the second phase.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> contains data files used to verify application functionality.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HwLink</span></code> contains a system configuration file to link AI Engine and PL kernels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PL</span></code> contains all PL kernels (<code class="docutils literal notranslate"><span class="pre">mm2s</span></code>, <code class="docutils literal notranslate"><span class="pre">s2mm</span></code>, and <code class="docutils literal notranslate"><span class="pre">polar_clip</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PS</span></code> contains the host (A72) application that runs the PL kernels, launches the graph, and verifies the output.</p></li>
</ul>
<p>Go to the lab directory:</p>
<div class="highlight-BASH notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> WithIntermediatePlatform
</pre></div>
</div>
</div>
<div class="section" id="phase-1-creating-a-fixed-platform-from-an-ai-engine-application-and-pl-kernels">
<h1>Phase 1: Creating a Fixed Platform from an AI Engine Application and PL Kernels<a class="headerlink" href="#phase-1-creating-a-fixed-platform-from-an-ai-engine-application-and-pl-kernels" title="Permalink to this heading">¶</a></h1>
<p>This lab uses the same files as the <a class="reference internal" href="VitisIDE_Flow.html"><span class="doc">Vitis IDE flow</span></a>, but all the operations are completed within a terminal.</p>
<ol>
<li><p>To complete phase 1, change directory: <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">Phase1</span></code>.</p>
<p>This directory contains a single file, which is a Makefile. Open it in any editor or display it in the terminal using <code class="docutils literal notranslate"><span class="pre">more</span></code>, <code class="docutils literal notranslate"><span class="pre">less</span></code>, or <code class="docutils literal notranslate"><span class="pre">cat</span></code>. The Makefile contains three stages:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">kernels</span></code>: To build the PL kernels. The output is a number of XO files, which are packaged RTL kernels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aie</span></code>: To build the AI Engine graph. The output is the file <code class="docutils literal notranslate"><span class="pre">libadf.a</span></code>, which is the compiled graph with all the PL/AI Engine interfaces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">link</span></code>: To link the AI Engine array design with the PL design. This stage creates the XCLBIN and the XSA files.</p></li>
</ul>
</li>
</ol>
<p>There are also optional stages to simulate the AI Engine application using the <code class="docutils literal notranslate"><span class="pre">aiesim</span></code> target and <code class="docutils literal notranslate"><span class="pre">run_emu</span></code> to launch hardware emulation that includes all the PL kernels.</p>
<p>The platform directory, <code class="docutils literal notranslate"><span class="pre">$PLATFORM_REPO_PATHS</span></code> is initialized in  <code class="docutils literal notranslate"><span class="pre">env_setup.h</span></code>. It should contain the platform <strong>xilinx_vck190_base_202210_1</strong>.</p>
<p>In the terminal, type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span> <span class="pre">phase1</span></code> and all the required stages (<code class="docutils literal notranslate"><span class="pre">kernels</span></code>, <code class="docutils literal notranslate"><span class="pre">aie</span></code>, and <code class="docutils literal notranslate"><span class="pre">link</span></code>) will be run in the terminal as well as hardware emulation (<code class="docutils literal notranslate"><span class="pre">package</span></code> and <code class="docutils literal notranslate"><span class="pre">run_emu</span></code>).</p>
<p>Check the placement of the AI Engine kernels using Vitis Analyzer and opening the <code class="docutils literal notranslate"><span class="pre">graph.aiecompile_summary</span></code> file.</p>
<p><strong>Note:</strong> The hardware emulation does not launch automatically. You have to launch it manually.</p>
<p>The following is the last message in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>  <span class="n">OK</span>  <span class="p">]</span> <span class="n">Mounted</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">mmcblk0p1</span><span class="o">.</span>
<span class="p">[</span>  <span class="n">OK</span>  <span class="p">]</span> <span class="n">Finished</span> <span class="n">Record</span> <span class="n">Runlevel</span> <span class="n">Change</span> <span class="ow">in</span> <span class="n">UTMP</span><span class="o">.</span>

<span class="n">PetaLinux</span> <span class="mf">2022.1</span><span class="n">_release_S03221922</span> <span class="n">versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">20221</span> <span class="n">ttyAMA0</span>

<span class="n">versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">20221</span> <span class="n">login</span><span class="p">:</span> <span class="n">root</span> <span class="p">(</span><span class="n">automatic</span> <span class="n">login</span><span class="p">)</span>

<span class="p">[</span>   <span class="mf">69.227997</span><span class="p">]</span> <span class="n">audit</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1006</span> <span class="n">audit</span><span class="p">(</span><span class="mf">1648486440.428</span><span class="p">:</span><span class="mi">2</span><span class="p">):</span> <span class="n">pid</span><span class="o">=</span><span class="mi">596</span> <span class="n">uid</span><span class="o">=</span><span class="mi">0</span> <span class="n">old</span><span class="o">-</span><span class="n">auid</span><span class="o">=</span><span class="mi">4294967295</span> <span class="n">auid</span><span class="o">=</span><span class="mi">0</span> <span class="n">tty</span><span class="o">=</span><span class="p">(</span><span class="n">none</span><span class="p">)</span> <span class="n">old</span><span class="o">-</span><span class="n">ses</span><span class="o">=</span><span class="mi">4294967295</span> <span class="n">ses</span><span class="o">=</span><span class="mi">1</span> <span class="n">res</span><span class="o">=</span><span class="mi">1</span>
<span class="p">[</span>   <span class="mf">69.233487</span><span class="p">]</span> <span class="n">audit</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1300</span> <span class="n">audit</span><span class="p">(</span><span class="mf">1648486440.428</span><span class="p">:</span><span class="mi">2</span><span class="p">):</span> <span class="n">arch</span><span class="o">=</span><span class="n">c00000b7</span> <span class="n">syscall</span><span class="o">=</span><span class="mi">64</span> <span class="n">success</span><span class="o">=</span><span class="n">yes</span> <span class="n">exit</span><span class="o">=</span><span class="mi">1</span> <span class="n">a0</span><span class="o">=</span><span class="mi">8</span> <span class="n">a1</span><span class="o">=</span><span class="n">fffff3d2d410</span> <span class="n">a2</span><span class="o">=</span><span class="mi">1</span> <span class="n">a3</span><span class="o">=</span><span class="n">ffffba2fa6b0</span> <span class="n">items</span><span class="o">=</span><span class="mi">0</span> <span class="n">ppid</span><span class="o">=</span><span class="mi">1</span> <span class="n">pid</span><span class="o">=</span><span class="mi">596</span> <span class="n">auid</span><span class="o">=</span><span class="mi">0</span> <span class="n">uid</span><span class="o">=</span><span class="mi">0</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span> <span class="n">euid</span><span class="o">=</span><span class="mi">0</span> <span class="n">suid</span><span class="o">=</span><span class="mi">0</span> <span class="n">fsuid</span><span class="o">=</span><span class="mi">0</span> <span class="n">egid</span><span class="o">=</span><span class="mi">0</span> <span class="n">sgid</span><span class="o">=</span><span class="mi">0</span> <span class="n">fsgid</span><span class="o">=</span><span class="mi">0</span> <span class="n">tty</span><span class="o">=</span><span class="p">(</span><span class="n">none</span><span class="p">)</span> <span class="n">ses</span><span class="o">=</span><span class="mi">1</span> <span class="n">comm</span><span class="o">=</span><span class="s2">&quot;(systemd)&quot;</span> <span class="n">exe</span><span class="o">=</span><span class="s2">&quot;/lib/systemd/systemd&quot;</span> <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="p">[</span>   <span class="mf">69.234988</span><span class="p">]</span> <span class="n">audit</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1327</span> <span class="n">audit</span><span class="p">(</span><span class="mf">1648486440.428</span><span class="p">:</span><span class="mi">2</span><span class="p">):</span> <span class="n">proctitle</span><span class="o">=</span><span class="s2">&quot;(systemd)&quot;</span>
<span class="n">root</span><span class="nd">@versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">20221</span><span class="p">:</span><span class="o">~</span><span class="c1">#</span>
</pre></div>
</div>
<p>To launch the simulation, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">mmcblk0p1</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>At the end of the simulation the following message is displayed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mm2s</span> <span class="p">(</span><span class="n">DataIn1</span><span class="p">)</span> <span class="n">completed</span> <span class="k">with</span> <span class="n">status</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">[</span><span class="mf">59672.228524</span><span class="p">]</span> <span class="n">zocl</span><span class="o">-</span><span class="n">drm</span> <span class="n">axi</span><span class="p">:</span><span class="n">zyxclmm_drm</span><span class="p">:</span>  <span class="n">ffff0008003cd410</span> <span class="n">kds_del_context</span><span class="p">:</span> <span class="n">Client</span> <span class="n">pid</span><span class="p">(</span><span class="mi">2424</span><span class="p">)</span> <span class="k">del</span> <span class="n">context</span> <span class="n">CU</span><span class="p">(</span><span class="mh">0x1</span><span class="p">)</span>
<span class="n">polar_clip</span> <span class="n">completed</span> <span class="k">with</span> <span class="n">status</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">[</span><span class="mf">59672.230697</span><span class="p">]</span> <span class="n">zocl</span><span class="o">-</span><span class="n">drm</span> <span class="n">axi</span><span class="p">:</span><span class="n">zyxclmm_drm</span><span class="p">:</span>  <span class="n">ffff0008003cd410</span> <span class="n">kds_del_context</span><span class="p">:</span> <span class="n">Client</span> <span class="n">pid</span><span class="p">(</span><span class="mi">2424</span><span class="p">)</span> <span class="k">del</span> <span class="n">context</span> <span class="n">CU</span><span class="p">(</span><span class="mh">0x2</span><span class="p">)</span>
<span class="n">s2mm</span> <span class="p">(</span><span class="n">DataOut1</span><span class="p">)</span> <span class="n">completed</span> <span class="k">with</span> <span class="n">status</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="p">[</span><span class="mf">59674.351664</span><span class="p">]</span> <span class="n">zocl</span><span class="o">-</span><span class="n">drm</span> <span class="n">axi</span><span class="p">:</span><span class="n">zyxclmm_drm</span><span class="p">:</span>  <span class="n">ffff0008003cd410</span> <span class="n">kds_del_context</span><span class="p">:</span> <span class="n">Client</span> <span class="n">pid</span><span class="p">(</span><span class="mi">2424</span><span class="p">)</span> <span class="k">del</span> <span class="n">context</span> <span class="n">CU</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">)</span>
<span class="p">[</span><span class="mf">59674.353188</span><span class="p">]</span> <span class="n">zocl</span><span class="o">-</span><span class="n">drm</span> <span class="n">axi</span><span class="p">:</span><span class="n">zyxclmm_drm</span><span class="p">:</span>  <span class="n">ffff0008003cd410</span> <span class="n">kds_del_context</span><span class="p">:</span> <span class="n">Client</span> <span class="n">pid</span><span class="p">(</span><span class="mi">2424</span><span class="p">)</span> <span class="k">del</span> <span class="n">context</span> <span class="n">CU</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span>
<span class="n">TEST</span> <span class="n">PASSED</span>
<span class="n">Releasing</span> <span class="n">remaining</span> <span class="n">XRT</span> <span class="n">objects</span><span class="o">...</span>
<span class="p">[</span><span class="mf">59674.355157</span><span class="p">]</span> <span class="p">[</span><span class="n">drm</span><span class="p">]</span> <span class="n">bitstream</span> <span class="mi">8</span><span class="n">ae06494</span><span class="o">-</span><span class="mi">3226</span><span class="o">-</span><span class="n">bda4</span><span class="o">-</span><span class="mi">94</span><span class="n">c7</span><span class="o">-</span><span class="mf">906e136725</span><span class="n">ad</span> <span class="n">unlocked</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="mi">0</span>
<span class="p">[</span><span class="mf">59674.452197</span><span class="p">]</span> <span class="n">zocl</span><span class="o">-</span><span class="n">drm</span> <span class="n">axi</span><span class="p">:</span><span class="n">zyxclmm_drm</span><span class="p">:</span> <span class="n">zocl_destroy_client</span><span class="p">:</span> <span class="n">client</span> <span class="n">exits</span> <span class="n">pid</span><span class="p">(</span><span class="mi">2424</span><span class="p">)</span>
<span class="n">root</span><span class="nd">@versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">20221</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">mmcblk0p1</span><span class="c1">#</span>
</pre></div>
</div>
<p>You can get out of QEMU by hitting <strong>Ctrl</strong> + <strong>a x</strong>.</p>
</div>
<div class="section" id="phase-2-using-a-platform-generated-by-vitis-and-modifying-the-ai-engine-application">
<h1>Phase 2: Using a Platform Generated by Vitis and Modifying the AI Engine Application<a class="headerlink" href="#phase-2-using-a-platform-generated-by-vitis-and-modifying-the-ai-engine-application" title="Permalink to this heading">¶</a></h1>
<p>Phase 2 contains the following stages:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pfm</span></code>: Create a fixed platform with the AI Engine and PS domains. The PS domain is a Linux-based OS that uses XRT to control the PL and the AI Engine kernels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aie2</span></code>: As in the previous phase, this stage builds an AI Engine application, but in this case it uses the new platform constraints.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: Compile the PS application.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">package2</span></code>: Create the PDI to load onto the device (<code class="docutils literal notranslate"><span class="pre">hw_emu</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_emu</span></code>: Launch the simulation and verifies that the output is still correct.</p></li>
</ol>
<p>Platform creation is based on a base platform which is specified in the <code class="docutils literal notranslate"><span class="pre">env_setup.sh</span></code> file:</p>
<div class="highlight-BASH notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PFM_NAME</span><span class="o">=</span>xilinx_vck190_base_202210_1
</pre></div>
</div>
<p>Generic Versal and specific platform directories are defined in the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>:</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Platform</span>
<span class="nv">VERSAL_SW</span> <span class="o">:=</span> <span class="si">${</span><span class="nv">PLATFORM_DIR</span><span class="si">}</span>/sw/versal/xilinx-versal-common-v2022.1
<span class="nv">BASE_PLATFORM</span> <span class="o">:=</span> <span class="si">${</span><span class="nv">PLATFORM_DIR</span><span class="si">}</span>/<span class="k">$(</span>PFM_NAME<span class="k">)</span>/<span class="k">$(</span>PFM_NAME<span class="k">)</span>.xpfm
<span class="nv">PLATFORM_SW</span> <span class="o">:=</span> <span class="si">${</span><span class="nv">PLATFORM_DIR</span><span class="si">}</span>/<span class="k">$(</span>PFM_NAME<span class="k">)</span>/sw/<span class="k">$(</span>PFM_NAME<span class="k">)</span>

<span class="nv">IMAGE</span>   <span class="o">:=</span> <span class="si">${</span><span class="nv">PLATFORM_REPO_PATHS</span><span class="si">}</span>/sw/versal/xilinx-versal-common-v2022.1/Image
</pre></div>
</div>
<p>The new platform is named <code class="docutils literal notranslate"><span class="pre">Phase1_container</span></code> and is located in the directory <code class="docutils literal notranslate"><span class="pre">platform_repo</span></code>:</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># New platform</span>
<span class="nv">PFM</span> <span class="o">:=</span> Phase1_container
<span class="c"># Phase 1 output</span>
<span class="nv">XCLBIN</span> <span class="o">:=</span> ../Phase1/<span class="k">$(</span>PFM<span class="k">)</span>.xclbin
<span class="nv">XSA</span>    <span class="o">:=</span> ../Phase1/<span class="k">$(</span>PFM<span class="k">)</span>.xsa

<span class="c"># Phase 2 platform creation output</span>
<span class="nv">NEW_PLATFORM</span> <span class="o">:=</span> ./platform_repo/<span class="k">$(</span>PFM<span class="k">)</span>/export/<span class="k">$(</span>PFM<span class="k">)</span>/<span class="k">$(</span>PFM<span class="k">)</span>.xpfm
<span class="nv">NEW_PLATFORM_SW</span> <span class="o">:=</span> ./platform_repo/<span class="k">$(</span>PFM<span class="k">)</span>/export/<span class="k">$(</span>PFM<span class="k">)</span>/sw/<span class="k">$(</span>PFM<span class="k">)</span>

<span class="nv">NEW_ROOTFS</span> <span class="o">:=</span> <span class="k">$(</span>NEW_PLATFORM_SW<span class="k">)</span>/xrt/rootfs/rootfs.ext4
<span class="nv">NEW_SYSROOT</span> <span class="o">:=</span> <span class="k">$(</span>NEW_PLATFORM_SW<span class="k">)</span>/xrt/sysroot
</pre></div>
</div>
<p>The new platform is created by a Tcl file (<code class="docutils literal notranslate"><span class="pre">xsct_create_pfm.tcl</span></code>) run by <code class="docutils literal notranslate"><span class="pre">xsct</span></code>. This file is divided into multiple parts:</p>
<ul class="simple">
<li><p>Set the directory names based on the Versal software and VCK190 platform directory.</p></li>
<li><p>Create the platform.</p></li>
<li><p>Create and configure the AI Engine domain.</p></li>
<li><p>Create and configure the A72 domain.</p></li>
<li><p>Generate the platform based on all configurations.</p></li>
</ul>
<p>The second stage, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">aie2</span></code>, consists of generating the AI Engine application graph. The kernel itself has not changed but a kernel location constraint has been added to the graph so that you can see a big difference in the kernel placement. Check this new placement using Vitis Analyzer on the compile summary.</p>
<p>The third stage, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">host</span></code>, is straightforward and you can see that the first object file that is created is <code class="docutils literal notranslate"><span class="pre">aie_control_xrt.o</span></code>. It is built from the CPP file that has been generated by the second stage.</p>
<p>The fourth stage, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">package2</span></code>, has a number of outputs. Among them is a file named <code class="docutils literal notranslate"><span class="pre">launch_hw_emu.sh</span></code>, which is used to run the hardware emulation in the last stage.</p>
<p>The fifth and final stage, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">run_emu</span></code>, starts the hardware emulation that will also verify the correctness of the output.</p>
</div>
<div class="section" id="perform-on-board-testing">
<h1>Perform On-Board Testing<a class="headerlink" href="#perform-on-board-testing" title="Permalink to this heading">¶</a></h1>
<ol class="simple">
<li><p>To perform on-board testing, the same stages can be replicated but with a different target:</p></li>
</ol>
<ul class="simple">
<li><p>For phase 1, type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TARGET=hw</span> <span class="pre">clean</span> <span class="pre">phase1</span></code>.</p></li>
<li><p>For phase 2, type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TARGET=hw</span> <span class="pre">phase2</span></code>.</p></li>
</ul>
<ol class="simple">
<li><p>When the phase 2 process is finished, an <code class="docutils literal notranslate"><span class="pre">sd_card.img</span></code> file has been created and can be used as in the <a class="reference internal" href="DirectRecompileMakefile_Flow.html"><span class="doc">Direct Recompile Makefile</span></a> flow.</p></li>
<li><p>To launch the program on the board, type the following command:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">mmcblk0p1</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<div class="section" id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this heading">¶</a></h2>
<p>GitHub issues will be used for tracking requests and bugs. For questions go to <a class="reference external" href="http://forums.xilinx.com/">forums.xilinx.com</a>.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h2>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"><sup>XD039 | &copy; Copyright 2021–2022 Xilinx, Inc.</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc..
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>