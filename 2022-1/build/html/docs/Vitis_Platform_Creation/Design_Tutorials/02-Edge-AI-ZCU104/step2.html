<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Step 2: Create Vitis Software Platform &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Main</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Step 2: Create Vitis Software Platform</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Vitis_Platform_Creation/Design_Tutorials/02-Edge-AI-ZCU104/step2.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--
# Copyright 2020 Xilinx Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
--><div class="section" id="step-2-create-vitis-software-platform">
<h1>Step 2: Create Vitis Software Platform<a class="headerlink" href="#step-2-create-vitis-software-platform" title="Permalink to this heading">¶</a></h1>
<p>In this step, we will create a Vitis platform running Linux operation system. The Vitis platform requires several software components which need to be prepared in advance. Since Xilinx provides common software images for quick evaluation. Therefore we will utilize the common image for a quick start. DTB file is not prepared in the common image package as different platforms have different device peripherals. So we will use <code class="docutils literal notranslate"><span class="pre">createdts</span></code> command to generate the device tree file for our platform. Certainly, if you need to customize the system image like kernel or rootfs you can refer to the <a class="reference internal" href="../../Feature_Tutorials/02_petalinux_customization/README.html"><span class="doc">PetaLinux customization page</span></a> for customization. Below are the software components we need for our platform and its provenance.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Component</th>
<th>Conventional Path or Filename</th>
<th>Description</th>
<th>Provenance</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boot components in BOOT.BIN</td>
<td>boot/fsbl.elf</td>
<td>First stage boot loader</td>
<td>Generated with platform creation</td>
</tr>
<tr>
<td>Boot components in BOOT.BIN</td>
<td>boot/pmufw.elf</td>
<td>Chip internal power and security related management</td>
<td>Generated with platform creation</td>
</tr>
<tr>
<td>Boot components in BOOT.BIN</td>
<td>boot/bl31.elf</td>
<td>ARM trusted firmware/ secure monitor</td>
<td>Extracted from common image</td>
</tr>
<tr>
<td>Boot components in BOOT.BIN</td>
<td>boot/u-boot.elf</td>
<td>Second stage boot loader</td>
<td>Extracted from common image</td>
</tr>
<tr>
<td>Boot components in BOOT.BIN</td>
<td>boot/system.dtb</td>
<td>Device tree information file</td>
<td>Generated from "createdts" command</td>
</tr>
<tr>
<td>Boot components in FAT32 partition of SD card</td>
<td>sd_dir/boot.scr</td>
<td>U-boot configuration file to store in FAT32 partition of SD card</td>
<td>Extracted from common image</td>
</tr>
<tr>
<td>Linux Software Components</td>
<td>sw_comp/Image</td>
<td>Linux kernel  Image</td>
<td>Extracted from common image</td>
</tr>
<tr>
<td>Linux Software Components</td>
<td>sw_comp/rootfs.ext4</td>
<td>Linux file system</td>
<td>Extracted from common image</td>
</tr>
<tr>
<td>Linux SDK</td>
<td>sysroot</td>
<td>Cross compile and header files</td>
<td>Extracted from common image</td>
</tr>
</tbody>
</table><p>As most of the components are extracted from the common image package we will prepare the common image first.</p>
<div class="section" id="prepare-the-common-images">
<h2>Prepare the common images<a class="headerlink" href="#prepare-the-common-images" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Download common image from <a class="reference external" href="https://www.xilinx.com/support/download.html">Xilinx website download page.</a>  go to the <strong>WorkSpace</strong> folder we created in step1 and Place the image package in <strong>WorkSpace</strong> folder like below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> WorkSpace
tree -L <span class="m">1</span>     <span class="c1"># to see the directory hierarchy</span>
</pre></div>
</div>
<p><img alt="step2_common_image.PNG" src="../../../../_images/step2_common_image.PNG" /></p>
</li>
<li><p>Extract the common image.</p>
<p>We will create one folder named <strong>zcu104_software_platform</strong> to store the work content for this step2. Then the coming operations and products will be stored in this folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir zcu104_software_platform
<span class="nb">cd</span> zcu104_software_platform
tar xvf ../xilinx-zynqmp-common-v2022.1.tar.gz -C .
</pre></div>
</div>
<p>you can see <strong>xilinx-zynqmp-common-v2022.1</strong> folder which contains some components located in <strong>zcu104_software_platform</strong> folder like below.</p>
<p><img alt="common_image_content.PNG" src="../../../../_images/common_image_content.PNG" /></p>
</li>
</ol>
<p>From the above picture, you can see boot file, kernel image, rootfs and SDK tool are ready. DTB and first stage boot related files are not available. Since Vitis can generate FSBL and PMU firmware by enabling the option of <strong>Generate boot components</strong> when creating a platform. We will create a Vitis platform and enable the option of <strong>Generate boot components</strong> to generate the FSBL and PMU firmware.</p>
</div>
<div class="section" id="create-fsbl-and-pmu-firmware">
<h2>Create FSBL and PMU firmware<a class="headerlink" href="#create-fsbl-and-pmu-firmware" title="Permalink to this heading">¶</a></h2>
<p>As mentioned above we will create a Vitis Platform to obtain FSBL and PMU firmware. Using Vitis IDE and XSCT command both are capable of creating this platform. However, Vitis IDE can only support one XSA file as input. If your design has two XSA (hw and hw-emu), please use XSCT to create the platform.</p>
 <details> <summary><strong>Click here to expand the detailed steps using Vitis IDE to create a Vitis platform</strong></summary>  <ol class="simple">
<li><p>Launch Vitis IDE</p></li>
</ol>
<ul>
<li><p>Prepare Vitis environment</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;Vitis_tool_install_dir&gt;/settings64.sh
</pre></div>
</div>
</li>
<li><p>Launch Vitis by typing <code class="docutils literal notranslate"><span class="pre">vitis</span> <span class="pre">&amp;</span></code> in the console.</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">zcu104_software_platform</span></code> folder as workspace directory.</p></li>
</ul>
<ol class="simple">
<li><p>Create a new platform project</p></li>
</ol>
<ul class="simple">
<li><p>Select menu <strong>File &gt; New &gt; Platform Project</strong> to create a platform project.</p></li>
<li><p>Enter the project name. For this example, type <code class="docutils literal notranslate"><span class="pre">zcu104_custom_fsbl</span></code>. Click <strong>Next</strong>.</p></li>
<li><p>In the Platform page,</p>
<ul>
<li><p>Click <strong>Browse</strong> button, select the XSA file generated by the Vivado. In this case, it is <code class="docutils literal notranslate"><span class="pre">zcu104_custom_platform_hw.xsa</span></code>.</p></li>
<li><p>Set the operating system to <strong>standalone</strong>.</br></p></li>
<li><p>Set the processor to <strong>psu_cortexa53_0</strong>.</br></p></li>
<li><p>Set the architecture to <strong>64-bit</strong>.</br></p></li>
<li><p>Check the option <strong>Generate boot components</strong>, because the auto generated FSBL and PMU firmware are our goals.</br></p></li>
<li><p>Click <strong>Finish</strong>.</p></li>
</ul>
</li>
</ul>
<ol class="simple">
<li><p>Click <strong>zcu104_custom_fsbl</strong> project in the Vitis Explorer view, click the <strong>Build</strong> button to generate the platform.</p></li>
</ol>
<p>After building we can get FSBL and PMU firmware.</p>
 </details> <details> <summary><strong>Click here to expand the detailed steps using XSCT to create a Vitis platform</strong></summary>  <p>Create a tcl file with XSCT commands. For example, here is the parts of <a class="reference external" href="./ref_files/step2_pfm/xsct_create_pfm.tcl">xsct_create_pfm.tcl</a></p>
<div class="highlight-Tcl notranslate"><div class="highlight"><pre><span></span>setws .
#set OUTPUT platform_repo
platform create -name $platform_name \
    -desc &quot;A custom platform ZCU104 platform&quot; \
    -hw ${xsa_path}/${xsa_name}_hw.xsa \
    -hw_emu ${xsa_path}/${xsa_name}_hwemu.xsa \
    -fsbl-target psu_cortexa53_0 \
#    -out ./${OUTPUT} 
 
# standalone domain
domain create -name standalone -proc psu_cortexa53_0 -os standalone -arch {64-bit} 
# Linux domain
#domain create -name xrt -proc psu_cortexa53 -os linux -arch {64-bit} -runtime {ocl} -sd-dir {./sd_dir}  -bootmode {sd}
# domain active xrt
#domain config -boot {./boot}
#domain config -generate-bif
#domain config -qemu-data ./boot

platform write
platform generate
</pre></div>
</div>
<blockquote>
<div><p>Note: Please replace the file name and directory name in the script with your project file location.</p>
</div></blockquote>
<blockquote>
<div><p>Note: If you don’t need to support hardware emulation, you can omit the option <code class="docutils literal notranslate"><span class="pre">-hw_emu</span></code> and its value for the command <code class="docutils literal notranslate"><span class="pre">platform</span> <span class="pre">create</span></code>.</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">platform</span> <span class="pre">create</span></code> command needs the following input values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-name</span></code>: Platform name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hw</span></code>: Hardware XSA file location</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hw_emu</span></code>: Hardware emulation XSA file location</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-out</span></code>: platform output path  #if you use <code class="docutils literal notranslate"><span class="pre">setws</span></code> to specify the workspace there is no need for this option</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-sd-dir</span></code>: the directory that contains the files to be included in the FAT32 partition of the SD card image.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fsbl-target</span></code>: specify the CPU core and generate corresponding FSBL and PMU image.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">domain</span></code> command will setup a standalone domain or  the Linux domain with SD boot mode. It will use files in <code class="docutils literal notranslate"><span class="pre">./sd_dir</span></code> to form the FAT32 partition of the SD card image and files in <code class="docutils literal notranslate"><span class="pre">./boot</span></code> directory to generate boot.bin.</p>
<p>You can pass the values to the script directly by replacing the variable with the actual value, or define them in the header of the tcl script, or pass the value to XSCT when calling this script.</p>
<p>Here’s an example of calling XSCT if you hardcode all contents in xsct_create_pfm.tcl.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xsct xsct_create_pfm.tcl
</pre></div>
</div>
<p>To support better generalization, the example <a class="reference external" href="./ref_files/step2_pfm/Makefile">Makefile</a> and <a class="reference external" href="./ref_files/step2_pfm/xsct_create_pfm.tcl">xsct_create_pfm.tcl</a> in ref_files directory use variables to represent the file names and directory location. Please refer to them if you would like to get more programmability in your scripts.</p>
</details><p>In this step, we create a platform to get FSBL and PMU firmware. We will add all the components to the platform in the last step. The rest file we need to prepare is the DTB file.</p>
</div>
<div class="section" id="create-the-device-tree-file">
<h2>Create the device tree file<a class="headerlink" href="#create-the-device-tree-file" title="Permalink to this heading">¶</a></h2>
<p>Utilize XSCT tool to execute one command to generate device tree files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform
xsct 
</pre></div>
</div>
<p>Then execute <code class="docutils literal notranslate"><span class="pre">createdts</span></code> command in XSCT console like below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>createdts -hw ../zcu104_hardware_platform/zcu104_custom_platform.xsa -zocl  -platform-name mydevice <span class="se">\</span>
 -git-branch xlnx_rel_v2022.1 -board  zcu104-revc -compile
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">createdts</span></code> command needs the following input values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-name</span></code>: Platform name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hw</span></code>: Hardware XSA file with path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-git-branch</span></code>: device tree branch</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-board</span></code>: board name of the device. You can check the board name at <DTG Repo>/device_tree/data/kernel_dtsi.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-zocl</span></code>: enable the zocl driver support</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-compile</span></code>: specify the option to compile the device tree</p></li>
</ul>
<p>Notice below information would show in XSCT console. Please ignore the warning and that means you succeed to get system.dtb file which is located in &lt;mydevice/psu_cortexa53_0/device_tree_domain/bsp&gt;.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pl.dtsi:9.21-32.4: Warning <span class="o">(</span>unit_address_vs_reg<span class="o">)</span>: /amba_pl@0: node has a unit name, but no reg property                                                      
system-top.dts:26.9-29.4: Warning <span class="o">(</span>unit_address_vs_reg<span class="o">)</span>: /memory: node has a reg or ranges property, but no unit name
zynqmp.dtsi:790.43-794.6: Warning <span class="o">(</span>pci_device_reg<span class="o">)</span>: /axi/pcie@fd0e0000/legacy-interrupt-controller: missing PCI reg property
pl.dtsi:27.26-31.5: Warning <span class="o">(</span>simple_bus_reg<span class="o">)</span>: /amba_pl@0/misc_clk_0: missing or empty reg/ranges property
</pre></div>
</div>
<blockquote>
<div><p>Note: Createdts is a command executing in XSCT console to generate device files. This command needs several inputs to generate the device tree files. Regarding the meaning of every option you can execute help command to check the details. Besides XSCT is a Console tool of Vitis. You can start it by typing <code class="docutils literal notranslate"><span class="pre">xsct</span></code> in Linux terminal to start it according to above operation. Or, you can select menu **Xilinx &gt; XSCT Console ** to start the XSCT tool after you launch Vitis.</p>
</div></blockquote>
<p>Execute the following command to exit XSCT console.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exit</span>
</pre></div>
</div>
<div class="section" id="update-the-device-tree">
<h3>Update the Device tree<a class="headerlink" href="#update-the-device-tree" title="Permalink to this heading">¶</a></h3>
<p>Device tree describes the hardware components of the system. <code class="docutils literal notranslate"><span class="pre">createdts</span></code> command can generate the device tree file according to the hardware configurations from XSA file. If there are any settings not available in XSA, for example, any driver nodes that don’t have corresponding hardware, or user have their own design hardware, User needs to add customization settings in <code class="docutils literal notranslate"><span class="pre">system-user.dtsi</span></code>.</p>
<p>Besides uboot in common image does not have default environment variables. So updating the bootargs manually is needed. A pre-prepared <code class="docutils literal notranslate"><span class="pre">system-user.dtsi</span></code> file which adds pre-defined bootargs is under <code class="docutils literal notranslate"><span class="pre">ref_files</span></code> directory. Please copy this file to device tree BSP directory and modify system-top.dts to include this file. Please update DTS and rebuild it according to the following steps.</p>
<p>Go to <code class="docutils literal notranslate"><span class="pre">zcu104_software_platform</span></code> directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform
cp system-user.dtsi  mydevice/psu_cortexa53_0/device_tree_domain/bsp/
<span class="nb">echo</span> <span class="s2">&quot;#include \&quot;system-user.dtsi\&quot;&quot;</span> &gt;&gt; mydevice/psu_cortexa53_0/device_tree_domain/bsp/system-top.dts
</pre></div>
</div>
<p>Then rebuild the dts file</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform/mydevice/psu_cortexa53_0/device_tree_domain/bsp/
gcc -I my_dts -E -nostdinc -undef -D__DTS__ -x assembler-with-cpp -o system.dts system-top.dts  <span class="c1">#preprocess the dts file because DTC command can not recognize the #include grammar</span>
dtc -I dts -O dtb -o system.dtb system.dts <span class="c1"># compile the dts</span>
</pre></div>
</div>
<p>Then you can find the updated system.dtb file in &lt;zcu104_software_platform/mydevice/psu_cortexa53_0/device_tree_domain/bsp/&gt; directory.</p>
<p>After this step, all the components platform creation need is ready. Next we will attach all the components to our platform and build it.</p>
</div>
</div>
<div class="section" id="create-vitis-platform">
<h2>Create Vitis Platform<a class="headerlink" href="#create-vitis-platform" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>First We will create four directories: <strong>pfm, boot, sd_dir sw_comp</strong> to store the components and copy files to these directories.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> WorkSpace/zcu104_software_platform
mkdir pfm 
mkdir pfm/boot
mkdir pfm/sd_dir
mkdir pfm/sw_comp 
cp zcu104_platform_fsbl/zynqmp_fsbl/fsbl_a53.elf pfm/boot/fsbl.elf        <span class="c1">#rename it to fsbl.elf in case of V++ can not find it by name </span>
cp zcu104_platform_fsbl/zynqmp_pmufw/pmufw.elf pfm/boot/
cp xilinx-zynqmp-common-v2022.1/bl31.elf pfm/boot/
cp xilinx-zynqmp-common-v2022.1/u-boot.elf pfm/boot/
cp mydevice/psu_cortexa53_0/device_tree_domain/bsp/system.dtb  pfm/boot/
cp xilinx-zynqmp-common-v2022.1/boot.scr pfm/sd_dir/
cp mydevice/psu_cortexa53_0/device_tree_domain/bsp/system.dtb  pfm/sd_dir/
cp xilinx-zynqmp-common-v2022.1/rootfs.ext4 pfm/sw_comp
cp xilinx-zynqmp-common-v2022.1/Image pfm/sw_comp
</pre></div>
</div>
<blockquote>
<div><p>Note: fsbl_a53.elf, pmufw.elf, bl31.elf, u-boot.elf and system.dtb in boot DIR are the source of BOOT.BIN image. Boot.src and system.dtb in sd_dir are for u-boot initialization and Linux boot up and will be packaged to FAT32 partition by V++ package tool. Image and rootfs.ext4 are Linux kernel and root file system and also will be packaged to SD.IMG by V++ tool.</p>
</div></blockquote>
</li>
<li><p>Install the sysroot</p>
<ul class="simple">
<li><p>Go to common image extracted directory &lt;WorkSpace/zcu104_software_platform/xilinx-zynqmp-common-v2022.1/&gt;</p></li>
<li><p>Type ./sdk.sh -d <Install Target Dir> to install PetaLinux SDK. use the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option to provide a full pathname to the output directory  <strong>.</strong> (This is an example. &lt; . &gt; means current Dir ) and confirm.</p></li>
<li><p>Note: The environment variable <strong>LD_LIBRARY_PATH</strong> must not be set when running this command</p></li>
</ul>
</li>
<li><p>Create Vitis platform</p>
<p>This time we will use IDE to create Vitis Platform. if you want to use XSCT to create platform please check <a class="reference external" href="#Create-FSBL-and-PMU-file">Using XSCT to create Vitis Platform</a>.</p>
<ul class="simple">
<li><p>Open Vitis workspace you were using before in step2</p></li>
<li><p>Select menu <strong>File &gt; New &gt; Platform Project</strong> to create a platform project.</p></li>
<li><p>Enter the project name. For this example, type <code class="docutils literal notranslate"><span class="pre">zcu104_custom</span></code>. Click <strong>Next</strong>.</p></li>
<li><p>In the Platform page,</p>
<ul>
<li><p>Click <strong>Browse</strong> button, select the XSA file generated by the Vivado. In this case, it is <code class="docutils literal notranslate"><span class="pre">zcu104_custom_platform_hw.xsa</span></code>.</p></li>
<li><p>Set the operating system to <strong>linux</strong>.</br></p></li>
<li><p>Set the processor to <strong>psu_cortexa53</strong>.</br></p></li>
<li><p>Architecture: <strong>64-bit</strong></br></p></li>
<li><p><strong>uncheck</strong> option <strong>Generate boot components</strong>, because we have got FSBL and PMU already.</br></p></li>
<li><p>Click <strong>Finish</strong>.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Set up the software settings in Platform Settings view</p>
<ul>
<li><p>Click the <strong>linux on psu_cortexa53</strong> domain, browse to the locations and select the directory or file needed to complete the dialog box for the following:</p></li>
<li><p><strong>Bif file</strong>: Click the drop-down icon and select <strong>Generate BIF</strong>.</p>
<blockquote>
<div><p>Note: The file names in <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code> are placeholders. Vitis will replace the placeholders with the relative path to platform during platform packaging. V++ packager, which runs when building the final application would expand it further to the full path during image packaging. Filename placeholders point to the files in boot components directory. The filenames in boot directory need to match with placeholders in BIF file. <code class="docutils literal notranslate"><span class="pre">&lt;bitstream&gt;</span></code> is a reserved keyword. V++ packager will replace it with the final system bit file.</p>
</div></blockquote>
</li>
<li><p><strong>Boot Components Directory</strong>: Browse to <strong>zcu104_software_platform/pfm/boot</strong> and click OK.</p></li>
<li><p><strong>FAT32 Partition Directory</strong>: Browse to <strong>zcu104_software_platform/pfm/sd_dir</strong> and click OK.</p></li>
<li><p><strong>QEMU Data</strong>: Browse to <strong>zcu104_software_platform/pfm/boot</strong> and click OK.</p></li>
</ul>
<p><img alt="vitis_linux_config.PNG" src="../../../../_images/vitis_linux_config.PNG" /></p>
<blockquote>
<div><p>Note: Setting QEMU DATA to boot components directory would help emulator to find the boot components during Linux boot when doing emulation.</p>
</div></blockquote>
<blockquote>
<div><p>Note: If there are additional QEMU settings, please update qemu_args.txt accordingly.</p>
</div></blockquote>
</li>
<li><p>Click <strong>zcu104_custom</strong> project in the Vitis Explorer view, click the <strong>Build</strong> button to build the platform.</p>
<p><img alt="missing image" src="../../../../_images/build_vitis_platform1.png" /></p>
<p><strong>Note: The generated platform is placed in the export directory. BSP and source files are also provided for rebuilding the FSBL and PMU if desired and are associated with the platform. The platform is ready to be used for application development.</strong></p>
<p><img alt="missing image" src="../../../../_images/vitis_platform_output1.png" /></p>
<p>If you’d create an Vitis application in the same workspace as this platform, you can find this platform available in the platform selection page in platform creation wizard. If you’d like to reuse this platform in another workspace, add its path to PLATFORM_REPO_PATHS environment variable before launching Vitis GUI, or use “Add” button in platform selection page of Vitis GUI to add its path.</p>
</li>
</ol>
</div>
<div class="section" id="fast-track">
<h2>Fast Track<a class="headerlink" href="#fast-track" title="Permalink to this heading">¶</a></h2>
<p>Scripts are provided to create the Vitis platform. To use these scripts, please run the following steps.</p>
<ol>
<li><p>Run build</p>
<blockquote>
<div><p>Note: Please download common image from <a class="reference external" href="https://www.xilinx.com/support/download.html">Xilinx website download page.</a> and give its path to the following command.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd to the step directory, e.g.</span>
<span class="n">cd</span> <span class="n">step2_pfm</span>
<span class="n">make</span> <span class="nb">all</span> <span class="n">COMMON_IMAGE_PATH</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">common_image</span><span class="o">/&gt;</span>
</pre></div>
</div>
</li>
<li><p>To clean the generated files, please run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make clean
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="next-step">
<h2>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>Next let’s try to <a class="reference internal" href="step3.html"><span class="doc">build some applications on this platform and test them.</span></a></p>
<p align="center"><sup>Copyright&copy; 2022 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc..
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>