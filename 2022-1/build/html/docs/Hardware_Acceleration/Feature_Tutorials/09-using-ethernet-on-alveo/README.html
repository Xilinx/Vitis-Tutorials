<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Using GT Kernel in Alveo with Vitis Flow &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="AI Engine Development" href="../../../AI_Engine_Development/AI_Engine_Development.html" />
    <link rel="prev" title="Host Memory Access" href="../08-using-hostmem/README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Main</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../Hardware-Acceleration.html">Hardware Acceleration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Hardware-Acceleration.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Hardware-Acceleration.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../Hardware-Acceleration.html#feature-tutorials">Feature Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02-mixing-c-rtl-kernels/README.html">Mixing C and RTL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03-dataflow_debug_and_optimization/README.html">Dataflow Debug and Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../05-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07-using-hbm/README.html">Optimizing for HBM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html">Host Memory Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html#xrt-and-platform-version">XRT and Platform version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html#tutorial-description">Tutorial Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html#running-the-application">Running the application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html#summary">Summary</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using GT Kernels and Ethernet IPs on Alveo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features-and-design-overview">Features and Design Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#design-flow-and-tutorial-steps">Design Flow and Tutorial Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../Hardware-Acceleration.html">Vitis Hardware Acceleration</a> &raquo;</li>
      <li>Using GT Kernel in Alveo with Vitis Flow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Hardware_Acceleration/Feature_Tutorials/09-using-ethernet-on-alveo/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>Vitis™ Application Acceleration Development Flow Tutorials</h1>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="using-gt-kernel-in-alveo-with-vitis-flow">
<h1>Using GT Kernel in Alveo with Vitis Flow<a class="headerlink" href="#using-gt-kernel-in-alveo-with-vitis-flow" title="Permalink to this heading">¶</a></h1>
<p><em><strong>Version: Vitis 2022.1</strong></em></p>
<p>The Xilinx Alveo Data Center accelerator cards provide networking connectivity such as one or two QSFP28 ports depending on the card. The QSFP28 interface can support a variety of Ethernet configurations including 10GbE, 25GbE, 40GbE, and 100GbE. Multiple instances of a single lane Ethernet protocol is also possible. With Vitis flow and the latest platforms, users can create RTL kernels containing GTY transceivers, provide streaming connection to other kernels including HLS compute units, datapath buffering into DRAM memories, and driver access for moving data between the host and FPGA by the Vitis tools to implement of full integrated design.</p>
<p>This simple tutorial illustrates the steps to include GTY transceivers in RTL kernel and integrate it in top level hardware overlay design with Vitis. Alveo U200 card is used as example platform and you could apply similar steps to other Alveo cards easily. Please note the example design in this tutorial has no realistic functions and is just used for methodology explaination here. Two lane number configurations (x1 and x4) are provided here.</p>
<div class="section" id="features-and-design-overview">
<h2>Features and Design Overview<a class="headerlink" href="#features-and-design-overview" title="Permalink to this heading">¶</a></h2>
<p>Below is the block diagram of the design, which consists two RTL kernels:</p>
<ul class="simple">
<li><p><strong>ethernet_krnl_axis_x1/4</strong>: This kernel includes one single-channel or four-channel 10G ethernet sub-system IP, one AXI control slave and two or eight AXI stream data FIFO modules. The data to/from GT transciever is streamed to the AXI stream data FIFO and connected outside. The kernel use XRT <em>ap_ctrl_hs</em> execution model. The host program can control the ethernet IP via AXI control slave.</p></li>
<li><p><strong>data_fifo_krnl</strong>: This kernel just includes two AXI stream data FIFO modules, which are connected together to form the loopback datapath to externel AXI stream ports. The kernel use XRT <em>ap_ctrl_none</em></p></li>
</ul>
<p>In the top level hardware topology these two or five kernels (depends on lane number) are stitched via AXI stream connection. The AXI control slave of kernel <strong>ethernet_krnl_axis_x1/4</strong> is also connected to the platform. Necessary reset and clock signals including those for GT transceivers are connected to relevant resources provided by the platform.</p>
<p><img alt="Blocks" src="../../../../_images/diagram.svg" /></p>
<p>Just like mentioned earlier, there is no meaningful functions from this design topology, so no host program code is provided.</p>
</div>
<div class="section" id="design-flow-and-tutorial-steps">
<h2>Design Flow and Tutorial Steps<a class="headerlink" href="#design-flow-and-tutorial-steps" title="Permalink to this heading">¶</a></h2>
<p>Firstly please see below the important files of this tutorial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── connectivity_x1/4.cfg                 Vitis linking configuration file
├── gen_ip_x1/4.tcl                       Vivado script to generate IP                     
├── Makefile                              Makefile for every steps
├── pack_data_fifo_kernel.tcl             Vivado script to pack data fifo kernel
├── pack_eth_x1/4_kernel.tcl              Vivado script to pack ethernet kernel
└── rtl/                                  RTL sources code for two kernels
</pre></div>
</div>
<p>RTL wrapper files for these two kernels are provided in the <em>./rtl</em> directory. All steps are executed in command line interface and <em>Makefile</em> is used to control the flow. In the <em>Makefile</em> following lines designate Alveo U200 as the target card for the design, and you could modify this for other Alveo cards. Also you can modify the lane number setting (default is 1).</p>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Target hardware setting, uncomment appropriate lines</span>
<span class="nv">BOARD</span>    <span class="o">:=</span> u200
<span class="nv">PLATFORM</span> <span class="o">:=</span> xilinx_u200_gen3x16_xdma_2_202110_1
<span class="nv">PART</span>     <span class="o">:=</span> xcu200-fsgd2104-2-e
</pre></div>
</div>
<p>Now let’s enter the root path of the tutorial and go over the tutorial step by step.</p>
<div class="section" id="generate-ip">
<h3>1. Generate IP<a class="headerlink" href="#generate-ip" title="Permalink to this heading">¶</a></h3>
<p>As explained previously, two IPs are needed in the design: ethernet sub-system (<strong>xxv_ethernet</strong>) and AXI stream FIFO (<strong>axis_data_fifo</strong>). They can be generated by either Vivado GUI mode or batch mode via Tcl script. Here we just use following command to use Vivado batch mode to generate them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">gen_ip</span>
</pre></div>
</div>
<p>This will start Vivado to execute the Tcl script <em>gen_ip.tcl</em>. The generated IP will reside in the created directory <strong>ip_generation</strong>. You can review the Tcl script to infer the dialague setting if using Vivado GUI mode. Please note some setting for IP <strong>xxv_ethernet</strong> is related to the target Alveo card you are using.</p>
</div>
<div class="section" id="package-kernels">
<h3>2. Package Kernels<a class="headerlink" href="#package-kernels" title="Permalink to this heading">¶</a></h3>
<p>Here since we have already got the RTL design files in the <em>./rtl</em> directory, we need to package them along with the IP (<em>.xci</em> files) into two Vitis kernels (<em>.xo</em> files). Again, you can use Vivado GUI version of <em>IP packager</em> to finish the IP packaging, but we will use command line and Tcl scripts to finish this. Use following command to package the kernels, then two kernel files (<em>ethernet_krnl_axis_x1.xo</em> and <em>data_fifo_krnl.xo</em>) will be generated in currently for following Vitis linking jobs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">pack_kernel</span>
</pre></div>
</div>
<p>You can review Tcl scripts <em>pack_eth_kernel.tcl</em> and <em>pack_data_fifo_kernel.tcl</em> to get the kernel packaging setting, which corresponds to GUI mode Vivado dialogues. In the packaging steps for ethernet kernel, you can see that in additional to standard AXI bus interfaces, two additional bus interfaces are created for later Vitis <em>v++</em> automatic connection feature: <strong>gt_port</strong> for GT transceivers data bus and <strong>gt_refclk</strong> for GT transceivers differential clock.</p>
</div>
<div class="section" id="vitis-linking">
<h3>3. Vitis Linking<a class="headerlink" href="#vitis-linking" title="Permalink to this heading">¶</a></h3>
<p>Here we use Vitis <em>v++</em> tool to finish hardware linking and generate the <em>.xclbin</em> file. Execute following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">build_hw</span>
</pre></div>
</div>
<p>This will execute <em>v++</em> command with <em>connectivity_x1.cfg</em> as the linking configuration file. Please find following lines in the configuration file which instruct Vitis to connect GT transceivers specific signals for <strong>xilinx_u200_gen3x16_xdma_1_202110_1</strong> platform.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For xilinx_u200_gen3x16_xdma_1_202110_1 platform</span>
<span class="n">connect</span><span class="o">=</span><span class="n">eth0</span><span class="o">/</span><span class="n">clk_gt_freerun</span><span class="p">:</span><span class="n">ss_ucs</span><span class="o">/</span><span class="n">aclk_kernel_00</span>
<span class="n">connect</span><span class="o">=</span><span class="n">io_clk_qsfp_refclka_00</span><span class="p">:</span><span class="n">eth0</span><span class="o">/</span><span class="n">gt_refclk</span>
<span class="n">connect</span><span class="o">=</span><span class="n">eth0</span><span class="o">/</span><span class="n">gt_port</span><span class="p">:</span><span class="n">io_gt_qsfp_00</span>
</pre></div>
</div>
<p>If you are using other cards or platforms, the signal/port names might be different and you need to modify this accordingly. You can refer to the platform information reported by <strong>platforminfo</strong> command for these platform specific GT signal/port naming. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">platforminfo</span> <span class="o">-</span><span class="n">p</span> <span class="n">xilinx_u200_gen3x16_xdma_1_202110_1</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>After the <em>v++</em> linking job finishes, you can use Vivado GUI to open the Vivado project <em>./_x/link/vivado/vpl/prj/prj.xpr</em>, then open the block design <strong>ulp</strong>. You can see that all the signals for the two kernels (with instance names <strong>df0</strong> and <strong>eth0</strong>), especially those GT transceivers signals have been connected correctly, like below screenshot.</p>
<p><img alt="Blocks" src="../../../../_images/kernel_connection.png" /></p>
<p>When <em>v++</em> linking finishes, we will get the XCLBIN file <strong>top_level.xclbin</strong>. You could also use Vivado to open the project <em>./_x/link/vivado/vpl/prj/prj.xpr</em> and open the finally implemented design to review the reports and silicon floorplan.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h2>
<p>To use GTY transceivers in Alveo card with Vitis flow is very simple and straightforward. You just need to handle it as ordinary RTL kernels with some extra configuration for GT transceivers specific signals. Vitis provides powerful and flexible capabilities to help the user to finish the integration efficiently.</p>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../08-using-hostmem/README.html" class="btn btn-neutral float-left" title="Host Memory Access" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../AI_Engine_Development/AI_Engine_Development.html" class="btn btn-neutral float-right" title="AI Engine Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc..
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>