#include "fir_chan_config.h"
#include <iostream>
#define N 3

int main()
{
    s_data_t in[CHAN_NUM][DATA_LENGTH] = {
        {0.1,  1.1,  2.1,  3.1,  4.1,  5.1,  6.1,  7.1,  8.1,  9.1,  10.1, 11.1},
        {12.1, 13.1, 14.1, 15.1, 16.1, 17.1, 18.1, 19.1, 20.1, 21.1, 22.1, 23.1},
        {24.1, 25.1, 26.1, 27.1, 28.1, 29.1, 30.1, 31.1, 32.1, 33.1, 34.1, 35.1}
    };
    m_data_t out[CHAN_NUM][DATA_LENGTH];
    int err=0; 
    m_data_t ref[3][CHAN_NUM][DATA_LENGTH] = {
        {
        {0  ,1     ,4.25  ,10.75 ,17.25 ,23.75 ,30.25 ,36.75 ,43.25 ,49.75  ,56.25  ,62.75}, 
        {54 ,124.5 ,212.5 ,229   ,245.5 ,262   ,278.5 ,295   ,311.5 ,328    ,344.5  ,361}, 
        {186,403.75,660.25,686.75,713.25,739.75,766.25,792.75,323.25,-210.25,-823.75,-797.25}
        },

        {
        {125.5  ,76     ,14.5  ,31    ,47.5  ,64    ,80.5  ,97    ,113.5 ,130   ,146.5  ,163},
        {514.25 ,435.75 ,342.25,368.75,395.25,421.75,448.25,474.75,501.25,527.75,554.25 ,580.75}, 
        {-138.75,-15.25 ,160.25,166.75,173.25,179.75,186.25,192.75,135.25,-2.25 ,-203.75,-197.25},
        },   

        {
        {196.25,117.75,24.25,50.75,77.25,103.75,130.25,156.75,183.25,209.75,236.25,262.75},
        {135.25,114.75,82.25,88.75,95.25,101.75,108.25,114.75,121.25,127.75,134.25,140.75},
        {-246.5,56    ,410.5,427  ,443.5,460   ,476.5 ,493   ,221.5 ,-114  ,-513.5,-497}
        }
    };

    for (int j = 0; j < N; ++j) {
        fir_top(in, out); 
        for(unsigned chan = 0; chan < CHAN_NUM; ++chan)
        {
            for (unsigned idx = 0; idx < DATA_LENGTH; ++idx)
            {
                //std::cout << "out[" << chan << "][" << idx << "]" << j <<  "is " << out[chan][idx] << " -- expected value is" <<  ref[j][chan][idx] << std::endl;
                
                if(out[chan][idx] != ref[j][chan][idx])
                    err++;
            }
        }
    }
    
    if (err > 0 )
        printf ("FAIL!!!!\n");
    else
        printf ("PASS!!!!\n");
    return err;
}
