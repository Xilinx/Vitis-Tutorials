<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- OneTrust Cookies Consent Notice start for xilinx.github.io --><script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script><!-- OneTrust Cookies Consent Notice end for xilinx.github.io --><title>手順 2: Vitis ソフトウェア プラットフォームの作成 - Vitis™ チュートリアル 2022.1 の資料</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" /><!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]--><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"><a href="../../../../index.html" class="icon icon-home">Vitis™ チュートリアル <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/> </a><div class="version">2022.1</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">English</span></p><ul><li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs/index.html">Main</a></li></ul><p class="caption" role="heading"><span class="caption-text">入門</span></p><ul><li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">概要</a></li></ul><p class="caption" role="heading"><span class="caption-text">アクセラレーション</span></p><ul><li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">ハードウェア アクセラレーション</a></li></ul><p class="caption" role="heading"><span class="caption-text">AI エンジン</span></p><ul><li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI エンジン開発</a></li></ul><p class="caption" role="heading"><span class="caption-text">プラットフォーム</span></p><ul><li class="toctree-l1"><a class="reference internal" href="../../Vitis_Platform_Creation.html">Vitis プラットフォームの作成</a></li></ul><p class="caption" role="heading"><span class="caption-text">その他のバージョン</span></p><ul><li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li><li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li><li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/index.html">2020.2</a></li><li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/indexE.html">2020.1</a></li></ul></div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" ><i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="../../../../index.html">Vitis™ チュートリアル</a></nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation"><ul class="wy-breadcrumbs"><li><a href="../../../../index.html" class="icon icon-home"></a>&raquo;</li> <li>手順 2: Vitis ソフトウェア プラットフォームの作成</li><li class="wy-breadcrumbs-aside"><a href="../../../../_sources/docs/Vitis_Platform_Creation/Design_Tutorials/02-Edge-AI-ZCU104/step2.md.txt" rel="nofollow">ページ ソースの表示</a></li></ul><hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody"><!--
# Copyright 2020 Xilinx Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
--><div class="section" id="step-2-create-vitis-software-platform">
<h1>手順 2: Vitis ソフトウェア プラットフォームの作成<a class="headerlink" href="#step-2-create-vitis-software-platform" title="Permalink to this heading">¶</a></h1>
<p>この手順では、Linux オペレーション システムを動作する Vitis プラットフォームを作成します。Vitis プラットフォームは、いくつかのソフトウェア コンポーネントを必要とし、事前に準備する必要があります。簡単に評価できるようにするため共通ソフトウェア イメージが提供されています。そこで、クイックスタート用に共通イメージを利用します。DTB ファイルは、プラットフォームによってデバイスのペリフェラルが異なるため、共通のイメージ パッケージには用意されていません。そこで、<code class="docutils literal notranslate"><span class="pre">createdts</span></code> コマンドを使用して、プラットフォーム用のデバイス ツリー ファイルを生成することにします。また、 カーネルや rootfs などのシステム イメージをカスタマイズする必要がある場合は、<a class="reference internal" href="../../Feature_Tutorials/02_petalinux_customization/README.html"><span class="doc">PetaLinux のカスタマイズ</span></a>を参照してください。次は、プラットフォームに必要なソフトウェア コンポーネントとその場所です。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>コンポーネント</th>
<th>従来のパスまたはファイル名</th>
<th>内容</th>
<th>場所</th>
</tr>
</thead>
<tbody>
<tr>
<td>BOOT.BIN 内のブートコンポーネント</td>
<td>boot/fsbl.elf</td>
<td>FSBL (第 1 段階ブートローダー)</td>
<td>プラットフォームの作成と共に生成</td>
</tr>
<tr>
<td>BOOT.BIN 内のブートコンポーネント</td>
<td>boot/pmufw.elf</td>
<td>チップ内部の電源やセキュリティ関連の管理</td>
<td>プラットフォームの作成と共に生成</td>
</tr>
<tr>
<td>BOOT.BIN 内のブートコンポーネント</td>
<td>boot/bl31.elf</td>
<td>Arm トラステッド ファームウェア/セキュア モニター</td>
<td>共通イメージから抽出</td>
</tr>
<tr>
<td>BOOT.BIN 内のブートコンポーネント</td>
<td>boot/u-boot.elf</td>
<td>第 2 段階のブートローダー</td>
<td>共通イメージから抽出</td>
</tr>
<tr>
<td>BOOT.BIN 内のブートコンポーネント</td>
<td>boot/system.dtb</td>
<td>デバイス ツリー情報ファイル</td>
<td>createdts コマンドで生成</td>
</tr>
<tr>
<td>SD カードの FAT32 パーティションのブート コンポーネント</td>
<td>sd_dir/boot.scr</td>
<td>SD カードの FAT32 パーティションに保存する U-Boot コンフィギュレーション ファイル</td>
<td>共通イメージから抽出</td>
</tr>
<tr>
<td>Linux ソフトウェア コンポーネント</td>
<td>sw_comp/Image</td>
<td>Linux カーネル イメージ</td>
<td>共通イメージから抽出</td>
</tr>
<tr>
<td>Linux ソフトウェア コンポーネント</td>
<td>sw_comp/rootfs.ext4</td>
<td>Linux ファイル システム</td>
<td>共通イメージから抽出</td>
</tr>
<tr>
<td>Linux SDK</td>
<td>sysroot</td>
<td>クロス コンパイルとヘッダー ファイル</td>
<td>共通イメージから抽出</td>
</tr>
</tbody>
</table><p>ほとんどのコンポーネントは共通イメージ パッケージから抽出されるため、まず共通イメージを用意します。</p>
<div class="section" id="prepare-the-common-images">
<h2>共通イメージの準備<a class="headerlink" href="#prepare-the-common-images" title="Permalink to this heading">¶</a></h2>
<ol><li><p><a class="reference external" href="https://japan.xilinx.com/support/download.html">ザイリンクス ウェブサイトのダウンロード ページ</a>から共通イメージをダウンロードし、手順 1 で作成した <strong>WorkSpace</strong> フォルダーに移動し、次のようにこのフォルダーにイメージ パッケージを保存します。<strong></strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> WorkSpace tree -L <span class="m">1</span> <span class="c1"># to see the directory hierarchy</span></pre></div>
</div>
<p><img alt="step2_common_image.PNG" src="../../../../_images/step2_common_image.PNG" /></p></li> <li><p>共通イメージを抽出します。</p>
<p><strong>zcu104_software_platform</strong> というフォルダーを作成し、この手順 2 の作業内容を保存します。これから実行する操作やファイルは、このフォルダーに保存されます。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir zcu104_software_platform <span class="nb">cd</span> zcu104_software_platform tar xvf ../xilinx-zynqmp-common-v2022.1.tar.gz -C .</pre></div>
</div>
<p>次のように、<strong>xilinx-zynqmp-common-v2022.1</strong> フォルダーには、<strong>zcu104_software_platform</strong> フォルダーにあるいくつかのコンポーネントが含まれています。</p>
<p><img alt="common_image_content.PNG" src="../../../../_images/common_image_content.PNG" /></p></li></ol>
<p>上の図から、ブート ファイル、カーネル イメージ、rootfs、SDK ツールの準備が整っていることがわかります。DTB と第 1 段階のブート関連ファイルは使用できません。Vitis はプラットフォーム作成時に <strong>[Generate boot components]</strong> のオプションを有効にすることで、FSBL と PMU のファームウェアを生成できるので、Vitis プラットフォームを作成し、<strong>[Generate boot components]</strong> のオプションを有効にして、FSBL と PMU のファームウェアを生成します。</p>
</div>
<div class="section" id="create-fsbl-and-pmu-firmware">
<h2>FSBL と PMU ファームウェアの作成<a class="headerlink" href="#create-fsbl-and-pmu-firmware" title="Permalink to this heading">¶</a></h2>
<p>前述のように、FSBL と PMU のファームウェアを取得するため、Vitis プラットフォームを作成します。Vitis IDE と XSCT コマンドを使用し、このプラットフォームを作成することが可能です。ただし、Vitis IDE は入力として XSA ファイルを 1 つしかサポートしません。XSA (hw および hw-emu) を使用する必要がある場合は、XSCT を使用してプラットフォームを作成してください。</p>
 <details><summary><strong>Vitis IDE を使用して Vitis プラットフォームを作成する詳細な手順は、ここをクリックしてください。</strong></summary><ol class="simple"><li><p>Vitis IDE を起動します。</p></li></ol><ul> <li><p>Vitis 環境を準備します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span>&lt;Vitis_tool_install_dir&gt;/settings64.sh</pre></div>
</div></li> <li><p>コンソールに <code class="docutils literal notranslate"><span class="pre">vitis</span> <span class="pre">&amp;</span></code> と入力して Vitis を起動します。</p></li> <li><p>ワークスペース ディレクトリとして <code class="docutils literal notranslate"><span class="pre">zcu104_software_platform</span></code> フォルダーを選択します。</p></li> </ul>
<ol class="simple"><li><p>新しいプラットフォーム プロジェクトを作成します。</p></li></ol><ul class="simple"> <li><p><strong>[File] → [New] → [Platform Project]</strong> をクリックし、プラットフォーム プロジェクトを作成します。</p></li> <li><p>プロジェクト名を入力します。この例の場合、「<code class="docutils literal notranslate"><span class="pre">zcu104_custom_fsbl</span></code>」と入力します。<strong>[Next]</strong> をクリックします。</p></li> <li><p>[Platform] ページで次を実行します。</p><ul> <li><p><strong>[Browse]</strong> ボタンをクリックし、Vivado で生成された XSA ファイルを選択します。この例では <code class="docutils literal notranslate"><span class="pre">zcu104_custom_platform_hw.xsa</span></code> です。</p></li> <li><p>オペレーティング システムを <strong>[standalone]</strong> に設定します。</br></p></li> <li><p>プロセッサを <strong>[psu_cortexa53_0]</strong> に設定します。</br></p></li> <li><p>[アーキテクチャ] を <strong>[64-bit]</strong> に設定します。</br></p></li> <li><p>FSBL と PMU ファームウェアを自動生成するのが目標なので、<strong>[Generate boot components]</strong> をオンにします。</br></p></li> <li><p><strong>[Finish]</strong> をクリックします。</p></li> </ul>
</li>
</ul>
<ol class="simple"><li><p>Vivado の [Explorer] ビューで <strong>zcu104_custom_fsbl</strong> プロジェクトを選択し、<strong>[Build]</strong> ボタンをクリックしてプラットフォームを生成します。</p></li></ol>
<p>ビルドのあと、SBL や PMU のファームウェアが自動生成されているのが確認できます。</p>
 </details><details><summary><strong>XSCT を使用して Vitis プラットフォームを作成する詳細な手順は、ここをクリックしてください。</strong></summary><p>XSCT コマンドを使用して Tcl ファイルを作成します。たとえば、<a class="reference external" href="./ref_files/step2_pfm/xsct_create_pfm.tcl">xsct_create_pfm.tcl</a> の主な部分を次に示します。</p>
<div class="highlight-Tcl notranslate"><div class="highlight"><pre><span></span>setws . #set OUTPUT platform_repo platform create -name $platform_name \ -desc &quot;A custom platform ZCU104 platform&quot; \ -hw ${xsa_path}/${xsa_name}_hw.xsa \ -hw_emu ${xsa_path}/${xsa_name}_hwemu.xsa \ -fsbl-target psu_cortexa53_0 \ # -out ./${OUTPUT} # standalone domain domain create -name standalone -proc psu_cortexa53_0 -os standalone -arch {64-bit} # Linux domain #domain create -name xrt -proc psu_cortexa53 -os linux -arch {64-bit} -runtime {ocl} -sd-dir {./sd_dir} -bootmode {sd} # domain active xrt #domain config -boot {./boot} #domain config -generate-bif #domain config -qemu-data ./boot platform write platform generate</pre></div>
</div>
<blockquote>
<div><p>注記: スクリプト内のファイル名とディレクトリ名をプロジェクト ファイルの場所に置き換えてください。</p>
</div></blockquote>
<blockquote>
<div><p>注記: ハードウェア エミュレーションをサポートする必要がない場合は、<code class="docutils literal notranslate"><span class="pre">platform</span> <span class="pre">create</span></code> コマンドの <code class="docutils literal notranslate"><span class="pre">-hw_emu</span></code> オプションとその値を省略できます。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">platform</span> <span class="pre">create</span></code> コマンドには、次の入力値が必要です。</p><ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">-name</span></code>: プラットフォーム名</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-hw</span></code>: ハードウェア XSA ファイルのディレクトリ</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-hw_emu</span></code>: ハードウェア エミュレーション XSA ファイルのディレクトリ</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-out</span></code>: プラットフォームの出力パス。#<code class="docutils literal notranslate"><span class="pre">setws</span></code> を使用してワークスペースを指定する場合は、このオプションは不要です。</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-sd-dir</span></code>: SD カード イメージの FAT32 パーティションに含めるファイルを含むディレクトリ。</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-fsbl-target</span></code>: CPU コアを指定し、対応する FSBL と PMU イメージを生成します。</p></li> </ul>
<p><code class="docutils literal notranslate"><span class="pre">domain</span></code> コマンドを使用すると、SD ブート モードでスタンドアロン ドメインまたは Linux ドメインが設定されます。この場合、<code class="docutils literal notranslate"><span class="pre">./sd_dir</span></code> 内のファイルを使用して、boot.bin を生成するために、SD カード イメージの FAT32 パーティションと <code class="docutils literal notranslate"><span class="pre">./boot</span></code> ディレクトリにあるファイルがが作成されます。</p>
<p>これらの値は、変数を実際の値に置き換えてスクリプトに直接渡すか、Tcl スクリプトのヘッダーで定義するか、このスクリプトを呼び出すときに値を XSCT に渡すことができます。</p>
<p>次は、xsct_create_pfm.tcl のすべての内容をハード コードした場合の XSCT の呼び出す例です。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xsct xsct_create_pfm.tcl</pre></div>
</div>
<p>カスタマイズしやすくするため、ref_files ディレクトリにあるサンプルの <a class="reference external" href="./ref_files/step2_pfm/Makefile">Makefile</a> および <a class="reference external" href="./ref_files/step2_pfm/xsct_create_pfm.tcl">xsct_create_pfm.tcl</a> では、変数を使用してファイル名およびディレクトリの場所を表しています。これらの例を参考に、スクリプトでさらにタスクをプログラム化してください。</p>
</details><p>この手順では、FSBL と PMU のファームウェアを取得するため、プラットフォームを作成します。最後の手順で、すべてのコンポーネントをプラットフォームに追加します。あと、用意が必要なファイルは DTB ファイルです。</p>
</div>
<div class="section" id="create-the-device-tree-file">
<h2>デバイス ツリー ファイルの作成<a class="headerlink" href="#create-the-device-tree-file" title="Permalink to this heading">¶</a></h2>
<p>XSCT ツールを使用して、デバイス ツリー ファイルを生成するコマンドを実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform xsct</pre></div>
</div>
<p>次のように <code class="docutils literal notranslate"><span class="pre">createdts</span></code> コマンドを XSCT コンソールで実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>createdts -hw ../zcu104_hardware_platform/zcu104_custom_platform.xsa -zocl -platform-name mydevice <span class="se">\</span> -git-branch xlnx_rel_v2022.1 -board zcu104-revc -compile</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">createdts</span></code> コマンドには、次の入力値が必要です。</p><ul class="simple"> <li><p><code class="docutils literal notranslate"><span class="pre">-name</span></code>: プラットフォーム名</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-hw</span></code>: パスを含むハードウェア XSA ファイル</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-git-branch</span></code>: デバイス ツリーの生成</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-board</span></code>: デバイスのボード名。ボード名はこちらで確認できます。<DTG Repo>/device_tree/data/kernel_dtsi</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-zocl</span></code>: zocl ドライバー サポートをイネーブル</p></li> <li><p><code class="docutils literal notranslate"><span class="pre">-compile</span></code>: デバイス ツリーをコンパイルするオプションを指定</p></li> </ul>
<p>XSCT コンソールには、次の情報が表示されます。この警告メッセージを無視すると、&lt;mydevice/psu_cortexa53_0/device_tree_domain/bsp&gt; にある system.dtb ファイルが取得されるようになります。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pl.dtsi:9.21-32.4: Warning <span class="o">(</span>unit_address_vs_reg<span class="o">)</span>: /amba_pl@0: node has a unit name, but no reg property system-top.dts:26.9-29.4: Warning <span class="o">(</span>unit_address_vs_reg<span class="o">)</span>: /memory: node has a reg or ranges property, but no unit name zynqmp.dtsi:790.43-794.6: Warning <span class="o">(</span>pci_device_reg<span class="o">)</span>: /axi/pcie@fd0e0000/legacy-interrupt-controller: missing PCI reg property pl.dtsi:27.26-31.5: Warning <span class="o">(</span>simple_bus_reg<span class="o">)</span>: /amba_pl@0/misc_clk_0: missing or empty reg/ranges property</pre></div>
</div>
<blockquote>
<div><p>注記: createdts は XSCT コンソールで実行するデバイス ファイル生成用コマンドです。このコマンドは、デバイス ツリー ファイルを生成するのに、いくつかの入力を必要とします。各オプションの詳細は、help コマンドを実行して確認できます。また、XSCT は Vitis のコンソール ツールでもあります。Linux のターミナルで「<code class="docutils literal notranslate"><span class="pre">xsct</span></code>」と入力すると、上記の操作に従って起動できます。または、Vitis を起動したあと、**[Xilinx] → [XSCT Console] ** をクリックして XSCT ツールを起動することも可能です。</p>
</div></blockquote>
<p>XSCT コンソールを終了するには、次のコマンドを実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">exit</span></pre></div>
</div>
<div class="section" id="update-the-device-tree">
<h3>デバイス ツリーのアップデート<a class="headerlink" href="#update-the-device-tree" title="Permalink to this heading">¶</a></h3>
<p>デバイス ツリーは、システムのハードウェア コンポーネントを記述します。<code class="docutils literal notranslate"><span class="pre">createdts</span></code>  コマンドを使用すると、XSA ファイルからハードウェア コンフィギュレーションに応じたデバイス ツリー ファイルを生成できます。対応するハードウェアがないドライバー ノードや、ユーザーが設計したハードウェアなど、XSA で使用できない設定がある場合は、<code class="docutils literal notranslate"><span class="pre">system-user.dtsi</span></code> にカスタマイズ設定を追加する必要があります。</p>
<p>また、共通イメージ パッケージの U-Boot イメージには、デフォルトの環境変数がありません。したがって、bootargs を手動で更新する必要があります。<code class="docutils literal notranslate"><span class="pre">ref_files</span></code> ディレクトリの下に、あらかじめ定義された <code class="docutils literal notranslate"><span class="pre">system-user.dtsi</span></code> ファイルが用意されていて、これを使用して bootargs を追加します。このファイルをデバイス ツリーの BSP ディレクトリにコピーし、このファイルが含まれるように system-top.dts を修正します。次の手順で DTS をアップデートし、再構築します。</p>
<p><code class="docutils literal notranslate"><span class="pre">zcu104_software_platform</span></code> ディレクトリに移動します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform cp system-user.dtsi mydevice/psu_cortexa53_0/device_tree_domain/bsp/ <span class="nb">echo</span> <span class="s2">&quot;#include \&quot;system-user.dtsi\&quot;&quot;</span>&gt;&gt; mydevice/psu_cortexa53_0/device_tree_domain/bsp/system-top.dts</pre></div>
</div>
<p>DTS ファイルを再構築します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> zcu104_software_platform/mydevice/psu_cortexa53_0/device_tree_domain/bsp/ gcc -I my_dts -E -nostdinc -undef -D__DTS__ -x assembler-with-cpp -o system.dts system-top.dts <span class="c1">#preprocess the dts file because DTC command can not recognize the #include grammar</span> dtc -I dts -O dtb -o system.dtb system.dts <span class="c1"># compile the dts</span></pre></div>
</div>
<p>&lt;zcu104_software_platform/mydevice/psu_cortexa53_0/device_tree_domain/bsp/&gt;ディレクトリに、アップデートされた system.dtb ファイルがあるので確認します。</p>
<p>この手順を終えると、プラットフォーム作成に必要なコンポーネントがすべて揃います。次に、すべてのコンポーネントをプラットフォームに接続し、構築します。</p>
</div>
</div>
<div class="section" id="create-vitis-platform">
<h2>Vitis プラットフォームの作成<a class="headerlink" href="#create-vitis-platform" title="Permalink to this heading">¶</a></h2>
<ol><li><p>まず、コンポーネントを保存するため、<strong>pfm、boot、sd_dir sw_comp</strong> の 4 つのディレクトリを作成し、これらのディレクトリにファイルをコピーします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> WorkSpace/zcu104_software_platform mkdir pfm mkdir pfm/boot mkdir pfm/sd_dir mkdir pfm/sw_comp cp zcu104_platform_fsbl/zynqmp_fsbl/fsbl_a53.elf pfm/boot/fsbl.elf <span class="c1">#rename it to fsbl.elf in case of V++ can not find it by name</span> cp zcu104_platform_fsbl/zynqmp_pmufw/pmufw.elf pfm/boot/ cp xilinx-zynqmp-common-v2022.1/bl31.elf pfm/boot/ cp xilinx-zynqmp-common-v2022.1/u-boot.elf pfm/boot/ cp mydevice/psu_cortexa53_0/device_tree_domain/bsp/system.dtb pfm/boot/ cp xilinx-zynqmp-common-v2022.1/boot.scr pfm/sd_dir/ cp mydevice/psu_cortexa53_0/device_tree_domain/bsp/system.dtb pfm/sd_dir/ cp xilinx-zynqmp-common-v2022.1/rootfs.ext4 pfm/sw_comp cp xilinx-zynqmp-common-v2022.1/Image pfm/sw_comp</pre></div>
</div>
<blockquote>
<div><p>注記: boot ディレクトリにある fsbl_a53.elf、pmufw.elf、bl31.elf、u-boot.elf, system.dtb は BOOT.BIN イメージのソースです。sd_dir にある Boot.src と system.dtb は U-Boot の初期化および Linux 起動用で、V++ パッケージ ツールで FAT32 パーティションにパッケージされます。イメージと rootfs.ext4 は Linux カーネルとルート ファイルシステムで、V++ ツールで SD.IMG にパッケージされます。</p>
</div></blockquote></li> <li><p>sysroot をインストール</p><ul class="simple"> <li><p>共通イメージを抽出したディレクトリ &lt;WorkSpace/zcu104_software_platform/xilinx-zynqmp-common-v2022.1/&gt; へ移動します。</p></li> <li><p>「./sdk.sh」と入力し、<Install Target Dir>PetaLinux SDK をインストールします。<code class="docutils literal notranslate"><span class="pre">-d</span></code> オプションを使用して、出力ディレクトリへの完全パス名を指定します  (これは例で、&lt; . &gt; は現在のディレクトリを意味します)。</p></li> <li><p>注記: このコマンドを実行する際、環境変数 <strong>LD_LIBRARY_PATH</strong> は設定しないでください。</p></li> </ul>
</li>
<li><p>Vitis プラットフォームの作成</p>
<p>今回は IDE を使用して Vitis プラットフォームを作成します。XSCT を使用してプラットフォームを作成する必要がある場合は、<a class="reference external" href="#Create-FSBL-and-PMU-file">XSCT を使用した Vitis プラットフォームの作成</a>を参照してください。</p><ul class="simple"> <li><p>手順 2 で使用していた Vitis ワークスペースを開きます。</p></li> <li><p><strong>[File] → [New] → [Platform Project]</strong> をクリックし、プラットフォーム プロジェクトを作成します。</p></li> <li><p>プロジェクト名を入力します。この例の場合、「<code class="docutils literal notranslate"><span class="pre">zcu104_custom</span></code>」と入力します。<strong>[Next]</strong> をクリックします。</p></li> <li><p>[Platform] ページで次を実行します。</p><ul> <li><p><strong>[Browse]</strong> ボタンをクリックし、Vivado で生成された XSA ファイルを選択します。この例では <code class="docutils literal notranslate"><span class="pre">zcu104_custom_platform_hw.xsa</span></code> です。</p></li> <li><p>オペレーティング システムを <strong>[linux]</strong> に設定します。</br></p></li> <li><p>プロセッサを <strong>[psu_cortexa53]</strong> に設定します。</br></p></li> <li><p>アーキテクチャを <strong>[64-bit]</strong> に設定します。</br></p></li> <li><p>FSBL と PMU が既にあるので、<strong>[Generate boot components]</strong> のチェック ボックスを<strong>オフにします</strong>。</br></p></li> <li><p><strong>[Finish]</strong> をクリックします。</p></li> </ul>
</li>
</ul>
</li>
<li><p>[Platform Settings] ビューでソフトウェア設定を指定します。</p><ul> <li><p><strong>[linux on psu_cortexa53]</strong> ドメインを選択し、[Browse] ボタンを使用して次のようにファイルおよびディレクトリを選択します。</p></li> <li><p><strong>[Bif file]</strong>: ドロップダウン アイコンをクリックして、<strong>[Generate BIF]</strong> を選択します。</p>
<blockquote>
<div><p>注記: <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code> 内のファイル名はプレースホルダーです。Vitis は、プラットフォームをパッケージするときに、プレースホルダーをプラットフォームへの相対パスに置き換えます。最終的なアプリケーションのビルド時に実行される v++ パッケージャーは、イメージをパッケージするときに、この相対パスを完全パスに展開します。ファイル名プレースホルダーは、boot コンポーネント ディレクトリ内のファイルを指定します。boot ディレクトリ内のファイル名は、BIF ファイル内のプレースホルダーと同じである必要があります。<code class="docutils literal notranslate"><span class="pre">&lt;bitstream&gt;</span></code> は、予約済みのキーワードです。v++ パッケージャーは、これを最終的なシステム BIT ファイルに置き換えます。</p>
</div></blockquote></li> <li><p><strong>[Boot Components Directory]</strong>: <strong>zcu104_software_platform/pfm/boot</strong> を選択し、[OK] をクリックします。</p></li> <li><p><strong>[FAT32 Partition Directory]</strong>: <strong>zcu104_software_platform/pfm/sd_dir</strong> を選択し、[OK] をクリックします。</p></li> <li><p><strong>QEMU Data</strong>: <strong>zcu104_software_platform/pfm/boot</strong> ディレクトリを指定して [OK] をクリックします。</p></li> </ul>
<p><img alt="vitis_linux_config.PNG" src="../../../../_images/vitis_linux_config.PNG" /></p>
<blockquote>
<div><p>注記: QEMU の DATA をブート コンポーネント ディレクトリに設定すると、エミュレーションを実行するときの Linux 起動時にブート コンポーネントを検出しやすくなります。</p>
</div></blockquote>
<blockquote>
<div><p>注記: QEMU 設定が追加されている場合は、qemu_args.txt を適宜アップデートしてください。</p>
</div></blockquote></li> <li><p>Vivado の [Explorer] ビューで <strong>zcu102_min</strong> プロジェクトを選択し、<strong>[Build]</strong> ボタンをクリックしてプラットフォームを構築します。</p>
<p><img alt="missing image" src="../../../../_images/build_vitis_platform1.png" /></p>
<p><strong>注記: 生成されたプラットフォームがエクスポート ディレクトリに保存されます。FSBL と PMU の再構築に必要な場合は、BSP とソース ファイルも提供され、プラットフォームと関連付けられます。プラットフォームがアプリケーション開発に使用できるようになりました。</strong></p>
<p><img alt="missing image" src="../../../../_images/vitis_platform_output1.png" /></p>
<p>このプラットフォームと同じワークスペースで Vitis アプリケーションを作成した場合は、[New Platform Project] ウィザードの [Platform] ページでこのプラットフォームを選択できます。このプラットフォームを別のワークスペースで再利用するには、Vitis GUI を起動する前にこのパスを PLATFORM_REPO_PATHS 環境変数に追加するか、Vitis GUI のプラットフォーム選択ページで [Add] ボタンをクリックしてパスを追加します。</p></li></ol>
</div>
<div class="section" id="fast-track">
<h2>ファスト トラック<a class="headerlink" href="#fast-track" title="Permalink to this heading">¶</a></h2>
<p>Vitis プラットフォームを作成するスクリプトが提供されています。これらのスクリプトを使用するには、次の手順を実行します。</p>
<ol><li><p>ビルドを実行します。</p>
<blockquote>
<div><p>注記: <a class="reference external" href="https://japan.xilinx.com/support/download.html">ザイリンクス ウェブサイトのダウンロード ページ</a>から共通イメージをダウンロードし、そのイメージへのパスを次のコマンドに入力してください。</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd to the step directory, e.g.</span> <span class="n">cd</span> <span class="n">step2_pfm</span> <span class="n">make</span> <span class="nb">all</span> <span class="n">COMMON_IMAGE_PATH</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">common_image</span><span class="o">/&gt;</span></pre></div>
</div></li> <li><p>生成されたファイルをクリーンアップするには、次を実行します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make clean</pre></div>
</div></li></ol>
</div>
<div class="section" id="next-step">
<h2>次の手順<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>次に、<a class="reference internal" href="step3.html"><span class="doc">このプラットフォーム上でいくつかのアプリケーションをビルドし、テスト</span></a>します。</p>
<p align="center"><sup>Copyright&copy; 2022 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>.footer { position: fixed; left: 0; bottom: 0; width: 100%; }</style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>© Copyright 2019-2022, Xilinx, Inc.. <span class="lastupdated">Last updated on May 16, 2022.</span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>