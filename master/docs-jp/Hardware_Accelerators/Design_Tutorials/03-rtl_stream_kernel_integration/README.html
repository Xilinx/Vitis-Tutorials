


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis チュートリアル
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">English version</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">入門</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis フロー 101 チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS の解析および最適化</a></li>
</ul>
<p class="caption"><span class="caption-text">機械学習 (英語版)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">アクセラレーション</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Vitis ハードウェア アクセラレータの概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#id1">設計チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#id2">機能チュートリアル</a></li>
</ul>
<p class="caption"><span class="caption-text">AI エンジン開発 (英語版)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/README.html">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">プラットフォーム作成チュートリアル</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/README.html">プラットフォームの作成</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT および Vitis システム最適化</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html">設計チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html#id2">機能チュートリアル</a></li>
</ul>
<p class="caption"><span class="caption-text">バージョン</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../_sources/Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis チュートリアル</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>AXI-Stream と Vitis を使用した混合カーネル デザインのチュートリアル</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p align="right"><a href="https://xilinx.github.io/Vitis-Tutorials/master/docs/index.html">English</a> | <a>日本語</a></p><div class="section" id="axi-stream-vitis">
<h1>AXI-Stream と Vitis を使用した混合カーネル デザインのチュートリアル<a class="headerlink" href="#axi-stream-vitis" title="Permalink to this headline">¶</a></h1>
<p>このチュートリアルでは、RTL カーネルと HLS C カーネルの両方、および Vitis ビジョン ライブラリを含む、混合カーネルのハードウェア デザイン例のデザイン フローを示します。このデザインはリアルタイム クロックの画像を生成し、サイズを変更してから、グローバル メモリ内の入力画像とアルファ ミックスし、最後に結果の画像をグローバル メモリへ出力します。AXI-Stream インターフェイスは、カーネル間の接続に使用されます。</p>
<div align="center"><img src="./doc/images/alpha_mixing.jpg" alt="アルファ ミキシング" ></div>
<br/><br/><p>ハードウェア デザインには、 rtc_gen、alpha_mix、strm_dump の 3 つのカーネルが含まれます。これらのカーネルは AXI-Stream リンクを使用して直接接続されます。次の図は、デザインのトポロジを示しています。</p>
<div align="center"><img src="./doc/images/topo.png" alt="トポロジ" ></div>
デザインは、次のソフトウェア/ハードウェア環境およびツール チェーン バージョンで検証されています。<ul class="simple">
<li><p>オペレーティング システム</p>
<ul>
<li><p>Redhat/CentOS 7.4 - 7.9</p></li>
<li><p>Ubuntu 16.04/18.04</p></li>
<li><p>OpenCV &amp; OpenCL ライブラリ (必須)</p></li>
</ul>
</li>
<li><p>Vitis: 2020.2</p></li>
<li><p>XRT: 2.8.726</p></li>
<li><p>ハードウェアとプラットフォーム (運用プラットフォームと開発プラットフォームの両方が必要)</p>
<ul>
<li><p>Alveo U200 - xilinx_u200_xdma_201830_2、xilinx_u200_gen3x16_xdma_1_1_202020_1</p></li>
<li><p>Alveo U250 - xilinx_u250_xdma_201830_2、xilinx_u250_gen3x16_xdma_3_1_202020_1</p></li>
<li><p>Alveo U50  - xilinx_u50_gen3x16_xdma_201920_3</p></li>
<li><p>Alveo U280 - xilinx_u280_xdma_201920_3</p></li>
</ul>
</li>
</ul>
<p>ディレクトリ構造と簡単な説明は、次のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── doc/                            # documents
├── hw/                             # Hardware build working directory
│   ├── alpha_mix.cpp               # HLS C source code for alpha_mix kernel
│   ├── build_rtc_gen_xo.sh         # shell script to call Vivado to package rtc_gen kernel IP to xo file
│   ├── config_gen.mk               # Makefile sub-module to generate Vitis linking configuration files
│   ├── include/                    # Vision Vision library include file for HLS C
│   ├── Makefile                    # Makefile for hardware building
│   ├── package_rtc_gen.tcl         # Vivado tcl script to package rtc_gen kernel IP to xo file
│   ├── rtc_gen_ip/                 # IP directory for rtc_gen kernel, including all the RTL source codes
│   ├── rtc_gen_kernel.xml          # Kernel desctiption file for rtc_gen kernel
│   └── strm_dump.cpp               # HLS C source for strm_dump kernel
├── README.md
├── rtc_gen                         # working directory for rtc_gen kernel development
│   ├── font_sim_data.txt           # text format font library file for RTL simulation
│   └── src/                        # RTL source code for rtc_gen kernel
└── sw/                             # Test program directory
    ├── build/                      # Software build working directory
    │   ├── font.dat                # Font library file including 11 characters
    │   ├── setup_emu.sh            # setup script for emulation mode
    │   └── xrt.ini                 # XRT configuration for emulation and debug
    ├── CMakeLists.txt              # cmake configuration file
    ├── media/                      # Media files for test program
    └── src/                        # Test program source codes
        ├── rtc_alpha_tb.cpp        # Test program for the whole design
        ├── rtc_gen_test.cpp        # Test program for rtc_gen kernel
        └── xcl2/                   # Xilinx OpenCL include files
</pre></div>
</div>
<div class="section" id="rtl-rtc-gen-xo">
<h2>RTL カーネル: rtc_gen (XO)<a class="headerlink" href="#rtl-rtc-gen-xo" title="Permalink to this headline">¶</a></h2>
<p>rtc_gen は、Verilog HDL で記述されたリアルタイムのクロック桁の画像を生成するカーネルです。rtc_gen には、クロック分周器付きの AXI バス クロックで駆動される内部の常時稼働リアルタイム クロックが含まれます。時間の値は、カーネル引数を使用してホストによって設定できます。カーネルはまず、0 ～ 9 桁のフォント画像ライブラリをグローバル メモリからオンチップ バッファーに読み込んでから、AXI-Stream ポートを介してリアルタイムのクロック桁の画像を出力します。ユーザーは、内部の常時稼働タイム カウンターから時間の値を読み出すこともできます。</p>
<p>フォント ライブラリの文字サイズは 240 (高さ) × 160 (幅) ピクセルで、11 文字 (数字 0 ～ 9 およびコロン) が含まれます。フォント ライブラリの内容については、次の図を参照してください。</p>
<div align="center"><img src="./doc/images/font_lib.png" alt="フォント ライブラリ" ></div><br/><br/>
フォント ライブラリ内の各ピクセルは 4 ビットで表されます。これは、実際には各ピクセルの不透明度の値になります。AXI-Stream ポートを介して出力する場合、4 ビットの不透明度の値は、左にシフトして 4 ビット追加されるので、8 ビットに拡張され、さらに 15 が追加されます (つまり、0xB が 0xBF に拡張されます)。不透明度の値は、ダウンストリームのアルファ ミキシング カーネルで使用され、カラー設定を含むタイム桁が生成されます。単一の文字のフォント画像のデータ サイズは、次のとおりです。<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="mi">240</span> <span class="n">x</span> <span class="mi">160</span> <span class="n">x</span> <span class="mi">4</span> <span class="o">=</span> <span class="mi">153</span><span class="p">,</span><span class="mi">600</span> <span class="n">bits</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span><span class="mi">200</span> <span class="nb">bytes</span>
</pre></div>
</div>
<p>フォント画像ライブラリの合計サイズは、次のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="mi">19</span><span class="p">,</span><span class="mi">200</span> <span class="n">x</span> <span class="mi">11</span> <span class="o">=</span> <span class="mi">211</span><span class="p">,</span><span class="mi">200</span> <span class="nb">bytes</span>
</pre></div>
</div>
<p>rtc_gen は、センチ秒ありの形式 (11 文字 を含む HOUR:MIN:SEC:CENTISEC) とセンチ秒なし (8 文字を含む HOUR:MIN:SEC) の 2 つの時間形式をサポートします。時間形式はカーネル引数で設定されます。2 つの出力時間形式の例は、次の図を参照してください。</p>
<div align="center"><img src="./doc/images/time_format.png" alt="時間形式" ></div>
rtc\_gen カーネルには、次の 3 つのバス インタフェースがあります。<ul class="simple">
<li><p>カーネル引数および制御用の AXI4-Lite スレーブ インターフェイス</p></li>
<li><p>フォント ライブラリ データ読み込み用の AXI4-Lite マスター インターフェイス</p></li>
<li><p>クロック桁の画像出力用の AXI-Stream マスター インターフェイス</p></li>
</ul>
<p>カーネルは、AXI マスター ベースのフォント ライブラリ読み出し用の rtc_gen_axi_read_master と、AXI スレーブ ベースのカーネル引数と制御用の rtc_gen_control_s_axi、コア カーネル関数および AXI-Stream 出力用の rtc_gen_core の 3 つのブロックで構成されています。rtc_gen_axi_read_master は、Vitis/Vivado RTL Kernel Wizard で生成される標準ブロックです。rtc_gen_control_s_axi も生成されるブロックですが、時間値の読み出し機能を追加するため、いくつか変更を加える必要があります。</p>
<div align="center"><img src="./doc/images/rtc_gen_block.png" alt="rtc_gen ブロック" ></div>
カーネルは、ホストによりトリガーされると、内部リアルタイム クロックから時間値を読み取り、その時間値に対応する時間画像のフレームを出力します。<p>次の表に、rtc_gen カーネルで使用される引数を示します。</p>
<p>| 番号| 引数| 幅| 説明
|———-|———-|———-|———-
| 0| work_mode| 1| [0]: カーネルの動作モードを決定します。<br> 0 = AXI 読み出しマスターを介してグローバル メモリからオンチップ SRAM までのフォントを読み込みます。<br>1 - AXI-Stream マスターを介して RTC 桁の図を出力します。
| 1| cs_count| 32| [21:0]: センチ秒カウンター。たとえば、システム クロックが 200MHz の場合、cs_count は 2,000,000 に設定する必要があります。
| 2| time_format| 1| [0]: センチ秒が出力桁の画像に含まれているかどうかを確認します。<br> 0 - センチ秒の出力をディスエーブルにします。<br> 1 - センチ秒の出力をディスエーブルにします。
| 3| time_set_val| 32| 内部フリーランニング クロックの時間値を設定します。<br> [31:24] - 時間 <br> [23:16] - 分 <br> [15:8] - 秒 <br> [7:0] - センチ秒
| 4| time_set_en| 1| [0]: このビットに 1 を書き込むと、time_set_value が内部フリーランニング クロックに読み込まれます。
| 5| time_val| 32| 内部リアルタイム クロック時間値の読み取り専用レジスタ: <br> [31:24] - 時間 <br> [23:16] - 分 <br> [15:8] - 秒 <br> [7:0] - センチ秒
| 6| read_addr| 64| AXI マスター ポインター。これは、フォント ライブラリ用の FPGA デバイス バッファー アドレスです。</p>
<p><br/><br/></p>
<p>RTL カーネル rtc_gen およびこの RTL カーネルを作成するための手順を追ったガイドラインの詳細は、<a class="reference internal" href="doc/rtc_gen_tutorial.html"><span class="doc">RTL カーネル (rtc_gen) の作成</span></a>を参照してください。</p>
</div>
<div class="section" id="hls-c-alpha-mix-xo">
<h2>HLS C カーネル: alpha_mix (XO)<a class="headerlink" href="#hls-c-alpha-mix-xo" title="Permalink to this headline">¶</a></h2>
<p>カーネル alpha_mix は、次のタスクを順番に実行します。</p>
<ul class="simple">
<li><p>AXI-Stream ポートを介して rtc_gen カーネルからクロック桁の画像を受信します。</p></li>
<li><p>Vitis ビジョン ライブラリのリサイズ関数を使用して、クロック桁の画像サイズを変更します。</p></li>
<li><p>グローバル メモリから背景画像を読み込んで、クロック桁の画像とのアルファ ミキシングを実行します</p></li>
<li><p>AXI-Stream ポートを介して混合した画像を送信します。</p></li>
</ul>
<div align="center"><img src="./doc/images/alpha_flow.png" alt="alpha_mix フロー" ></div>
alpha\_mix カーネルには次の 4 つのバス インタフェースがあります。<ul class="simple">
<li><p>制御用の AXI4-Lite スレーブ インターフェイス</p></li>
<li><p>背景画像読み込み用の AXI4-Lite マスター インターフェイス</p></li>
<li><p>クロック桁の画像受信用の AXI-Stream スレーブ インターフェイス</p></li>
<li><p>混合画像出力用の AXI-Stream マスター インターフェイス</p></li>
</ul>
<p>次の表に、alpha_mix カーネルで使用される引数の概要を示します。カーネルは XF_NPPC8 モードを使用しているので、クロック サイクルごとに 8 ピクセルが処理されます。背景画像の幅とサイズ変更された時間画像の幅が 8 の整数倍であることを確認してください。整数倍でないと、カーネルが停止する可能性があります。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="right">番号</th>
<th align="right">引数</th>
<th align="right">幅</th>
<th align="right">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">reserved</td>
<td align="right">-</td>
<td align="right">-</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">bgr_img_input</td>
<td align="right">64</td>
<td align="left">AXI マスター ポインター、入力背景画像用の FPGA デバイス バッファー</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">reserved</td>
<td align="right">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">time_img_rows_in</td>
<td align="right">32</td>
<td align="left">入力時間画像の高さ</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">time_img_cols_in</td>
<td align="right">32</td>
<td align="left">入力時間画像の幅</td>
</tr>
<tr>
<td align="right">5</td>
<td align="right">time_img_rows_rsz</td>
<td align="right">32</td>
<td align="left">サイズ変更した時間画像の高さ</td>
</tr>
<tr>
<td align="right">6</td>
<td align="right">time_img_cols_rsz</td>
<td align="right">32</td>
<td align="left">サイズ変更した時間画像の幅</td>
</tr>
<tr>
<td align="right">7</td>
<td align="right">time_img_pos_row</td>
<td align="right">32</td>
<td align="left">0 から開始する時間画像の垂直座標</td>
</tr>
<tr>
<td align="right">8</td>
<td align="right">time_img_pos_col</td>
<td align="right">32</td>
<td align="left">0 から開始する時間画像の水平座標</td>
</tr>
<tr>
<td align="right">9</td>
<td align="right">time_char_color</td>
<td align="right">32</td>
<td align="left">時間画像の色、[RGB] にはビット範囲 [23:0] を使用</td>
</tr>
<tr>
<td align="right">10</td>
<td align="right">time_bgr_color</td>
<td align="right">32</td>
<td align="left">時間背景色、[RGB] にはビット範囲 [23:0] を使用</td>
</tr>
<tr>
<td align="right">11</td>
<td align="right">time_bgr_opacity</td>
<td align="right">32</td>
<td align="left">時間背景の不透明度、[7:0] を使用、値の範囲は 0 ～ 255</td>
</tr>
<tr>
<td align="right">12</td>
<td align="right">bgr_img_rows</td>
<td align="right">32</td>
<td align="left">背景画像の高さ</td>
</tr>
<tr>
<td align="right">13</td>
<td align="right">bgr_img_cols</td>
<td align="right">32</td>
<td align="left">背景画像の幅</td>
</tr>
</tbody>
</table>
<p>カーネル引数の意味については、次の図を参照してください。</p>
<div align="center"><img src="./doc/images/alpha_arg.png" alt="alpha_mix カーネル引数" ></div>
HLS C カーネル alpha\_mix の詳細は、[HLS C カーネル (alpha\_mix) の作成](./doc/alpha_mix_tutorial.md)を参照してください。</div>
<div class="section" id="hls-c-strm-dump-xo">
<h2>HLS C カーネル: strm_dump (XO)<a class="headerlink" href="#hls-c-strm-dump-xo" title="Permalink to this headline">¶</a></h2>
<p>strm_dump は、AXI4-Lite マスターを介して入力 AXI-Stream をグローバル メモリにダンプする単純な HLS カーネルです。</p>
<p>次の表に strm_dump カーネルで使用される引数を示します</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="right">番号</th>
<th align="right">引数</th>
<th align="right">幅</th>
<th align="right">説明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">reserved</td>
<td align="right">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">output_addr</td>
<td align="right">64</td>
<td align="left">AXI マスター ポインター。これは出力画像の FPGA デバイス バッファー アドレスです。</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">byte_size</td>
<td align="right">32</td>
<td align="left">出力されるデータ量 (バイト単位)。これは、時間形式と色の深さに基づいて計算できます。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="xclbin">
<h2>ビットストリーム インプリメンテーション (XCLBIN)<a class="headerlink" href="#xclbin" title="Permalink to this headline">¶</a></h2>
<div class="section" id="rtc-gen-test-hw-xclbin-rtc-gen-test-hw-emu-xclbin">
<h3>rtc_gen_test_hw.xclbin / rtc_gen_test_hw_emu.xclbin<a class="headerlink" href="#rtc-gen-test-hw-xclbin-rtc-gen-test-hw-emu-xclbin" title="Permalink to this headline">¶</a></h3>
<p>これは rtc_gen カーネル用の単純なテスト システムで、AXI-Stream バスを使用して接続された rtc_gen と strm_dump の 2 つのカーネルを統合します。次の U50 プラットフォームの接続図を参照してください。ビルド ターゲット (hw または hw_emu) によって、2 つの XCLBIN ファイルが生成されます。</p>
<div align="center"><img src="./doc/images/rtc_gen_test_diagram.png" alt="rtc_gen_test の図" ></div>
<h3>rtc\_alpha\_hw.xclbin / rtc\_alpha\_hw\_emu.xclbin</h3><p>これは完全にインプリメント済みのシステムで、3 つのカーネル (rtc_gen、alpha_mix および strm_dump) をすべて統合したもので、AXI-Stream バスを介して接続されます。strm_dump カーネルの関数は、alpha_mix カーネルに簡単に統合できることに注意してください。ここでは、カーネル間の AXI-Stream 接続機能を示すために、strm_dump カーネルを分けました。U50 プラットフォームの次の接続図を参照してください。ビルド ターゲット (hw または hw_emu) によって、2 つの XCLBIN ファイルが生成されます。</p>
<div align="center"><img src="./doc/images/rtc_alpha_diagram.png" alt="rtc_alpha の図" ></div>

<h2>テスト プログラム</h2></div>
<div class="section" id="rtc-gen-test-cpp">
<h3>rtc_gen_test.cpp<a class="headerlink" href="#rtc-gen-test-cpp" title="Permalink to this headline">¶</a></h3>
<p>このプログラムは、まず環境変数 XCL_EMULATION_MODE に従って実行モードを判断し、次にバイナリ ファイル rtc_gen_test_hw.xclbin または rtc_gen_test_hw_emu.xclbin を選択して、RTL カーネル rtc_gen のテストを終了します。8 桁と 11 桁のクロック形式の両方をテストし、生成されたクロック画像を直接表示します。また、このプログラムは XRT 下位レベルの API である xclRegRead を使用して、rtc_gen カーネルの time_val レジスタの値、つまり内部ハードウェア タイム カウンターの値を読み取り、表示します。time_val の値は、画像表示の更新を制御するためにも使用されます。xclRegRead 関数が正しく動作するようにするには、実行ディレクトリで xrt.ini ファイルを作成または変更して、次の行を追加します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Runtime</span><span class="p">]</span>
<span class="n">exclusive_cu_context</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</div>
<div class="section" id="rtc-alpha-tb-cpp">
<h3>rtc_alpha_tb.cpp<a class="headerlink" href="#rtc-alpha-tb-cpp" title="Permalink to this headline">¶</a></h3>
<p>このプログラムは、まず環境変数 XCL_EMULATION_MODE に従って実行モードを判断し、次にバイナリ ファイル rtc_alpha_hw.xclbin または rtc_alpha_hw_emu.xclbin を選択して、生成されたリアルタイム クロック画像を背景画像に混合します。ユーザーはコマンド パラメーターを使用して、背景画像を選択したり、時間形式を設定したり、クロック時間の設定できます。また、プログラムのソースコードを変更して、クロック画像の色、サイズ、位置を変更することもできます。このテスト プログラムは、xclRegRead API を使用して rtc_gen カーネルの time_val レジスタの値を読み取り、その値を使用して画像表示の更新を制御します。</p>
<br/>
<h2>このリポジトリの使用方法</h2><p>次の手順を実行する前に、XRT および Vitis 設定ファイルを必ず読み込んでください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
<span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">Vitis</span><span class="o">/</span><span class="mf">2020.2</span><span class="o">/</span><span class="n">settings64</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>2 つのテスト プログラムが画像を表示する必要があります。そのため、リモート サーバーを使用している場合は、VNC デスクトップを使用するか、X11 転送とローカル X11 サーバーを使用した ssh 接続を使用してください。</p>
</div>
<div class="section" id="id1">
<h3>ハードウェアのビルド<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>./hw ディレクトリに移動し、<strong>make</strong> コマンドを使用して 3 つの XO ファイルと XCLBIN ファイルのビルドを終了します。使用可能なすべての make コマンド オプションは、次のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
      <span class="n">Display</span> <span class="n">help</span> <span class="n">information</span>

<span class="n">make</span> <span class="nb">all</span> <span class="n">TARGET</span><span class="o">=&lt;</span><span class="n">hw</span><span class="o">/</span><span class="n">hw_emu</span><span class="o">&gt;</span> <span class="n">PLATFORM</span><span class="o">=&lt;</span><span class="n">FPGA</span> <span class="n">PLATFORM</span><span class="o">&gt;</span>
      <span class="n">Command</span> <span class="n">to</span> <span class="n">build</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">rtc_gen_test</span> <span class="ow">and</span> <span class="n">rtc_alpha</span> <span class="n">xclbin</span> <span class="ow">and</span> <span class="n">necessary</span> <span class="n">kernel</span> <span class="n">files</span> <span class="p">(</span><span class="n">xo</span><span class="p">)</span> <span class="k">for</span>  
      <span class="n">specified</span> <span class="n">target</span> <span class="ow">and</span> <span class="n">platform</span><span class="o">.</span> <span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span><span class="p">,</span> <span class="n">PLATFORM</span><span class="o">=</span><span class="n">xilinx_u200_gen3x16_xdma_1_1_202020_1</span>

<span class="n">make</span> <span class="n">all_xo</span> <span class="n">TARGET</span><span class="o">=&lt;</span><span class="n">hw</span><span class="o">/</span><span class="n">hw_emu</span><span class="o">&gt;</span> <span class="n">PLATFORM</span><span class="o">=&lt;</span><span class="n">FPGA</span> <span class="n">PLATFORM</span><span class="o">&gt;</span>
      <span class="n">Command</span> <span class="n">to</span> <span class="n">build</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">files</span> <span class="p">(</span><span class="n">xo</span><span class="p">),</span> <span class="n">including</span> <span class="n">rtc_gen</span><span class="o">.</span><span class="n">xo</span><span class="p">,</span> <span class="n">alpha_mix</span><span class="o">.</span><span class="n">xo</span> <span class="ow">and</span> <span class="n">strm_dump</span><span class="o">.</span><span class="n">xo</span>
      <span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span><span class="p">,</span> <span class="n">PLATFORM</span><span class="o">=</span><span class="n">xilinx_u200_gen3x16_xdma_1_1_202020_1</span>

<span class="n">make</span> <span class="n">clean</span>
      <span class="n">Command</span> <span class="n">to</span> <span class="n">remove</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">files</span><span class="o">.</span>
</pre></div>
</div>
<p>make コマンド オプションでは、TARGET は hw または hw_emu にします。rtc_gen カーネルはソフトウェア エミュレーション モデルを提供しないためsw_emu モードは使用できません。TARGET が hw の場合、XCLBIN ファイルと XO ファイルには _hw が最後に付き、TARGET が hw_emu の場合は _hw_emu が付きます。RTL カーネル rtc_gen は、hw または hw_emu オプションの影響を受けないので、XO ファイル rtc_gen.xo のみが存在することに注意してください。</p>
<p>PLATFORM は、xilinx_u200_gen3x16_xdma_1_1_202020_1、xilinx_u200_xdma_201830_2、xilinx_u250_gen3x16_xdma_3_1_202020_1、xilinx_u250_xdma_201830_2、xilinx_u50_gen3x16_xdma_201920_3 および xilinx_u280_xdma_201920_3 の 6 つのいずれかになります。これらの Alveo カードがインストールされているかどうかにかかわらず、システムに開発プラットフォーム パッケージ (deb または rpm パッケージ) をインストールしていれば、プラットフォームをビルド プラットフォームとして使用できます。/opt/xinxi/platform ディレクトリを参照するか、またはコマンド platforminfo -l を使用すると、どのプラットフォームがインストールされているか確認できます。最終的に生成された XCLBIN ファイルと XO ファイルは、make コマンドが正常に実行された後、./hw ディレクトリに保存されます。</p>
<p>たとえば、すべての XO ファイルと XCLBIN ファイルを U50 カードを使用してハードウェア エミュレーション モードでビルドする場合は、次のように入力します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="nb">all</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw_emu</span> <span class="n">PLATFORM</span><span class="o">=</span><span class="n">xilinx_u50_gen3x16_xdma_201920_3</span>
</pre></div>
</div>
<p>ハードウェア ターゲット用の XCLBIN ファイルのビルドには時間がかかるので、時間を節約するために、サポートされる各プラットフォーム用に事前にビルドされた XCLBIN ファイル (rtc_gen_test_hw.xclbin および rtc_alpha_hw.xclbin) も用意しています。これらは target=hw オプションでビルドされているので、hw_emu モードでは使用できません。hw_emu ターゲットの XCLBIN ファイルの場合は、ビルドとシステム依存性が非常に速いので、ご自身でビルドしてください。</p>
<p>プリビルドされた XCLBIN ファイルは、次のリンクからダウンロードできます。 <a class="reference external" href="https://japan.xilinx.com/bin/public/openDownload?filename=rtl_stream_kernel_xclbin_2020.2.tgz">https://japan.xilinx.com/bin/public/openDownload?filename=rtl_stream_kernel_xclbin_2020.2.tgz</a></p>
<p><strong>プリビルドされた xclbin ファイルを使用するには、ターゲット プラットフォームに該当する 2 つの xclbin ファイルを ./hw ディレクトリにコピーしてください。このディレクトリは、ダウンストリーム手順で直接使用されます。</strong></p>
</div>
<div class="section" id="id2">
<h3>ソフトウェアのビルドと実行<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>手順 1: makefileを生成</p></li>
</ul>
<p>./sw/debuild ディレクトリに移動し、<strong>cmake ..</strong> または <strong>cmake3 ..</strong> コマンドを入力します。これにより、ソフトウェア ビルド用の makefile が生成され、./hw ディレクトリ内の 2 つの XCLBIN ファイルが ./sw/build ディレクトリにリンクされます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">./</span><span class="n">sw</span><span class="o">/</span><span class="n">build</span>
<span class="n">cmake</span> <span class="o">..</span>
</pre></div>
</div>
<ul class="simple">
<li><p>手順 2: プログラムをコンパイル</p></li>
</ul>
<p><strong>make</strong> コマンドを入力すると、2 つの C++ プログラムがコンパイルされます。これにより、rtc_gen_test と rtc_alpha_tb の 2 つの実行可能ファイルが生成されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>テスト プログラムでは XRT の下位レベル API の xclRegRead が使用されるため、ハードウェア モードとハードウェア エミュレーション モードには異なるリンク ライブラリ セットがあります。コンパイルが問題なく終了すると、rtc_alpha_tb、rtc_alpha_tb_emu、rtc_gen_test、rtc_gen_test_emu の 4 つの実行可能ファイルが生成されます。ハードウェアまたはハードウェア エミュレーション モードには、正しい実行可能ファイルを使用してください。</p>
<ul class="simple">
<li><p>手順 3: 実行モード (ハードウェアまたはハードウェア エミュレーション) を設定</p></li>
</ul>
<p>実行モードを設定するスクリプト setup_emu.sh は が提供されています。</p>
<p><strong>ハードウェア モードで実行</strong></p>
<p>エミュレーション モードを入力しなかった場合は、rtc_gen_test および rtc_alpha_ab の実行ファイルを実行して、ハードウェア モードで実行します。ハードウェア エミュレーションモードを入力し、実際のハードウェア モードに戻る場合は、次のコマンドを使用してから、実行ファイルを実行します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">setup_emu</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">s</span> <span class="n">off</span>
</pre></div>
</div>
<p><strong>ハードウェア エミュレーション モードで実行</strong></p>
<p>テスト プログラムをハードウェア エミュレーション モードで試すには、rtc_gen_test_emu および rtc_alpha_tb_emu の実行可能ファイルを使用する必要があります。これらを実行する前に、まず次のコマンドを実行してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">setup_emu</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">s</span> <span class="n">on</span> <span class="o">-</span><span class="n">p</span> <span class="n">PLATFORM_NAME</span>
</pre></div>
</div>
<p>PLATFORM_NAME は、サポートされている 6 つのプラットフォームの 1 つです。次のコマンドを実行すると、ヘルプ情報を取得できます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">setup_emu</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>たとえば、U50 プラットフォームで実行ファイルをハードウェア エミュレーション モードで実行する場合は、次のように入力します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">setup_emu</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">s</span> <span class="n">on</span> <span class="o">-</span><span class="n">p</span> <span class="n">xilinx_u50_gen3x16_xdma_201920_3</span>
</pre></div>
</div>
<p>setup_emu.sh は、必要なコンフィギュレーション ファイルを生成し、環境を設定します。</p>
<p><strong>注記:</strong> ここで入力する platform_name は、./sw/duild ディレクトリ内の XCLBIN ファイルと同じである必要があります。</p>
<p>このデザイン例のハードウェア エミュレーションの詳細は、<a class="reference internal" href="doc/hw_emu_tutorial.html"><span class="doc">エミュレーション チュートリアル</span></a>を参照してください。</p>
<ul class="simple">
<li><p>手順 4: 実行可能ファイル <strong>rtc_gen_test</strong> または <strong>rtc_gen_test_emu</strong> を実行</p></li>
</ul>
<p>実行可能な rtc_gen_test または rtc_gen_test_emu を実行して、ハードウェアまたはハードウェア エミュレーション モードで実行中のプログラムを終了します。最初に 8 桁のクロックが表示されます。画像ウィンドウを手前にして、Esc キーを押すと、2 つ目の 11 桁のクロックが表示されます。画像ウィンドウを手前にしたまま、もう一度 Esc キーを押してプログラムを終了します。また、カーネルの time_val レジスタの値も読み出して表示します。<strong>rtc_gen_test_emu を実行する前に、必ず実行モードをハードウェア エミュレーションに設定してください。</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">rtc_gen_test</span>

<span class="ow">or</span>

<span class="o">./</span><span class="n">rtc_gen_test_emu</span>
</pre></div>
</div>
<p>プログラムはまず実行モード (hw または hw_emu) を判別し、次に ./sw/build/rtc_gen_test_hw.xclbin または .sw/build/rtc_gen_test_hw_emu.xclbin ファイルを探して解析し、使用しているプラットフォームを取得してから、インストールしたカードと比較します。不一致が検出されると、エラー情報をレポートして、プログラムを終了します。</p>
<p><strong>注記:</strong> ハードウェア エミュレーション モードで実行すると、RTL シミュレーションが実際に実行されるため、時間がかかることがあります。</p>
<ul class="simple">
<li><p>手順 5: 実行ファイル rtc_alpha_tb または rtc_alpha_tb_emu を実行</p></li>
</ul>
<p>実行ファイルrtc_alpha_tb または rtc_alpha_tb_emu を実行し、ハードウェアまたはハードウェア エミュレーション モードで実行中のプログラムを終了します。実行ファイルにはいくつかのコマンド パラメーターがあります。使用方法は次のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtc_alpha_tb</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">BACK_IMAGE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span>

  <span class="o">-</span><span class="n">i</span> <span class="n">BACK_IMAGE</span><span class="p">:</span> <span class="nb">set</span> <span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">background</span> <span class="n">image</span><span class="p">,</span> <span class="n">default</span> <span class="ow">is</span> <span class="o">../</span><span class="n">media</span><span class="o">/</span><span class="n">alveo</span><span class="o">.</span><span class="n">jpg</span>
  <span class="o">-</span><span class="n">f</span> <span class="p">:</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">use</span> <span class="n">eleven</span><span class="o">-</span><span class="n">digit</span> <span class="n">clock</span><span class="p">,</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">eight</span><span class="o">-</span><span class="n">digit</span>
  <span class="o">-</span><span class="n">s</span> <span class="p">:</span> <span class="n">use</span> <span class="n">system</span> <span class="n">time</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">clock</span><span class="p">,</span> <span class="n">default</span> <span class="n">don</span><span class="s1">&#39;t set the clock</span>
  <span class="o">-</span><span class="n">h</span> <span class="p">:</span> <span class="nb">print</span> <span class="n">help</span> <span class="n">information</span>
</pre></div>
</div>
<p>./sw/media ディレクトリには、alveo.jpg、vitis.jpg、victor.jpg の 3 つの画像が含まれますが、ほかの画像も使用できます。画像は 3 チャンネル形式 (透明度なしの RGB) である必要があります。また、十分な大きさの画像を使用する必要があります。そうしない場合は、プログラムのソース コードを変更して、クロック画像のサイズまたは位置を調整してください。</p>
<p>次に、実行コマンド ラインの例を示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtc_alpha_tb</span>
      <span class="n">Mix</span> <span class="n">the</span> <span class="n">clock</span> <span class="n">image</span> <span class="k">with</span> <span class="o">../</span><span class="n">media</span><span class="o">/</span><span class="n">alveo</span><span class="o">.</span><span class="n">jpg</span> <span class="ow">and</span> <span class="n">display</span><span class="p">,</span> <span class="n">don</span><span class="s1">&#39;t sync the kernel internal real-time-clock</span>
      <span class="k">with</span> <span class="n">Linux</span> <span class="n">system</span> <span class="n">clock</span><span class="p">,</span> <span class="ow">and</span> <span class="n">use</span> <span class="mi">8</span><span class="o">-</span><span class="n">digit</span> <span class="nb">format</span><span class="o">.</span>

<span class="n">rtc_alpha_tb</span> <span class="o">-</span><span class="n">i</span> <span class="o">../</span><span class="n">media</span><span class="o">/</span><span class="n">vitis</span><span class="o">.</span><span class="n">jpg</span> <span class="o">-</span><span class="n">f</span> <span class="o">-</span><span class="n">s</span>
      <span class="n">Mix</span> <span class="n">the</span> <span class="n">clock</span> <span class="n">image</span> <span class="k">with</span> <span class="o">../</span><span class="n">media</span><span class="o">/</span><span class="n">vitis</span><span class="o">.</span><span class="n">jpg</span> <span class="ow">and</span> <span class="n">display</span><span class="p">,</span> <span class="n">sync</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">internal</span> <span class="n">real</span><span class="o">-</span><span class="n">time</span><span class="o">-</span><span class="n">clock</span> <span class="k">with</span>
      <span class="n">Linux</span> <span class="n">system</span> <span class="n">clock</span><span class="p">,</span> <span class="ow">and</span> <span class="n">use</span> <span class="mi">11</span><span class="o">-</span><span class="n">digit</span> <span class="nb">format</span><span class="o">.</span>
</pre></div>
</div>
<p>プログラムを終了するには、画像ウィンドウを手前にして、<strong>Esc</strong> キーを押します。</p>
<p>プログラムはまず実行モード (hw または hw_emu) を判別し、次に ./sw/build/rtc_alpha_hw.xclbin または .sw/build/rtc_alpha_hw_emu.xclbin ファイルを探して解析し、使用しているプラットフォームを取得してから、インストールしたカードと比較します。不一致が検出されると、エラー情報をレポートして、プログラムを終了します。</p>
<p>./sw/src/rtc_alpha_tb.cpp ファイルの先頭にある #define セクションを変更して、クロック画像の色、サイズ、位置、不透明度を調整したら、<strong>手順 2</strong> を繰り返してプログラムを再コンパイルおよび実行して、結果を確認できます。背景画像の幅とサイズ変更されたクロック画像は、必ず 8 の整数倍にしてください。</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// position of clock image, top-left corner is (0,0)</span>
<span class="cp">#define RTC_POSITION_ROW 64</span>
<span class="cp">#define RTC_POSITION_COL 400</span>

<span class="c1">// resized clock image size for 8-digit font digit size</span>
<span class="c1">// ensure RTC_IMG_WIDTH is integer multiple of 8</span>
<span class="cp">#define RTC_IMG_WIDTH_8D 480</span>
<span class="cp">#define RTC_IMG_HEIGHT_8D 90</span>

<span class="c1">// resized clock image size for 11-digit font digit size</span>
<span class="c1">// ensure RTC_IMG_WIDTH is integer multiple of 8</span>
<span class="cp">#define RTC_IMG_WIDTH_11D 528</span>
<span class="cp">#define RTC_IMG_HEIGHT_11D 72</span>

<span class="c1">// clock image font color</span>
<span class="cp">#define FONT_COLOR_R 255</span>
<span class="cp">#define FONT_COLOR_G 255</span>
<span class="cp">#define FONT_COLOR_B 255</span>

<span class="c1">// clock image background color</span>
<span class="cp">#define BGR_COLOR_R 80</span>
<span class="cp">#define BGR_COLOR_G 80</span>
<span class="cp">#define BGR_COLOR_B 80</span>

<span class="c1">// clock image background opacity</span>
<span class="cp">#define BGR_OPA 100</span>
</pre></div>
</div>
<p><strong>注記:</strong> ハードウェア エミュレーション モードで実行すると、RTL シミュレーションが実際に実行されるため、時間がかかることがあります。より小さな背景画像を使用すると、実行時間を短縮できます。この場合は、上記で説明したサイズと位置のパラメーターを変更してください。</p>
<ul class="simple">
<li><p>手順 6: rtc_gen_test および rtc_alpha_tb プログラムを使用して、Vitis プロファイリング関数を試します。</p></li>
</ul>
<p>Vitis は、パフォーマンス、帯域幅の使用状況、デザインのボトルネックなどを詳細に把握できる強力なプロファイリング機能を備えています。詳細は、<a class="reference internal" href="doc/profile_tutorial.html"><span class="doc">アプリケーションのプロファイリング</span></a>を参照してください。</p>
<hr class="docutils" />
<p align="center"><sup>Copyright&copy; 2020 Xilinx</sup></p>
<p align= center class="sphinxhide"><b><a href="../../../README.md">メイン ページに戻る</a> &mdash; <a href="../../README.md/">ハードウェア アクセラレータ チュートリアルの初めに戻る</a></b></p></br>
<p align="center"><sup>この資料は 2021 年 2 月 8 日時点の表記バージョンの英語版を翻訳したもので、内容に相違が生じる場合には原文を優先します。資料によっては英語版の更新に対応していないものがあります。
日本語版は参考用としてご使用の上、最新情報につきましては、必ず最新英語版をご参照ください。</sup></p></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>