


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis In-Depth Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Machine_Learning/README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Machine_Learning/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Machine_Learning/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html">Introduction to Vitis Hardware Accelerators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../AI_Engine_Development/README.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Creation Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Vitis_Platform_Creation/README.html">Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT and Vitis System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Runtime_and_System_Optimization/README.html">Xilinx Runtime (XRT) and Vitis System Optimization Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../../_sources/Hardware_Accelerators/Introduction/03-Algorithm_Acceleration/docs/module1_baseline/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis In-Depth Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Understanding Code Setup with Host and Kernel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/Hardware_Accelerators/Introduction/03-Algorithm_Acceleration/docs/module1_baseline/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Code, files and instructions for <strong>module 1</strong></p>
<blockquote>
<div><p><strong><em>In this module…</em></strong><br /><em>1&gt; Review the OpenCL API for the host/kernel paradigm<br />2&gt; Run Vitis via the GUI or make to execute software and hardware emulation<br />3&gt; Run Vitis Analyzer to review the application timeline<br />4&gt; Run Vitis HLS to identify the throughput bottleneck<br />5&gt; Insert a testbench into HLS to iterate quickly and verify kernel code changes</em></p>
</div></blockquote>
<div class="section" id="understanding-code-setup-with-host-and-kernel">
<h1>Understanding Code Setup with Host and Kernel<a class="headerlink" href="#understanding-code-setup-with-host-and-kernel" title="Permalink to this headline">¶</a></h1>
<p>The source code for each module is located under their local <code>./src</code> directory:</p>
<ul>
<li><p>Take a look at the host code and notice the several APIs that are used. Notice how the data is transferred back and forth to the kernel an back. The execution model can be broken down into the following steps:</p>
<ul class="simple">
<li><p>The host program writes the data needed by a kernel into the global memory of the attached device through the PCIe interface on an Alveo Data Center accelerator card, or through the AXI bus on an embedded platform.</p></li>
<li><p>The host program sets up the kernel with its input parameters.</p></li>
<li><p>The host program triggers the execution of the kernel function on the FPGA.</p></li>
<li><p>The kernel performs the required computation while reading data from global memory, as necessary.</p></li>
<li><p>The kernel writes data back to global memory and notifies the host that it has completed its task.</p></li>
<li><p>The host program reads data back from global memory into the host memory and continues processing as needed</p></li>
</ul>
</li>
<li><p>Take a look at the kernel code.  This code is compiled by the Vitis tools and transformed into an hardware description that the Vivado tool implements onto Xilinx devices. Since the the host and kernel code are developed and compiled independently, wrap the kernel function declaration with the extern “C” linkage in the header file, or wrap the whole function in the kernel code.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
             <span class="kt">void</span> <span class="nf">kernel_function</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
           <span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="build-and-emulate-with-vitis">
<h1>Build and Emulate with Vitis<a class="headerlink" href="#build-and-emulate-with-vitis" title="Permalink to this headline">¶</a></h1>
<p>For each module of this tutorial, Vitis can be run via the GUI <strong>or</strong> at the command line (more efficient in the context of this tutorial):</p>
<details>
  <summary><b>Click to expand! (<code>Vitis GUI</code> instructions)</b></summary><div class="section" id="using-vitis-via-the-gui">
<h2>Using Vitis via the GUI<a class="headerlink" href="#using-vitis-via-the-gui" title="Permalink to this headline">¶</a></h2>
<p>TIP: when following the links below, use right-click “open in another tab” to avoid losing the context for these instructions…</p>
<ol class="simple">
<li><p>Open a terminal</p></li>
<li><p>Setup and launch Vitis</p></li>
<li><p>“File” menu -&gt; “Import…” <a href="../images/gui1_import.png">(image)</a></p></li>
<li><p>Accept the default of the Vitis project exported zip file and click “Next” <a href="../images/gui2_next.png">(image)</a></p></li>
<li><p>Click “Browse” on the next window and navigate to the ./docs/module1_baseline/project directory <a href="../images/gui3_browse.png">(image)</a></p></li>
<li><p>Select the vitis_export_archive.ide.zip and click “Okay” <a href="../images/gui4_zip.png">(image)</a></p></li>
<li><p>Next window click “Finish” <a href="../images/gui5_finish.png">(image)</a></p></li>
</ol>
</div>
<div class="section" id="setting-up-the-platform">
<h2>Setting up the Platform<a class="headerlink" href="#setting-up-the-platform" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>On the center window pane, click on the triple dot icon <code>[…]</code> right after the platform link <a href="../images/gui6_platform.png">(image)</a></p></li>
<li><p>Navigate to specify the platform accessible from your system</p></li>
</ol>
</div>
<div class="section" id="building-and-emulating-the-design">
<h2>Building and Emulating the Design<a class="headerlink" href="#building-and-emulating-the-design" title="Permalink to this headline">¶</a></h2>
<p>Notice the “Assistant” window pane with its 3 main flow steps</p>
<ol class="simple">
<li><p><code>Emulation-SW</code>: to validate the design at the functional level</p></li>
<li><p><code>Emulation-HW</code>: compile the kernel into a cycle accurate representation to better gauge metrics</p></li>
<li><p><code>Hardware</code>: to launch the full compilation and generate a bitstream</p></li>
</ol>
<p>Run the software emulation (takes a couple of minutes)…</p>
<p>Run the hardware emulation (takes between 10 to 20 minutes)</p>
<p>Once hardware emulation has completed, go to the Vitis Analyzer section below…</p>
</details><p><em><strong>OR</strong></em></p>
<details>
  <summary><b>Click to expand! (instructions for <code>make</code>)</b></summary></div>
<div class="section" id="using-make">
<h2>Using <strong>make</strong><a class="headerlink" href="#using-make" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Open a terminal</p></li>
<li><p>Setup Vitis</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">./build</span></code></p></li>
<li><p>Run: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">run</span> <span class="pre">TARGET=sw_emu</span></code> (for a functional emulation)</p></li>
<li><p>Run: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">run</span> <span class="pre">TARGET=hw_emu</span></code> (for a more detailed emulation - takes 10 minutes or more)</p>
<ul class="simple">
<li><p>For now don’t run “hw” target as it would take over an hour to run</p></li>
</ul>
</li>
</ol>
</details></div>
</div>
<hr class="docutils" />
<div class="section" id="vitis-analyzer-for-application-end-to-end-timeline-analysis">
<h1>Vitis Analyzer for Application End-to-end Timeline Analysis<a class="headerlink" href="#vitis-analyzer-for-application-end-to-end-timeline-analysis" title="Permalink to this headline">¶</a></h1>
<p>Vitis Analyzer is a graphical tool which lets you browse many aspects of the design starting from the whole system down to the details of the kernel.</p>
<details>
  <summary><b>Click to expand! (instructions for <code>Vitis Analyzer</code></b>)</summary><ol>
<li><p>Open a terminal and setup Vitis</p></li>
<li><p>Run: <code>vitis_analyzer &amp;</code></p></li>
<li><p>File menu -&gt; Open Summary…</p></li>
<li><p>Browse to <code>./build</code></p></li>
<li><p>Select cholesky_kernel_hw_emu_xclbin_<b>run</b>_summary (prefixed with the blue “play” pictogram)</p></li>
<li><p>Navigate around by yourself watch this 45 seconds <a class="reference external" href="../images/analyzer_anim.gif">looping gif</a> to see how to go around in Vitis Analyzer.</p>
<p>Make sure to check:</p>
<ol class="simple">
<li><p>Profile summary</p></li>
<li><p>Guidance reports - indicates area of improvement</p></li>
<li><p>Application timeline - more information just below</p></li>
</ol>
</li>
</ol>
<p>The application timeline has the following structure:</p>
<ul>
<li><p><em>Host</em></p>
<ul class="simple">
<li><p><strong>OpenCL API Calls:</strong>
All OpenCL API calls are traced here. The activity time is measured from the host perspective.</p></li>
<li><p><strong>General:</strong>
All general OpenCL API calls such as clCreateProgramWithBinary, clCreateContext, and clCreateCommandQueue, are traced here.</p></li>
<li><p><strong>Queue:</strong>
OpenCL API calls that are associated with a specific command queue are traced here. This includes commands such as clEnqueueMigrateMemObjects, and clEnqueueNDRangeKernel. If the user application creates multiple command queues, then this section shows all the queues and activities.</p></li>
<li><p><strong>Data Transfer:</strong>
In this section the DMA transfers from the host to the device memory are traced. There are multiple DMA threads implemented in the OpenCL runtime and there is typically an equal number of DMA channels. The DMA transfer is initiated by the user application by calling OpenCL APIs such as clEnqueueMigrateMemObjects. These DMA requests are forwarded to the runtime which delegates to one of the threads. The data transfer from the host to the device appear under Write as they are written by the host, and the transfers from device to host appear under Read.</p></li>
<li><p><strong>Kernel Enqueues:</strong>
The kernels enqueued by the host program are shown here. The kernels here should not be confused with the kernels/CUs on the device. Here kernel refers to the NDRangeKernels and tasks created by the OpenCL commands clEnqueueNDRangeKernels and clEnqueueTask. These are plotted against the time measured from the host’s perspective. Multiple kernels can be scheduled to be executed at the same time, and they are traced from the point they are scheduled to run until the end of the kernel execution. Multiple entries would be shown in different rows depending on the number of overlapping kernel executions.</p></li>
</ul>
</li>
<li><p><em>Device “name”</em></p>
<p><strong>Binary Container “name”:</strong>
Simply the binary container name.</p>
<ul class="simple">
<li><p><strong>Accelerator “name”:</strong>
Name of the compute unit (a.k.a., Accelerator) on the FPGA.</p></li>
</ul>
</li>
</ul>
</details></div>
<hr class="docutils" />
<div class="section" id="vitis-hls-for-kernel-optimizations">
<h1>Vitis HLS for Kernel Optimizations<a class="headerlink" href="#vitis-hls-for-kernel-optimizations" title="Permalink to this headline">¶</a></h1>
<p>The C++ kernels destined implemented onto the device LUTs and flops (a.k.a the “fabric”) are automatically compiled with the high-level synthesis tool Vitis HLS. In this tutorial we run Vitis HLS “manually” to gain additional insights about the underlying synthesis technology and the Cholesky kernel algorithm.</p>
<details>
  <summary><b>Click to expand! (instructions for <code>Vitis HLS</code>)</b></summary><ol class="simple">
<li><p>Open a terminal and setup Vitis</p></li>
<li><p>Navigate to <code>./build/cholesky_kernel_hw_emu/cholesky_kernel</code></p>
<ul class="simple">
<li><p>There should be yet another cholesky_kernel directory at that level</p></li>
</ul>
</li>
<li><p>Run: <code>vitis_hls -p cholesky_kernel &amp;</code> (to start the Vitis high-level synthesis GUI)</p></li>
<li><p>Vitis HLS now shows the high-level synthesis report</p></li>
<li><p>In the GUI expand the <strong>Synthesis Summary Report</strong> window</p></li>
<li><p>Expand the loops and function in the <strong>Performance &amp; Resources</strong> section</p></li>
<li><p>Right click on the <strong>II violation</strong> as shown in this clip to locate it in the code: <a class="reference external" href="../images/HLS_anim.gif"><strong>50s HLS looping GIF</strong></a></p></li>
</ol>
<p>Note: you can restore the original Vitis HLS window layout via the “Window” menu -&gt; “Reset Perspective”.</p>
<div class="section" id="initiation-interval">
<h2>Initiation Interval<a class="headerlink" href="#initiation-interval" title="Permalink to this headline">¶</a></h2>
<p>We see an II violation of 8 for two loops in this function.
One of them looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Loop only takes one element every 8 clock cycles!!!</span>
<span class="c1">// We expected one every cycle (II of 1)</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">tmp</span> <span class="o">+=</span> <span class="n">dataA</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">dataA</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since this version of the algorithm uses double data types with an accumulation, the silicon needs 8 cycles at 300MHz to perform and complete the operation before starting the next. So we can only compute samples one after another by intervals of 8 cycles…  This is the first bottleneck that we’ll tackle in the next module.</p>
</div>
<div class="section" id="kernel-latency">
<h2>Kernel Latency<a class="headerlink" href="#kernel-latency" title="Permalink to this headline">¶</a></h2>
<p>Let’s now look at latency.</p>
<p><code class="docutils literal notranslate"><span class="pre">cholesky_kernel/solution/syn/report/cholesky_kernel_csynth.rpt</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>* Loop:
+--------------------+--------+---------+-------------+-----------+-----------+------------+----------+
|                    | Latency (cycles) |  Iteration  |  Initiation Interval  |    Trip    |          |
|       Loop Name    |  min   |   max   |   Latency   |  achieved |   target  |    Count   | Pipelined|
+--------------------+--------+---------+-------------+-----------+-----------+------------+----------+
|- VITIS_LOOP_32_..  |       ?|        ?|            3|          1|          1|           ?|    yes   |
|- Loop_first_col    |       ?|        ?|           34|          1|          1|           ?|    yes   |
|- Loop_col          |       ?|        ?|            ?|          -|          -|           ?|    no    |
| + Loop_diag        |      17|  2097161|           18|          8|          1| 1 ~ 262144 |    yes   |
| + Loop_row         |       ?|        ?| 61 ~ 2097205|          -|          -|           ?|    no    |
|  ++ Loop_vec_mul   |      17|  2097161|           18|          8|          1| 1 ~ 262144 |    yes   |
|- VITIS_LOOP_67_..  |       ?|        ?|            4|          1|          1|           ?|    yes   |
+--------------------+--------+---------+-------------+-----------+-----------+------------+----------+
</pre></div>
</div>
<p>Notice that:</p>
<ul class="simple">
<li><p>The <code>VITIS</code> prefixed loops: these are loops automatically labeled by Vitis HLS since none were applied in the source code for them.  The other loops did have a label, it’s shown in the table.</p></li>
<li><p>The question marks (?), they denote a metric that cannot be calculated because dependent on scalar input to the function and indeed in this example the matrix size is configurable and latency will vary depending on the size.</p></li>
<li><p>The last “Pipeline” column indicates if a loop was constrained to process its inputs at each cycle. The simple loops or most inner nested loops are the ones generally “pipelined” automatically by the tool</p></li>
</ul>
<p>As an input to the Cholesky function the user passes the size of the matrix N (in the example we ran it was 64).</p>
<p>The first loop requires N iterations at II=1 so it takes Nx3 to complete since the iteration latency is 3.
The <code>Loop_first_col</code> loop takes Nx34
The <code>Loop_col</code> loop runs N times ( (<code>Loop_diag</code> is N * 18) + (<code>Loop_row</code> is N * (N + 18))
Last loop also requires N iterations like the first one.</p>
<p>Some we can roughly estimate the duration to be:
<code> N(18N+N(18N+residual1)+residual2) = 18N<sup>3</sup> + (18+residual1)N<sup>2</sup> + residual2.N </code></p>
<p>So essentially the algorithm latency goes by the cube of N, the size of the matrix.</p>
</div>
<div class="section" id="adding-a-c-testbench-for-the-kernel">
<h2>Adding a C++ testbench for the kernel<a class="headerlink" href="#adding-a-c-testbench-for-the-kernel" title="Permalink to this headline">¶</a></h2>
<p>For this tutorial we provide a pre-made C++ “main” program to wrap around the kernel and simulate in the Vitis HLS environment.</p>
<p><strong>Instructions:</strong></p>
<ol>
<li><p>In a terminal, from the <code>docs</code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="o">./</span><span class="n">hls_tb</span> <span class="o">./</span><span class="n">module1_baseline</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">cholesky_kernel_hw_emu</span><span class="o">/</span><span class="n">cholesky_kernel</span>
<span class="n">cp</span> <span class="o">./</span><span class="n">module1_baseline</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">cholesky_kernel</span><span class="o">.</span><span class="n">hpp</span> <span class="o">./</span><span class="n">module1_baseline</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">cholesky_kernel_hw_emu</span><span class="o">/</span><span class="n">cholesky_kernel</span><span class="o">/</span><span class="n">hls_tb</span>
</pre></div>
</div>
</li>
<li><p>If the Vitis HLS GUI was closed, open it again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">./</span><span class="n">module1_baseline</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">cholesky_kernel_hw_emu</span><span class="o">/</span><span class="n">cholesky_kernel</span>
<span class="n">vitis_hls</span> <span class="o">-</span><span class="n">p</span> <span class="n">cholesky_kernel</span> <span class="o">&amp;</span>
</pre></div>
</div>
</li>
<li><p>In the “Explorer” window left pane of the GUI, locate “Test Bench” under “Source”.
Right-click -&gt; “Add file…”, select test_hls.cpp.
Repeat this operation for the two data files: matrix_input.dat and golden_result.dat in ./hls_tb/tb_data</p></li>
<li><p>Now select “Project”-&gt; “Run C simulation” in main menu.
This runs a purely functional simulation called “Csim”, none of what HLS synthesizes is involved.</p></li>
<li><p>Select “Project”-&gt; “Run C simulation”</p></li>
<li><p>Select “Solution” -&gt; “Run C Synthesis” -&gt; “Active Solution”</p></li>
<li><p>Run “Solution” -&gt; “Run C/RTL Cosimulation”.  In the popup window select Okay.</p></li>
</ol>
<p>The Vitis HLS Cosimulation runs a cycle accurate RTL simulation which shows the actual latency in clock cycles.  In the test bench the matrix is a 16x16.</p>
</details></div>
</div>
<hr class="docutils" />
<div class="section" id="wrap-up-for-module-1">
<h1>Wrap-up for module 1<a class="headerlink" href="#wrap-up-for-module-1" title="Permalink to this headline">¶</a></h1>
<p><strong>Key points:</strong></p>
<ul class="simple">
<li><p>To accelerate an algorithm on an Alveo card, the program needs a host and a kernel design unit</p></li>
<li><p>Vitis helps build the application, provides drivers to enable host-kernel communications</p></li>
<li><p>Vitis provides an analyzer tool to help understand the sequence of operations</p></li>
<li><p>Vitis HLS is a compiler technology that transforms the C code algorithm into an hardware language to implement onto the Xilinx device</p></li>
</ul>
<hr class="docutils" />
<div class="section" id="next">
<h2>Next<a class="headerlink" href="#next" title="Permalink to this headline">¶</a></h2>
<p>You can now proceed to <a class="reference internal" href="../module2_pipeline/README.html"><span class="doc">module 2</span></a>.</p>
<hr class="docutils" />
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2020-2021 Xilinx</sup></p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>