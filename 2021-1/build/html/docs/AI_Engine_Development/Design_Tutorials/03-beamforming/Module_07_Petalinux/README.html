<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Introduction &mdash; Vitis™ Tutorials 2021.1 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2021.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/index.html">Main</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/build/html/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/AI_Engine_Development/Design_Tutorials/03-beamforming/Module_07_Petalinux/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Development</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-ai.html">See Vitis-AI™ Development Environment on xilinx.com</a>
    </td>
 </tr>
</table><div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<p>In Module 05, you created a standalone software platform and compiled a bare-metal PS host application. In this module, you will build a PetaLinux software platform. In Module 08, you will compile the Linux PS host application. PetaLinux is an embedded Linux software development kit (SDK) targeting FPGA-based system on-a-chip (SoC) designs. PetaLinux tools offer everything necessary to customize, build, and deploy embedded Linux solutions on Xilinx processing systems. The PetaLinux tool offers a full Linux distribution building system which includes the Linux OS as well as a complete configuration, build, and deploy environment for Xilinx silicon.</p>
<div class="section" id="differences-between-bare-metal-and-petalinux">
<h2>Differences between Bare Metal and PetaLinux<a class="headerlink" href="#differences-between-bare-metal-and-petalinux" title="Permalink to this heading">¶</a></h2>
<p>In the bare-metal application, you had to access the registers of your PL kernels by computing the physical memory addresses. These memory addresses can change between builds and software releases. With the PetaLinux software platform, it is possible to bind general UIO drivers for each PL kernel instance. Instead of accessing specific physical addresses as you did in bare metal, you can use these UIO drivers which access the physical addresses for you.</p>
<p>Creating a PetaLinux application allows you to take advantage of a variety of other features such as security, multi-threading, and multi-processing.</p>
</div>
<div class="section" id="building-the-design">
<h2>Building the Design<a class="headerlink" href="#building-the-design" title="Permalink to this heading">¶</a></h2>
<p>To create, configure, and build the PetaLinux project in one step, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">petalinux</span>
</pre></div>
</div>
<p>The rest of this module explains the individual commands in the Makefile that were used to create the Petalinux project.</p>
</div>
<div class="section" id="building-the-petalinux-software-platform">
<h2>Building the PetaLinux Software Platform<a class="headerlink" href="#building-the-petalinux-software-platform" title="Permalink to this heading">¶</a></h2>
<p>Creation of the PetaLinux software platform can be broken down into the following phases: create PetaLinux, config PetaLinux, build PetaLinux, and build a Versal custom PetaLinux platform. The <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">petalinux</span></code> step performs all these steps with one command.</p>
<div class="section" id="create-petalinux-creating-the-petalinux-project-with-a-bsp">
<h3>Create PetaLinux: Creating the PetaLinux Project with a BSP<a class="headerlink" href="#create-petalinux-creating-the-petalinux-project-with-a-bsp" title="Permalink to this heading">¶</a></h3>
<p>First, create the PetaLinux project from a board support package (BSP) with the <code class="docutils literal notranslate"><span class="pre">petalinux-create</span></code> command. A BSP is a collection of software drivers and an operating system on which your Linux applications are built. It is the support code for a given hardware platform or board that helps in basic initialization at power-up and helps software applications to be run on top of it. Because you are using a VCK190 board, you will need the <code class="docutils literal notranslate"><span class="pre">xilinx-vck190-v2021.1-final.bsp</span></code> package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span><span class="p">;</span>
<span class="n">cd</span> <span class="n">build</span><span class="p">;</span>
<span class="n">petalinux</span><span class="o">-</span><span class="n">create</span> <span class="o">-</span><span class="n">t</span> <span class="n">project</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">PATH</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">BSP</span><span class="o">&gt;/</span><span class="n">xilinx</span><span class="o">-</span><span class="n">vck190</span><span class="o">-</span><span class="n">v2021</span><span class="mf">.1</span><span class="o">-</span><span class="n">final</span><span class="o">.</span><span class="n">bsp</span> <span class="o">-</span><span class="n">n</span> <span class="n">vck190_linux</span>
</pre></div>
</div>
<p>These commands create a new PetaLinux project directory structure under <code class="docutils literal notranslate"><span class="pre">build/vck190_linux</span></code>.</p>
</div>
<div class="section" id="config-petalinux-updating-the-petalinux-project-with-an-xsa">
<h3>Config PetaLinux: Updating the PetaLinux Project with an XSA<a class="headerlink" href="#config-petalinux-updating-the-petalinux-project-with-an-xsa" title="Permalink to this heading">¶</a></h3>
<p>Next, update the PetaLinux project with the XSA created in Module 04. The XSA contains the configured PS and the PL kernels you want to control from your Linux applications. This step enables you to make the PetaLinux tools software platform ready for building a Linux system, customized to your hardware platform. Import the hardware description with the <code class="docutils literal notranslate"><span class="pre">petalinux-config</span></code> command by giving the path of the directory containing the XSA file as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>petalinux-config -p build/vck190_linux --get-hw-description ../Module04_AI_Engine_and_PL_Integration/build/rev1/hw –silentconfig
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--silentconfig</span></code> option allows you to reuse a prior configuration used during the <code class="docutils literal notranslate"><span class="pre">petalinux_create</span></code> command.</p>
</div>
<div class="section" id="config-petalinux-customizing-the-root-file-system">
<h3>Config PetaLinux: Customizing the Root File System<a class="headerlink" href="#config-petalinux-customizing-the-root-file-system" title="Permalink to this heading">¶</a></h3>
<p>Edit the <code class="docutils literal notranslate"><span class="pre">build/vck190_linux/project-spec/configs/config</span></code> file. In this configuration file, ensure that the root file system type is EXT4 by setting the following config options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_SUBSYSTEM_ROOTFS_EXT4</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_SUBSYSTEM_RFS_FORMATS</span><span class="o">=</span><span class="s2">&quot;cpio cpio.gz cpio.gz.u-boot tar.gz jffs2 ext4&quot;</span>
</pre></div>
</div>
<p>To ensure the EXT4 root file system is generated, the bootargs in the <code class="docutils literal notranslate"><span class="pre">uio-system-user.dtsi</span></code> must be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">bootargs</span> <span class="o">=</span> <span class="s2">&quot;console=ttyAMA0 earlycon=pl011,mmio32,0xFF000000,115200n8 clk_ignore_unused root=/dev/mmcblk1p2 rw rootwait rootfs=ext4 uio_pdrv_genirq.of_id=generic-uio&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Lastly, the <code class="docutils literal notranslate"><span class="pre">config</span></code> file specifies the machine name as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_SUBSYSTEM_MACHINE_NAME</span><span class="o">=</span><span class="s2">&quot;versal-vck190-reva-x-ebm-02-reva&quot;</span>
</pre></div>
</div>
<p>Next, add user packages by appending the CONFIG_* lines to the <code class="docutils literal notranslate"><span class="pre">build/vck190_linux/project-spec/configs/rootfs_config</span></code> file. By default, most config options are set to “is not set”. Update the following config options to <code class="docutils literal notranslate"><span class="pre">=y</span></code>:</p>
<ul class="simple">
<li><p><strong>Packages for base XRT support:</strong> This is required for the Vitis application acceleration development flow. It includes XRT and ZOCL.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_packagegroup</span><span class="o">-</span><span class="n">petalinux</span><span class="o">-</span><span class="n">xrt</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Packages for easy system management (recommended):</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_dnf</span>
<span class="n">CONFIG_e2fsprogs</span><span class="o">-</span><span class="n">resize2fs</span>
<span class="n">CONFIG_parted</span>
<span class="n">CONFIG_imagefeature</span><span class="o">-</span><span class="n">package</span><span class="o">-</span><span class="n">management</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Packages for libsysfs, libmetal, and OpenAMP libraries:</strong> The libmetal library provides common user APIs used to access devices, handle device interrupts, and request memory across different operating environments. OpenAMP builds on top of libmetal to provide a framework for remote processor management and inter-processor communication.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_libmetal</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_open</span><span class="o">-</span><span class="n">amp</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_libsysfs</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>The package for the AI Engine:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_ai</span><span class="o">-</span><span class="n">engine</span><span class="o">-</span><span class="n">driver</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Enable debug tweaks:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_YOCTO_ENABLE_DEBUG_TWEAKS</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Enable PetaLinux auto login:</strong></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_auto</span><span class="o">-</span><span class="n">login</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
</div>
<div class="section" id="config-petalinux-updating-the-device-tree">
<h3>Config Petalinux: Updating the Device Tree<a class="headerlink" href="#config-petalinux-updating-the-device-tree" title="Permalink to this heading">¶</a></h3>
<p>The DTSI file is provided for you. Copy the <code class="docutils literal notranslate"><span class="pre">uio-system-user.dtsi</span></code> file to the PetaLinux project.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">uio</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">dtsi</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_petalinux</span><span class="o">/</span><span class="n">project</span><span class="o">-</span><span class="n">spec</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">user</span><span class="o">/</span><span class="n">recipes</span><span class="o">-</span><span class="n">bsp</span><span class="o">/</span><span class="n">device</span><span class="o">-</span><span class="n">tree</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">system</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">dtsi</span>
</pre></div>
</div>
<p>This is a user-modifiable PetaLinux device tree configuration file. Open the <code class="docutils literal notranslate"><span class="pre">uio-system-user.dtsi</span></code>. You will see that this file creates a <code class="docutils literal notranslate"><span class="pre">generic-uio</span></code> driver for each PL kernel instance (<code class="docutils literal notranslate"><span class="pre">dlbf_data_00</span></code>, <code class="docutils literal notranslate"><span class="pre">dlbf_data_01</span></code>, <code class="docutils literal notranslate"><span class="pre">dblf_coeff_00</span></code>, … etc). With this device tree configuration, you can communicate to the memory addresses of the PL kernels through these UIO drivers without actually knowing the physical addresses.</p>
</div>
<div class="section" id="config-petalinux-customizing-kernel-configuration">
<h3>Config Petalinux: Customizing Kernel Configuration<a class="headerlink" href="#config-petalinux-customizing-kernel-configuration" title="Permalink to this heading">¶</a></h3>
<p>Create the <code class="docutils literal notranslate"><span class="pre">vck190_linux/project-spec/meta-user/recipes-kernel/linux/linux-xlnx/bsp.cfg</span></code> file. This is a Linux kernel config fragment file with the following config options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_I2C_XILINX</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_GPIO_XILINX</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_FPGA</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_FPGA_MGR_VERSAL_FPGA</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_XILINX_INTC</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<p>These configuration settings enable device drivers for general purpose GPIO IP, I2C IP, FPGA Manager, and Xilinx Interrupt Controller. These drivers are <em>not</em> used in the Linux PS host application.</p>
</div>
<div class="section" id="config-petalinux-clean-up">
<h3>Config Petalinux: Clean-Up<a class="headerlink" href="#config-petalinux-clean-up" title="Permalink to this heading">¶</a></h3>
<p>Run the following command to clean up the configuration files you edited:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">petalinux</span><span class="o">-</span><span class="n">config</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_linux</span> <span class="o">--</span><span class="n">silentconfig</span>
</pre></div>
</div>
</div>
<div class="section" id="build-petalinux-building-the-petalinux-image">
<h3>Build PetaLinux: Building the PetaLinux Image<a class="headerlink" href="#build-petalinux-building-the-petalinux-image" title="Permalink to this heading">¶</a></h3>
<p>Build the PetaLinux system image with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">petalinux</span><span class="o">-</span><span class="n">build</span> <span class="o">-</span><span class="n">p</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_linux</span>
</pre></div>
</div>
<p>This step generates a device tree DTB file, platform loader and manager firmware (PLM), processing system management firmware (PSM), Arm™ trusted firmware (ATF), U-Boot, the Linux kernel, a root file system image, and the boot script for a Versal™ ACAP. Finally, it generates the necessary boot images. The compilation progress shows on the console when executing this command.</p>
<p>When the build finishes, the generated U-Boot and Linux images are stored in the <code class="docutils literal notranslate"><span class="pre">build/vck190_petalinux/images/linux</span></code> directory.</p>
</div>
<div class="section" id="build-petalinux-building-the-sdk-target-sysroot-generation">
<h3>Build Petalinux: Building the SDK (Target Sysroot Generation)<a class="headerlink" href="#build-petalinux-building-the-sdk-target-sysroot-generation" title="Permalink to this heading">¶</a></h3>
<p>The OpenEmbedded build system uses BitBake to generate the software development kit (SDK) installer script standard SDKs. PetaLinux builds Yocto SDK and installs it. The installed SDK can be used as a <code class="docutils literal notranslate"><span class="pre">sysroot</span></code> for the application development. Build the SDK with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>petalinux-build -p build/vck190_petalinux –sdk
</pre></div>
</div>
<p>This command builds the SDK and copies it at <code class="docutils literal notranslate"><span class="pre">build/vck190_petalinx/images/linux/sdk.sh</span></code>.</p>
</div>
<div class="section" id="build-petalinux-installing-the-sdk-target-sysroot-generation">
<h3>Build PetaLinux: Installing the SDK (Target Sysroot Generation)<a class="headerlink" href="#build-petalinux-installing-the-sdk-target-sysroot-generation" title="Permalink to this heading">¶</a></h3>
<p>The generated SDK must be installed/extracted to a directory. The following command extracts the SDK to the default installation directory <code class="docutils literal notranslate"><span class="pre">build/vck190_petalinux/images/linux/sdk/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd build/vck190_petalinux
petalinux-package –sysroot
</pre></div>
</div>
</div>
<div class="section" id="build-petalinux-generating-the-boot-image">
<h3>Build PetaLinux: Generating the Boot Image<a class="headerlink" href="#build-petalinux-generating-the-boot-image" title="Permalink to this heading">¶</a></h3>
<p>Lastly, generate the boot image (<code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code>). A boot image usually contains a PDI file (imported from the hardware design), PLM, PSM firmware, Arm® trusted firmware, U-Boot, and DTB.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_petalinux</span>
<span class="n">petalinux</span><span class="o">-</span><span class="n">package</span> <span class="o">--</span><span class="n">boot</span> <span class="o">--</span><span class="n">u</span><span class="o">-</span><span class="n">boot</span>
</pre></div>
</div>
<p>This generates <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code>, <code class="docutils literal notranslate"><span class="pre">BOOT_bh.bin</span></code>, and <code class="docutils literal notranslate"><span class="pre">qemu_boot.img</span></code> in the <code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux</span></code> directory. The default DTB load address is 0x1000. For more information, see the Bootgen User Guide (<a class="reference external" href="https://www.xilinx.com/search/support-keyword-search.html#q=ug1283">UG1283</a>).</p>
</div>
</div>
<div class="section" id="build-the-versal-custom-petalinux-platform">
<h2>Build the Versal Custom PetaLinux Platform<a class="headerlink" href="#build-the-versal-custom-petalinux-platform" title="Permalink to this heading">¶</a></h2>
<p>Now that we have our customized PetaLinux image, the next step is to create a Versal custom platform with that Linux image. Packaging a platform requires the following software components for EXT4 rootfs:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux/linux.bif</span></code>: Boot image generation description file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux/bl31.elf</span></code>: Component referred to by the <code class="docutils literal notranslate"><span class="pre">linux.bif</span></code> file in same folder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux/u-boot.elf</span></code>: Component referred to by the <code class="docutils literal notranslate"><span class="pre">linux.bif</span></code> file in the same folder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux/system.dtb</span></code>: Component referred to by the <code class="docutils literal notranslate"><span class="pre">linux.bif</span></code> file in the same folder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">build/image/boot.src</span></code> - U-Boot configuration file</p></li>
</ul>
<p>First, add the BIF file (<code class="docutils literal notranslate"><span class="pre">linux.bif</span></code>) to the <code class="docutils literal notranslate"><span class="pre">build/vck190_linux/images/linux</span></code> directory. We have provided one for you to copy. When you open the <code class="docutils literal notranslate"><span class="pre">linux.bif</span></code> file, you will notice that the file names should match the contents of the boot directory. They are the source for creating the <code class="docutils literal notranslate"><span class="pre">BOOT.BIN</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">linux</span><span class="o">.</span><span class="n">bif</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_linux</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">linux</span><span class="o">.</span><span class="n">bif</span>
</pre></div>
</div>
<p>Next, prepare the image directory. The contents of this directory will be packaged to FAT32 partition by the <code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">--package</span></code> tool. Copy the <code class="docutils literal notranslate"><span class="pre">boot.src</span></code> script for U-Boot initialization into the image directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build</span><span class="o">/</span><span class="n">image</span>
<span class="n">cp</span> <span class="n">build</span><span class="o">/</span><span class="n">vck190_linux</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">boot</span><span class="o">.</span><span class="n">src</span> <span class="n">build</span><span class="o">/</span><span class="n">image</span><span class="o">/.</span>
</pre></div>
</div>
<p>Lastly, create the Versal custom PetaLinux platform (<code class="docutils literal notranslate"><span class="pre">.xpfm</span></code>) using the <code class="docutils literal notranslate"><span class="pre">xsct_create_pfm.tcl</span></code> script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xsct</span> <span class="n">xsct_create_pfm</span><span class="o">.</span><span class="n">tcl</span> <span class="n">vck190_custom</span> <span class="o">../</span><span class="n">Module_04</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">rev1</span><span class="o">/</span><span class="n">hw</span><span class="o">/</span><span class="n">beamforming</span><span class="o">.</span><span class="n">rev1</span><span class="o">.</span><span class="n">hw</span><span class="o">.</span><span class="n">xsa</span>
</pre></div>
</div>
<p>This script uses the XSA from Module 04 and the custom Petalinux image to generate a new Versal custom platform (.xpfm) in the <code class="docutils literal notranslate"><span class="pre">build/vck190_custom/</span></code> directory. The new XPFM platform is used in the <code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">--package</span></code> step in Module 09 to generate the SD card image.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.xilinx.com/products/design-tools/embedded-software/petalinux-sdk.html#tools">PetaLinux Tools Website</a></p></li>
<li><p>PetaLinux Tools Documentation (<a class="reference external" href="https://www.xilinx.com/search/support-keyword-search.html#q=ug1144">UG1144</a>)</p></li>
<li><p>Bootgen User Guide (<a class="reference external" href="https://www.xilinx.com/search/support-keyword-search.html#q=ug1283">UG1283</a>)</p></li>
<li><p>Libmetal and OpenAMP (<a class="reference external" href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2021_1/ug1186-zynq-openamp-gsg.pdf">UG1186</a>)</p></li>
<li><p><a class="reference external" href="https://gitenterprise.xilinx.com/swm/Versal_Platform_Creation/tree/master/Tutorial-VCK190_Custom">Versal Platform Creation Tutorial</a></p></li>
</ul>
<p>© Copyright 2021 Xilinx, Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on July 27, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>