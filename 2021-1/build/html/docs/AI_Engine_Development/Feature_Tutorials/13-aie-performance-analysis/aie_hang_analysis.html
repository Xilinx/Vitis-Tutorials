<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>AI Engine Deadlock Analysis &mdash; Vitis™ Tutorials 2021.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2021.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>AI Engine Deadlock Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/13-aie-performance-analysis/aie_hang_analysis.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  </table>
<table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Development</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-ai.html">See Vitis-AI™ Development Environment on xilinx.com</a>
    </td>
 </tr>
</table><section id="ai-engine-deadlock-analysis">
<h1>AI Engine Deadlock Analysis<a class="headerlink" href="#ai-engine-deadlock-analysis" title="Permalink to this heading">¶</a></h1>
<p>This tutorial introduces you to some common deadlock scenarios and shows you how to detect deadlocks (design hangs) in different tool flows. The methods introduced to detect and analyze deadlock issues include:</p>
<ol class="simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">event</span></code> in Vitis Analyzer to analyze design hangs.</p></li>
<li><p>Using waveforms in hardware emulation to check AI Engine input and output activities.</p></li>
<li><p>Using event APIs to analyze data activities for AI Engine input and output in hardware flows.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">xbutil2</span></code> to report AI Engine and AI Engine shim status.</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">devmem</span></code> Linux command to probe AI Engine registers.</p></li>
</ol>
<p><strong>Note:</strong> The default working directory in this step is <code class="docutils literal notranslate"><span class="pre">testcase_nofifo_hang</span></code>, unless explicitly stated otherwise.</p>
<section id="common-deadlock-scenarios">
<h2>Common Deadlock Scenarios<a class="headerlink" href="#common-deadlock-scenarios" title="Permalink to this heading">¶</a></h2>
<p>A deadlock is usually caused by insufficient FIFOs, or the access rate not matching between multiple FIFOs (or different branches of the same net in stream multicast). The following figure shows some deadlock scenarios:</p>
<p><img alt="Deadlock Scenarios" src="../../../../_images/figure51.PNG" /></p>
<p><strong>Scenario 1:</strong> This scenario occurs when K1 tries to write to FIFO0, but the FIFO is full. K2 is still waiting for data coming from FIFO1 before consuming data from FIFO0.</p>
<p><strong>Scenario 2:</strong> This scenario occurs when NET0 multicasts to multiple destinations, and the destinations are connected by stream or cascade stream (FIFO1). The NET0 branch 1 is full because K2 is waiting for data from FIFO1, but K1 is still hungry for data from NET0 branch 0 to produce data for FIFO1.</p>
<p><strong>Scenario 3:</strong> This scenario occurs when K1 and K2 are connected by buffers (including RTP buffers) and streams. When K1 is trying to write data to K2 using FIFO0, K2 is still trying to acquire lock for the ping or pong buffer. K1 will not release the lock of the buffer until it finishes its current iteration.</p>
</section>
<section id="ai-engine-deadlock-example-and-analysis-in-ai-engine-simulator">
<h2>AI Engine Deadlock Example and Analysis in AI Engine Simulator<a class="headerlink" href="#ai-engine-deadlock-example-and-analysis-in-ai-engine-simulator" title="Permalink to this heading">¶</a></h2>
<p>The example is similar to the one used in <a class="reference internal" href="aie_execution_measurement.html"><span class="doc">AI Engine Execution and Measurement</span></a>, except that it does not have a FIFO for the stream connection:</p>
<p><img alt="Deadlock Example Graph" src="../../../../_images/figure61.PNG" /></p>
<p>When the design stalls, <code class="docutils literal notranslate"><span class="pre">graph::wait()</span></code> and <code class="docutils literal notranslate"><span class="pre">graph::end()</span></code> hang. It needs to interrupt graph execution by:</p>
<ul class="simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">graph::wait(CYCLE_NUMBER)</span></code>: specifying the number of cycles to wait for the API to return (if the graph does not return after <code class="docutils literal notranslate"><span class="pre">CYCLE_NUMBER</span></code> cycles, this API still returns immediately).</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">graph::end(CYCLE_NUMBER)</span></code>: specifying the number of cycles to wait for the graph to be ended (if the graph does not return after <code class="docutils literal notranslate"><span class="pre">CYCLE_NUMBER</span></code> cycles, this API still ends the graph immediately).</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">--simulation-cycle-timeout</span> <span class="pre">CYCLE_NUMBER</span></code> option for <code class="docutils literal notranslate"><span class="pre">aiesimulator</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">CYCLE_NUMBER</span></code> should be large enough for AI Engine simulator to record all the stall events, or for hardware to run into hang status.</p>
<ol>
<li><p>In this example, examine <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. We wait for 10000 cycles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gr</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Run AI Engine simulator using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aiesim</span>
</pre></div>
</div>
</li>
<li><p>Open <strong>Trace</strong> view in Vitis Analyzer by using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
<p><img alt="Trace View" src="../../../../_images/figure71.PNG" /></p>
<p>The hang occurs after the following activities:</p>
<p><strong>1:</strong> Kernel <code class="docutils literal notranslate"><span class="pre">aie_dest1</span></code> acquires the lock of read buffer (<code class="docutils literal notranslate"><span class="pre">buf0</span></code>) and write buffer (<code class="docutils literal notranslate"><span class="pre">buf1</span></code>).</p>
<p><strong>2:</strong> Kernel <code class="docutils literal notranslate"><span class="pre">aie_dest1</span></code> starts.</p>
<p><strong>3:</strong> Kernel hangs in stream stall.</p>
<p><strong>4:</strong> S2mm is waiting for kernel <code class="docutils literal notranslate"><span class="pre">aie_dest1</span></code> to release buffer <code class="docutils literal notranslate"><span class="pre">buf0</span></code>.</p>
</li>
</ol>
</section>
<section id="ai-engine-deadlock-detection-in-the-hardware-emulation-flow">
<h2>AI Engine Deadlock Detection in the Hardware Emulation Flow<a class="headerlink" href="#ai-engine-deadlock-detection-in-the-hardware-emulation-flow" title="Permalink to this heading">¶</a></h2>
<p>Like AI Engine simulator, the hardware emulation flow can also dump VCD for AI Engine. To dump VCD, write <code class="docutils literal notranslate"><span class="pre">AIE_DUMP_VCD=foo</span></code> in a file and specify this file for the <code class="docutils literal notranslate"><span class="pre">-aie-sim-options</span></code> option of <code class="docutils literal notranslate"><span class="pre">launch_hw_emu.sh</span></code>.</p>
<p>It is usually helpful to view the input and output of AI Engine in the waveform. The <code class="docutils literal notranslate"><span class="pre">-g</span></code> option can be added to <code class="docutils literal notranslate"><span class="pre">launch_hw_emu.sh</span></code> to launch the XSIM waveform. The command looks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">launch_hw_emu</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">aie</span><span class="o">-</span><span class="n">sim</span><span class="o">-</span><span class="n">options</span> <span class="o">./</span><span class="n">sim_options</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>When the XSIM GUI pops up, add <code class="docutils literal notranslate"><span class="pre">ai_engine_0</span></code> or the PL kernels’ signals to the waveform. Click <strong>Start</strong> in XSIM. In the Linux prompt, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>After the PS code completes in Linux, check the input to the AI Engine <code class="docutils literal notranslate"><span class="pre">S00_AXIS</span></code> and the output from the AI Engine <code class="docutils literal notranslate"><span class="pre">M00_AXIS</span></code>:</p>
<p><img alt="XSIM" src="../../../../_images/figure81.PNG" /></p>
<p>After the PS receives 104 samples, the design hangs. <code class="docutils literal notranslate"><span class="pre">TVALID</span></code> is always High, indicating that the PL kernel <code class="docutils literal notranslate"><span class="pre">mm2s</span></code> is still trying to send data to the AI Engine, but <code class="docutils literal notranslate"><span class="pre">TREADY</span></code> from the AI Engine turns to Low, and remains Low. There are also no samples from the AI Engine to the PL in the <code class="docutils literal notranslate"><span class="pre">M00_AXIS</span></code> interface of the AI Engine.</p>
<p>Analysis of the VDC file in Vitis Analyzer is similar to analysis in AI Engine simulator. A workaround is to move the VCD file generated by the hardware emulation flow to the working directory and open it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
</section>
<section id="ai-engine-deadlock-detection-in-the-hardware-flow">
<h2>AI Engine Deadlock Detection in the Hardware Flow<a class="headerlink" href="#ai-engine-deadlock-detection-in-the-hardware-flow" title="Permalink to this heading">¶</a></h2>
<p>If a deadlock does not show in the AI Engine simulator or hardware emulation flows, it might still show in the hardware flow.</p>
<p>The PS code to profile how much data has been transferred for the input and output is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event</span><span class="p">::</span><span class="n">handle</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">event</span><span class="p">::</span><span class="n">start_profiling</span><span class="p">(</span><span class="o">*</span><span class="n">dout</span><span class="p">,</span> <span class="n">event</span><span class="p">::</span><span class="n">io_stream_running_event_count</span><span class="p">);</span>
<span class="n">event</span><span class="p">::</span><span class="n">handle</span> <span class="n">handle2</span> <span class="o">=</span> <span class="n">event</span><span class="p">::</span><span class="n">start_profiling</span><span class="p">(</span><span class="o">*</span><span class="n">din</span><span class="p">,</span> <span class="n">event</span><span class="p">::</span><span class="n">io_stream_running_event_count</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">handle</span><span class="o">==</span><span class="n">event</span><span class="p">::</span><span class="n">invalid_handle</span> <span class="o">||</span> <span class="n">handle2</span><span class="o">==</span><span class="n">event</span><span class="p">::</span><span class="n">invalid_handle</span><span class="p">){</span>
	<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;ERROR:Invalid handle. Only two performance counter in a AIE-PL interface tile</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">kernel</span> <span class="n">run</span>
<span class="n">auto</span> <span class="n">s2mm_run</span> <span class="o">=</span> <span class="n">s2mm</span><span class="p">(</span><span class="n">out_bo</span><span class="p">,</span> <span class="n">nullptr</span><span class="p">,</span> <span class="n">OUTPUT_SIZE</span><span class="p">);</span><span class="o">//</span><span class="mi">1</span><span class="n">st</span> <span class="n">run</span> <span class="k">for</span> <span class="n">s2mm</span> <span class="n">has</span> <span class="n">started</span>
<span class="n">auto</span> <span class="n">mm2s_run</span> <span class="o">=</span> <span class="n">mm2s</span><span class="p">(</span><span class="n">in_bo</span><span class="p">,</span> <span class="n">nullptr</span><span class="p">,</span> <span class="n">OUTPUT_SIZE</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Wait</span> <span class="n">graph</span> <span class="k">for</span> <span class="n">some</span> <span class="n">cycles</span>
<span class="n">gr</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">50000</span><span class="p">);</span> <span class="o">//</span> <span class="n">wait</span> <span class="k">for</span> <span class="n">AIE</span> <span class="n">kernel</span> <span class="n">to</span> <span class="n">complete</span> <span class="ow">or</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">50000</span> <span class="n">cycles</span>

<span class="n">long</span> <span class="n">long</span> <span class="n">data_out_count</span> <span class="o">=</span> <span class="n">event</span><span class="p">::</span><span class="n">read_profiling</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
<span class="n">long</span> <span class="n">long</span> <span class="n">data_in_count</span> <span class="o">=</span> <span class="n">event</span><span class="p">::</span><span class="n">read_profiling</span><span class="p">(</span><span class="n">handle2</span><span class="p">);</span>
<span class="n">event</span><span class="p">::</span><span class="n">stop_profiling</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
<span class="n">event</span><span class="p">::</span><span class="n">stop_profiling</span><span class="p">(</span><span class="n">handle2</span><span class="p">);</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s2">&quot;Output data received:&quot;</span><span class="o">&lt;&lt;</span><span class="n">data_out_count</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s2">&quot;Input data sent:&quot;</span><span class="o">&lt;&lt;</span><span class="n">data_in_count</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">mm2s</span></code> needs to be started after <code class="docutils literal notranslate"><span class="pre">event::start_profiling</span></code>. Otherwise, the data transfer begins after <code class="docutils literal notranslate"><span class="pre">mm2s</span></code> starts, and that happens before <code class="docutils literal notranslate"><span class="pre">event::start_profiling</span></code> and <code class="docutils literal notranslate"><span class="pre">gr.run(4)</span></code>.</p>
<p>The output is similar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Output</span> <span class="n">data</span> <span class="n">received</span><span class="p">:</span><span class="mi">0</span>
<span class="n">Input</span> <span class="n">data</span> <span class="n">sent</span><span class="p">:</span><span class="mi">104</span>
</pre></div>
</div>
<p>From how much data has been transferred for the input and output, the status of the design can be estimated. The <code class="docutils literal notranslate"><span class="pre">graph.wait(50000)</span></code> in the above code can be replaced with <code class="docutils literal notranslate"><span class="pre">sleep</span></code> or <code class="docutils literal notranslate"><span class="pre">usleep</span></code> APIs to wait a certain amount of time depending on the scale of the design.</p>
<p>If necessary, an Integrated Logic Analyzer (ILA) can be inserted to probe the interfaces of the PL kernels to detect the AI Engine and PL kernels’ running status.</p>
<section id="methods-to-detect-ai-engine-status-in-hardware-emulation-and-hardware">
<h3>Methods to Detect AI Engine Status in Hardware Emulation and Hardware<a class="headerlink" href="#methods-to-detect-ai-engine-status-in-hardware-emulation-and-hardware" title="Permalink to this heading">¶</a></h3>
<p>This section provides details of other methods of detecting and analyzing AI Engine running status.</p>
<ul>
<li><p><strong>Using <code class="docutils literal notranslate"><span class="pre">xbutil2</span></code> to report graph running status:</strong> The following command can be used to report graph running status：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil2</span> <span class="n">examine</span> <span class="o">-</span><span class="n">r</span> <span class="n">aie</span>
</pre></div>
</div>
<p>`
<img alt="xbutil2 examine -r aie" src="../../../../_images/figure9a.PNG" />
<img alt="xbutil2 examine -r aie" src="../../../../_images/figure9b.PNG" />
<img alt="xbutil2 examine -r aie" src="../../../../_images/figure9c.PNG" />
<img alt="xbutil2 examine -r aie" src="../../../../_images/figure9d.PNG" /></p>
<p><strong>Tip:</strong> If a design hangs in Linux, press <strong>Ctrl+Z</strong> to suspend the design and run command.</p>
<p>It is seen that <code class="docutils literal notranslate"><span class="pre">core[0]</span></code> (tile_24_1, <code class="docutils literal notranslate"><span class="pre">aie_dest2</span></code>)  is in the status <code class="docutils literal notranslate"><span class="pre">east_lock_stall</span></code>, and <code class="docutils literal notranslate"><span class="pre">core[1]</span></code> (tile_25_1, <code class="docutils literal notranslate"><span class="pre">aie_dest1</span></code>) is in the status <code class="docutils literal notranslate"><span class="pre">stream_stall_ms0</span></code>. That is to say, <code class="docutils literal notranslate"><span class="pre">aie_dest1</span></code> is trying to write to the consumer <code class="docutils literal notranslate"><span class="pre">aie_dest2</span></code>, while <code class="docutils literal notranslate"><span class="pre">aie_dest2</span></code> is still trying to acquire lock to start.</p>
<p><strong>Tip:</strong> Cross-probe between <strong>Graph</strong> and <strong>Array</strong> view in Vitis Analyzer to understand kernels, buffers, and the locations of ports.</p>
<p>The following command can be used to report the events that have occurred on ports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">xbutil2</span> <span class="n">examine</span> <span class="o">-</span><span class="n">r</span> <span class="n">aieshim</span>
</pre></div>
</div>
<p><img alt="xbutil2 examine -r aieshim" src="../../../../_images/figure10.PNG" /></p>
<p>Tile (24,0) is where the output locates, and tile (25,0) is where the input locates. It is seen that additional events numbered 75 and 76 happen in the inputs, indicating that input data is read into the AI Engine, but no output data is written.</p>
</li>
<li><p><strong>Using <code class="docutils literal notranslate"><span class="pre">devmem</span></code> to probe AI Engine registers to see AI Engine status:</strong> By using the <code class="docutils literal notranslate"><span class="pre">devmem</span></code> command, you can read AI Engine registers to see the AI Engine internal status. The register reference can be found in the <em>Versal ACAP AI Engine Register Reference</em> (<a class="reference external" href="https://www.xilinx.com/html_docs/registers/am015/am015-versal-aie-register-reference.html">AM015</a>).</p>
<p>For example, the core status registers can be found here:</p>
<p><img alt="core status" src="../../../../_images/figure111.PNG" /></p>
<p>Find the absolute addresses for the kernels in the design. The status of the kernels can be read by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">root</span><span class="nd">@versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">2021_1</span><span class="p">:</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="c1"># devmem 0x2000C872004 </span>
  <span class="mh">0x00001000</span>
  <span class="n">root</span><span class="nd">@versal</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">2021_1</span><span class="p">:</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span><span class="c1"># devmem 0x2000C072004 </span>
  <span class="mh">0x00000200</span>
</pre></div>
</div>
<p>Value <code class="docutils literal notranslate"><span class="pre">0x00001000</span></code> indicates that it is <code class="docutils literal notranslate"><span class="pre">Stream_Stall_MS0</span></code>, and value <code class="docutils literal notranslate"><span class="pre">0x00000200</span></code> indicates that it is <code class="docutils literal notranslate"><span class="pre">Lock_Stall_E</span></code>. The analysis of the result is similar to using <code class="docutils literal notranslate"><span class="pre">xbutil2</span></code>.</p>
</li>
</ul>
</section>
<section id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h3>
<p>After completing this tutorial, you have learned how to detect and analyze design hang issues.</p>
</section>
</section>
</section>
<section id="revision-history">
<h1>Revision History<a class="headerlink" href="#revision-history" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p>July 2021: Initial release.</p></li>
</ul>
<p>© Copyright 2021 Xilinx, Inc.</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on July 27, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="https://pages.gitenterprise.xilinx.com/techdocs/Test/vvas/build/html/index.html#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>