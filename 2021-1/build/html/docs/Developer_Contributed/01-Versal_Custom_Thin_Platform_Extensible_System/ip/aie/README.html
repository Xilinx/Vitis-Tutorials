<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>AI Engine datamover examples &mdash; Vitis™ Tutorials 2021.1 documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2021.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>AI Engine datamover examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/docs/Developer_Contributed/01-Versal_Custom_Thin_Platform_Extensible_System/ip/aie/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>Vitis™ In-Depth Tutorials</h1>
    </td>
 </tr>
</table><section id="ai-engine-datamover-examples">
<h1>AI Engine datamover examples<a class="headerlink" href="#ai-engine-datamover-examples" title="Permalink to this heading">¶</a></h1>
<p>These AI Engine kernel examples demonstrate a few different coding techniques using datamovers as case study.
They also show how to optimize the kernel processing to allow for efficient processing of data with the inner loops.
By modifying the graph and constraints file, the kernel examples can be put in different comparison contexts for learning purpose.</p>
<section id="description-of-the-aie-kernels">
<h2>Description of the AIE kernels<a class="headerlink" href="#description-of-the-aie-kernels" title="Permalink to this heading">¶</a></h2>
<p>The current graph create 4 individual data paths each moving data from PL through an instance of a datamover kernel back to PL.
The kernels are indexed from 0 to 3 using the following kernels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="mf">0.</span> <span class="n">datamover_scalar</span><span class="o">.</span><span class="n">cc</span>      <span class="p">:</span> <span class="n">Uses</span> <span class="n">AIE</span> <span class="n">scalar</span> <span class="n">processing</span> <span class="n">to</span> <span class="n">move</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">data</span> <span class="p">(</span><span class="n">cint16</span><span class="p">)</span> <span class="n">each</span> <span class="n">clock</span> <span class="n">cycle</span><span class="o">.</span>
  <span class="mf">1.</span> <span class="n">datamover_vector_reg</span><span class="o">.</span><span class="n">cc</span>  <span class="p">:</span> <span class="n">Uses</span> <span class="n">AIE</span> <span class="n">vector</span> <span class="n">processing</span> <span class="n">to</span> <span class="n">move</span> <span class="mi">256</span><span class="o">-</span><span class="n">bit</span> <span class="n">data</span> <span class="p">(</span><span class="mi">8</span> <span class="n">lanes</span> <span class="n">of</span> <span class="n">cint16</span><span class="p">)</span> <span class="n">each</span> <span class="n">clock</span> <span class="n">cycle</span><span class="o">.</span>
                                <span class="n">The</span> <span class="n">vector</span> <span class="n">registers</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">temporary</span> <span class="n">storage</span> <span class="k">as</span> <span class="n">a</span> <span class="n">circular</span> <span class="n">buffer</span><span class="o">.</span>
  <span class="mf">2.</span> <span class="n">datamover_mul_one</span><span class="o">.</span><span class="n">cc</span>     <span class="p">:</span> <span class="n">Similar</span> <span class="k">as</span> <span class="n">vector</span> <span class="n">data</span> <span class="n">mover</span><span class="p">,</span> <span class="k">except</span> <span class="n">that</span> <span class="n">the</span> <span class="mi">8</span> <span class="n">lanes</span> <span class="n">are</span> <span class="n">passed</span> <span class="n">through</span> <span class="n">the</span> <span class="n">DSP</span> <span class="n">MUL</span>
                                <span class="n">by</span> <span class="n">multiplying</span> <span class="k">with</span> <span class="mf">1.</span> <span class="n">This</span> <span class="n">mimics</span> <span class="n">the</span> <span class="n">pipeline</span> <span class="n">delay</span> <span class="n">vector</span> <span class="n">MUL</span><span class="o">/</span><span class="n">MAC</span> <span class="n">signal</span> <span class="n">processing</span><span class="o">.</span>
  <span class="mf">3.</span> <span class="n">stream_datamover</span><span class="o">.</span><span class="n">cc</span>      <span class="p">:</span> <span class="n">Based</span> <span class="n">on</span> <span class="n">direct</span> <span class="n">stream</span> <span class="n">access</span> <span class="n">of</span> <span class="n">the</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">AXI</span> <span class="n">Stream</span><span class="o">.</span> <span class="n">As</span> <span class="k">with</span> <span class="n">the</span> <span class="n">vector</span> <span class="n">data</span> <span class="n">mover</span><span class="p">,</span>
                                <span class="n">the</span> <span class="n">vector</span> <span class="n">register</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">as</span> <span class="n">a</span> <span class="n">circular</span> <span class="n">buffer</span><span class="o">.</span> <span class="n">To</span> <span class="n">align</span> <span class="k">with</span> <span class="n">the</span> <span class="mi">128</span><span class="o">-</span><span class="n">bit</span> <span class="n">width</span> <span class="n">of</span> <span class="n">the</span> 
                                <span class="n">vector</span> <span class="n">register</span><span class="p">,</span> <span class="n">the</span> <span class="mi">4</span><span class="p">:</span><span class="mi">1</span> <span class="n">conversion</span> <span class="kn">from</span> <span class="mi">32</span> <span class="n">to</span> <span class="mi">128</span><span class="o">-</span><span class="n">bit</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">stream</span> <span class="n">API</span> <span class="ow">is</span> <span class="n">used</span><span class="o">.</span>
                                <span class="n">In</span> <span class="n">practice</span> <span class="n">this</span> <span class="n">means</span> <span class="n">we</span> <span class="n">can</span> <span class="n">read</span> <span class="mi">128</span><span class="o">-</span><span class="n">bits</span> <span class="n">of</span> <span class="n">data</span> <span class="n">every</span> <span class="mi">4</span><span class="n">th</span> <span class="n">clock</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">corresponding</span> <span class="n">to</span>
                                <span class="mi">4</span> <span class="n">cint16</span> <span class="n">samples</span><span class="o">.</span> <span class="n">Similar</span> <span class="n">argument</span> <span class="k">for</span> <span class="n">the</span> <span class="n">output</span><span class="p">,</span> <span class="n">we</span> <span class="n">write</span> <span class="mi">128</span><span class="o">-</span><span class="n">bit</span> <span class="n">data</span> <span class="n">every</span> <span class="mi">4</span><span class="n">th</span>
                                <span class="n">clock</span> <span class="n">cycle</span> <span class="ow">and</span> <span class="n">the</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span> <span class="n">conversion</span> <span class="n">to</span> <span class="mi">32</span><span class="o">-</span><span class="n">bit</span> <span class="n">stream</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="short-description-of-vector-datamover-optimizations">
<h2>Short description of vector datamover optimizations<a class="headerlink" href="#short-description-of-vector-datamover-optimizations" title="Permalink to this heading">¶</a></h2>
<p>To make efficient use of vector read and write operations, MUL/MAC operations,  and scalar commands some considerations are needed.
The AI Engine core has the capability of processing two 256-bit reads, one 256-bit write, one DSP MUL/MAC operation, and a scalar
instruction in one clock cycle using Very Long Instruction Word. The core also has dedicated registers to manage the counter for
the inner loop as a Zero Overhead Loop.
For this to be scheduled properly, first consider the inner loop in terms of data flow. As this case is bound by the 256-bit writes
we only need to refresh 256-bit vector of input data. To give room for the input data to be stored on the vector register,
it will have to use a 256-bit vector ahead of the output 256-bit vector. This also avoids read and write access on the same
address of the vector register.</p>
<section id="special-note-on-preparing-the-loop">
<h3>Special note on preparing the loop<a class="headerlink" href="#special-note-on-preparing-the-loop" title="Permalink to this heading">¶</a></h3>
<p>The inner loop is where the main work takes place with VLIW keeping the AI Engine busy with processing.
Upon entering the loop, the first operation must have valid data to process. For the vector reg datamover,
this means we need to preload the first 256-bit vector of data before entering the loop. A similar argument for the vector multiplication
data mover, but in this case, we require two 256-bit vectors of data.
This is because we process 8 lanes of data each clock cycle and the permutation for each lane offsets the data in the vector
register according to the figure below.</p>
<img src="../../documentation/readme_files/datamover_mul_one_8_lanes.png"><p>To complete the full circle, the inner loop is unrolled manually so the for loop always starts in the same position.
This is possible due to that the vector register will automatically wrap around according to its type declaration.</p>
</section>
</section>
<section id="compile-and-build-aie-design">
<h2>Compile and build AIE design<a class="headerlink" href="#compile-and-build-aie-design" title="Permalink to this heading">¶</a></h2>
<p>For the global project settings and paths to work, always build the AIE ip from the design root directory.
Use build instructions in step 7.</p>
</section>
<section id="simulating-and-checking-the-aie-kernels">
<h2>Simulating and checking the AIE kernels<a class="headerlink" href="#simulating-and-checking-the-aie-kernels" title="Permalink to this heading">¶</a></h2>
<p>Simulating the kernel is done from the ip/aie directory. For convenience this command can be issued from root dir:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">cd</span> <span class="n">ip</span><span class="o">/</span><span class="n">aie</span><span class="p">;</span><span class="n">make</span> <span class="n">sim_analyzer</span><span class="p">;</span><span class="n">cd</span> <span class="o">-</span>
</pre></div>
</div>
<p>Open the AI Engine Simulation summary with Vitis Analyzer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">vitis_analyzer</span> <span class="n">ip</span><span class="o">/</span><span class="n">aie</span><span class="o">/</span><span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<p>The following documents provide supplemental information for this tutorial.</p>
<section id="ai-engine-documentation">
<h3><a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/yii1603912637443.html">AI Engine Documentation</a><a class="headerlink" href="#ai-engine-documentation" title="Permalink to this heading">¶</a></h3>
<p>Contains sections on how to develop AI Engine graphs, how to use the AI Engine compiler, AI Engine simulation, and performance analysis.</p>
</section>
<section id="vitis-unified-software-development-platform-2021-1-documentation">
<h3><a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/index.html">Vitis Unified Software Development Platform 2021.1 Documentation</a><a class="headerlink" href="#vitis-unified-software-development-platform-2021-1-documentation" title="Permalink to this heading">¶</a></h3>
</section>
</section>
<section id="revision-history">
<h2>Revision History<a class="headerlink" href="#revision-history" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>October   2021 - Updated AI Engine Datamovers</p></li>
<li><p>September 2021 - Initial Release</p></li>
</ul>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<p align="center"><sup>XD106 | © Copyright 2021 Xilinx, Inc.</sup></p></section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on July 27, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>