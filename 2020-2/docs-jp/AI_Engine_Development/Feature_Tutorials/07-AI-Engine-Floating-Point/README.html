


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis チュートリアル
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">English version</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">入門</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis フロー 101 チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS の解析および最適化</a></li>
</ul>
<p class="caption"><span class="caption-text">機械学習 (英語版)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">アクセラレーション</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html">Vitis ハードウェア アクセラレータの概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#id1">設計チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#id2">機能チュートリアル</a></li>
</ul>
<p class="caption"><span class="caption-text">AI エンジン開発 (英語版)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">プラットフォーム作成チュートリアル</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/README.html">プラットフォームの作成</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT および Vitis システム最適化</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html">設計チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html#id2">機能チュートリアル</a></li>
</ul>
<p class="caption"><span class="caption-text">バージョン</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../_sources/AI_Engine_Development/Feature_Tutorials/07-AI-Engine-Floating-Point/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis チュートリアル</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/AI_Engine_Development/Feature_Tutorials/07-AI-Engine-Floating-Point/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table>
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>AI Engine Examples</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h1>Using Floating-Point in the AI Engine</h1>
 </td>
 </tr>
</table><div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this set of examples is to understand floating-point vector computations within the AI Engine.</p>
</div>
<div class="section" id="before-you-begin">
<h1>Before You Begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline">¶</a></h1>
<p>Before starting to explore these examples, refer to the following documents:</p>
<ul class="simple">
<li><p>Versal™ ACAP AI Engine architecture documentation</p>
<ul>
<li><p><strong><a class="reference external" href="https://www.xilinx.com/support/documentation/architecture-manuals/am009-versal-ai-engine.pdf">AI Engine Architecture</a></strong></p></li>
<li><p><strong><a class="reference external" href="https://forums.xilinx.com/t5/Design-and-Debug-Techniques-Blog/Versal-ACAP-AI-Engines-for-Dummies/ba-p/1132493">Versal ACAP AI Engines for Dummies</a></strong></p></li>
<li><p><strong><a class="reference external" href="Details">Architecture Details Summary</a></strong></p></li>
</ul>
</li>
<li><p>Tools and documentation lounge</p>
<ul>
<li><p><strong><a class="reference external" href="https://www.xilinx.com/member/versal_ai_tools_ea.html">AI Engine Tools lounge</a></strong></p></li>
<li><p><strong><a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2020_2/vitis_doc/yii1603912637443.html">UG1076: Versal ACAP AI Engine Programming Environment User Guide</a></strong></p></li>
</ul>
</li>
<li><p>Also, download and install:</p>
<ul>
<li><p>Vitis 2020.2 <strong><a class="reference external" href="https://www.xilinx.com/support/download.html">Download Vitis</a></strong></p></li>
<li><p>Licenses for AI Engine tools.</p></li>
<li><p>Base Platform <strong><a class="reference external" href="https://www.xilinx.com/support/download.html">VCK190 Vitis Platform</a></strong></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ai-engine-architecture-details">
<h1>AI Engine Architecture Details<a class="headerlink" href="#ai-engine-architecture-details" title="Permalink to this headline">¶</a></h1>
<p>Versal adaptive compute acceleration platforms (ACAPs) combine Scalar Engines, Adaptable Engines, and Intelligent Engines with leading-edge memory and interfacing technologies to deliver powerful heterogeneous acceleration for any application.
Intelligent Engines are SIMD VLIW AI Engines for adaptive inference and advanced signal processing compute, and DSP Engines for fixed point, floating point, and complex MAC operations.</p>
<p><img src="./images/Versal.png" width=500 height=380><br></p>
<p>The Intelligent Engine comes as an array of AI Engines connected together using AXI-Stream interconnect blocks:</p>
<p><strong>AI Engine array</strong></p>
<p><img src="./images/AIEngineArray.png" width=500><br></p>
<p>As seen in the image above, each AI Engine is connected to four memory modules on the four cardinal directions.
The AI Engine and memory modules are both connected to the AXI-Stream interconnect.</p>
<p>The AI Engine is  a VLIW (7-way) processor that contains:</p>
<ul class="simple">
<li><p>Instruction Fetch and Decode Unit</p></li>
<li><p>A Scalar Unit</p></li>
<li><p>A Vector Unit (SIMD)</p></li>
<li><p>Three Address Generator Units</p></li>
<li><p>Memory and Stream Interface</p></li>
</ul>
<p><strong>AI Engine Module</strong></p>
<p><img src="./images/AIEngine.png" width=400><br></p>
<p>Have a look at the fixed-point unit pipeline, as well as floating-point unit pipeline within the vector unit.</p>
<div class="section" id="fixed-point-pipeline">
<h2>Fixed-Point Pipeline<a class="headerlink" href="#fixed-point-pipeline" title="Permalink to this headline">¶</a></h2>
<p><img src="./images/FixedPointPipeline.jpg" width=800 height=500><br></p>
<p>In this pipeline one can see the data selection and shuffling units; PMXL, PMXR, and PMC. The pre-add (PRA) is just before the multiply block and then two lane reduction blocks (PSA, PSB) allows to perform up to 128 multiplies and get an output on 16 lanes down to two lanes. The accumulator block is fed either by its own output (AM) or by the upshift output. The feedback on the ACC block is only one clock cycle.</p>
</div>
<div class="section" id="floating-point-pipeline">
<h2>Floating-point Pipeline<a class="headerlink" href="#floating-point-pipeline" title="Permalink to this headline">¶</a></h2>
<p><img src="./images/FloatingPointPipeline.jpg" width=800 height=500><br></p>
<p>In this pipeline one can see that the selection and shuffling units (PMXL, PMC) are the same as in the fixed-point unit. Unlike the fixed-point pipeline there is no lane reduction unit, so the lanes that you have at the input will also be there at the output. Another difference is that the post-accumulator is on two clock cycles. If the goal is to reuse the same accumulator over and over, only one <code class="docutils literal notranslate"><span class="pre">fpmac</span></code> per two clock cycles can be issued.</p>
</div>
</div>
<div class="section" id="floating-point-intrinsics">
<h1>Floating-point intrinsics<a class="headerlink" href="#floating-point-intrinsics" title="Permalink to this headline">¶</a></h1>
<p>There is a limited set of intrinsics with which a multitude of operations can be performed. All of them return either a <code class="docutils literal notranslate"><span class="pre">v8float</span></code> or  <code class="docutils literal notranslate"><span class="pre">v4cfloat</span></code>, 256-bit vectors.</p>
<p>The basic addition, subtraction, and negation functions are as follows:</p>
<ul class="simple">
<li><p>fpadd</p></li>
<li><p>fpadd_abs</p></li>
<li><p>fpsub</p></li>
<li><p>fpsub_abs</p></li>
<li><p>fpneg</p></li>
<li><p>fpneg_abs</p></li>
<li><p>fpabs</p></li>
</ul>
<p>The simple multiplier function is available with the following options:</p>
<ul class="simple">
<li><p>fpmul</p></li>
<li><p>fpabs_mul</p></li>
<li><p>fpneg_mul</p></li>
<li><p>fpneg_abs_mul</p></li>
</ul>
<p>The multiplication accumulation/subtraction function has the following options:</p>
<ul class="simple">
<li><p>fpmac</p></li>
<li><p>fpmac_abs</p></li>
<li><p>fpmsc</p></li>
<li><p>fpmsc_abs</p></li>
</ul>
<p>On top of these various intrinsics you have a fully configurable version multiplier and multiply-accumulate:</p>
<ul class="simple">
<li><p>fpmul_conf</p></li>
<li><p>fpmac_conf</p></li>
</ul>
<div class="section" id="start-offset">
<h2>Start, offset<a class="headerlink" href="#start-offset" title="Permalink to this headline">¶</a></h2>
<p>In all the subsequent intrinsics, the input vector(s) go through a data shuffling function that is controlled by two parameters:</p>
<ul class="simple">
<li><p>Start</p></li>
<li><p>Offset</p></li>
</ul>
<p>Let us take the <code class="docutils literal notranslate"><span class="pre">fpmul</span></code> function:</p>
<p><em>v8float</em> <strong>fpmul</strong>(<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<ul class="simple">
<li><p><strong>xbuf, xstart, xoffs</strong>: first buffer and shuffling parameters</p></li>
<li><p><strong>zbuf, zstart, zoffs</strong>: second buffer and shuffling parameters</p></li>
<li><p><strong>Start</strong>: starting offset for all lanes of the buffer</p></li>
<li><p><strong>Offset</strong>: additional, lane-dependent offset for the buffer. Definition takes 4 bits per lane.</p></li>
</ul>
<p>For example:</p>
<p><em>v8float</em> <strong>ret</strong> = <strong>fpmul</strong>(<strong>xbuf</strong>,<strong>2</strong>,<strong>0x210FEDCB</strong>,<strong>zbuf</strong>,<strong>7</strong>,<strong>0x76543210</strong>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">zstart</span> <span class="o">+</span> <span class="n">zoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
<p>All values in hexadecimal:</p>
<p>| ret <br> Index <br> (Lane) | | xbuf <br> Start | xbuf <br> Offset | Final <br> xbuf <br> Index | | zbuf <br> Start | zbuf <br> Offset | Final <br> zbuf <br> Index |
| :—: | :—: | :—: | :—: | :—: | :—: | :—: | :—: | :—: |
|  0  | | 2  | B  | D  | | 7 | 0 | 7 |
| 1   | | 2  | C  | E  | | 7 | 1 | 8 |
| 2   | | 2  | D  | F  | | 7 | 2 | 9 |
| 3   | | 2  | E  | 10  | | 7 | 3 | A |
| 4   | | 2  | F  | 11  | | 7 | 4 | B |
| 5   | | 2  | 0  | 2   | | 7 | 5 | C |
| 6   | | 2  | 1  | 3   | | 7 | 6 | D |
| 7   | | 2  | 2  | 4   | | 7 | 7 | E |</p>
</div>
<div class="section" id="fpneg-fpabs-fpadd-fpsub">
<h2>fpneg, fpabs, fpadd, fpsub<a class="headerlink" href="#fpneg-fpabs-fpadd-fpsub" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fpneg">
<h3>fpneg<a class="headerlink" href="#fpneg" title="Permalink to this headline">¶</a></h3>
<p>Output is the opposite of its input. Input can be either <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">cfloat</span></code> forming a 512-bit or a 1024-bit buffer (<code class="docutils literal notranslate"><span class="pre">v32float,</span> <span class="pre">v16float,</span> <span class="pre">v16cfloat,</span> <span class="pre">v8cfloat</span></code>). The output is a 256-bit buffer as all the floating-point operators (<code class="docutils literal notranslate"><span class="pre">v8float,</span> <span class="pre">v4cfloat</span></code>).</p>
<p><em>v8float</em> 	<strong>fpneg</strong> (<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="fpabs">
<h3>fpabs<a class="headerlink" href="#fpabs" title="Permalink to this headline">¶</a></h3>
<p>Output is the absolute value of the input.
It takes only real floating-point input vectors.</p>
</div>
<div class="section" id="fpneg-abs">
<h3>fpneg_abs<a class="headerlink" href="#fpneg-abs" title="Permalink to this headline">¶</a></h3>
<p>Output is the negation of the absolute value of the input.
It takes only real floating-point input vectors.</p>
</div>
<div class="section" id="fpadd-fpsub">
<h3>fpadd, fpsub<a class="headerlink" href="#fpadd-fpsub" title="Permalink to this headline">¶</a></h3>
<p>Output is the sum (the subtraction) of the input buffers.</p>
<p><em>v8float</em> 	<strong>fpadd</strong> (<em>v8float</em> <strong>acc</strong>, <em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>)</p>
<p>| Parameter | Comment |
| —: | :— |
| <strong>acc</strong>  |  First addition input buffer. It has the same type as the output|
| <strong>xbuf</strong>  |  Second addition input buffer.|
| <strong>xstart</strong>|	Starting offset for all lanes of X.|
| <strong>xoffs</strong>	|  4 bits per lane: Additional lane-dependent offset for X.|</p>
<p>The executed operation is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
<p>Allowed datatypes:</p>
<ul class="simple">
<li><p><strong>acc</strong>: <code class="docutils literal notranslate"><span class="pre">v8float,</span> <span class="pre">v4cfloat</span></code></p></li>
<li><p><strong>xbuf</strong>: <code class="docutils literal notranslate"><span class="pre">v32float,</span> <span class="pre">v16float,</span> <span class="pre">v16cfloat,</span> <span class="pre">v8cfloat</span></code></p></li>
</ul>
</div>
<div class="section" id="fpadd-abs-fpsub-abs">
<h3>fpadd_abs, fpsub_abs<a class="headerlink" href="#fpadd-abs-fpsub-abs" title="Permalink to this headline">¶</a></h3>
<p>Adds or subtracts the absolute value of the second buffer to the first one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+/-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fpmul">
<h2>fpmul<a class="headerlink" href="#fpmul" title="Permalink to this headline">¶</a></h2>
<p>The simple floating-point multiplier comes in many different flavors mixing or not <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">cfloat</span></code> vector data types. When two <code class="docutils literal notranslate"><span class="pre">cfloat</span></code> are involved, the intrinsic results in two microcode instructions that must be scheduled. The first buffer can be either 512 or 1024-bit long (<code class="docutils literal notranslate"><span class="pre">v32float,</span> <span class="pre">v16float,</span> <span class="pre">v16cfloat,</span> <span class="pre">v8cfloat</span></code>), the second buffer is always 256-bit long (<code class="docutils literal notranslate"><span class="pre">v8float,</span> <span class="pre">v4cfloat</span></code>). Any combination is allowed.</p>
<p><em>v8float</em> <strong>fpmul</strong>(<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<p>Returns the multiplication result.</p>
<p>| Parameter | Comment |
| —: | :— |
| <strong>xbuf</strong>  |  First multiplication input buffer.|
| <strong>xstart</strong>|	Starting offset for all lanes of X.|
| <strong>xoffs</strong>	|  4 bits per lane, additional lane-dependent offset for X.|
| <strong>zbuf</strong>	|  Second multiplication input buffer.|
| <strong>zstart</strong>|	Starting offset for all lanes of Z. This must be a compile time constant.|
| <strong>zoffs</strong> |  	4 bits per lane, additional lane-dependent offset for Z.|</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">zstart</span> <span class="o">+</span> <span class="n">zoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="fpabs-mul">
<h2>fpabs_mul<a class="headerlink" href="#fpabs-mul" title="Permalink to this headline">¶</a></h2>
<p>Only for real arguments. Signature is identical to <code class="docutils literal notranslate"><span class="pre">fpmul</span></code>:</p>
<p><em>v8float</em> <strong>fpabs_mul</strong>(<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<p>It returns the absolute value of the product:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">zstart</span> <span class="o">+</span> <span class="n">zoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="section" id="fpneg-mul">
<h2>fpneg_mul<a class="headerlink" href="#fpneg-mul" title="Permalink to this headline">¶</a></h2>
<p>Signature is identical to <code class="docutils literal notranslate"><span class="pre">fpmul</span></code>:</p>
<p><em>v8float</em> <strong>fpneg_mul</strong>(<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<p>It returns the opposite value of the product:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">zstart</span> <span class="o">+</span> <span class="n">zoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="fpneg-abs-mul">
<h2>fpneg_abs_mul<a class="headerlink" href="#fpneg-abs-mul" title="Permalink to this headline">¶</a></h2>
<p>Only for real arguments. Signature is identical to <code class="docutils literal notranslate"><span class="pre">fpmul</span></code>:</p>
<p><em>v8float</em> <strong>fpneg_mul</strong>(<em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<p>It returns the opposite value of the product:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">xbuf</span><span class="p">[</span><span class="n">xstart</span> <span class="o">+</span> <span class="n">xoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">zstart</span> <span class="o">+</span> <span class="n">zoffs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="fpmac-fpmsc-fpmac-abs-fpmsc-abs">
<h2>fpmac, fpmsc, fpmac_abs, fpmsc_abs<a class="headerlink" href="#fpmac-fpmsc-fpmac-abs-fpmsc-abs" title="Permalink to this headline">¶</a></h2>
<p>For all these functions there is one more argument compared to the <code class="docutils literal notranslate"><span class="pre">fpmul</span></code> function. This is the previous value of the accumulator.</p>
<p><em>v8float</em> <strong>fpmac</strong>(<em>v8float</em> <strong>acc</strong>, <em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>)</p>
<ul class="simple">
<li><p><strong>fpmac</strong> : multiply operands and add to the accumulator</p></li>
<li><p><strong>fpmsc</strong> : multiply operands and subtract from the accumulator</p></li>
<li><p><strong>fpmac_abs</strong> : multiply operands and add the absolute value to the accumulator</p></li>
<li><p><strong>fpmsc_abs</strong> : multiply operands and subtract the absolute value from the accumulator</p></li>
</ul>
<p>The two “abs” variants are available only for real arguments.</p>
</div>
<div class="section" id="fpmul-conf-fpmac-conf">
<h2>fpmul_conf, fpmac_conf<a class="headerlink" href="#fpmul-conf-fpmac-conf" title="Permalink to this headline">¶</a></h2>
<p>These functions are fully configurable <code class="docutils literal notranslate"><span class="pre">fpmul</span></code> and <code class="docutils literal notranslate"><span class="pre">fpmac</span></code>  functions. The output can be considered to always have eight values because each part of the complex float is treated differently A <code class="docutils literal notranslate"><span class="pre">v4cfloat</span></code> will have the loop interating over real0 - complex0 - real1 - complex1 … This capability is introduced to allow flexibility and implement operations on conjugates.</p>
<p><em>v8float</em> <strong>fpmac_conf</strong>(<em>v8float</em> <strong>acc</strong>, <em>v32float</em> <strong>xbuf</strong>, <em>int</em> <strong>xstart</strong>, <em>unsigned int</em> <strong>xoffs</strong>, <em>v8float</em> <strong>zbuf</strong>, <em>int</em> <strong>zstart</strong>, <em>unsigned int</em> <strong>zoffs</strong>, <em>bool</em> <strong>ones</strong>, <em>bool</em> <strong>abs</strong>, <em>unsigned int</em> <strong>addmode</strong>, <em>unsigned int</em> <strong>addmask</strong>, <em>unsigned int</em> <strong>cmpmode</strong>, <em>unsigned int &amp;</em> <strong>cmp</strong>)</p>
<p>Returns the multiplication result.</p>
<p>| Parameter | Comment |
| —: | :— |
| <strong>acc</strong>  |  Current accumulator value. This parameter does not exist for <strong>fpmul_conf</strong>.|
| <strong>xbuf</strong>  |  First multiplication input buffer.|
| <strong>xstart</strong>|	Starting offset for all lanes of X.|
| <strong>xoffs</strong>	|  4 bits per lane: Additional lane-dependent offset for X.|
| <strong>zbuf</strong>	|  <strong>Optional</strong> Second multiplication input buffer. If <strong>zbuf</strong> is not specified, <strong>xbuf</strong> is taken as the second buffer|
| <strong>zstart</strong>|	Starting offset for all lanes of Z. This must be a compile time constant.|
| <strong>zoffs</strong> |  	4 bits per lane: Additional lane-dependent offset for Z.|
| <strong>ones</strong>   |  If true all lanes from Z are replaced with 1.0. |
| <strong>abs</strong>   | If true the absolute value is taken before accumulation.  |
| <strong>addmode</strong>   |  Select one of fpadd_add (all add), fpadd_sub (all sub), fpadd_mixadd or fpadd_mixsub (add-sub or sub-add pairs). This must be a compile time constant. |
| <strong>addmask</strong>   | 8 x 1 LSB bits: Corresponding lane is negated if bit is set (depending on addmode).  |
| <strong>cmpmode</strong>   |  Use “fpcmp_lt” to select the minimum between accumulator and result of multiplication per lane, “fpcmp_ge” for the maximum and “fpcmp_nrm” for the usual sum. |
| <strong>cmp</strong>   |  <strong>Optional</strong> 8 x 1 LSB bits: When using fpcmp_ge or fpcmp_lt in “cmpmode”, it sets a bit if accumulator was chosen (per lane). |</p>
</div>
</div>
<div class="section" id="floating-point-examples">
<h1>Floating-Point Examples<a class="headerlink" href="#floating-point-examples" title="Permalink to this headline">¶</a></h1>
<p>The purpose of this set of examples is to show how to use floating-point computations within the AI Engines in different schemes:</p>
<ul class="simple">
<li><p>FIR filter</p></li>
<li><p>Matrix Multiply</p></li>
</ul>
<div class="section" id="fir-filter">
<h2>FIR Filter<a class="headerlink" href="#fir-filter" title="Permalink to this headline">¶</a></h2>
<p>As there is no post-add lane reduction hardware in the floating-point pipeline of the AI Engine, all outputs will always be on eight lanes (<code class="docutils literal notranslate"><span class="pre">float</span></code>) or four lanes (<code class="docutils literal notranslate"><span class="pre">cfloat</span></code>). This means that we can compute eight (four) lanes in parallel, each time with a single coefficient, using <code class="docutils literal notranslate"><span class="pre">fpmul</span></code> and then <code class="docutils literal notranslate"><span class="pre">fpmac</span></code> for all the coefficients, one by one.</p>
<p>The floating-point accumulator has a latency of two clock cycles, so two <code class="docutils literal notranslate"><span class="pre">fpmac</span></code> instructions using the same accumulator cannot be used back to back, but only every other cycle. Code can be optimized by using two accumulators, used in turn, that get added at the end to get the final result.</p>
<ul class="simple">
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">FIRFilter</span></code> directory.</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> in the console and wait for completion of the three following stages:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Compile</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Simulate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Visualize</span></code></p></li>
</ol>
</li>
</ul>
<p>The last stage is opening <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code> that will allow you to visualize the graph of the design and the simulation process timeline.</p>
<p>In this design you learned:</p>
<ul class="simple">
<li><p>How to use real floating-point data and coefficients in FIR filters.</p></li>
<li><p>How to handle complex floating-point data and complex floating-points coefficients in FIR filters.</p></li>
<li><p>How to organize the compute sequence.</p></li>
<li><p>How to use: <code class="docutils literal notranslate"><span class="pre">fpmul</span></code>, <code class="docutils literal notranslate"><span class="pre">fpmac</span></code>, and <code class="docutils literal notranslate"><span class="pre">fpadd</span></code> in the real and complex case.</p></li>
</ul>
<div class="section" id="real-floating-point-filter">
<h3>Real Floating-Point Filter<a class="headerlink" href="#real-floating-point-filter" title="Permalink to this headline">¶</a></h3>
<p>In the example, the filter has 16 coefficients which do not fit within a 256-bit register. The register must be updated in the middle of the computation.</p>
<p>For data storage a small 512-bit register is used. It is decomposed in two 256-bit parts: W0, W1.</p>
<ul class="simple">
<li><p>First iteration</p>
<ul>
<li><p>Part W0 is loaded with first 8 samples  (0…7)</p></li>
<li><p>Part W1 with the next 8 samples (8…15)</p></li>
<li><p>Part W0 with the following ones (16…23)</p></li>
</ul>
</li>
<li><p>Second iteration</p>
<ul>
<li><p>Part W0 : 8…15</p></li>
<li><p>Part W1 : 16…23</p></li>
<li><p>Part W0 : 24…31</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="complex-floating-point-filter">
<h3>Complex Floating-Point Filter<a class="headerlink" href="#complex-floating-point-filter" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cfloat</span> <span class="pre">x</span> <span class="pre">cfloat</span></code> multiplications take two cycles to perform due to the abscence of the post add. These two parts can be interleaved with the two cycle latency of the accumulator.</p>
<p>There are still 16 coefficients but now they are complex, hence double the size. The coefficients have to be updated four times for a complete iteration. The data transfer is also slightly more complex.</p>
</div>
</div>
<div class="section" id="matrix-multiply">
<h2>Matrix Multiply<a class="headerlink" href="#matrix-multiply" title="Permalink to this headline">¶</a></h2>
<p>In this example, a matrix multiply (A<em>B) example is shown with the simple fpmul and fpmac intrinsics in the real and complex case. In the complex case there are also two other examples using the fpmul_conf and fpmac_conf intrinsics to compute A</em>B and A*conj(B).</p>
<p>Intrinsics being lane by lane computation oriented, this feature will be used to compute a number of consecutive columns of the output matrix. The latency of two of the accumulator is absorbed by computing two rows of the output matrix.</p>
<p>All the parameter settings for the <code class="docutils literal notranslate"><span class="pre">fpmul/mac_conf</span></code> intrinsics are explained in the code itself.</p>
<ul class="simple">
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">MatMult</span></code> directory.</p></li>
<li><p>Type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> in the console and wait for the completions of the 3 stages:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Compile</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Simulate</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Visualize</span></code></p></li>
</ol>
</li>
</ul>
<p>The last stage is opening <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code> that will allow you to visualize the graph of the design and the simulation process timeline.</p>
<p>In this design you learned:</p>
<ul class="simple">
<li><p>How to organize matrix multiply compute sequence when using real or complex floating-point numbers.</p></li>
<li><p>How to handle complex floating-point data and complex floating-points coefficients in FIR filters.</p></li>
<li><p>How to use <code class="docutils literal notranslate"><span class="pre">fpmul_conf</span></code> and <code class="docutils literal notranslate"><span class="pre">fpmac_conf</span></code> intrinsics.</p></li>
</ul>
</div>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”);</p>
<p>you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software</p>
<p>distributed under the License is distributed on an “AS IS” BASIS,</p>
<p>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p>
<p>See the License for the specific language governing permissions and</p>
<p>limitations under the License.</p>
<p align="center"><sup>XD021 | &copy; Copyright 2021 Xilinx, Inc.</sup></p></div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>