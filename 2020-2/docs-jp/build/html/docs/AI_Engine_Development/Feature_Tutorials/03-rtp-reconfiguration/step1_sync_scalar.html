<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Synchronous Update of Scalar RTP &mdash; Vitis™ Tutorials 2020.2 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2020.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Introduction/README.html">Introduction to Vitis Hardware Accelerators Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/README.html">Accelerating Video Convolution Filtering Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/04-traveling-salesperson/README.html">The Travelling Salesman Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/05-bottom_up_rtl_kernel/README.html">Bottom-up RTL Kernel Flow with Vitis for Acceleration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/03-dataflow_debug_and_optimization/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/04-using-hbm/README.html">Using HBM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/03_Edge_VCK190/README.html">Versal Custom Platform Creation Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Synchronous Update of Scalar RTP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/03-rtp-reconfiguration/step1_sync_scalar.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table>
 <tr>
   <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Runtime Parameter Reconfiguration Tutorial</h1>
   </td>
 </tr>
 <tr>
 </td>
 </tr>
</table><div class="section" id="synchronous-update-of-scalar-rtp">
<h1>Synchronous Update of Scalar RTP<a class="headerlink" href="#synchronous-update-of-scalar-rtp" title="Permalink to this heading">¶</a></h1>
<p>Kernel execution depends on the availability of windows of data on their inputs, and the space to write windows of data on their outputs. This example illustrates a complementary method, whereby a kernel will only get triggered to run after a write of data from another processor. This can be an ARM processor or another AI Engine.</p>
<p>In this example, a write from an ARM processor causes a partial sine wave to be generated using the direct digital synthesis (DDS) kernel on the AI Engine. The ARM processor can control the frequency of the sine wave by writing different values to the <code class="docutils literal notranslate"><span class="pre">runtime</span></code> parameter. In HW and HW Cosim flow, the AI Engine output is streamed to the PL kernels, and the PS controls the running AI Engine and PL. The following figure shows this example.</p>
<p><img alt="design structure and flow" src="../../../../_images/figure1.PNG" /></p>
<p><strong>Note: The default working directory in this step is “step1”, unless specified explicitly.</strong></p>
<div class="section" id="review-graph-programming-code">
<h2>Review Graph Programming Code<a class="headerlink" href="#review-graph-programming-code" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Examine the header file, (<code class="docutils literal notranslate"><span class="pre">aie/dds.h</span></code>), of the sine kernel (DDS):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">sine</span><span class="p">(</span><span class="n">const</span> <span class="n">int32</span> <span class="n">phase_increment</span><span class="p">,</span> <span class="n">output_window_cint16</span> <span class="o">*</span> <span class="n">owin</span><span class="p">);</span>
</pre></div>
</div>
<p>Now examine <code class="docutils literal notranslate"><span class="pre">aie/kernels/dds.cc</span></code>, notice how <code class="docutils literal notranslate"><span class="pre">phase_increment</span></code> is used in the sine function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">phase_in</span> <span class="o">+=</span> <span class="p">(</span><span class="n">phase_increment</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
<span class="n">cint16</span> <span class="n">scvalues</span> <span class="o">=</span> <span class="n">sincos</span><span class="p">(</span><span class="n">phase_in</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span> <span class="o">//</span><span class="n">sincos</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">instrinsic</span> <span class="p">(</span><span class="n">see</span> <span class="n">readme</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Examine <code class="docutils literal notranslate"><span class="pre">aie/graph.h</span></code> and <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. These are provided as a starting point to specify the data flow graph of this example.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">graph.h</span></code>, the kernel object <code class="docutils literal notranslate"><span class="pre">dds</span></code>, the graph input port <code class="docutils literal notranslate"><span class="pre">trigger</span></code>, and the graph output port <code class="docutils literal notranslate"><span class="pre">out</span></code> are declared in the <code class="docutils literal notranslate"><span class="pre">ddsgraph</span> <span class="pre">class</span></code>. The dds kernel object is bound to the <code class="docutils literal notranslate"><span class="pre">sine</span></code> function declared in the included <code class="docutils literal notranslate"><span class="pre">dds.h</span></code> header. The dds kernel output is connected to the graph output. It tells the compiler that the source for the function is in <code class="docutils literal notranslate"><span class="pre">kernels/dds.cc</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code>, an instance of the <code class="docutils literal notranslate"><span class="pre">ddsgraph</span></code>, <code class="docutils literal notranslate"><span class="pre">gr</span></code>, is instantiated. The graph output is connected to <code class="docutils literal notranslate"><span class="pre">platform.sink[0]</span></code>, which will be directed to <code class="docutils literal notranslate"><span class="pre">data/output.txt</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>

<span class="n">PLIO</span> <span class="o">*</span><span class="n">dout</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;Dataout&quot;</span><span class="p">,</span> <span class="n">plio_32_bits</span><span class="p">,</span>  <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>

<span class="n">adf</span><span class="p">::</span><span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="n">dout</span><span class="p">);</span>

<span class="n">ddsgraph</span> <span class="n">gr</span><span class="p">;</span>

<span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">main()</span></code> function, graph <code class="docutils literal notranslate"><span class="pre">init()</span></code>, <code class="docutils literal notranslate"><span class="pre">run()</span></code>, and <code class="docutils literal notranslate"><span class="pre">end()</span></code> are called to initialize, run, and wait to be ended.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gr.init();
gr.run(4);
…
gr.end();
</pre></div>
</div>
<p>The graph <code class="docutils literal notranslate"><span class="pre">run()</span></code> has been called with the parameter <code class="docutils literal notranslate"><span class="pre">4</span></code> to specify the iteration number of the graph. Otherwise, it will run forever.</p>
</li>
</ol>
</div>
<div class="section" id="review-rtp-update-code">
<h2>Review RTP Update Code<a class="headerlink" href="#review-rtp-update-code" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Examine <code class="docutils literal notranslate"><span class="pre">aie/graph.h</span></code> again. The following line is to connect the trigger input port of the graph to the first input port of the dds kernel (i.e., the <code class="docutils literal notranslate"><span class="pre">phase_increment</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">sine</span></code> function).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span> <span class="n">dds</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<p>The syntax of this connection is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">input_port</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">output_port</span><span class="o">&amp;</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that you need to use the template class argument <code class="docutils literal notranslate"><span class="pre">adf::parameter</span></code> to specialize the connection type to the parameter type (because you are now connecting parameters and not windows of data). The parameter does not need to be sized in the same way as a window, because the compiler can always determine its size.</p>
</li>
<li><p>Examine <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. You can see the lines of code to update the RTP. Note that the number of updates matches the number of iterations specified in <code class="docutils literal notranslate"><span class="pre">gr.run(4)</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>

<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<p>The graph update calls update:</p>
<ul class="simple">
<li><p>the trigger input with a value of 10 in the ping buffer</p></li>
<li><p>the trigger input with a value of 10  in the pong buffer</p></li>
<li><p>the trigger input with a value of 100 in the ping buffer</p></li>
<li><p>the trigger input with a value of 100 in the pong buffer</p></li>
</ul>
<p>The syntax of the graph update function is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">adf</span><span class="p">::</span><span class="n">graph</span><span class="p">::</span><span class="n">update</span><span class="p">(</span><span class="n">input_port</span> <span class="o">&amp;</span><span class="n">portName</span><span class="p">,</span> <span class="nb">int</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<p>Because the <code class="docutils literal notranslate"><span class="pre">runtime</span></code> parameter in this example is synchronous, the graph execution on the AI Engine will start after the first update call for one iteration, then wait for the next trigger by the next update call. Four consecutive update calls will run the graph for four iterations, where the first two iterations use 10 as the value for the <code class="docutils literal notranslate"><span class="pre">phase_increment</span></code> parameter and the last two iterations use 100.</p>
</li>
</ol>
</div>
<div class="section" id="run-ai-engine-compiler-and-ai-engine-simulator">
<h2>Run AI Engine compiler and AI Engine simulator<a class="headerlink" href="#run-ai-engine-compiler-and-ai-engine-simulator" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Run the AI Engine compiler and the AI Engine simulator to verify the functional correctness of the design. Note that <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> is only used for AI Engine simulator, which is a SystemC simulation.</p>
<p>The make command to run the AI Engine compiler to generate the AI Engine design graph (<code class="docutils literal notranslate"><span class="pre">libadf.a</span></code>) is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">make</span> <span class="n">aie</span>
</pre></div>
</div>
<p>The corresponding command for aiecompiler is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>aiecompiler -platform=$PLATFORM_REPO_PATHS/xilinx_vck190_es1_base_202020_1/xilinx_vck190_es1_base_202020_1.xpfm -include=&quot;./aie&quot; -include=&quot;./data&quot; -include=&quot;./aie/kernels&quot; -include=&quot;./&quot; -workdir=./Work aie/graph.cpp
</pre></div>
</div>
<p>Switches for the AI Engine are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-platform</span></code>: specifies the path to the target platform</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-include</span></code>: specifies the path to find header and source files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-workdir</span></code>: specifies the output directory. By default, the compiler generates all its output into a subdirectory called <code class="docutils literal notranslate"><span class="pre">Work</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-aie/graph.cpp</span></code>: specifies the graph source file</p></li>
</ul>
<p>For more information about AI Engine programming and tools, refer to <em>Versal ACAP AI Engine Programming Environment User Guide</em> (UG1076).</p>
</li>
<li><p>After the graph has been compiled, run <code class="docutils literal notranslate"><span class="pre">aiesimulator</span></code> using the following make command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aiesim</span>
</pre></div>
</div>
<p>The corresponding AI Engine simulator command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiesimulator</span> <span class="o">--</span><span class="n">pkg</span><span class="o">-</span><span class="nb">dir</span><span class="o">=./</span><span class="n">Work</span>
</pre></div>
</div>
<p>After simulation completes, you should see the <code class="docutils literal notranslate"><span class="pre">output.txt</span></code> file in <code class="docutils literal notranslate"><span class="pre">aiesimulator_output/data</span></code>. The output file contains output data and timestamps. You can compare the generated <code class="docutils literal notranslate"><span class="pre">output.txt</span></code> file with the golden reference file (<code class="docutils literal notranslate"><span class="pre">data/golden.txt</span></code>) using the following commands in command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="n">T</span> <span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">output</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">output_data</span><span class="o">.</span><span class="n">txt</span>
<span class="n">diff</span> <span class="o">-</span><span class="n">w</span> <span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">output_data</span><span class="o">.</span><span class="n">txt</span> <span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">golden</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>The timestamps in <code class="docutils literal notranslate"><span class="pre">output.txt</span></code> are removed in the new output file <code class="docutils literal notranslate"><span class="pre">output_data.txt</span></code>. The new output file should match the data in <code class="docutils literal notranslate"><span class="pre">golden.txt</span></code>. If the files match it is normal to see no output from the diff command.</p>
<p>If you are using MATLAB or Octave, you can use the following script to visualize the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;./aiesimulator_output/data/output_data.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;-ascii&#39;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This plots the first column (real part) of the output complex data.</p>
</li>
</ol>
<p><img alt="sine waveform - real" src="../../../../_images/figure2.PNG" /></p>
<p>In <code class="docutils literal notranslate"><span class="pre">aie/kernels/dds.cc</span></code>, the sine kernel function uses the sincos intrinsic with the phase parameter to generate 32-bit integer concatenating Sine (bits [31:16]) and Cosine (bits [15:0]) in signed Q.15 fixed-point format. The 32-bit integer output samples are cast and stored in a <code class="docutils literal notranslate"><span class="pre">cint16</span></code> window. As a result, the first column (real part) represents a cosine waveform. In the four iterations, the first two iterations use a value of 10 as the <code class="docutils literal notranslate"><span class="pre">phase_increment</span></code> parameter and the last two iterations use 100, so you see the cosine waveform frequency increases in the middle of the plot.</p>
<ol>
<li><p>You can then use the following line to plot the second column (imaginary part) of the output complex data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>The following plot shows the sine waveform generated by the <code class="docutils literal notranslate"><span class="pre">sine</span></code> kernel function with the frequency changed in the middle of the simulation iterations.</p>
</li>
</ol>
<p><img alt="sine waveform - imaginary" src="../../../../_images/figure3.PNG" /></p>
</div>
<div class="section" id="build-for-hardware-emulation-and-hardware-flow">
<h2>Build for Hardware Emulation and Hardware Flow<a class="headerlink" href="#build-for-hardware-emulation-and-hardware-flow" title="Permalink to this heading">¶</a></h2>
<p>In the previous step, you generated the AI Engine design graph (<code class="docutils literal notranslate"><span class="pre">libadf.a</span></code>) using the AI Engine compiler. Note that the graph has instantiated a PLIO (in <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>), which will be connected to the PL side.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PLIO</span> <span class="o">*</span><span class="n">dout</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;Dataout&quot;</span><span class="p">,</span> <span class="n">plio_32_bits</span><span class="p">,</span>  <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">plio_32_bits</span></code> indicates the interface to the PL side is 32 bits wide. In the PL side, an HLS kernel <code class="docutils literal notranslate"><span class="pre">s2mm</span></code> will be instantiated. It will receive stream data from the AI Engine graph, and output data to global memory, which will be read by the host code in the PS.</p>
<p><strong>Note</strong>: In this section, the make commands apply to <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> mode by default. Taking the <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> mode as an example, to target <code class="docutils literal notranslate"><span class="pre">hw</span></code> mode, add <code class="docutils literal notranslate"><span class="pre">TARGET=hw</span></code> to the make commands. For detailed commands, change the <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">hw_emu</span></code> option to <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">hw</span></code>.</p>
<p>To compile the HLS PL kernel, run the following make command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">kernels</span>
</pre></div>
</div>
<p>The corresponding v++ compiler command is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="o">++</span> <span class="o">-</span><span class="n">c</span> <span class="o">--</span><span class="n">platform</span> <span class="n">xilinx_vck190_es1_base_202020_1</span> <span class="o">-</span><span class="n">k</span> <span class="n">s2mm</span> <span class="n">s2mm</span><span class="o">.</span><span class="n">cpp</span> <span class="o">-</span><span class="n">o</span> <span class="n">s2mm</span><span class="o">.</span><span class="n">xo</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">temps</span>
</pre></div>
</div>
<p>Switches for the v++ compiler are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span></code>: compiles the kernel source into Xilinx object (<code class="docutils literal notranslate"><span class="pre">.xo</span></code>) files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--platform</span></code>: specifies the name of a supported platform as specified by the <em><code class="docutils literal notranslate"><span class="pre">PLATFORM_REPO_PATHS</span></code></em> environment variable, or the full path to the platform <code class="docutils literal notranslate"><span class="pre">.xpfm</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span></code>: specifies the kernel name.</p></li>
</ul>
<p>The next step is to link the AI Engine graph and PL kernels to generate the hardware platform. The make command for this is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">xclbin</span>
</pre></div>
</div>
<p>This make take 10 minutes or more to complete. The corresponding v++ linker command is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="o">++</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">l</span> <span class="o">--</span><span class="n">platform</span> <span class="n">xilinx_vck190_es1_base_202020_1</span> <span class="n">pl_kernels</span><span class="o">/</span><span class="n">s2mm</span><span class="o">.</span><span class="n">xo</span> <span class="n">libadf</span><span class="o">.</span><span class="n">a</span> <span class="o">-</span><span class="n">t</span> <span class="n">hw_emu</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">temps</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">config</span> <span class="n">system</span><span class="o">.</span><span class="n">cfg</span> <span class="o">-</span><span class="n">o</span> <span class="n">vck190_aie_base_graph_hw_emu</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>Switches for the v++ linker are as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code>: links the PL kernels, AI Engine graph and platform into an FPGA binary file (<code class="docutils literal notranslate"><span class="pre">xclbin</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span></code>: specifies the link target, <code class="docutils literal notranslate"><span class="pre">hw</span></code> for hardware run, <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> for HW emulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--config</span></code>: specifies the configuration file. The configuration file (<code class="docutils literal notranslate"><span class="pre">system.cfg</span></code>), specifies stream connections between the Graph and PL kernels, and other optional selections.</p></li>
</ul>
<p>After generating the hardware platform, host code (<code class="docutils literal notranslate"><span class="pre">sw/host.cpp</span></code>) is to be compiled using the following make command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">host</span>
</pre></div>
</div>
<p>The detailed commands for compiling the host code are as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${CXX} -std=c++14 -I$XILINX_HLS/include/ -I$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux//usr/include/xrt/ -O0 -g -Wall -c -fmessage-length=0 --sysroot=$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux/ -I$XILINX_VITIS/aietools/include -I../ -I../aie -o aie_control_xrt.o aie_control_xrt.cpp
${CXX} -std=c++14 -I$XILINX_HLS/include/ -I$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux//usr/include/xrt/ -O0 -g -Wall -c -fmessage-length=0 --sysroot=$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux/ -I$XILINX_VITIS/aietools/include -I../ -I../aie -o host.o host.cpp
${CXX} -o ../host.exe aie_control_xrt.o host.o -ladf_api_xrt -lgcc -lc -lxrt_coreutil -lxilinxopencl -lpthread -lrt -ldl -lcrypt -lstdc++ -L$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux//usr/lib/ --sysroot=$PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.2/sysroots/aarch64-xilinx-linux/ -L$XILINX_VITIS/aietools/lib/aarch64.o
</pre></div>
</div>
<p>Here, the cross compiler pointed by <code class="docutils literal notranslate"><span class="pre">CXX</span></code> is used to compile the linux host code. <code class="docutils literal notranslate"><span class="pre">aie_control_xrt.cpp</span></code> is copied from the directory <code class="docutils literal notranslate"><span class="pre">Work/ps/c_rts</span></code>.</p>
<p>The host code for HW emulation and HW (<code class="docutils literal notranslate"><span class="pre">sw/host.cpp</span></code>) includes OpenCL APIs to control the executions of PL kernels, and adf APIs <code class="docutils literal notranslate"><span class="pre">(*init(),update(),run(),wait()*)</span></code>. The execution model of the PL kernel is made up of the following steps:</p>
<ol>
<li><p>Get the OpenCL platform and device:</p>
<p>a. Prepare OpenCL context and command queue.</p>
<p>b. Program <code class="docutils literal notranslate"><span class="pre">xclbin</span></code>.</p>
<p>c. Get kernel objects from the program.</p>
</li>
<li><p>Prepare the device buffers for kernels. Transfer data from the host memory to the global memory in the device.</p></li>
<li><p>The host program sets up the kernel with its input parameters and triggers the execution of the kernel on the FPGA.</p></li>
<li><p>Wait for kernel completion.</p></li>
<li><p>Transfer data from the device global memory to host memory.</p></li>
<li><p>Host code performs post-processing on the host memory.</p></li>
</ol>
<p>Following is a code snippet from <code class="docutils literal notranslate"><span class="pre">sw/host.cpp</span></code> to illustrate these concepts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;adf/adf_api/XRTConfig.h&quot;</span>
<span class="c1">#include &quot;experimental/xrt_kernel.h&quot;</span>
<span class="o">...</span>
<span class="o">//</span><span class="mf">1.</span> <span class="n">Get</span> <span class="n">OpenCL</span> <span class="n">platform</span> <span class="ow">and</span> <span class="n">device</span><span class="p">,</span> <span class="n">prepare</span> <span class="n">OpenCL</span> <span class="n">context</span> <span class="ow">and</span> <span class="n">command</span> <span class="n">queue</span><span class="o">.</span> <span class="n">Program</span> <span class="n">xclbin</span><span class="p">,</span> <span class="ow">and</span> <span class="n">get</span> <span class="n">kernel</span> <span class="n">objects</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">program</span><span class="o">.</span> <span class="n">adf</span><span class="p">::</span><span class="n">registerXRT</span><span class="p">()</span> <span class="ow">is</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">ADF</span> <span class="n">API</span><span class="o">.</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Device</span> <span class="n">device</span><span class="p">;</span>
<span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cl</span><span class="p">::</span><span class="n">Platform</span><span class="o">&gt;</span> <span class="n">platforms</span><span class="p">;</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Platform</span><span class="p">::</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">platforms</span><span class="p">);</span>
<span class="o">...</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Context</span> <span class="n">context</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="n">cl</span><span class="p">::</span><span class="n">CommandQueue</span> <span class="n">q</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">CL_QUEUE_PROFILING_ENABLE</span> <span class="o">|</span> <span class="n">CL_QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE</span><span class="p">);</span>
<span class="o">...</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Program</span><span class="p">::</span><span class="n">Binaries</span> <span class="n">bins</span><span class="p">;</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Program</span> <span class="n">program</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">bins</span><span class="p">);</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Kernel</span> <span class="n">krnl_s2mm</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="s2">&quot;s2mm&quot;</span><span class="p">);</span> <span class="o">//</span><span class="n">get</span> <span class="n">kernel</span> <span class="nb">object</span>
<span class="o">...</span>
<span class="o">//</span> <span class="n">Create</span> <span class="n">XRT</span> <span class="n">device</span> <span class="n">handle</span> <span class="k">for</span> <span class="n">ADF</span> <span class="n">API</span>
<span class="n">void</span> <span class="o">*</span><span class="n">dh</span><span class="p">;</span>
<span class="n">device</span><span class="o">.</span><span class="n">getInfo</span><span class="p">(</span><span class="n">CL_DEVICE_HANDLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dh</span><span class="p">);</span>
<span class="n">auto</span> <span class="n">dhdl</span> <span class="o">=</span> <span class="n">xrtDeviceOpenFromXcl</span><span class="p">(</span><span class="n">dh</span><span class="p">);</span>
<span class="n">auto</span> <span class="n">top</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">const</span> <span class="n">axlf</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="n">adf</span><span class="p">::</span><span class="n">registerXRT</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">uuid</span><span class="p">);</span>

<span class="o">//</span><span class="mf">2.</span> <span class="n">Prepare</span> <span class="n">device</span> <span class="n">buffers</span> <span class="k">for</span> <span class="n">kernels</span><span class="o">.</span> <span class="n">Transfer</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">host</span> <span class="n">memory</span> <span class="n">to</span> <span class="k">global</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span> 
<span class="n">std</span><span class="p">::</span><span class="nb">complex</span><span class="o">&lt;</span><span class="n">short</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">host_out</span><span class="p">;</span> <span class="o">//</span><span class="n">host</span> <span class="n">buffer</span>
<span class="n">cl</span><span class="p">::</span><span class="n">Buffer</span> <span class="n">buffer_out</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">CL_MEM_WRITE_ONLY</span><span class="p">,</span> <span class="n">output_size_in_bytes</span><span class="p">);</span>
<span class="n">host_out</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="nb">complex</span><span class="o">&lt;</span><span class="n">short</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">q</span><span class="o">.</span><span class="n">enqueueMapBuffer</span><span class="p">(</span><span class="n">buffer_out</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="n">CL_MAP_READ</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">*</span><span class="n">OUTPUT_SIZE</span><span class="p">,</span><span class="n">nullptr</span><span class="p">,</span><span class="n">nullptr</span><span class="p">,</span><span class="n">nullptr</span><span class="p">);</span>

<span class="o">//</span><span class="mf">3.</span> <span class="n">The</span> <span class="n">host</span> <span class="n">program</span> <span class="n">sets</span> <span class="n">up</span> <span class="n">the</span> <span class="n">kernel</span> <span class="k">with</span> <span class="n">its</span> <span class="nb">input</span> <span class="n">parameters</span>
<span class="n">krnl_s2mm</span><span class="o">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">buffer_out</span><span class="p">);</span>
<span class="n">krnl_s2mm</span><span class="o">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">OUTPUT_SIZE</span><span class="p">);</span>

<span class="o">//</span><span class="n">Launch</span> <span class="n">the</span> <span class="n">Kernel</span>
<span class="n">q</span><span class="o">.</span><span class="n">enqueueTask</span><span class="p">(</span><span class="n">krnl_s2mm</span><span class="p">);</span>

<span class="o">//</span> <span class="n">ADF</span> <span class="n">API</span><span class="p">:</span> <span class="n">Initialize</span><span class="p">,</span> <span class="n">run</span> <span class="ow">and</span> <span class="n">update</span> <span class="n">graph</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">RTP</span><span class="p">)</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">trigger</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>

<span class="o">//</span><span class="mf">4.</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">kernel</span> <span class="n">completion</span><span class="o">.</span> 
<span class="n">q</span><span class="o">.</span><span class="n">finish</span><span class="p">();</span><span class="o">//</span><span class="n">Wait</span> <span class="k">for</span> <span class="n">s2mm</span> <span class="n">to</span> <span class="n">complete</span>    

<span class="o">//</span><span class="mf">5.</span> <span class="n">Transfer</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">global</span> <span class="n">memory</span> <span class="ow">in</span> <span class="n">device</span> <span class="n">to</span> <span class="n">host</span> <span class="n">memory</span><span class="o">.</span>
<span class="n">q</span><span class="o">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">buffer_out</span><span class="p">},</span><span class="n">CL_MIGRATE_MEM_OBJECT_HOST</span><span class="p">);</span>	
<span class="n">q</span><span class="o">.</span><span class="n">finish</span><span class="p">();</span><span class="o">//</span><span class="n">Wait</span> <span class="k">for</span> <span class="n">memory</span> <span class="n">transfer</span> <span class="n">to</span> <span class="n">complete</span>

<span class="o">//</span><span class="mf">6.</span> <span class="n">post</span><span class="o">-</span><span class="n">processing</span> <span class="n">on</span> <span class="n">host</span> <span class="n">memory</span> <span class="o">-</span> <span class="s2">&quot;host_out&quot;</span>
</pre></div>
</div>
<p>Head files “adf/adf_api/XRTConfig.h” and “experimental/xrt_kernel.h” are needed by <code class="docutils literal notranslate"><span class="pre">adf</span></code> API and XRT API.</p>
<p><strong>Note</strong>: In this example, graph execution needs to start before <code class="docutils literal notranslate"><span class="pre">finish()</span></code> for command queue. If <code class="docutils literal notranslate"><span class="pre">finish()</span></code> is invoked first, which is a blocking call, the graph will never start and provide output to s2mm, and hence the application will hang on the blocked point.</p>
<p>The next step is to use v++ with <code class="docutils literal notranslate"><span class="pre">-p</span></code> to generate the package file. The make command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">package</span>
</pre></div>
</div>
<p>The corresponding v++ command to do package is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>v++ -p -t hw_emu -f $PLATFORM_REPO_PATHS/xilinx_vck190_es1_base_202020_1/xilinx_vck190_es1_base_202020_1.xpfm \
--package.rootfs $PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.1/rootfs.ext4  \
--package.kernel_image $PLATFORM_REPO_PATHS/sw/versal/xilinx-versal-common-v2020.1/Image  \
--package.boot_mode=sd \
--package.image_format=ext4 \
--package.defer_aie_run \
--package.sd_dir data \
--package.sd_file host.exe vck190_aie_base_graph_hw_emu.xclbin libadf.a
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">--package.defer_aie_run</span></code> specifies that the Versal AI Engine cores will be enabled by the PS. When not specified, the tool will generate CDO commands to enable the AI Engine cores during PDI load instead. <code class="docutils literal notranslate"><span class="pre">--package.sd_dir</span> <span class="pre">&lt;arg&gt;</span></code> specifies a directory path to package into the *<code class="docutils literal notranslate"><span class="pre">sd_card*</span> <span class="pre">directory/image</span></code>, which is helpful for including some golden data into the package. “<code class="docutils literal notranslate"><span class="pre">--package.sd_file</span> <span class="pre">&lt;arg&gt;</span></code>” is used to specify files to package into the *<code class="docutils literal notranslate"><span class="pre">sd_card*</span> <span class="pre">directory/image</span></code>.</p>
<p>For more details about <code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">-p</span> <span class="pre">(--package)</span></code> options, refer to UG1393.</p>
</div>
<div class="section" id="deploy-for-hardware-emulation-and-hardware-flow">
<h2>Deploy for Hardware Emulation and Hardware Flow<a class="headerlink" href="#deploy-for-hardware-emulation-and-hardware-flow" title="Permalink to this heading">¶</a></h2>
<p>The last step is to run HW emulation with the following make command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run_hw_emu</span>
</pre></div>
</div>
<p>The corresponding script is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">launch_hw_emu</span><span class="o">.</span><span class="n">sh</span> 
</pre></div>
</div>
<p><strong>Hint: Option <code class="docutils literal notranslate"><span class="pre">-add-env</span> <span class="pre">VITIS_LAUNCH_WAVEFORM_BATCH=1</span></code> can be added to <code class="docutils literal notranslate"><span class="pre">launch_hw_emu.sh</span></code> to record the waveform of the platform into waveform file (<code class="docutils literal notranslate"><span class="pre">*.wdb</span></code>).</strong></p>
<p><strong>Hint:If keyboard is accidentally hit that prevents system booting automatically, type <code class="docutils literal notranslate"><span class="pre">boot</span></code> in <code class="docutils literal notranslate"><span class="pre">Versal&gt;</span></code> prompt to resume the system booting.</strong></p>
<p>After Linux has booted, run following commands in Linux prompt (this is only for HW cosim):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p1</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="n">export</span> <span class="n">XCL_EMULATION_MODE</span><span class="o">=</span><span class="n">hw_emu</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>To exit QEMU press Ctrl+A, x</p>
<p>Alternatively, to run in hardware, after booting Linux, run following commands in the Linux prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>The host code is self-checking. It will check the output data against the golden data. If the output data matches the golden data, after the run is completed, it will print:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span> <span class="n">PASSED</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>In this step, you learned about the following core concepts:</p>
<ul class="simple">
<li><p>Synchronous update of scalar RTP</p></li>
<li><p>Flows to perform AIE simulation</p></li>
<li><p>HW emulation and HW run</p></li>
</ul>
<p>Next, review <a class="reference internal" href="step2_async_scalar.html"><span class="doc">Asynchronous Update of Scalar RTP</span></a>.</p>
<p align="center"><sup>Copyright&copy; 2020 Xilinx</sup><br><sup>XD001</sup></br></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on August 5, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>