<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>1. AI Engine Emulator Source Code Debug &mdash; Vitis™ Tutorials 2020.2 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2020.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Introduction/README.html">Introduction to Vitis Hardware Accelerators Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/README.html">Accelerating Video Convolution Filtering Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/04-traveling-salesperson/README.html">The Travelling Salesman Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/05-bottom_up_rtl_kernel/README.html">Bottom-up RTL Kernel Flow with Vitis for Acceleration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/03-dataflow_debug_and_optimization/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/04-using-hbm/README.html">Using HBM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/03_Edge_VCK190/README.html">Versal Custom Platform Creation Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>1. AI Engine Emulator Source Code Debug</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/09-debug-walkthrough/Debug2_ai.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table>
 <tr>
   <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Debug Walkthrough Tutorial - From Simulation to Hardware</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h2>AI Engine Debug with AI Engine Emulator</h2>
 </td>
 </tr>
</table><p>AI Engine emulator provides the following features:</p>
<ul class="simple">
<li><p>Cycle approximate simulation.</p></li>
<li><p>Hardware constraints check such as AI Engine heap/stack/program memory size.</p></li>
<li><p>Functional verification of kernel code via <code class="docutils literal notranslate"><span class="pre">printf()</span></code> and value change dump (VCD) file generation.</p></li>
<li><p>Performance verification of kernel code using VCD file generation and generating profile reports.</p></li>
<li><p>Out of bound memory access checks of kernel code.</p></li>
</ul>
<p>The following steps showcase AI Engine Emulator features:</p>
<p><a class="reference external" href="#1-AI-Engine-emulator-source-code-debug">1. AI Engine Emulator Source Code Debug</a></p>
<ul class="simple">
<li><p><a class="reference external" href="#AI-Engine-emulator-source-code-debug-limitations">AI Engine Emulator Source Code Debug Limitations</a></p></li>
</ul>
<p><a class="reference external" href="#2-AI-Engine-emulator-trace-and-profile-data-generation">2. AI Engine Emulator Trace and Profile Data Generation</a></p>
<p><a class="reference external" href="#3-AI-Engine-emulator-printf-support">3. AI Engine Emulator printf support</a></p>
<ul class="simple">
<li><p><a class="reference external" href="#printf-limitations">printf Limitations</a></p></li>
</ul>
<p><a class="reference external" href="#4-AI-Engine-emulator---enable-memory-check-option">4. AI Engine Emulator –enable-memory-check option</a></p>
<p><a class="reference external" href="#5-Command-line-project-source-code-debug-with-AI-Engine-emulator">5. Command-Line Project Source Code Debug with AI Engine emulator</a></p>
<div class="section" id="ai-engine-emulator-source-code-debug">
<h1>1. AI Engine Emulator Source Code Debug<a class="headerlink" href="#ai-engine-emulator-source-code-debug" title="Permalink to this heading">¶</a></h1>
<div class="section" id="step-1-select-ai-engine-configuration">
<h2>Step 1. Select AI Engine Configuration<a class="headerlink" href="#step-1-select-ai-engine-configuration" title="Permalink to this heading">¶</a></h2>
<p>From the top menu, select <strong>Emulation-AIE</strong> as the current active configuration.</p>
<img src="images/aie_sim_config.png" width="200"></div>
<div class="section" id="step-2-build-with-ai-engine-emulator">
<h2>Step 2. Build with AI Engine Emulator<a class="headerlink" href="#step-2-build-with-ai-engine-emulator" title="Permalink to this heading">¶</a></h2>
<p>Right-click on AI Engine project and select <strong>Build Project</strong> to build.</p>
<img src="images/aie_sim_build.png" width="300"></div>
<div class="section" id="step-3-debug-with-ai-engine-emulator">
<h2>Step 3. Debug with AI Engine Emulator<a class="headerlink" href="#step-3-debug-with-ai-engine-emulator" title="Permalink to this heading">¶</a></h2>
<p>Right-click on AI Engine project, select <strong>Debug As</strong> and <strong>Launch AIE Emulator</strong> to debug AI Engine project.</p>
<img src="images/he_run_aie0.png" width="450"></div>
<div class="section" id="step-4-source-code-debug-with-ai-engine-emulator">
<h2>Step 4. Source Code Debug with AI Engine Emulator<a class="headerlink" href="#step-4-source-code-debug-with-ai-engine-emulator" title="Permalink to this heading">¶</a></h2>
<p>After debugger is launched, the resume, disconnect, step into, step over, and step return buttons can be used to examine source code execution flow. Moving the cursor to each available button, pops up a notice about that button’s functionality.
<img src="images/he_debug.png" width="200"></p>
<p>From the source code view, double-click on line number to setup breakpoint. Breakpoint view will show newly added breakpoint.</p>
<img src="images/he_debug_breakpoint.png" width="800"><p>During debug, highlighted areas indicate changes in values since the last step.
<img src="images/he_run_aie.png"></p>
<img src="images/he_run_aie2.png"></div>
<div class="section" id="step-5-verify-result">
<h2>Step 5. Verify Result<a class="headerlink" href="#step-5-verify-result" title="Permalink to this heading">¶</a></h2>
<p>AI Engine emulator output files from design are located at <code class="docutils literal notranslate"><span class="pre">${PROJECT}/Emulation-AIE/aiesimulator_output/data</span></code>. Verify the output files <code class="docutils literal notranslate"><span class="pre">${PROJECT}/Emulation-AIE/aiesimulation_output/data/dlbf_out[0-7].txt</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT}/Emulation-AIE/aiesimulation_output/data/ulbf_out[0-3].txt</span></code> against golden files <code class="docutils literal notranslate"><span class="pre">${PROJECT}/data/dlbf_gold[0-7].txt</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT}/data/ulbf_gold[0-3].txt</span></code> to ensure that the design’s I/O functionalities are correct. IDE supports compare with feature to compare two files, highlight two files to be compared then right click one of highlighted file and select <code class="docutils literal notranslate"><span class="pre">compare</span> <span class="pre">with</span></code> then <code class="docutils literal notranslate"><span class="pre">each</span> <span class="pre">other</span> <span class="pre">with</span> <span class="pre">transformation</span></code> then <code class="docutils literal notranslate"><span class="pre">Predefined</span> <span class="pre">filters</span></code> then <code class="docutils literal notranslate"><span class="pre">Remove</span> <span class="pre">timestamp</span></code>.
Select <code class="docutils literal notranslate"><span class="pre">each</span> <span class="pre">other</span> <span class="pre">with</span> <span class="pre">transformation</span></code> is due to AIE emulation inserts timestamp for each output data.</p>
</div>
</div>
<div class="section" id="ai-engine-emulator-source-code-debug-limitations">
<h1>AI Engine emulator source code debug limitations<a class="headerlink" href="#ai-engine-emulator-source-code-debug-limitations" title="Permalink to this heading">¶</a></h1>
<ol class="simple">
<li><p>There are maximum four breakpoints available for each tile. Program under debug is stopped at first line of <code class="docutils literal notranslate"><span class="pre">main()</span></code>, this does not impact those available breakpoints.</p></li>
<li><p>Due to compiler <code class="docutils literal notranslate"><span class="pre">-O0</span></code> option is not supported, non-sequential execution when stepping through source code is expected.</p></li>
<li><p>If an individual kernel is highlighted, select resume button to continue execution until next breakpoint or blocked to wait for I/O. If highlight the beamformer design, select resume button to resume all kernels execution until meet each kernel’s breakpoint or blocked  waiting for each kernel’s I/O operation.</p></li>
<li><p>Due to compiler optimization, some variables’ values are stored in registers. “N/A” is shown in variables view for those optimized variables’ values.</p></li>
</ol>
</div>
<div class="section" id="ai-engine-emulator-trace-and-profile-data-generation">
<h1>2. AI Engine Emulator Trace and Profile Data Generation<a class="headerlink" href="#ai-engine-emulator-trace-and-profile-data-generation" title="Permalink to this heading">¶</a></h1>
<div class="section" id="step-1-configuration-before-launching-ai-engine-simulator">
<h2>Step 1: Configuration Before Launching AI Engine Simulator<a class="headerlink" href="#step-1-configuration-before-launching-ai-engine-simulator" title="Permalink to this heading">¶</a></h2>
<p>Highlight beamformer sub-project, right-click to select <strong>Run As</strong> and then <strong>Run configurations…</strong> to enter into a configuration that allows trace and profile selection.</p>
<img src="images/aie_sim_init.png" width="450"><p><strong>Note:</strong> Enable VCD generation for event trace, enable profile generation for selected/all tiles.</p>
<img src="images/aie_sim_init1.png" width="450"><p><strong>Note:</strong> The <code class="docutils literal notranslate"><span class="pre">--simulation-cycle-timeout</span></code> shown in the previous image is OPTIONAL. In case of long run time, this option helps to control execution period so that trace and profile can be generated properly. Clear this option for other tests especially for source code debug to avoid shorter run time.</p>
</div>
<div class="section" id="step-2-launch-ai-engine-emulator">
<h2>Step 2: Launch AI Engine Emulator<a class="headerlink" href="#step-2-launch-ai-engine-emulator" title="Permalink to this heading">¶</a></h2>
<p>After run configuration is completed, right-click on beamformer sub-project to select <strong>Run As</strong> and <strong>Launch AIE Emulator</strong>.
<img src="images/aie_sim_run.png">
Vitis™ IDE console displays <code class="docutils literal notranslate"><span class="pre">[Warning]</span> <span class="pre">:</span> <span class="pre">Sim</span> <span class="pre">result:</span> <span class="pre">0</span></code> indicates this simulation run is completed.</p>
</div>
<div class="section" id="step-3-launch-vitis-analyzer">
<h2>Step 3: Launch Vitis Analyzer<a class="headerlink" href="#step-3-launch-vitis-analyzer" title="Permalink to this heading">¶</a></h2>
<p>Double-click on <strong>${AIE_PROJECT}/Emulation-AIE/aiesimulator_output/default.aierun_summary</strong> to launch Vitis_analyzer for event trace and profile information.
<img src="images/aie_sim_va_launch.png"></p>
<img src="images/aie_sim_va.png">
<img src="images/aie_sim_profile.png"><p><strong>Note:</strong> Click on <strong>Trace</strong> for generated event trace info. Click on <strong>Profile</strong> for selected AI Engine tiles’ profile report files. These events are timing approximately accurate and can be a good reference how the design runs.</p>
</div>
</div>
<div class="section" id="ai-engine-emulator-printf-support">
<h1>3. AI Engine Emulator <code class="docutils literal notranslate"><span class="pre">printf</span></code> Support<a class="headerlink" href="#ai-engine-emulator-printf-support" title="Permalink to this heading">¶</a></h1>
<p>The simplest form of tracing is to use a formatted <code class="docutils literal notranslate"><span class="pre">printf()</span></code> statement in the code for printing debug messages. Visual inspection of intermediate values and addresses can help you understand the progress of program execution. No additional include files are necessary for using <code class="docutils literal notranslate"><span class="pre">printf()</span></code> other than standard C/C++ includes (<code class="docutils literal notranslate"><span class="pre">stdio.h</span></code>). You can add <code class="docutils literal notranslate"><span class="pre">printf()</span></code> statements to your code to be processed during simulation, or hardware emulation, and remove them or comment them out for hardware builds.</p>
<div class="section" id="step-1-add-printf-statement-in-source-code">
<h2>Step 1. Add <code class="docutils literal notranslate"><span class="pre">printf</span></code> statement in source code<a class="headerlink" href="#step-1-add-printf-statement-in-source-code" title="Permalink to this heading">¶</a></h2>
<p>Select <code class="docutils literal notranslate"><span class="pre">bf8x8_fst.cc</span></code> file in Vitis IDE to be edited. Add <code class="docutils literal notranslate"><span class="pre">printf(&quot;prbcnt=%d\n&quot;,</span> <span class="pre">prbcnt);</span></code> statement at line 32 of <code class="docutils literal notranslate"><span class="pre">fb8x8_fst.cc</span></code> file.</p>
<p><strong>Note:</strong> Adding <code class="docutils literal notranslate"><span class="pre">printf()</span></code> statements to your AI Engine kernel code will increase the compiled size of the AI Engine program. Be careful that the compiled size of your kernel code does not exceed the per-AI Engine processor memory limit of 16 KB.</p>
</div>
<div class="section" id="step-2-build-the-project">
<h2>Step 2. Build the Project<a class="headerlink" href="#step-2-build-the-project" title="Permalink to this heading">¶</a></h2>
<p>Highlight the beamformer sub-project, right-click to enable pull-down menu, select <strong>Build Project</strong> to build the beamformer project.</p>
</div>
<div class="section" id="step-3-enable-printf-in-run-configuration">
<h2>Step 3. Enable <code class="docutils literal notranslate"><span class="pre">printf</span></code> in Run Configuration<a class="headerlink" href="#step-3-enable-printf-in-run-configuration" title="Permalink to this heading">¶</a></h2>
<p>To enable <code class="docutils literal notranslate"><span class="pre">printf()</span></code> function, it is required to specify <code class="docutils literal notranslate"><span class="pre">--profile</span></code> in run configuration.</p>
<img src="images/aie_sim_printf0.png" width="450"></div>
<div class="section" id="step-4-run-the-project">
<h2>Step 4. Run the Project<a class="headerlink" href="#step-4-run-the-project" title="Permalink to this heading">¶</a></h2>
<p>Highlight the beamformer sub-project, right-click to enable pull-down menu, select <strong>Run As</strong> and <strong>Launch AIE Emulator</strong> to run the project in Vitis IDE.</p>
</div>
<div class="section" id="step-5-expected-result">
<h2>Step 5. Expected result<a class="headerlink" href="#step-5-expected-result" title="Permalink to this heading">¶</a></h2>
<p>Output of printf statements displays on console window.
<img src="images/aie_sim_printf.png"></p>
</div>
<div class="section" id="printf-limitations">
<h2><code class="docutils literal notranslate"><span class="pre">printf</span></code> Limitations<a class="headerlink" href="#printf-limitations" title="Permalink to this heading">¶</a></h2>
<p>Adding <code class="docutils literal notranslate"><span class="pre">printf()</span></code> statements increases program memory size. Make sure not to exceed program memory size when using <code class="docutils literal notranslate"><span class="pre">printf()</span></code> statements to debug.</p>
</div>
</div>
<div class="section" id="ai-engine-emulator-enable-memory-check-option">
<h1>4. AI Engine Emulator <code class="docutils literal notranslate"><span class="pre">--enable-memory-check</span></code> Option<a class="headerlink" href="#ai-engine-emulator-enable-memory-check-option" title="Permalink to this heading">¶</a></h1>
<p>This option helps to find out of range memory access from each tile during AI Engine emulation run time, however this option impacts run time performance negatively.
The ‘out of range’ memory access indicates valid address assignment within each section. There could be certain addresses that are not assigned between sections. Hence this option is useful to debug the design.</p>
<div class="section" id="step-1-identify-an-invalid-address-from-design">
<h2>Step 1. Identify an Invalid Address from Design<a class="headerlink" href="#step-1-identify-an-invalid-address-from-design" title="Permalink to this heading">¶</a></h2>
<p>From a Linux terminal that points to a valid Vitis IDE installation/setup, issue this command to list a specific tile’s valid memory addresses and sizes assigned by AI Engine compiler. Flag “A” indicates this section will be loaded into tile memory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For Vitis IDE project</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PROJECT_PATH</span><span class="si">}</span>/Emulation-AIE/Work/aie/6_0/Release
<span class="c1"># For command line project</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">PROJECT_PATH</span><span class="si">}</span>/Work/aie/6_0/Release
readelf -S 6_0
</pre></div>
</div>
<img src="images/aie_sim_mem-check1.png" width="450"></div>
<div class="section" id="step-2-add-access-to-an-invalid-memory-address">
<h2>Step 2. Add access to an invalid memory address<a class="headerlink" href="#step-2-add-access-to-an-invalid-memory-address" title="Permalink to this heading">¶</a></h2>
<p>Add these 7 lines at line 27 of <strong>fb8x8_fst.cc</strong> file to access invalid memory address access, for example 0x00039900.</p>
<div class="highlight-base notranslate"><div class="highlight"><pre><span></span>#if 1
    // demo
//  volatile int *loc = (volatile int *)0xdeadbeef;
    volatile int *loc = (volatile int *)0x00039900;
    int test = *loc;
#endif
</pre></div>
</div>
</div>
<div class="section" id="step-3-build-the-application">
<h2>Step 3. Build the application<a class="headerlink" href="#step-3-build-the-application" title="Permalink to this heading">¶</a></h2>
<p>Highlight the beamformer sub-project, right-click to enable pull-down menu, select <strong>Build Project</strong> to build the project.</p>
</div>
<div class="section" id="step-4-add-enable-memory-check-option-in-build-configuration">
<h2>Step 4. Add <code class="docutils literal notranslate"><span class="pre">--enable-memory-check</span></code> option in build configuration<a class="headerlink" href="#step-4-add-enable-memory-check-option-in-build-configuration" title="Permalink to this heading">¶</a></h2>
<p>Highlight beamformer sub-project, right click to select <strong>Run As</strong> then <strong>Run configurations…</strong>. Add <strong>–enable-memory-check</strong> option to run configuration.</p>
</div>
<div class="section" id="step-5-run-the-application">
<h2>Step 5. Run the application<a class="headerlink" href="#step-5-run-the-application" title="Permalink to this heading">¶</a></h2>
<p>Highlight the beamformer sub-project, right click to enable pull-down menu, select <strong>Run As</strong> then <strong>Launch AIE Emulator</strong> to run the project in Vitis IDE.</p>
</div>
<div class="section" id="step-6-expected-result">
<h2>Step 6. Expected result<a class="headerlink" href="#step-6-expected-result" title="Permalink to this heading">¶</a></h2>
<p>Access location at address 0x00039900 that is between sections and is not allowed to access. This triggers the memory check error(s) and displays at Vitis IDE console.</p>
<img src="images/aie_sim_mem-check3.png">
Note: The error messages may be rolled out of visible area, scroll up from console window to inspect the expected error messages.</div>
<div class="section" id="step-7-additional-test">
<h2>Step 7. Additional test<a class="headerlink" href="#step-7-additional-test" title="Permalink to this heading">¶</a></h2>
<p>For invalid memory access that is out of kernel program memory range, for example 0xdeadbeef, a segfault error will be thrown regardless <code class="docutils literal notranslate"><span class="pre">--enable-memory-check</span></code> option is enabled/disabled.
Comment out line 30 and uncomment line 29 from previous source code update. Repeat step 3 and 4 to build and run the update code.
Expect to see the segfault error from Vitis IDE console.
<img src="images/aie_sim_mem-check4.png"></p>
</div>
<div class="section" id="step-8-clean-up">
<h2>Step 8. Clean up<a class="headerlink" href="#step-8-clean-up" title="Permalink to this heading">¶</a></h2>
<p>Remove those added 7 lines of <strong>bf8x8_fst.cc</strong> file from step 2 to maintain source code sanity.</p>
</div>
</div>
<div class="section" id="command-line-project-source-code-debug-with-ai-engine-emulator">
<h1>5. Command line project source code debug with AI Engine emulator<a class="headerlink" href="#command-line-project-source-code-debug-with-ai-engine-emulator" title="Permalink to this heading">¶</a></h1>
<p>Use cases that involve using Vitis IDE functionalities without migrating to Vitis IDE are permitted.</p>
<div class="section" id="step-1-download-the-project">
<h2>Step 1. Download the project<a class="headerlink" href="#step-1-download-the-project" title="Permalink to this heading">¶</a></h2>
<p>Clone the project source from git repository and unzip the zip file.</p>
</div>
<div class="section" id="step-2-build-the-command-line-project-with-debug-capabilities">
<h2>Step 2. Build the Command-Line Project with Debug Capabilities<a class="headerlink" href="#step-2-build-the-command-line-project-with-debug-capabilities" title="Permalink to this heading">¶</a></h2>
<p>Use this tutorial’s <code class="docutils literal notranslate"><span class="pre">Makefile.emu</span></code>  that has <code class="docutils literal notranslate"><span class="pre">--package.enable_aie_debug</span></code>  option in packaging step. This option inserts Configuration Data Object (CDO) that generates stop requests for the AI Engine cores, so that they stop at the reset vector. This option is required to add debug capabilities. Issue command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">package_dbg</span></code>  with this tutorial’s <code class="docutils literal notranslate"><span class="pre">Makefile.emu</span></code> to package binaries that can be debugged.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp Makefile.emu Makefile
make
make package_dbg
</pre></div>
</div>
<p><strong>Note:</strong></p>
<ol class="simple">
<li><p>The packaged binaries that have debug capabilities require to run with debugger. Run without debugger will see execution hang due to wait for debugger invocation. Issue command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">package</span></code> to package binaries back without debugging capabilities.</p></li>
<li><p>Beamformer design takes about 60 minutes or more to build depends on the build computer’s spec.</p></li>
</ol>
</div>
<div class="section" id="step-3-launch-hardware-emulator-and-boot-petalinux">
<h2>Step 3. Launch Hardware Emulator and Boot Petalinux<a class="headerlink" href="#step-3-launch-hardware-emulator-and-boot-petalinux" title="Permalink to this heading">¶</a></h2>
<p>There are two Linux terminals required. Both terminals are required to point to a valid Vitis IDE installation/setup area to use Vitis software platform.
From terminal 1, setup tool path properly and issue this command to launch hardware emulator and boot up Petalinux.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./launch_hw_emu.sh -add-env <span class="nv">ENABLE_RDWR_DEBUG</span><span class="o">=</span><span class="nb">true</span> -add-env <span class="nv">RDWR_DEBUG_PORT</span><span class="o">=</span><span class="m">10100</span> -pid-file emulation.pid -no-reboot -forward-port <span class="m">1440</span> <span class="m">1534</span>
<span class="c1"># Run next command in emulator shell after emulator is up and ready to debug</span>
<span class="nb">source</span> /mnt/sd-mmcblk0p1/init.sh
</pre></div>
</div>
<p>Command option explanation:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-add-env</span> <span class="pre">RDWR_DEBUG_PORT=${aie_mem_sock_port}</span></code> defines the port for communicating with the AI Engine domain. In the previous example, it is 10100.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-forward-port</span> <span class="pre">${linux_tcf_agent_port}</span></code> 1534 defines the port for the Linux TCF agent. In the previous example, it is 1440, which is the default.</p></li>
</ol>
<p>Note:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">launch_hw_emu.sh</span></code> is generated properly when the project under debug is built and packaged with hardware emulator correctly. Update repository’s Makefile line 3 from <code class="docutils literal notranslate"><span class="pre">TARGET</span> <span class="pre">=</span> <span class="pre">hw</span></code> to <code class="docutils literal notranslate"><span class="pre">TARGET</span> <span class="pre">=</span> <span class="pre">hw_emu</span></code>.</p></li>
<li><p>This command takes a few minutes to run because both hardware emulator and Petalinux are required to boot up properly.</p></li>
<li><p>Wait until both hardware server and Petalinux boot up then move to next step.</p></li>
</ol>
</div>
<div class="section" id="step-4-run-host-application-from-emulation-console">
<h2>Step 4. Run Host Application from Emulation Console<a class="headerlink" href="#step-4-run-host-application-from-emulation-console" title="Permalink to this heading">¶</a></h2>
<p>After emulator and Petalinux boot up, issue these commands from emulator console (terminal 1 from step 3).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /mnt/sd-mmcblk0p1
<span class="nb">source</span> ./init.sh
<span class="nb">export</span> <span class="nv">XILINX_XRT</span><span class="o">=</span>/usr
./host.exe a.xclbin
</pre></div>
</div>
<p>Note: This step is required to initialize and debug AI Engine tiles because this design has the <code class="docutils literal notranslate"><span class="pre">--package.defer_aie_run</span></code> option.</p>
</div>
<div class="section" id="step-5-launch-vitis-ide-and-xrt-server">
<h2>Step 5. Launch Vitis IDE and XRT Server<a class="headerlink" href="#step-5-launch-vitis-ide-and-xrt-server" title="Permalink to this heading">¶</a></h2>
<p>From terminal 2, setup tool path properly and issue this command to launch XRT server and Vitis IDE.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vitis -debug -flow embedded -os baremetal -port <span class="m">4352</span> -launch-script <span class="si">${</span><span class="nv">PROJECT_PATH</span><span class="si">}</span>/aie_app_debug_em.tcl
xrt_server -I30000 -S -s tcp::4352
</pre></div>
</div>
<p>Command options:</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vitis</span> <span class="pre">-debug</span></code>: Launches the Vitis IDE in standalone debug mode.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-flow</span> <span class="pre">embedded</span></code>: Specifies the embedded processor flow for the AI Engine processor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-os</span> <span class="pre">baremetal</span></code>: For baremetal OS of the AI Engine domain.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-port</span> <span class="pre">4352</span></code>: Specifies the xrt_server port as discussed in Step 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-launch_script</span> <span class="pre">${aie_project}/aie_app_debug_em.tcl</span></code>: Specifies the Tcl script which sets up the AI Engine debug environment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-I30000</span></code>: Defines an idle timeout in seconds, in which the server will quit if there is no response.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-S</span></code>: Specifies print server properties in JSON format to stdout.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">tcp::${xrt_server_port}</span></code>: Defines the agent listening protocol and port. It is 4352 in example, but can be any free port.</p></li>
</ol>
<p><strong>Note:</strong> Debugger could be blocked from PS execution initially. Run PS application from simulator shell so debugger stops at first line of main function (default) from AIE tiles.</p>
</div>
<div class="section" id="step-6-expected-vitis-ide">
<h2>Step 6. Expected Vitis IDE<a class="headerlink" href="#step-6-expected-vitis-ide" title="Permalink to this heading">¶</a></h2>
<img src="images/aie_cl_run.png"></div>
<div class="section" id="step-7-clean-up-launched-processes">
<h2>Step 7. Clean up Launched Processes<a class="headerlink" href="#step-7-clean-up-launched-processes" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>killall -9 pllauncher<span class="p">;</span> killall -9 qemu-system-aarch64<span class="p">;</span> killall -9 xrt_server
</pre></div>
</div>
</div>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
<p align="center"><sup>XD005 | &copy; Copyright 2021 Xilinx, Inc.</sup></p></div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on August 5, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>