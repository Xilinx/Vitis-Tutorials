


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis In-Depth Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Machine_Learning/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html">Introduction to Vitis Hardware Accelerators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Creation Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/README.html">Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT and Vitis System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html">Xilinx Runtime (XRT) and Vitis System Optimization Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../_sources/AI_Engine_Development/Feature_Tutorials/02-using-gmio/single_aie_gmio.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis In-Depth Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>AI Engine GMIO Programming Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/AI_Engine_Development/Feature_Tutorials/02-using-gmio/single_aie_gmio.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>AI Engine GMIO Tutorial</h1>
   </td>
 </tr>
 <tr>
 </td>
 </tr>
</table><div class="section" id="ai-engine-gmio-programming-model">
<h1>AI Engine GMIO Programming Model<a class="headerlink" href="#ai-engine-gmio-programming-model" title="Permalink to this headline">¶</a></h1>
<p>This example introduces AI Engine GMIO programming model. It includes three steps:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Step-1---Synchronous-GMIO-Transfer">Step 1 - Synchronous GMIO Transfer</a></p></li>
<li><p><a class="reference external" href="#Step-2---Asynchronous-GMIO-transfer-for-Input-and-Synchronous-GMIO-transfer-for-Output">Step 2 - Asynchronous GMIO transfer for Input and Synchronous GMIO transfer for Output</a></p></li>
<li><p><a class="reference external" href="#Step-3---Asynchronous-GMIO-Transfer-and-Hardware-flow">Step 3 - Asynchronous GMIO Transfer and Hardware flow</a></p></li>
</ul>
<p>We will use AI Engine simulator event trace in each step to see how performance can be improved step by step. The last step introduces code to make GMIO work in hardware.</p>
<div class="section" id="step-1-synchronous-gmio-transfer">
<h2>Step 1 - Synchronous GMIO Transfer<a class="headerlink" href="#step-1-synchronous-gmio-transfer" title="Permalink to this headline">¶</a></h2>
<p>In this step, we introduce the synchronous GMIO transfer mode. Change the working directory to <code class="docutils literal notranslate"><span class="pre">single_aie_gmio/step1</span></code>. Looking at the graph code <code class="docutils literal notranslate"><span class="pre">aie/graph.h</span></code>, it can be seen that the design has one output <code class="docutils literal notranslate"><span class="pre">out</span></code> and one input <code class="docutils literal notranslate"><span class="pre">din</span></code>, with an AI Engine kernel <code class="docutils literal notranslate"><span class="pre">weighted_sum_with_margin</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">mygraph</span><span class="p">:</span> <span class="n">public</span> <span class="n">adf</span><span class="p">::</span><span class="n">graph</span>
<span class="p">{</span>
<span class="n">private</span><span class="p">:</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">kernel</span> <span class="n">k_m</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">port</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">direction</span><span class="p">::</span><span class="n">out</span><span class="o">&gt;</span> <span class="n">out</span><span class="p">;</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">port</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">direction</span><span class="p">::</span><span class="ow">in</span><span class="o">&gt;</span> <span class="n">din</span><span class="p">;</span>
  <span class="n">mygraph</span><span class="p">()</span>
  <span class="p">{</span>
  <span class="n">k_m</span> <span class="o">=</span> <span class="n">adf</span><span class="p">::</span><span class="n">kernel</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">weighted_sum_with_margin</span><span class="p">);</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">window</span><span class="o">&lt;</span><span class="mi">1024</span><span class="p">,</span><span class="mi">32</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">din</span><span class="p">,</span> <span class="n">k_m</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">window</span><span class="o">&lt;</span><span class="mi">1024</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">k_m</span><span class="o">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out</span><span class="p">);</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">source</span><span class="p">(</span><span class="n">k_m</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;weighted_sum.cc&quot;</span><span class="p">;</span>
  <span class="n">adf</span><span class="p">::</span><span class="n">runtime</span><span class="o">&lt;</span><span class="n">adf</span><span class="p">::</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k_m</span><span class="p">)</span><span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Examine the host code in <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. It is seen that two <code class="docutils literal notranslate"><span class="pre">GMIO</span></code> ports, <code class="docutils literal notranslate"><span class="pre">gmioIn</span></code> and <code class="docutils literal notranslate"><span class="pre">gmioOut</span></code>, are instantiated and they are connected to the platform input and output. Then the graph is instantiated and connected to the platform.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>
<span class="n">GMIO</span> <span class="n">gmioIn</span><span class="p">(</span><span class="s2">&quot;gmioIn&quot;</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">GMIO</span> <span class="n">gmioOut</span><span class="p">(</span><span class="s2">&quot;gmioOut&quot;</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">adf</span><span class="p">::</span><span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gmioIn</span><span class="p">,</span><span class="o">&amp;</span><span class="n">gmioOut</span><span class="p">);</span>
<span class="n">mygraph</span> <span class="n">gr</span><span class="p">;</span>
<span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gr</span><span class="o">.</span><span class="n">din</span><span class="p">);</span>
</pre></div>
</div>
<p>The GMIO instantiation <code class="docutils literal notranslate"><span class="pre">gmioIn</span></code> represents the DDR memory space to be read by the AI Engine and <code class="docutils literal notranslate"><span class="pre">gmioOut</span></code> represents the DDR memory space to be written by the AI Engine. The constructor specifies the logical name of the GMIO, burst length (that can be 64,
128, or 256 bytes) of the memory-mapped AXI4 transaction, and the required bandwidth in MB/s (here 1000 MB/s).</p>
<p>Inside the main function, two 256-element int32 arrays (1024 bytes) are allocated by <code class="docutils literal notranslate"><span class="pre">GMIO::malloc</span></code>. The <code class="docutils literal notranslate"><span class="pre">dinArray</span></code> points to the memory space to be read by the AI Engine and the <code class="docutils literal notranslate"><span class="pre">doutArray</span></code> points to the memory space to be written by the AI Engine. In Linux, the vitual address passed to <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie_nb</span></code>, <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm_nb</span></code>, <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie</span></code>, and <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm</span></code> must be allocated by <code class="docutils literal notranslate"><span class="pre">GMIO::malloc</span></code>. After the input data is allocated, it can be initialized.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span><span class="o">*</span> <span class="n">dinArray</span><span class="o">=</span><span class="p">(</span><span class="n">int32</span><span class="o">*</span><span class="p">)</span><span class="n">GMIO</span><span class="p">::</span><span class="n">malloc</span><span class="p">(</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
<span class="n">int32</span><span class="o">*</span> <span class="n">doutArray</span><span class="o">=</span><span class="p">(</span><span class="n">int32</span><span class="o">*</span><span class="p">)</span><span class="n">GMIO</span><span class="p">::</span><span class="n">malloc</span><span class="p">(</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">doutRef</span></code> is used for golden output reference. It can be allocated by a standard <code class="docutils literal notranslate"><span class="pre">malloc</span></code> because it does not involve GMIO transfer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span><span class="o">*</span> <span class="n">doutRef</span><span class="o">=</span><span class="p">(</span><span class="n">int32</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie</span></code> and <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie_nb</span></code> are used to initiate read transfers from the AI Engine to DDR memory using memory-mapped AXI transactions. The first argument in <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie</span></code> and <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie_nb</span></code> is the pointer to the start address of the memory space for the transaction (here <code class="docutils literal notranslate"><span class="pre">dinArray</span></code>). The second argument is the transaction size in bytes. The memory space for the transaction must be within the memory space allocated by <code class="docutils literal notranslate"><span class="pre">GMIO::malloc</span></code>. Similarly, <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm</span></code> and <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm_nb</span></code> are used to initiate write transfers from the AI Engine to DDR memory. <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie_nb</span></code> and <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm_nb</span></code> are non-blocking functions that return immediately when the transaction is issued - they do not wait for the transaction to complete. In contrast, the functions, <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie</span></code> and <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm</span></code> behave in a blocking manner.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmioIn</span><span class="o">.</span><span class="n">gm2aie</span><span class="p">(</span><span class="n">dinArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ITERATION</span><span class="p">);</span>
<span class="n">gmioOut</span><span class="o">.</span><span class="n">aie2gm</span><span class="p">(</span><span class="n">doutArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
</pre></div>
</div>
<p>The blocking transfer (<code class="docutils literal notranslate"><span class="pre">gmioIn.gm2aie</span></code>) has to be completed before <code class="docutils literal notranslate"><span class="pre">gr.run()</span></code> because the GMIO transfer is in synchronous mode here. But the window input of the graph (in PING-PONG manner by default) has only two buffers to store the received data. This means that at the maximum, two blocks of window input data can be transferred by GMIO blocking transfer. Otherwise, the <code class="docutils literal notranslate"><span class="pre">GMIO::gm2aie</span></code> will block the design. In this example program, <code class="docutils literal notranslate"><span class="pre">ITERATION</span></code> is set to one.</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">GMIO::aie2gm()</span></code> is working in synchronous mode, the output processing can be done just after it is completed.</p>
<p><strong>Note:</strong> The memory is non-cachable for GMIO in Linux.</p>
<p>In the example program, the design runs four iterations in a loop. In the loop, pre-processing and post-processing are done before and after data transfer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
  <span class="o">//</span><span class="n">pre</span><span class="o">-</span><span class="n">processing</span>
  <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">ITERATION</span><span class="o">*</span><span class="mi">1024</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
    <span class="n">dinArray</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">gmioIn</span><span class="o">.</span><span class="n">gm2aie</span><span class="p">(</span><span class="n">dinArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
  <span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ITERATION</span><span class="p">);</span>
  <span class="n">gmioOut</span><span class="o">.</span><span class="n">aie2gm</span><span class="p">(</span><span class="n">doutArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>

  <span class="o">//</span><span class="n">post</span><span class="o">-</span><span class="n">processing</span>
  <span class="n">ref_func</span><span class="p">(</span><span class="n">dinArray</span><span class="p">,</span><span class="n">coeff</span><span class="p">,</span><span class="n">doutRef</span><span class="p">,</span><span class="n">ITERATION</span><span class="o">*</span><span class="mi">1024</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">ITERATION</span><span class="o">*</span><span class="mi">1024</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">doutArray</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">!=</span><span class="n">doutRef</span><span class="p">[</span><span class="n">j</span><span class="p">]){</span>
      <span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s2">&quot;ERROR:dout[&quot;</span><span class="o">&lt;&lt;</span><span class="n">j</span><span class="o">&lt;&lt;</span><span class="s2">&quot;]=&quot;</span><span class="o">&lt;&lt;</span><span class="n">doutArray</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s2">&quot;,gold=&quot;</span><span class="o">&lt;&lt;</span><span class="n">doutRef</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="n">error</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When PS has completed processing, the memory space allocated by <code class="docutils literal notranslate"><span class="pre">GMIO::malloc</span></code> can be released by <code class="docutils literal notranslate"><span class="pre">GMIO::free</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GMIO</span><span class="p">::</span><span class="n">free</span><span class="p">(</span><span class="n">dinArray</span><span class="p">);</span>
<span class="n">GMIO</span><span class="p">::</span><span class="n">free</span><span class="p">(</span><span class="n">doutArray</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="run-ai-engine-compiler-and-ai-engine-simulator">
<h3>Run AI Engine compiler and AI Engine simulator<a class="headerlink" href="#run-ai-engine-compiler-and-ai-engine-simulator" title="Permalink to this headline">¶</a></h3>
<p>Run the following make command to compile the design graph <code class="docutils literal notranslate"><span class="pre">libadf.a</span></code> and launch the AI Engine simulator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aiesim</span>
</pre></div>
</div>
<p>Notice that “–dump-vcd” option is added to the AI Engine simulator command. Use <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code> to open AI Engine simulator run result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="o">./</span><span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
<p>Click the <code class="docutils literal notranslate"><span class="pre">Trace</span></code> tab in the Vitis™ analyzer. The events are shown as follows:</p>
<p><img alt="Event trace result" src="../../../_images/picture1.png" /></p>
<p>The red arrow denotes the dependency between data transfer and kernel execution. It can be seen that the data transfer and kernel execution are performed in a sequential manner. The time required for kernel execution is much longer than that for data transfer. Next, let us overlay data transfer and kernel execution with a vectorized kernel.</p>
</div>
</div>
<div class="section" id="step-2-asynchronous-gmio-transfer-for-input-and-synchronous-gmio-transfer-for-output">
<h2>Step 2 - Asynchronous GMIO transfer for Input and Synchronous GMIO transfer for Output<a class="headerlink" href="#step-2-asynchronous-gmio-transfer-for-input-and-synchronous-gmio-transfer-for-output" title="Permalink to this headline">¶</a></h2>
<p>In the previous step, it was identified that the sequential manner of data transfer and kernel execution is the main bottleneck of the design performance. In this step, the AI Engine kernel is replaced with a vectorized version to reduce kernel execution time. Change the working directory to <code class="docutils literal notranslate"><span class="pre">single_aie_gmio/step2</span></code>. The vectorized kernel code is in <code class="docutils literal notranslate"><span class="pre">aie/weighted_sum.cc</span></code>.</p>
<p>Besides the kernel update, we try to do asychronous GMIO transfers for inputs, but leave synchronous GMIO transfers for outputs in this step. The purpose of mixing synchronous and asychronous GMIO transfers is to overlap data transfer and kernel execution. Thus, the performance is further improved.</p>
<p>Examine the code in main function <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. This time <code class="docutils literal notranslate"><span class="pre">ITERATION</span></code> is four, and graph is executed by four iterations with <code class="docutils literal notranslate"><span class="pre">gr.run(ITERATION)</span></code> and the GMIO transaction from memory to AI Engine is through non-blocking GMIO API <code class="docutils literal notranslate"><span class="pre">gmioIn.gm2aie_nb(dinArray,BLOCK_SIZE_in_Bytes);</span></code>. It does not block the following executions. However, we will keep using blocking GMIO API for output data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">pre</span><span class="o">-</span><span class="n">processing</span>
<span class="o">...</span>
<span class="n">gmioIn</span><span class="o">.</span><span class="n">gm2aie_nb</span><span class="p">(</span><span class="n">dinArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span><span class="o">//</span><span class="n">Transfer</span> <span class="nb">all</span> <span class="n">blocks</span> <span class="nb">input</span> <span class="n">data</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ITERATION</span><span class="p">);</span> <span class="o">//</span><span class="n">ITERATION</span><span class="o">=</span><span class="mi">4</span>
<span class="n">gmioOut</span><span class="o">.</span><span class="n">aie2gm</span><span class="p">(</span><span class="n">doutArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span><span class="o">//</span><span class="n">Transfer</span> <span class="nb">all</span> <span class="n">blocks</span> <span class="n">output</span> <span class="n">data</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span>
<span class="o">...</span>
<span class="o">//</span><span class="n">post</span><span class="o">-</span><span class="n">processing</span>
</pre></div>
</div>
<p>Althrough a non-blocking GMIO API is used to transfer the input data, there is no need for explicit synchronization between data transfer and kernel execution. The synchronization between input data transfer and kernel execution is guaranteed by the window buffer, meaning that every iteration of kernel execution will wait for the block of input data to be ready. The output data is synchronized using a blocking GMIO API. After the blocking API returns, the data is guaranteed to be available in DDR memory and the post-processing sequence can be safely started.</p>
<div class="section" id="id1">
<h3>Run AI Engine compiler and AI Engine simulator<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Run the following make command to compile the design graph <code class="docutils literal notranslate"><span class="pre">libadf.a</span></code> and launch the AI Engine simulator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aiesim</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code> to open AI Engine simulator run result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="o">./</span><span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
<p>Click the <code class="docutils literal notranslate"><span class="pre">Trace</span></code> tab in the Vitis Analyzer. The events are shown as follows:</p>
<p><img alt="Event trace result" src="../../../_images/picture2.png" /></p>
<p>The red arrow denotes the dependency between data transfer and kernel execution and orange rectangle shows overlapping between data transfer and kernel execution. It can be seen that the kernel execution time has been reduced (by comparing to data transfer) and data transfer and kernel execution are overlapping. In the next step, let us explore asynchronous output data transfer and its synchronization mechanism.</p>
</div>
</div>
<div class="section" id="step-3-asynchronous-gmio-transfer-and-hardware-flow">
<h2>Step 3 - Asynchronous GMIO Transfer and Hardware flow<a class="headerlink" href="#step-3-asynchronous-gmio-transfer-and-hardware-flow" title="Permalink to this headline">¶</a></h2>
<p>In this step, we will see how to asynchronously transfer output data with non-blocking GMIO API, and how to use <code class="docutils literal notranslate"><span class="pre">GMIO::wait</span></code> to perform data synchronization. In addition, we will see how to run the AI Engine program with GMIO in hardware.</p>
<p>Change working directory to <code class="docutils literal notranslate"><span class="pre">single_aie_gmio/step3</span></code>. Examine <code class="docutils literal notranslate"><span class="pre">aie/graph.cpp</span></code>. The main difference in code is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmioIn</span><span class="o">.</span><span class="n">gm2aie_nb</span><span class="p">(</span><span class="n">dinArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span><span class="o">//</span><span class="n">Transfer</span> <span class="nb">all</span> <span class="n">blocks</span> <span class="nb">input</span> <span class="n">data</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ITERATION</span><span class="p">);</span>
<span class="n">gmioOut</span><span class="o">.</span><span class="n">aie2gm_nb</span><span class="p">(</span><span class="n">doutArray</span><span class="p">,</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span><span class="o">//</span><span class="n">Transfer</span> <span class="nb">all</span> <span class="n">blocks</span> <span class="n">output</span> <span class="n">data</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span>
<span class="o">//</span><span class="n">PS</span> <span class="n">can</span> <span class="n">do</span> <span class="n">other</span> <span class="n">tasks</span> <span class="n">here</span> <span class="n">when</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">transferring</span>
<span class="n">gmioOut</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">gmioOut.aie2gm_nb()</span></code> will return immediately after it has been called without waiting for the data transfer to be completed. PS can do other tasks after non-blocking API call when data is transferring. Then, it needs <code class="docutils literal notranslate"><span class="pre">gmioOut.wait();</span></code> to do the data synchronization. After <code class="docutils literal notranslate"><span class="pre">GMIO::wait</span></code>, the output data is in memory and can be processed by the host application.</p>
<p>To make GMIO work in hardware flow, the following code needs to be added to the main function before graph execution and GMIO data transfer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if !defined(__AIESIM__) &amp;&amp; !defined(__ADF_FRONTEND__)</span>
	<span class="c1">#include &quot;adf/adf_api/XRTConfig.h&quot;</span>
	<span class="c1">#include &quot;experimental/xrt_kernel.h&quot;</span>
	<span class="o">//</span> <span class="n">Create</span> <span class="n">XRT</span> <span class="n">device</span> <span class="n">handle</span> <span class="k">for</span> <span class="n">ADF</span> <span class="n">API</span>
	<span class="n">char</span><span class="o">*</span> <span class="n">xclbinFilename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">auto</span> <span class="n">dhdl</span> <span class="o">=</span> <span class="n">xrtDeviceOpen</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="o">//</span><span class="n">device</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">xrtDeviceLoadXclbinFile</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span><span class="n">xclbinFilename</span><span class="p">);</span>
	<span class="n">xuid_t</span> <span class="n">uuid</span><span class="p">;</span>
	<span class="n">xrtDeviceGetXclbinUUID</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">uuid</span><span class="p">);</span>
	<span class="n">adf</span><span class="p">::</span><span class="n">registerXRT</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">uuid</span><span class="p">);</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>The macro <code class="docutils literal notranslate"><span class="pre">__AIESIM__</span></code> is automatically defined by tool when running AI Engine simulator. The macro <code class="docutils literal notranslate"><span class="pre">__ADF_FRONTEND__</span></code> is automatically defined by tool when running x86simulator. Using the guard macro <code class="docutils literal notranslate"><span class="pre">__AIESIM__</span></code> and <code class="docutils literal notranslate"><span class="pre">__ADF_FRONTEND__</span></code> as shown in the previous code, this part of code is not used in AI Engine simulator, but used in hardware flow and hardware emulation flow to make those flows work correctly.</p>
<p>At the end of the program, close the device using the XRT API <code class="docutils literal notranslate"><span class="pre">xrtDeviceClose()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if !defined(__AIESIM__) &amp;&amp; !defined(__ADF_FRONTEND__)</span>
	<span class="n">xrtDeviceClose</span><span class="p">(</span><span class="n">dhdl</span><span class="p">);</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<div class="section" id="run-ai-engine-simulator-and-hardware-flow">
<h3>Run AI Engine simulator and hardware flow<a class="headerlink" href="#run-ai-engine-simulator-and-hardware-flow" title="Permalink to this headline">¶</a></h3>
<p>Run the following make command to compile the design graph <code class="docutils literal notranslate"><span class="pre">libadf.a</span></code> and launch the AI Engine simulator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aiesim</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code> to open AI Engine simulator run result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="o">./</span><span class="n">aiesimulator_output</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">aierun_summary</span>
</pre></div>
</div>
<p>Click the <code class="docutils literal notranslate"><span class="pre">Trace</span></code> tab in the Vitis Analyzer. The events are displayed as shown in the following figure:</p>
<p><img alt="Event trace result" src="../../../_images/picture3.png" /></p>
<p>It can be seen that the data transfer and kernel execution are overlapping.</p>
<p>Run the following make command to build image for hardware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">package</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span>
</pre></div>
</div>
<p>After the package is done, run the following commands in the Linux prompt after booting Linux from an SD card:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span>
<span class="o">./</span><span class="n">host</span><span class="o">.</span><span class="n">exe</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>The host code is self-checking. It will check the output data against the golden data. If the output data matches the golden data after the run is complete, it will print the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>PASS!
</pre></div>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>In this example, you learned about the following core concepts:</p>
<ul class="simple">
<li><p>Programming model for blocking and non-blocking GMIO transactions</p></li>
<li><p>Improve design performance by using guidance from the AI Engine simulator event trace</p></li>
<li><p>Hardware flow for AI Engine GMIO</p></li>
</ul>
<p>Next, review <a class="reference internal" href="single_pl_gmio.html"><span class="doc">PL GMIO Programming Model</span></a>.</p>
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2020-2021 Xilinx</sup></p><p>Licensed under the Apache License, Version 2.0 (the “License”);</p>
<p>you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/</span><span class="n">LICENSE</span><span class="o">-</span><span class="mf">2.0</span>
</pre></div>
</div>
<p>Unless required by applicable law or agreed to in writing, software</p>
<p>distributed under the License is distributed on an “AS IS” BASIS,</p>
<p>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</p>
<p>See the License for the specific language governing permissions and</p>
<p>limitations under the License.</p>
<p align="center"><sup>XD007</sup></p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>