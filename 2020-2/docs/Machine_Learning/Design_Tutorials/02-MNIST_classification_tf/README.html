


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis In-Depth Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Introduction to Machine Learning with Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html">Introduction to Vitis Hardware Accelerators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/README.html#feature-tutorials">Feature Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/README.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platform Creation Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/README.html">Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">XRT and Vitis System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/README.html">Xilinx Runtime (XRT) and Vitis System Optimization Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/Vitis-Tutorials-2019.2-Hotfix1/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../_sources/Machine_Learning/Design_Tutorials/02-MNIST_classification_tf/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis In-Depth Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Current status</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/Machine_Learning/Design_Tutorials/02-MNIST_classification_tf/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!--
Copyright 2020 Xilinx Inc.
 
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0
 
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Author: Mark Harvey, Xilinx Inc
--><table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>Vitis AI Tutorials</h1>
   </td>
 </tr>
 <tr>
 <td align="center"><h3>MNIST Classification using Vitis AI and TensorFlow 1.15</h3>
 </td>
 </tr>
</table><div class="section" id="current-status">
<h1>Current status<a class="headerlink" href="#current-status" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Tested with Vitis AI 1.3 and TensorFlow 1.15</p></li>
<li><p>Tested on the following platforms: ZCU102, Alveo U50</p></li>
</ul>
</div>
<div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This tutorial introduces the user to the Vitis AI TensorFlow design process and will illustrate how to go from a python description of the network model to running a compiled model on a Xilinx evaluation board.</p>
<p>The application code in this example design is written in Python and uses the VART runtime.</p>
<p>We will run the following steps:</p>
<ul class="simple">
<li><p>Training and evaluation of a small custom convolutional neural network using TensorFlow 1.15</p></li>
<li><p>Removal of the training nodes and conversion of the graph variables to constants (..often referred to as ‘freezing the graph’).</p></li>
<li><p>Evaluation of the floating-point frozen model using the MNIST test dataset.</p></li>
<li><p>Quantization of the floating-point frozen model.</p></li>
<li><p>Evaluation of the quantized 8bit model using the MNIST test dataset.</p></li>
<li><p>Compilation of the quantized model to create the .xmodel file ready for execution on the DPU accelerator IP.</p></li>
<li><p>Download and run the application on the ZCU102 and/or Alveo U50 evaluation board.</p></li>
</ul>
</div>
<div class="section" id="the-mnist-dataset">
<h1>The MNIST dataset<a class="headerlink" href="#the-mnist-dataset" title="Permalink to this headline">¶</a></h1>
<p>The MNIST handwritten digits dataset is a publicly available dataset that contains a total of 70k 8bit grayscale images each of which are 28pixels x 28pixels. The complete dataset of 70k images is normally divided into 60k images for training and 10k images for validation. The dataset is considered to be the ‘hello world’ of machine learning and makes a simple introduction to learn the complete Xilinx Vitis-AI flow.</p>
<p><img alt="mnist" src="Machine_Learning\Design_Tutorials\02-MNIST_classification_tf\./files/img/mnist.png?raw=true" /></p>
</div>
<div class="section" id="the-convolution-neural-network">
<h1>The convolution neural network<a class="headerlink" href="#the-convolution-neural-network" title="Permalink to this headline">¶</a></h1>
<p>The convolutional neural network in this design has deliberately been kept as simple as possible and consists of just four layers of 2D convolution interspersed with batch normalization and ReLU activation. The network is described in the customcnn.py python script.</p>
<p><img alt="cnn" src="Machine_Learning\Design_Tutorials\02-MNIST_classification_tf\./files/img/cnn.png?raw=true" /></p>
</div>
<div class="section" id="preparing-the-host-machine-and-target-boards">
<h1>Preparing the host machine and target boards<a class="headerlink" href="#preparing-the-host-machine-and-target-boards" title="Permalink to this headline">¶</a></h1>
<p>The host machine has several requirements that need to be met before we begin. You will need:</p>
<ul class="simple">
<li><p>An x86 host machine with a supported OS and either the CPU or GPU versions of the Vitis-AI docker installed - see <a class="reference external" href="https://github.com/Xilinx/Vitis-AI/blob/master/docs/system_requirements.md">System Requirements</a>.</p></li>
<li><p>The host machine will require Docker to be installed and the Vitis-AI GPU docker image to be built - see <a class="reference external" href="https://github.com/Xilinx/Vitis-AI#getting-started">Getting Started</a>.</p></li>
<li><p>A GPU card suitable for training is recommended, but the training in this tutorial is quite simple and a CPU can be used.</p></li>
<li><p>If you plan to use the ZCU102 evaluation board, it should be prepared with the board image as per the <a class="reference external" href="https://github.com/Xilinx/Vitis-AI/tree/master/setup/mpsoc/VART#step2-setup-the-target">Setup the Target</a> instructions. Hints on how to connect the various cables to the ZCU102 are also available <a class="reference external" href="https://www.xilinx.com/html_docs/vitis_ai/1_3/installation.html#yjf1570690235238">here</a>.</p></li>
<li><p>For the Alveo U50, follow the <a class="reference external" href="https://github.com/Xilinx/Vitis-AI/tree/master/setup/alveo/u50_u50lv_u280#setup-alveo-accelerator-card-with-hbm-for-dpucahx8hl">Setup Alveo Accelerator Card with HBM for DPUCAHX8H/L</a> instructions</p></li>
</ul>
<p>For more details, refer to the latest version of the <em>Vitis AI User Guide</em> (<a class="reference external" href="https://www.xilinx.com/html_docs/vitis_ai/1_3/zmw1606771874842.html">UG1414</a>).</p>
<p>This tutorial assumes the user is familiar with Python3, TensorFlow and has some knowledge of machine learning principles.</p>
</div>
<div class="section" id="shell-scripts-in-this-tutorial">
<h1>Shell scripts in this tutorial<a class="headerlink" href="#shell-scripts-in-this-tutorial" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0_setenv.sh</span></code> : Sets all necessary environment variables used by the other scripts. Most variables can be edited by the user to configure the environment for their own requirements. Note that the image_input_fn.py Python script contains a reference to the list of calibration images as an absolute path:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calib_image_list</span> <span class="o">=</span> <span class="s1">&#39;./build/quantize/images/calib_list.txt&#39;</span>
</pre></div>
</div>
<p>..so if either of the <code class="docutils literal notranslate"><span class="pre">BUILD</span></code> or <code class="docutils literal notranslate"><span class="pre">QUANT</span></code> variables are modified in <code class="docutils literal notranslate"><span class="pre">0_setenv.sh</span></code> then the absolute path in <code class="docutils literal notranslate"><span class="pre">image_input_fn.py</span></code> will also need to be modified.</p>
<p>It is highly recommended to leave the <code class="docutils literal notranslate"><span class="pre">CALIB_IMAGES</span></code> variable set to 1000 as this is the minimum recommended number of images for calibration of the quantization.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1_train.sh</span></code>  : Runs training and evaluation of the network. Will save the trained model as an inference graph and floating-point checkpoint.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2_freeze.sh</span></code> : Converts the inference graph and checkpoint into a single binary protobuf file (.pb). The output .pb file is generally known as a ‘frozen graph’ since all variables are converted into constants and graph nodes associated with training such as the optimizer and loss functions are stripped out.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3_eval_frozen_graph.sh</span></code> : This is an optional step which tests the accuracy of the frozen graph. The accuracy results should be very similar to the results obtained after training.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">4_quant.sh</span></code> : This script first creates a set of image files to be used in the calibration phase of quantization and then launches the <code class="docutils literal notranslate"><span class="pre">vai_q_tensorflow</span> <span class="pre">quantize</span></code> command to convert the floating-point frozen graph to a fixed-point integer model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">5_eval_quant_graph.sh</span></code> : This step is optional but highly recommended - it will run the same evaluation function that was used to evaluate the frozen graph on the quantized model. Users should confirm that the accuracy reported by the evaluation of the quantized model is sufficient for their requirements and similar to the results for the floating-point models.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">6_compile_u50.sh</span></code> : Launches the <code class="docutils literal notranslate"><span class="pre">vai_c_tensorflow</span></code> command to compile the quantized model into an .xmodel file for the Alveo U50 accelerator card.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">6_compile_zcu102.sh</span></code>: Launches the <code class="docutils literal notranslate"><span class="pre">vai_c_tensorflow</span></code> command to compile the quantized model into an .xmodel file for the ZCU102 evaluation board.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">7_make</span> <span class="pre">target_u50.sh</span></code> : Copies the .xmodel and images to the <code class="docutils literal notranslate"><span class="pre">./build/target_u50</span></code> folder ready for use with the Alveo U50 accelerator card.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">7_make</span> <span class="pre">target_zcu102.sh</span></code> : Copies the .xmodel and images to the <code class="docutils literal notranslate"><span class="pre">./build/target_zcu102</span></code> folder ready to be copied to the ZCU102 evaluation board’s SD card.</p></li>
</ul>
</div>
<div class="section" id="image-pre-processing">
<h1>Image pre-processing<a class="headerlink" href="#image-pre-processing" title="Permalink to this headline">¶</a></h1>
<p>All images are undergo simple pre-processing before being used for training, evaluation and quantization calibration. The images are normalized to bring all pixel values into the range 0 to 1 by dividing them by 255.</p>
</div>
<div class="section" id="implementation">
<h1>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h1>
<p>Clone or download this GitHub repository to your local machine where you have installed the necessary tools. Open a linux terminal, cd into the repository folder then into the ‘files’ folder. Start the Vitis AI docker - if you have a GPU in the host system, it is recommended that you use the GPU version of the docker container, however if a GPU is not available then the CPU docker container will be sufficient:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># navigate to densenet tutorial folder</span>
<span class="nb">cd</span> &lt;path_to_MNIST_design&gt;/files

<span class="c1"># to start GPU docker</span>
./docker_run.sh xilinx/vitis-ai-gpu:latest

<span class="c1"># ..or to start CPU docker</span>
./docker_run.sh xilinx/vitis-ai-cpu:latest
</pre></div>
</div>
<p>The docker container will start and you should see something like this in the terminal:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">==========================================</span>
 
__      ___ _   _                   _____
<span class="se">\ \ </span>   / <span class="o">(</span>_<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>_<span class="o">)</span>            /<span class="se">\ </span>  <span class="p">|</span>_   _<span class="p">|</span>
 <span class="se">\ \ </span> / / _<span class="p">|</span> <span class="p">|</span>_ _ ___ ______ /  <span class="se">\ </span>   <span class="p">|</span> <span class="p">|</span>
  <span class="se">\ \/</span> / <span class="p">|</span> <span class="p">|</span> __<span class="p">|</span> / __<span class="p">|</span>______/ /<span class="se">\ \ </span>  <span class="p">|</span> <span class="p">|</span>
   <span class="se">\ </span> /  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="se">\_</span>_ <span class="se">\ </span>    / ____ <span class="se">\ </span>_<span class="p">|</span> <span class="p">|</span>_
    <span class="se">\/</span>   <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_<span class="p">|</span>_<span class="p">|</span>___/    /_/    <span class="se">\_\_</span>____<span class="p">|</span>
 
<span class="o">==========================================</span>

Docker Image Version:  <span class="m">1</span>.3 
Build Date: <span class="m">2020</span>-12-20
VAI_ROOT: /opt/vitis_ai

For TensorFlow Workflows <span class="k">do</span>:
     conda activate vitis-ai-tensorflow 
For Caffe Workflows <span class="k">do</span>:
     conda activate vitis-ai-caffe 
For Neptune Workflows <span class="k">do</span>:
     conda activate vitis-ai-neptune 
For PyTorch Workflows <span class="k">do</span>:
     conda activate vitis-ai-pytorch 
For TensorFlow <span class="m">2</span>.3 Workflows <span class="k">do</span>:
     conda activate vitis-ai-tensorflow2 
For Darknet Optimizer Workflows <span class="k">do</span>:
     conda activate vitis-ai-optimizer_darknet 
For Caffe Optimizer Workflows <span class="k">do</span>:
     conda activate vitis-ai-optimizer_caffe 
For TensorFlow <span class="m">1</span>.15 Workflows <span class="k">do</span>:
     conda activate vitis-ai-optimizer_tensorflow 
For LSTM Workflows <span class="k">do</span>:
     conda activate vitis-ai-lstm 
Vitis-AI /workspace &gt; 
</pre></div>
</div>
<blockquote>
<div><p>:bulb: If you get a “Permission Denied” error message when starting the Docker container, it is almost certainly because the <code class="docutils literal notranslate"><span class="pre">docker_run.sh</span></code> script is not set as being executable. You can fix this by running the command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ chmod +x ./docker_run.sh
</pre></div>
</div>
</div></blockquote>
<p>The complete tools flow can be run just by executing the <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">run_all.sh</span></code> command, or by running each of the steps in order (from <code class="docutils literal notranslate"><span class="pre">0_setenv.sh</span></code> to <code class="docutils literal notranslate"><span class="pre">7_make_target_&lt;board_name&gt;.sh</span></code>):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> ./0_setenv.sh
$ <span class="nb">source</span> ./1_train.sh
.
.
$ <span class="nb">source</span> ./7_make_target_u50.sh
</pre></div>
</div>
</div>
<div class="section" id="running-the-application-on-the-zcu102-board">
<h1>Running the application on the ZCU102 board<a class="headerlink" href="#running-the-application-on-the-zcu102-board" title="Permalink to this headline">¶</a></h1>
<p>All of the required files for running on the ZCU102 board are copied into the <code class="docutils literal notranslate"><span class="pre">files/build/target_zcu102</span></code> folder by the <code class="docutils literal notranslate"><span class="pre">7_make_target_zcu102.sh</span></code> script. The <code class="docutils literal notranslate"><span class="pre">7_make_target_zcu102.sh</span></code> script also copies the test set images to <code class="docutils literal notranslate"><span class="pre">files/build/target_zcu102/images</span></code> - the application code will preprocess and classify these images. The entire target_zcu102 folder will need to be copied to the ZCU102 SDcard.</p>
<p>Copying the complete <code class="docutils literal notranslate"><span class="pre">files/build/target_zcu102</span></code> folder to the /home/root folder of the flashed SD card can be done in one of several ways:</p>
<ol class="simple">
<li><p>Direct copy to SD Card:</p></li>
</ol>
<ul class="simple">
<li><p>If your host machine has an SD card slot, insert the flashed SD card and when it is recognised you will see two volumes, BOOT and ROOTFS. Navigate into the ROOTFS and then into the /home folder.  Make the ./root folder writeable by issuing the command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">-R</span> <span class="pre">777</span> <span class="pre">root</span></code> and then copy the entire <code class="docutils literal notranslate"><span class="pre">files/build/target_zcu102</span></code> folder from the host machine into the /home/root folder of the SD card.</p></li>
<li><p>Unmount both the BOOT and ROOTFS volumes from the host machine and then eject the SD Card from the host machine.</p></li>
</ul>
<ol class="simple">
<li><p>With scp command:</p></li>
</ol>
<ul class="simple">
<li><p>If the ZCU102 is connected to a network and reachable by the host machine, the target folder can be copied using scp. If you connect directly from your host machine to the ZCU102 using ethernet, you may need to set up static IP addresses.</p></li>
<li><p>The command will be something like <code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">-r</span> <span class="pre">build/target_zcu102</span> <span class="pre">root&#64;192.168.1.227:~/.</span></code> assuming that the ZCU102 IP address is 192.168.1.227 - adjust this and the path to the target folder as appropriate for your system.</p></li>
<li><p>If the password is asked for, insert ‘root’.</p></li>
</ul>
<p>With the target folder copied to the SD Card and the ZCU102 booted, you can issue the command for launching the application - note that this is done on the ZCU102 board, not the host machine, so it requires a connection to the ZCU102 such as a serial connection to the UART or an SSH connection via Ethernet.</p>
<p>The application can be started by navigating into the target_zcu102 folder (<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">target_zcu102</span></code>) and then issuing the command <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">app_mt.py</span></code>. The application will start and after a few seconds will show the throughput (in frames/sec) and the accuracy:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>root@xilinx-zcu102-2020_2:~ <span class="nb">cd</span> target_zcu102
root@xilinx-zcu102-2020_2:~/target_zcu102# python3 app_mt.py 
Command line options:
 --image_dir :  images
 --threads   :  <span class="m">1</span>
 --model     :  model_dir/customcnn.xmodel
Pre-processing <span class="m">10000</span> images...
Starting <span class="m">1</span> threads...
<span class="nv">Throughput</span><span class="o">=</span><span class="m">3248</span>.51 fps, total <span class="nv">frames</span> <span class="o">=</span> <span class="m">10000</span>, <span class="nv">time</span><span class="o">=</span><span class="m">3</span>.0783 seconds
Correct:9870, Wrong:130, Accuracy:0.9870
</pre></div>
</div>
<p>For better throughput, the number of threads can be increased by using the <code class="docutils literal notranslate"><span class="pre">-t</span></code> option. For example, to execute with 4 threads:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>root@xilinx-zcu102-2020_2:~/target_zcu102# python3 app_mt.py -t <span class="m">4</span>
Command line options:
 --image_dir :  images
 --threads   :  <span class="m">4</span>
 --model     :  model_dir/customcnn.xmodel
Pre-processing <span class="m">10000</span> images...
Starting <span class="m">4</span> threads...
<span class="nv">Throughput</span><span class="o">=</span><span class="m">5771</span>.71 fps, total <span class="nv">frames</span> <span class="o">=</span> <span class="m">10000</span>, <span class="nv">time</span><span class="o">=</span><span class="m">1</span>.7326 seconds
Correct:9870, Wrong:130, Accuracy:0.9870
</pre></div>
</div>
</div>
<div class="section" id="running-the-application-on-the-alveo-u50">
<h1>Running the application on the Alveo U50<a class="headerlink" href="#running-the-application-on-the-alveo-u50" title="Permalink to this headline">¶</a></h1>
<p>This final step will copy all the required files for running on the U50 into the <code class="docutils literal notranslate"><span class="pre">./build/target_u50</span></code> folder. The <code class="docutils literal notranslate"><span class="pre">7_make_target_u50.sh</span></code> script also copies the test set images to <code class="docutils literal notranslate"><span class="pre">/build/target_u50/images</span></code> - the application code will preprocess and classify these images.</p>
<p>The following steps should be run from inside the Vitis-AI Docker container.</p>
<p>Run the <code class="docutils literal notranslate"><span class="pre">U50_overlay.sh</span></code> script (internet connection required) to download and install the correct overlay on the U50 (note that the U50 will need to have been flashed with the correct deployment shell - this should have been done in the ‘Preparing the host machine and target boards’ section above). The complete steps to run are as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> U50_overlay.sh
<span class="nb">cd</span> build/target_u50
/usr/bin/python3 app_mt.py -m model_dir/customcnn.xmodel
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>vitis-ai-tensorflow<span class="o">)</span> Vitis-AI /workspace/build/target_u50 &gt; /usr/bin/python3 app_mt.py
Command line options:
 --image_dir :  images
 --threads   :  <span class="m">1</span>
 --model     :  model_dir/customcnn.xmodel
Pre-processing <span class="m">10000</span> images...
Starting <span class="m">1</span> threads...
<span class="nv">Throughput</span><span class="o">=</span><span class="m">8006</span>.58 fps, total <span class="nv">frames</span> <span class="o">=</span> <span class="m">10000</span>, <span class="nv">time</span><span class="o">=</span><span class="m">1</span>.2490 seconds
Correct:9870, Wrong:130, Accuracy:0.9870
</pre></div>
</div>
<p>Similar to the ZCU102, the number of threads can be increased for higher throughput:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>vitis-ai-tensorflow<span class="o">)</span> Vitis-AI /workspace/build/target_u50 &gt; /usr/bin/python3 app_mt.py -t <span class="m">6</span>
Command line options:
 --image_dir :  images
 --threads   :  <span class="m">6</span>
 --model     :  model_dir/customcnn.xmodel
Pre-processing <span class="m">10000</span> images...
Starting <span class="m">6</span> threads...
<span class="nv">Throughput</span><span class="o">=</span><span class="m">22105</span>.08 fps, total <span class="nv">frames</span> <span class="o">=</span> <span class="m">10000</span>, <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.4524 seconds
Correct:9870, Wrong:130, Accuracy:0.9870
</pre></div>
</div>
</hr>
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2020-2021 Xilinx</sup></p></div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020–2021, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>