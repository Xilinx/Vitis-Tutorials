


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/14-implementing-iir-filter/Part1a/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Implementing an IIR Filter on the AI Engine - Part 1a</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/docs/AI_Engine_Development/Feature_Tutorials/14-implementing-iir-filter/Part1a/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>AI Engine Development</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-ai.html">See Vitis-AI™ Development Environment on xilinx.com</a>
    </td>
 </tr>
</table><div class="section" id="implementing-an-iir-filter-on-the-ai-engine-part-1a">
<h1>Implementing an IIR Filter on the AI Engine - Part 1a<a class="headerlink" href="#implementing-an-iir-filter-on-the-ai-engine-part-1a" title="Permalink to this headline">¶</a></h1>
<p><em><strong>Version: Vitis 2021.2</strong></em></p>
<div class="section" id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">¶</a></h2>
<p>We use the <a class="reference external" href="https://www.dsprelated.com/freebooks/filters/Transposed_Direct_Forms.html">transposed direct form II</a> (TDF2) of an IIR filter for <a class="reference external" href="https://www.dsprelated.com/freebooks/filters/Numerical_Robustness_TDF_II.html">numerical robustness</a> and focus on implementing a <a class="reference external" href="https://en.wikipedia.org/wiki/Digital_biquad_filter">biquad</a> section to allow cascading multiple sections to form higher order IIR filters.</p>
<p>The block diagram for a TDF2 <a class="reference external" href="https://www.dsprelated.com/showarticle/1137.php">IIR biquad filter</a> is shown below</p>
<p><img alt="Fig. 1" src="../../../../../_images/iir_biquad.png" /></p>
<p>and has the following difference equation:</p>
<p><img alt="Eqn. 1" src="../../../../../_images/eqn1.PNG" /></p>
<p>Starting with the <em>first</em> 8 input samples (i.e., <em>x</em>[0], <em>x</em>[1],…, <em>x</em>[7]), the four previous states will be initialized to <em>x</em>[-1] = <em>x</em>[-2] = <em>y</em>[-1] = <em>y</em>[-2] = 0. Thus, the corresponding 8 outputs can be expressed as:</p>
<p><img alt="Eqn. 2" src="../../../../../_images/eqn2.PNG" /></p>
<p>This system of equations may be solved sequentially or in parallel. To fully utilize the SIMD capabilities of the vector processor, we need to parallelize this system of equations [<a class="reference external" href="https://raphlinus.github.io/audio/2019/02/14/parallel-iir.html">2</a>]. Note that we can express all the outputs in terms of the current inputs and the four previous states. For example, substituting the expression for <em>y</em>[<em>n</em> + 0] to solve for <em>y</em>[<em>n</em> + 1] in terms of the current inputs (<em>x</em>[<em>n</em>]~<em>x</em>[<em>n</em> + 1]) and the four states (<em>x</em>[<em>n</em>-1], <em>x</em>[<em>n</em>-2], <em>y</em>[<em>n</em>-1] and <em>y</em>[<em>n</em>-2]):</p>
<p><img alt="Eqn. 3" src="../../../../../_images/eqn3.PNG" /></p>
<p>Using a symbolic solver like <a class="reference external" href="https://wxmaxima-developers.github.io/wxmaxima/index.html">wxMaxima</a> or <a class="reference external" href="https://www.wolfram.com/mathematica/">Mathematica</a>, we find that:</p>
<p><img alt="Eqn. 4" src="../../../../../_images/eqn4.PNG" /></p>
<p>where</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*************************************</span>
<span class="n">Ky0_ym2</span> <span class="o">=</span> <span class="o">-</span><span class="n">a2</span><span class="p">;</span>
<span class="n">Ky0_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span><span class="p">;</span>
<span class="n">Ky0_xm2</span> <span class="o">=</span> <span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky0_xm1</span> <span class="o">=</span> <span class="n">b1</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky0_x0</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky1_ym2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="p">;</span>
<span class="n">Ky1_ym1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">;</span>
<span class="n">Ky1_xm2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky1_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky1_x0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky1_x1</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky2_ym2</span> <span class="o">=</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a2</span><span class="p">);</span>
<span class="n">Ky2_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="p">;</span>
<span class="n">Ky2_xm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky2_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky2_x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky2_x1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky2_x2</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky3_ym2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">a2</span><span class="p">;</span>
<span class="n">Ky3_ym1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>
<span class="n">Ky3_xm2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky3_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky3_x0</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky3_x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky3_x2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky3_x3</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky4_ym2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">));</span>
<span class="n">Ky4_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">));</span>
<span class="n">Ky4_xm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky4_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky4_x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky4_x1</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky4_x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky4_x3</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky4_x4</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky5_ym2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Ky5_ym1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">^</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">;</span>
<span class="n">Ky5_xm2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky5_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky5_x0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky5_x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky5_x2</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky5_x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky5_x4</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky5_x5</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky6_ym2</span> <span class="o">=</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">);</span>
<span class="n">Ky6_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="n">a1</span><span class="o">^</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">a2</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">;</span>
<span class="n">Ky6_xm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x3</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky6_x4</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x5</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky6_x6</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
<span class="n">Ky7_ym2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">);</span>
<span class="n">Ky7_ym1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">^</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">7</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">15</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">4</span><span class="p">;</span>
<span class="n">Ky7_xm2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">b2</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky7_xm1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">7</span><span class="o">*</span><span class="n">b1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">b2</span> <span class="o">-</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b2</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x0</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">7</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky7_x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">6</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">5</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">4</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x4</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">a1</span><span class="o">^</span><span class="mi">3</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">+</span> <span class="n">b2</span><span class="p">))</span><span class="o">*</span><span class="n">K</span><span class="p">);</span>
<span class="n">Ky7_x5</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">^</span><span class="mi">2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a2</span><span class="o">*</span><span class="n">b0</span> <span class="o">-</span> <span class="n">a1</span><span class="o">*</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x6</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a1</span><span class="o">*</span><span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b1</span><span class="p">)</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="n">Ky7_x7</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">K</span><span class="p">;</span>
<span class="o">*************************************</span>
</pre></div>
</div>
<p>Note that the matrix of constants <strong>C</strong> in (4) has 8 rows and 12 columns.</p>
<p><code class="docutils literal notranslate"><span class="pre">aie_iir_1a.jl</span></code> is a Julia script included in this tutorial which:</p>
<ul class="simple">
<li><p>defines the filter characteristics</p></li>
<li><p>breaks down the filter into second order sections</p></li>
<li><p>generates the SIMD coefficients for each stage using the <a class="reference external" href="https://juliamath.github.io/DoubleFloats.jl/stable/">Double64</a> datatype</p></li>
</ul>
<p>The vector processor on the AI engine can perform 8 multiply-accumulate operations on <a class="reference external" href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">binary32</a> variables in <em>one cycle</em>. If there were 8 <em>independent</em> inputs to be processed simultaneously by 8 <em>independent</em> IIR biquad filters, then the kernel code would be straightforward, and from (1), those signals would be processed with an <em>ideal</em> latency of 5 cycles:</p>
<ul class="simple">
<li><p>cycle 1: y<sub>i</sub>[n]  = <em>K</em> * <em>b</em><sub>0</sub> * <em>x</em><sub>i</sub>[<em>n</em>]</p></li>
<li><p>cycle 2: y<sub>i</sub>[n] += <em>K</em> * <em>b</em><sub>1</sub> * <em>x</em><sub>i</sub>[<em>n</em>-1]</p></li>
<li><p>cycle 3: y<sub>i</sub>[n] += <em>K</em> * <em>b</em><sub>2</sub> * <em>x</em><sub>i</sub>[<em>n</em>-2]</p></li>
<li><p>cycle 4: y<sub>i</sub>[n] +=      <em>-a</em><sub>1</sub> * <em>y</em><sub>i</sub>[<em>n</em>-1]</p></li>
<li><p>cycle 5: y<sub>i</sub>[n] +=      <em>-a</em><sub>2</sub> * <em>y</em><sub>i</sub>[<em>n</em>-2]</p></li>
</ul>
<p>An actual implementation would require populating the registers with data; performing the calculation; going through the pipeline; updating the internal states; extracting the data, etc.; thereby incurring more than 5 cycles for latency.</p>
<p>We can use (4) to calculate 8 sequential outputs for 1 input signal using <em>one</em> AI engine core. One way to visualize the calculation is to process one column of the matrix of constants <strong>C</strong> at every clock cycle. Since <strong>C</strong> has 12 columns, it would <em>ideally</em> take 12 cycles to generate 8 outputs.</p>
</div>
<div class="section" id="kernel-code">
<h2>Kernel Code<a class="headerlink" href="#kernel-code" title="Permalink to this headline">¶</a></h2>
<p>The kernel code (using high-level intrinsics (HLI)) for one second order stage is shown below.</p>
<p><code class="docutils literal notranslate"><span class="pre">kernel.hpp</span></code></p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef __KERNEL_HPP__	</span><span class="c1">// include guard to prevent multiple inclusion</span>

	<span class="cp">#define __KERNEL_HPP__</span>

	<span class="cp">#include</span> <span class="cpf">&lt;adf.h&gt;</span><span class="c1">			// Adaptive DataFlow header</span><span class="cp"></span>
	<span class="cp">#include</span> <span class="cpf">&lt;aie_api/aie.hpp&gt;</span><span class="c1">	// header files for high-level intrinsics</span><span class="cp"></span>

	<span class="k">typedef</span> <span class="n">aie</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="mi">8</span><span class="o">&gt;</span> <span class="n">Vector8f</span><span class="p">;</span>		<span class="c1">// vector of 8 floating-point elements</span>
	<span class="k">typedef</span> <span class="n">aie</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">Vector16f</span><span class="p">;</span>	<span class="c1">// vector of 16 floating-point elements</span>
	<span class="k">typedef</span> <span class="n">aie</span><span class="o">::</span><span class="n">accum</span><span class="o">&lt;</span><span class="n">accfloat</span><span class="p">,</span> <span class="mi">8</span><span class="o">&gt;</span> <span class="n">VAcc8f</span><span class="p">;</span>		<span class="c1">// accumulator with 8 floating-point elements</span>

	<span class="k">template</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">id</span><span class="o">&gt;</span>
	<span class="kt">void</span> <span class="n">SecondOrderSection</span><span class="p">(</span>
	    <span class="n">input_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">idata</span><span class="p">,</span>		<span class="c1">// 8 input samples per iteration</span>
		<span class="n">output_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">odata</span><span class="p">,</span> 	<span class="c1">// 8 output samples per iteration</span>
		<span class="k">const</span> <span class="kt">float</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">)[</span><span class="mi">96</span><span class="p">]</span>			<span class="c1">// run-time parameter: SIMD matrix of coefficients</span>
	<span class="p">);</span>

<span class="cp">#endif </span><span class="c1">// __KERNEL_HPP__</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">kernel.cpp</span></code></p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;aie_api/aie_adf.hpp&gt;</span><span class="cp"></span>

<span class="c1">// !!! Need to separate C++20 portions for kernel from C++14-processed files (e.g. graph.hpp and tb.cpp)</span>
<span class="cp">#include</span> <span class="cpf">&quot;kernel.hpp&quot;</span><span class="cp"></span>

<span class="k">template</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">id</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">SecondOrderSection</span><span class="p">(</span>
    <span class="n">input_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">idata</span><span class="p">,</span>		<span class="c1">// 8 input samples per iteration</span>
	<span class="n">output_window</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">odata</span><span class="p">,</span> 	<span class="c1">// 8 output samples per iteration</span>
	<span class="k">const</span> <span class="kt">float</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">)[</span><span class="mi">96</span><span class="p">]</span>			<span class="c1">// SIMD matrix of coefficients</span>
<span class="p">)</span> <span class="p">{</span>

	<span class="k">static</span> <span class="n">Vector8f</span> <span class="n">state_reg</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">zeros</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="mi">8</span><span class="o">&gt;</span><span class="p">();</span>	<span class="c1">// clear states</span>

	<span class="n">Vector8f</span> <span class="n">xreg_hi</span> <span class="o">=</span> <span class="n">window_readincr_v</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idata</span><span class="p">);</span>		<span class="c1">// fetch input samples</span>
	<span class="n">Vector16f</span> <span class="n">xreg</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">concat</span><span class="p">(</span><span class="n">state_reg</span><span class="p">,</span> <span class="n">xreg_hi</span><span class="p">);</span>	<span class="c1">// xreg[4]: ym2; xreg[5]: ym1; xreg[6]: xm2; xreg[7]: xm1; xreg[8:15]: x0:x7</span>
	<span class="n">Vector8f</span> <span class="n">coeff</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">load_v</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">VAcc8f</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">mul</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">xreg</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>				<span class="c1">// do 1st multiplication instead of zeroing</span>

	<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">coeff</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">load_v</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">C</span><span class="p">[</span><span class="mi">8</span> <span class="o">*</span> <span class="n">i</span><span class="p">]);</span>
        <span class="kt">float</span> <span class="n">xval</span> <span class="o">=</span> <span class="n">xreg</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">];</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="n">aie</span><span class="o">::</span><span class="n">mac</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">xval</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">Vector8f</span> <span class="n">yout</span> <span class="o">=</span> <span class="n">acc</span><span class="p">;</span>

	<span class="c1">// update states</span>
	<span class="n">state_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">yout</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">state_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">yout</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">state_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">xreg_hi</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">state_reg</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">xreg_hi</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>

	<span class="n">window_writeincr</span><span class="p">(</span><span class="n">odata</span><span class="p">,</span> <span class="n">yout</span><span class="p">);</span>

<span class="p">}</span> <span class="c1">// end SecondOrderSection()</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>The kernel code is compiled with a C++20-compliant compiler, while the rest of the code (i.e., <code class="docutils literal notranslate"><span class="pre">graph.hpp</span></code> and simulation testbench) is compiled with a C++14-compliant compiler. Since the kernel header will be included in <code class="docutils literal notranslate"><span class="pre">graph.hpp</span></code>, it cannot contain any C++20 constructs.</p></li>
<li><p>The template parameter <code class="docutils literal notranslate"><span class="pre">id</span></code> will be used to instantiate multiple instances of the <code class="docutils literal notranslate"><span class="pre">SecondOrderSection()</span></code> function.</p></li>
<li><p>The function will accept a “window” (i.e., a predetermined number of elements defined in <code class="docutils literal notranslate"><span class="pre">graph.hpp</span></code>) of input values and generate another “window” of output values.</p></li>
<li><p>The filter coefficients will be passed as a 1-D array via the <code class="docutils literal notranslate"><span class="pre">C</span></code> argument.</p></li>
<li><p>The filter states (<code class="docutils literal notranslate"><span class="pre">state_reg</span></code>) need to kept between function calls and thus are declared <code class="docutils literal notranslate"><span class="pre">static</span></code>.</p></li>
<li><p>Instead of doing a regular matrix-vector multiplication as indicated by (4), each iteration of the <code class="docutils literal notranslate"><span class="pre">for</span></code> loop takes the <em>n<sup>th</sup></em> column of the the <strong>C</strong> matrix, and multiplies all the elements of that column with the <em>n<sup>th</sup> element</em> of the <strong>x</strong> vector, i.e., a vector scaling operation.</p></li>
</ul>
</div>
<div class="section" id="julia-script-notes">
<h2>Julia Script Notes<a class="headerlink" href="#julia-script-notes" title="Permalink to this headline">¶</a></h2>
<p>To check the functionality of the kernel code, we use use <code class="docutils literal notranslate"><span class="pre">aie_iir_1a.jl</span></code> to generate the coefficients for <em>one</em> second order section, as well as the impulse response. The script will also generate a <a class="reference external" href="https://en.wikipedia.org/wiki/Kronecker_delta">unit sample function</a> as an input to the kernel.</p>
<p>Some of the user-settable parameters in the Julia script are shown below.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># --- begin user parameters</span>

<span class="n">fp</span> <span class="o">=</span> <span class="mf">10.0e6</span>             <span class="c"># passband frequency</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mf">100.0e6</span>            <span class="c"># sampling frequency</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>                   <span class="c"># no. of poles</span>
<span class="n">rp</span> <span class="o">=</span> <span class="mf">0.1</span>                <span class="c"># passband ripple (dB)</span>
<span class="n">rs</span> <span class="o">=</span> <span class="mf">80.0</span>               <span class="c"># stopband attenuation (dB)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">256</span>                 <span class="c"># no. of samples for impulse response</span>
<span class="n">show_plots</span> <span class="o">=</span> <span class="nb">true</span>       <span class="c"># display plots?</span>
<span class="n">write_cmatrix</span> <span class="o">=</span> <span class="nb">true</span>    <span class="c"># write C matrix to files?</span>
<span class="n">write_impulse</span> <span class="o">=</span> <span class="nb">true</span>    <span class="c"># write impulse response?</span>

<span class="c"># --- end user parameters</span>
</pre></div>
</div>
<p>To run the script, start Julia, then run the following commands at the prompt.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">cd</span><span class="p">(</span><span class="s2">&quot;path_to_aie_iir_1a.jl&quot;</span><span class="p">)</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;aie_iir_1a.jl&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">path_to_aie_iir_1a.jl</span></code> with the actual path to the <code class="docutils literal notranslate"><span class="pre">aie_iir_1a.jl</span></code> script.</p></li>
<li><p>The path must be enclosed in double-quotes.</p></li>
<li><p>The initial startup may seem slow as it loads several packages.</p></li>
<li><p>This will generate 5 plots:</p>
<ul>
<li><p>original filter’s frequency response</p></li>
<li><p>original filter’s impulse response</p></li>
<li><p>SOS frequency response</p></li>
<li><p>SOS impulse response</p></li>
<li><p>impulse response error</p></li>
</ul>
</li>
<li><p>The following files will also be generated:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">C1.h</span></code> - array of coefficients to be passed to the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input.dat</span></code> - unit sample function to be used as an input signal for the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">impresponse.dat</span></code> - calculated impulse response for comparison with AI engine result</p></li>
</ul>
</li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">C1.h</span></code> to the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory, and <code class="docutils literal notranslate"><span class="pre">input.dat</span></code> to the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory of the AI engine project (note: this has already been done in the attached project archive)</p></li>
</ul>
</div>
<div class="section" id="adaptive-dataflow-graph">
<h2>Adaptive Dataflow Graph<a class="headerlink" href="#adaptive-dataflow-graph" title="Permalink to this headline">¶</a></h2>
<p>The adaptive dataflow graph file looks something like this.</p>
<p><code class="docutils literal notranslate"><span class="pre">graph.hpp</span></code></p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef __GRAPH_H__			</span><span class="c1">// include guard to prevent multiple inclusion</span>

	<span class="cp">#define __GRAPH_H__</span>

	<span class="cp">#include</span> <span class="cpf">&lt;adf.h&gt;</span><span class="c1">		// Adaptive DataFlow header</span><span class="cp"></span>
	<span class="cp">#include</span> <span class="cpf">&quot;kernel.hpp&quot;</span><span class="cp"></span>

	<span class="k">using</span> <span class="k">namespace</span> <span class="nn">adf</span><span class="p">;</span>

	<span class="c1">// dataflow graph declaration</span>
	<span class="k">class</span> <span class="nc">the_graph</span> <span class="o">:</span> <span class="k">public</span> <span class="n">graph</span> <span class="p">{</span>	<span class="c1">// inherit all properties of the adaptive     dataflow graph</span>

		<span class="k">private</span><span class="o">:</span>
			<span class="n">kernel</span> <span class="n">section1</span><span class="p">;</span>

		<span class="k">public</span><span class="o">:</span>
			<span class="n">input_port</span> <span class="n">in</span><span class="p">;</span>		<span class="c1">// input port for data to enter the kernel</span>
			<span class="n">input_port</span> <span class="n">cmtx1</span><span class="p">;</span>	<span class="c1">// input port for SIMD matrix coefficients</span>
			<span class="n">output_port</span> <span class="n">out</span><span class="p">;</span>	<span class="c1">// output port for data to leave the kernel</span>

			<span class="c1">// constructor</span>
			<span class="n">the_graph</span><span class="p">()</span> <span class="p">{</span>

				<span class="c1">// associate the kernel with the function to be executed</span>
				<span class="n">section1</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">SecondOrderSection</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">);</span>

				<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">num_bytes</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">);</span>

				<span class="c1">// establish connections</span>
				<span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">num_bytes</span><span class="o">&gt;&gt;</span> <span class="n">net0</span> <span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">section1</span><span class="p">.</span><span class="n">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>				<span class="c1">// window size in bytes</span>
				<span class="n">connect</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cmtx1</span><span class="p">,</span> <span class="n">adf</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">section1</span><span class="p">.</span><span class="n">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
				<span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">num_bytes</span><span class="o">&gt;&gt;</span> <span class="n">net1</span> <span class="p">(</span><span class="n">section1</span><span class="p">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">out</span><span class="p">);</span>

				<span class="c1">// specify which source code file contains the kernel function</span>
				<span class="n">source</span><span class="p">(</span><span class="n">section1</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;kernel.cpp&quot;</span><span class="p">;</span>

				<span class="c1">// !!! temporary value: assumes this kernel dominates the AI engine tile !!!</span>
				<span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">section1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

			<span class="p">}</span> <span class="c1">// end the_graph()</span>

	<span class="p">};</span> <span class="c1">// end class the_graph</span>

<span class="cp">#endif </span><span class="c1">// __GRAPH_H__</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">section1</span> <span class="pre">=</span> <span class="pre">kernel::create(SecondOrderSection&lt;1&gt;)</span></code> tells the tools that the AI engine kernel program will use the templated function <code class="docutils literal notranslate"><span class="pre">SecondOrderSection</span></code> with a template parameter of <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connect&lt;window&lt;num_bytes&gt;&gt;</span> <span class="pre">net0</span> <span class="pre">(in,</span> <span class="pre">section1.in[0])</span></code> tells the tools that 8 floating-point elements (32 bytes) need to be available before the kernel can start executing. This also tells the tool to reserve 64 bytes (ping-pong buffer) of memory for the input data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connect&lt;parameter&gt;(cmtx1,</span> <span class="pre">adf::async(section1.in[1]))</span></code> tells the tools that an <em>asynchronous</em> run-time parameter is required for the <em>first</em> execution of the kernel. Subsequent executions will use the <em>latest</em> run-time parameter available, i.e., if the asynchronous parameter is only sent <em>once</em>, then that parameter will be reused for the remaining life of the kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">connect&lt;window&lt;num_bytes&gt;&gt;</span> <span class="pre">net1</span> <span class="pre">(section1.out[0],</span> <span class="pre">out)</span></code> tells the tools that the kernel will place 8 floating-point elements (32 bytes) at its output. This also tells the tool to reserve 64 bytes (ping-pong buffer) of memory for the output data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source(section1)</span> <span class="pre">=</span> <span class="pre">&quot;kernel.cpp&quot;</span></code> tells the tools where to find the source code for the kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">runtime&lt;ratio&gt;(section1)</span> <span class="pre">=</span> <span class="pre">1.0</span></code> tells the tools that only this kernel can be placed in the AI engine. At this time, the actual execution time is unknown.</p></li>
</ul>
</div>
<div class="section" id="testbench-code">
<h2>Testbench Code<a class="headerlink" href="#testbench-code" title="Permalink to this headline">¶</a></h2>
<p>The testbench code looks something like this.</p>
<p><code class="docutils literal notranslate"><span class="pre">tb.cpp</span></code></p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;kernel.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;graph.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;C1.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="nn">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="nn">adf</span><span class="p">;</span>

<span class="c1">// the testbench requires a virtual platform for simulation</span>
<span class="n">simulation</span><span class="o">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="s">&quot;data/input.dat&quot;</span><span class="p">,</span> <span class="s">&quot;output.dat&quot;</span><span class="p">);</span>

<span class="c1">// specify the DFG</span>
<span class="n">the_graph</span> <span class="n">my_graph</span><span class="p">;</span>

<span class="c1">// define connections between virtual platform and the DFG</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span> <span class="p">(</span><span class="n">platform</span><span class="p">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">my_graph</span><span class="p">.</span><span class="n">in</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span> <span class="p">(</span><span class="n">my_graph</span><span class="p">.</span><span class="n">out</span><span class="p">,</span> <span class="n">platform</span><span class="p">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">num_pts</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>	<span class="c1">// number of sample points in &quot;input.dat&quot;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">num_iterations</span> <span class="o">=</span> <span class="n">num_pts</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>	<span class="c1">// number of iterations to run</span>

<span class="c1">// main simulation program</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

	<span class="n">my_graph</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>				<span class="c1">// load the DFG into the AI engine array, establish     connectivity, etc.</span>

	<span class="n">my_graph</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_graph</span><span class="p">.</span><span class="n">cmtx1</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="mi">96</span><span class="p">);</span>
	<span class="n">my_graph</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">);</span>	<span class="c1">// run the DFG for the specified number of iterations</span>

	<span class="n">my_graph</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>					<span class="c1">// housekeeping</span>

	<span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="p">}</span> <span class="c1">// end main()</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">simulation::platform&lt;1,</span> <span class="pre">1&gt;</span> <span class="pre">platform(&quot;data/input.dat&quot;,</span> <span class="pre">&quot;output.dat&quot;)</span></code> tells the tools that the input to the kernel will come from the file <code class="docutils literal notranslate"><span class="pre">data/input.dat</span></code> and the output data should be written to the file <code class="docutils literal notranslate"><span class="pre">output.dat</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_graph.update(my_graph.cmtx1,</span> <span class="pre">C1,</span> <span class="pre">96)</span></code> sends the 96 coefficients for the filter to the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_graph.run(num_iterations)</span></code> runs the kernel 256/8 = 32 times to allow comparison with the impulse response from the Julia script</p></li>
</ul>
</div>
<div class="section" id="build-and-run-the-program">
<h2>Build and Run the Program<a class="headerlink" href="#build-and-run-the-program" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Copy the files in <code class="docutils literal notranslate"><span class="pre">src</span></code> and <code class="docutils literal notranslate"><span class="pre">dat</span></code> to your project. Set the <code class="docutils literal notranslate"><span class="pre">Top-Level</span> <span class="pre">File</span></code> to <code class="docutils literal notranslate"><span class="pre">src/tb.cpp</span></code>.</p></li>
<li><p>Since we are only interested in functional verification at this time, we use <code class="docutils literal notranslate"><span class="pre">Emulation-SW</span></code> to build and run the program.</p></li>
<li><p>If the program builds and runs without errors, the output should be in <code class="docutils literal notranslate"><span class="pre">Emulation-SW/x86simulator_output/output.dat</span></code></p></li>
<li><p>Copy the generated <code class="docutils literal notranslate"><span class="pre">impresponse.dat</span></code> file to the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory (note: this has already been done in the project archive)</p></li>
<li><p>We can use Julia to verify the kernel output</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">julia</span><span class="o">&gt;</span> <span class="n">using</span> <span class="n">PyPlot</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">using</span> <span class="n">DelimitedFiles</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">readdlm</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{specify_directory}</span><span class="s2">/impresponse.dat&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">dut</span> <span class="o">=</span> <span class="n">readdlm</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{specify_directory}</span><span class="s2">/output.dat&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ref</span> <span class="o">-</span> <span class="n">dut</span><span class="p">;</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">plot</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">grid</span><span class="p">(</span><span class="s2">&quot;on&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">title</span><span class="p">(</span><span class="s2">&quot;Impulse Response Error&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Sampling Index&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">);</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">eps</span><span class="p">(</span><span class="n">Float32</span><span class="p">)</span>
<span class="mf">1.1920929</span><span class="n">f</span><span class="o">-</span><span class="mi">7</span>
<span class="n">julia</span><span class="o">&gt;</span> <span class="n">maximum</span><span class="p">(</span><span class="nb">abs</span><span class="o">.</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
<span class="mf">1.0517072768223557e-8</span>
</pre></div>
</div>
<p>The resulting Julia plot of the impulse response error is shown below.
<img alt="Fig. 2" src="../../../../../_images/impresp_error.PNG" /></p>
<p>You may also try modifying and running <code class="docutils literal notranslate"><span class="pre">check.jl</span></code>.</p>
<p>Since the maximum of the absolute error is less than the <a class="reference external" href="https://en.wikipedia.org/wiki/Machine_epsilon">machine epsilon</a> for <a class="reference external" href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">binary32</a> (<code class="docutils literal notranslate"><span class="pre">Float32</span></code> in Julia), we can conclude that the kernel code is working as expected.</p>
<p>The complete design is included in the <code class="docutils literal notranslate"><span class="pre">data</span></code> and <code class="docutils literal notranslate"><span class="pre">src</span></code> directories. Refer to the aie_exp/Part1 tutorial if you are unfamiliar with building a Vitis design from scratch.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We provided a Julia script which generates the required coefficients for a second order section of an IIR filter and kernel code to implement it. We used <code class="docutils literal notranslate"><span class="pre">Emulation-SW</span></code> to verify the functionality of the design. The AI engine kernel code implementation shows negligible difference compared to the original filter.</p>
<p>In Part 1b, we show the process of creating the adaptive dataflow graph for an arbitrary number of cascaded second order sections.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] Julius O. Smith III. “<a class="reference external" href="https://www.dsprelated.com/freebooks/filters/">Introduction to Digital Filters with Audio Applications</a>”</p>
<p>[2] <a class="reference external" href="https://raphlinus.github.io/audio/2019/02/14/parallel-iir.html">IIR filters can be evaluated in parallel</a></p>
</div>
</div>
<div class="section" id="support">
<h1>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h1>
<p>GitHub issues will be used for tracking requests and bugs. For questions go to <a class="reference external" href="http://forums.xilinx.com/">forums.xilinx.com</a>.</p>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"><sup>XD108 | &copy; Copyright 2021 Xilinx, Inc.</sup></p></div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on February 10, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>