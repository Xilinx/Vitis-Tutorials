


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/linkid.js"></script>
	    <script type="text/javascript" src="../../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Controlling Vivado Implementation" href="../06-controlling-vivado-implementation/README.html" />
    <link rel="prev" title="Using Multiple DDR Banks" href="../04-mult-ddr-banks/README.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../Hardware-Acceleration.html">Hardware Acceleration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Hardware-Acceleration.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Hardware-Acceleration.html#design-tutorials">Design Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../Hardware-Acceleration.html#feature-tutorials">Feature Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02-mixing-c-rtl-kernels/README.html">Mixing C and RTL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03-dataflow_debug_and_optimization/README.html">Dataflow Debug and Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../04-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using Multiple Compute Units</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tutorial-overview">Tutorial Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#before-you-begin">Before You Begin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#makefile-flow">Makefile Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../06-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07-using-hbm/README.html">Optimizing for HBM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../08-using-hostmem/README.html">Host Memory Access</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../_sources/docs/Hardware_Acceleration/Feature_Tutorials/05-using-multiple-cu/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../Hardware-Acceleration.html">Vitis Hardware Acceleration</a> &raquo;</li>
        
      <li>Using Multiple Compute Units</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/docs/Hardware_Acceleration/Feature_Tutorials/05-using-multiple-cu/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>Vitis™ Application Acceleration Development Flow Tutorials</h1>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="using-multiple-compute-units">
<h1>Using Multiple Compute Units<a class="headerlink" href="#using-multiple-compute-units" title="Permalink to this headline">¶</a></h1>
<p><em><strong>Version: Vitis 2021.2</strong></em></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial demonstrates a flexible kernel linking process to increase the number of kernel instances on an FPGA. Each specified instance of a kernel is also known as a compute unit (CU). This process of increasing number of CU improves the parallelism in a combined host-kernel system.</p>
</div>
<div class="section" id="tutorial-overview">
<h2>Tutorial Overview<a class="headerlink" href="#tutorial-overview" title="Permalink to this headline">¶</a></h2>
<p>By default, the Vitis™ core development kit creates one CU for each kernel. A host program can use the same kernel multiple times for different sets of data. In these cases, it is useful to generate multiple CUs of the kernel to let those CUs run concurrently and improve the performance of the overall system.</p>
<p>For more information, see <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2021.1%3Bt=vitis+doc%3Bd=buildingdevicebinary.html%3Ba=yzb1524519238289">Creating Multiple Instances of a Kernel</a> in the Application Acceleration
Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p>
<p>During this tutorial, you will:</p>
<ol class="simple">
<li><p>Run hardware emulation and inspect the emulation report to identify multiple serial kernel executions.</p></li>
<li><p>Change the host code to enable out-of-order command executions.</p></li>
<li><p>Alter the kernel linking process to create multiple CUs of the same kernel.</p></li>
<li><p>Re-run the hardware emulation and confirm the parallel execution of the CUs.</p></li>
</ol>
<p>This tutorial uses an image filter example to demonstrate the multiple CU feature. The host application processes the image, extracts Y, U, and V planes, and then runs the kernel three times to filter each plane of an image. By default, these three kernels run sequentially, using the same hardware resources because the FPGA only contains a single CU of the kernel. This tutorial demonstrates how to increase the number of CU, and then executing the kernel runs in parallel.</p>
</div>
<div class="section" id="before-you-begin">
<h2>Before You Begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline">¶</a></h2>
<p>This tutorial uses:</p>
<ul class="simple">
<li><p>BASH Linux shell commands</p></li>
<li><p>2020.2 Vitis core development kit release and the <em>xilinx_u200_gen3x16_xdma_1_202110_1</em> platform.
If necessary, it can be easily extended to other versions and platforms.</p></li>
</ul>
<blockquote>
<div><p><strong>IMPORTANT:</strong></p>
<ul>
<li><p>Before to running any of the examples, make sure you have installed the Vitis core development kit as described in <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/acceleration_installation.html#vhc1571429852245">Installation</a> in the Application Acceleration
Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p></li>
<li><p>If you run applications on Xilinx® Alveo™ Data Center accelerator cards, ensure the card and software drivers have been correctly installed by following the instructions on the <a class="reference external" href="https://www.xilinx.com/products/boards-and-kits/alveo.html">Alveo Portfolio page</a>.</p></li>
<li><p>This tutorial module contains a pre-compiled OpenCV™ library compiled by gcc-6.2.0, and requires gcc/g++ version 5.5 at least, or will return an error during host code compilation. You must also set the LD_LIBRARY_PATH using the following code to pick the required runtime library related to gcc-6:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$XILINX_VITIS/lib/lnx64.o/Default
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<div class="section" id="accessing-the-tutorial-reference-files">
<h3>Accessing the Tutorial Reference Files<a class="headerlink" href="#accessing-the-tutorial-reference-files" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>To access the reference files, enter the following in a terminal: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">http://github.com/Xilinx/Vitis-Tutorials</span></code>.</p></li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">Hardware_Acceleration/Feature_Tutorials/05-using-multiple-cu</span></code> directory, and then access the <code class="docutils literal notranslate"><span class="pre">reference-files</span></code> directory.</p></li>
</ol>
</div>
</div>
<div class="section" id="makefile-flow">
<h2>Makefile Flow<a class="headerlink" href="#makefile-flow" title="Permalink to this headline">¶</a></h2>
<p>You can observe the Makefile used for this tutorial in <code class="docutils literal notranslate"><span class="pre">reference-files/Makefile</span></code>. The top-level settings include:</p>
<ul>
<li><p><strong>VPP</strong>: Vitis compiler path to compile the kernel code.</p></li>
<li><p><strong>EMCONFIGUTIL</strong>: The path of the utility that creates emulation configuration file, <code class="docutils literal notranslate"><span class="pre">emconfig.json</span></code>.</p></li>
<li><p><strong>DEVICE</strong>: The target platform.</p></li>
<li><p><strong>LFLAGS</strong>: The linker option using the OpenCV library for the host code linker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Wl</span><span class="p">,</span><span class="o">-</span><span class="n">rpath</span><span class="p">,</span><span class="o">./</span><span class="n">opencv</span><span class="o">/</span><span class="n">opencv_gcc</span> <span class="o">-</span><span class="n">L</span><span class="o">./</span><span class="n">opencv</span><span class="o">/</span><span class="n">opencv_gcc</span> <span class="o">-</span><span class="n">lopencv_core</span> <span class="o">-</span><span class="n">lopencv_highgui</span>
</pre></div>
</div>
</li>
<li><p><strong>EXE_OPT</strong>: The runtime options passed as command line arguments: Compiled kernel <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> file, input image.</p></li>
</ul>
<div class="section" id="run-hardware-emulation">
<h3>Run Hardware Emulation<a class="headerlink" href="#run-hardware-emulation" title="Permalink to this headline">¶</a></h3>
<p>Run hardware emulation with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw_emu</span>
</pre></div>
</div>
<p>For hardware emulation (<code class="docutils literal notranslate"><span class="pre">hw_emu</span></code>), the kernel code is compiled into a hardware model, which is run in a hardware simulator, while the rest of the system uses a C simulator. Building and running takes longer but provides a detailed, cycle-aware, view of kernel activity. This target is useful for testing the functionality of the logic that will run in the FPGA and for getting initial performance estimates.</p>
<blockquote>
<div><p><strong>NOTE:</strong> For instructions on how to build the host software and hardware, refer to the <a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/master/Getting_Started">Vitis Getting Started</a> tutorial.</p>
</div></blockquote>
</div>
<div class="section" id="inspect-the-host-code">
<h3>Inspect the Host Code<a class="headerlink" href="#inspect-the-host-code" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>While the emulation run is executing, in another terminal, open the <code class="docutils literal notranslate"><span class="pre">src/host/host.cpp</span></code> file.</p></li>
<li><p>Inspect lines 255-257. You can see that the Filter function is called three times for the Y, U, and V channels.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">request</span><span class="p">[</span><span class="n">xx</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">y_src</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">y_dst</span><span class="o">.</span><span class="n">data</span><span class="p">());</span>
<span class="n">request</span><span class="p">[</span><span class="n">xx</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">u_src</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">u_dst</span><span class="o">.</span><span class="n">data</span><span class="p">());</span>
<span class="n">request</span><span class="p">[</span><span class="n">xx</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">coeff</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">v_src</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">v_dst</span><span class="o">.</span><span class="n">data</span><span class="p">());</span>
</pre></div>
</div>
<p>This function is described from line 80. Here, you can see kernel arguments are set, and the kernel is executed by the <code class="docutils literal notranslate"><span class="pre">clEnqueueTask</span></code> command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">arguments</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">cl_mem</span><span class="p">),</span>       <span class="o">&amp;</span><span class="n">mSrcBuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">cl_mem</span><span class="p">),</span>       <span class="o">&amp;</span><span class="n">mSrcBuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">width</span><span class="p">);</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">height</span><span class="p">);</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">stride</span><span class="p">);</span>
 <span class="n">clSetKernelArg</span><span class="p">(</span><span class="n">mKernel</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">cl_mem</span><span class="p">),</span>       <span class="o">&amp;</span><span class="n">mDstBuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="o">//</span> <span class="n">Schedule</span> <span class="n">the</span> <span class="n">writing</span> <span class="n">of</span> <span class="n">the</span> <span class="n">inputs</span>
<span class="n">clEnqueueMigrateMemObjects</span><span class="p">(</span><span class="n">mQueue</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mSrcBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nullptr</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">mEvent</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="o">//</span> <span class="n">Schedule</span> <span class="n">the</span> <span class="n">execution</span> <span class="n">of</span> <span class="n">the</span> <span class="n">kernel</span>
<span class="n">clEnqueueTask</span><span class="p">(</span><span class="n">mQueue</span><span class="p">,</span> <span class="n">mKernel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">mEvent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">mEvent</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>All three <code class="docutils literal notranslate"><span class="pre">clEnqueueTask</span></code> commands are enqueued using a single in-order command queue (line 75). As a result, all the commands are executed sequentially in the order they are added to the queue.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Filter2DDispatcher</span><span class="p">(</span>
        <span class="n">cl_device_id</span>     <span class="o">&amp;</span><span class="n">Device</span><span class="p">,</span>
        <span class="n">cl_context</span>       <span class="o">&amp;</span><span class="n">Context</span><span class="p">,</span>
        <span class="n">cl_program</span>       <span class="o">&amp;</span><span class="n">Program</span> <span class="p">)</span>
  <span class="p">{</span>
        <span class="n">mKernel</span>  <span class="o">=</span> <span class="n">clCreateKernel</span><span class="p">(</span><span class="n">Program</span><span class="p">,</span> <span class="s2">&quot;Filter2DKernel&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mErr</span><span class="p">);</span>
        <span class="n">mQueue</span>   <span class="o">=</span> <span class="n">clCreateCommandQueue</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span> <span class="n">Device</span><span class="p">,</span> <span class="n">CL_QUEUE_PROFI</span>   <span class="n">LING_ENABLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mErr</span><span class="p">);</span>
        <span class="n">mContext</span> <span class="o">=</span> <span class="n">Context</span><span class="p">;</span>
        <span class="n">mCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="emulation-result">
<h3>Emulation Result<a class="headerlink" href="#emulation-result" title="Permalink to this headline">¶</a></h3>
<p>Review the generated Timeline Trace report (<code class="docutils literal notranslate"><span class="pre">opencl_trace.csv</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vitis_analyzer</span> <span class="n">filter2d</span><span class="o">.</span><span class="n">hw_emu</span><span class="o">.</span><span class="n">xclbin</span><span class="o">.</span><span class="n">run_summary</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>NOTE:</strong> The run directory contains a file named <code class="docutils literal notranslate"><span class="pre">xrt.ini</span></code>. This file contains runtime options that generate additional reports such as the Profile Summary report and Timeline Trace.</p>
</div></blockquote>
<p>After the Vitis analyzer loads, click <strong>Timeline Trace</strong> located on the left side panel. The Application Timeline report collects and displays host and device events on a common timeline to help you understand and visualize the overall health and performance of your systems.</p>
<ul class="simple">
<li><p>At the bottom of the timeline, you can see three blue bars, one for each kernel enqueing from the host. The host enqueues the kernel execution sequentially (in order) because it uses a single, in-order command queue.</p></li>
<li><p>After the blue bars, you can see three green bars, one for each kernel execution. They are working on the FPGA sequentially.
<img alt="Serial kernel enqueue" src="../../../../_images/serial_kernel_enqueue_vitis.JPG" /></p></li>
</ul>
</div>
<div class="section" id="improve-the-host-code-for-concurrent-kernel-enqueuing">
<h3>Improve the Host Code for Concurrent Kernel Enqueuing<a class="headerlink" href="#improve-the-host-code-for-concurrent-kernel-enqueuing" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Edit the <code class="docutils literal notranslate"><span class="pre">src/host/host.cpp</span></code> host file to change line 75. You will change this line to declare the command queue as an <em>out-of-order</em> command queue.</p>
<p>Code before the change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mQueue</span>   <span class="o">=</span> <span class="n">clCreateCommandQueue</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span> <span class="n">Device</span><span class="p">,</span> <span class="n">CL_QUEUE_PROFILING_ENABLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mErr</span><span class="p">);</span>
</pre></div>
</div>
<p>Code after the change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mQueue</span>   <span class="o">=</span> <span class="n">clCreateCommandQueue</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span> <span class="n">Device</span><span class="p">,</span> <span class="n">CL_QUEUE_PROFILING_ENABLE</span> <span class="o">|</span> <span class="n">CL_QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mErr</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>(<em>Optional</em>) Run the hardware emulation with the changed host code.</p>
<p>If you choose to run the Hardware Emulation feature, use the Timeline Trace to observe that using the out-of-order queue enables the kernels requested to be executed at almost the same time as one another (the blue bars represent kernel enqueue requests scheduled by the host).</p>
<p>However, though the host scheduled all these executions concurrently, second and third execution requests are delayed as there is only one CU on the FPGA (the FPGA still executes the kernels sequentially).<br /><img alt="Sequential kernels" src="../../../../_images/sequential_kernels_2.JPG" /><br />In the next step, you will increase the number of CU on the FPGA to allow three host kernel executions concurrently.</p>
</li>
</ol>
</div>
<div class="section" id="increasing-the-number-of-cus">
<h3>Increasing the Number of CUs<a class="headerlink" href="#increasing-the-number-of-cus" title="Permalink to this headline">¶</a></h3>
<p>Now, build the kernel xclbin again by altering the link step to generate three CUs of the same kernel.</p>
<p>Open the <code class="docutils literal notranslate"><span class="pre">link.cfg</span></code> file, and change the <code class="docutils literal notranslate"><span class="pre">nk</span></code> setting.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nk</span> <span class="o">=</span> <span class="n">Filter2DKernel</span><span class="p">:</span><span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="run-hardware-emulation-and-inspect-the-change">
<h3>Run Hardware Emulation and Inspect the Change<a class="headerlink" href="#run-hardware-emulation-and-inspect-the-change" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Regenerate the <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> file. You need to do <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span></code> to delete the existing xclbin with one CU and to create a new xclbin with three kernel CUs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">clean</span>
<span class="n">make</span> <span class="n">run</span> <span class="n">MODE</span><span class="o">=</span><span class="n">hw_emu</span>
</pre></div>
</div>
</li>
<li><p>View the new <code class="docutils literal notranslate"><span class="pre">xclbin.run_summary</span></code> in the Vitis analyzer.</p></li>
</ol>
<p>You can now see that the application takes advantage of the three CUs, and that the kernel executions overlaps and executes in parallel, speeding up the overall application.
<img alt="missing image" src="../../../../_images/overlapping_kernels_vitis_2.JPG" /></p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>You have learned how to alter the kernel linking process to execute same kernel functions concurrently on an FPGA.
</br></p>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/README.md">Return to Main Page</a></b></p>
<p align="center" class="sphinxhide"><sup>Copyright&copy; 2021 Xilinx</sup></p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../06-controlling-vivado-implementation/README.html" class="btn btn-neutral float-right" title="Controlling Vivado Implementation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../04-mult-ddr-banks/README.html" class="btn btn-neutral float-left" title="Using Multiple DDR Banks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on January 18, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2019-2022, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>