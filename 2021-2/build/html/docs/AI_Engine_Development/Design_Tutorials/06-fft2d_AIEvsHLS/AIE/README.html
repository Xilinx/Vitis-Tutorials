


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../../_sources/docs/AI_Engine_Development/Design_Tutorials/06-fft2d_AIEvsHLS/AIE/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>AI Engine Implementation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/docs/AI_Engine_Development/Design_Tutorials/06-fft2d_AIEvsHLS/AIE/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table>
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2021.1 Versal 2D-FFT Implementation Using Vitis Acceleration Library Tutorial (XD073)</h1>
   </td>
 </tr>
</table><div class="section" id="ai-engine-implementation">
<h1>AI Engine Implementation<a class="headerlink" href="#ai-engine-implementation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="#Building-the-Design">Building the Design</a></p>
<p><a class="reference external" href="#Hardware-Design-Details">Hardware Design Details</a></p>
<p><a class="reference external" href="#Software-Design-Details">Software Design Details</a></p>
<p><a class="reference external" href="#Performance-Details">Performance Details</a></p>
</div>
</div>
<div class="section" id="building-the-design">
<h1>Building the Design<a class="headerlink" href="#building-the-design" title="Permalink to this headline">¶</a></h1>
<details>
<summary>Design Build</summary> <div class="section" id="design-build">
<h2>Design Build<a class="headerlink" href="#design-build" title="Permalink to this headline">¶</a></h2>
<p>In this section, you will build and run the 2D-FFT design using the AI Engine implementation. You will compile the AI Engine design and integrate it into a larger system design (including the PL kernels and PS host application). Review <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/yii1603912637443.html">Integrating the Application Section in the AI Engine Documentation</a> for the general flow.</p>
<p>At the end of this section, the design flow will generate a new directory (called <code class="docutils literal notranslate"><span class="pre">build/</span></code>). Underneath are sub-directories named <code class="docutils literal notranslate"><span class="pre">fft2d_$(MAT_ROWS)x$(MAT_COLS)/x$(FFT_2D_INSTS)/</span></code> (for example, <code class="docutils literal notranslate"><span class="pre">fft2d_1024x2048/x1/</span></code>) depending on value of matrix dimensions <code class="docutils literal notranslate"><span class="pre">${MAT_ROWS}</span></code>, <code class="docutils literal notranslate"><span class="pre">${MAT_COLS}</span></code> and the number of instances <code class="docutils literal notranslate"><span class="pre">$(FFT_2D_INSTS)</span></code> chosen in the build. Each sub-directory contains the <code class="docutils literal notranslate"><span class="pre">hw_emu/</span></code> and/or <code class="docutils literal notranslate"><span class="pre">hw/</span></code> subfolders. The respective subfolders contain <code class="docutils literal notranslate"><span class="pre">Work/</span></code> and <code class="docutils literal notranslate"><span class="pre">libadf.a</span></code>, outputs from the AI Engine compiler, the host app executable and the builds, targeted to <code class="docutils literal notranslate"><span class="pre">hw</span></code> or <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> respectively. The <code class="docutils literal notranslate"><span class="pre">hw_emu/</span></code> subfolder contains the build for hardware emulation. The <code class="docutils literal notranslate"><span class="pre">hw/</span></code> subfolder contains the build for hardware run on a VCK190 board.</p>
</details><details>
<summary>Make Steps</summary> </div>
<div class="section" id="make-steps">
<h2>Make Steps<a class="headerlink" href="#make-steps" title="Permalink to this headline">¶</a></h2>
<p>To run the following <code class="docutils literal notranslate"><span class="pre">make</span></code> steps (that is, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">kernels</span></code>, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">graph</span></code>, and so on), you must be in the <code class="docutils literal notranslate"><span class="pre">AIE/</span></code> folder. The options that can be specified in the <code class="docutils literal notranslate"><span class="pre">make</span></code> steps are as follows.</p>
<p><code class="docutils literal notranslate"><span class="pre">TARGET:</span></code> This can be set to <code class="docutils literal notranslate"><span class="pre">hw</span></code> or <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> to build the design in the hardware or hardware emulation flow respectively. The default option is <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS:</span></code> This can be set to 1, 5, or 10 to build the design with the number of kernel instances. The default is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ITER_CNT:</span></code> The number of iterations the design is run. The default is <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">FFT_2D_PT</span></code>: FFT 2D point. Permissible values are <code class="docutils literal notranslate"><span class="pre">64</span></code>, <code class="docutils literal notranslate"><span class="pre">128</span></code>, <code class="docutils literal notranslate"><span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">512</span></code>, and <code class="docutils literal notranslate"><span class="pre">2048</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span> <span class="pre">x</span> <span class="pre">MAT_COLS:</span></code> Dimensions of the matrix (number of rows in the input matrix x number of cols in the input matrix). Automatically configured as <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT/2,</span> <span class="pre">FFT_2D_PT</span></code>. Permissible values are <code class="docutils literal notranslate"><span class="pre">32x64</span></code>, <code class="docutils literal notranslate"><span class="pre">64x128</span></code>, <code class="docutils literal notranslate"><span class="pre">128x256</span></code>, <code class="docutils literal notranslate"><span class="pre">256x512</span></code>, and <code class="docutils literal notranslate"><span class="pre">1024x2048</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">1024x2048</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">EN_TRACE:</span></code> Flag to enable trace profiling. <code class="docutils literal notranslate"><span class="pre">0</span></code> is disabled and <code class="docutils literal notranslate"><span class="pre">1</span></code> is enabled. The default is <code class="docutils literal notranslate"><span class="pre">0</span></code> (disabled).</p>
<p>The Makefile uses the following directory references:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Relative fft_2d directory
RELATIVE_PROJECT_DIR := ./

# Absolute fft_2d directory = &lt;user path&gt;/Tutorials/AI_Engine/fft_2d
PROJECT_REPO := $(shell readlink -f $(RELATIVE_PROJECT_DIR))

DESIGN_REPO  := $(PROJECT_REPO)/design
AIE_SRC_REPO := $(DESIGN_REPO)/aie_src
HOST_APP_SRC := $(DESIGN_REPO)/host_app_src
PL_SRC_REPO  := $(DESIGN_REPO)/pl_src
SYSTEM_CONFIGS_REPO    := $(DESIGN_REPO)/system_configs
PROFILING_CONFIGS_REPO := $(DESIGN_REPO)/profiling_configs
BASE_BLD_DIR     := $(PROJECT_REPO)/build
FFTPT_BLD_DIR    := $(BASE_BLD_DIR)/fft2d_$(MAT_ROWS)x$(MAT_COLS)
INSTS_BLD_DIR    := $(FFTPT_BLD_DIR)/x$(FFT_2D_INSTS)
BUILD_TARGET_DIR := $(INSTS_BLD_DIR)/$(TARGET)
WORK_DIR         := Work
</pre></div>
</div>
</details><details>
<summary>Build the Entire Design with a Single Command</summary></div>
<div class="section" id="build-the-entire-design-with-a-single-command">
<h2>Build the Entire Design with a Single Command<a class="headerlink" href="#build-the-entire-design-with-a-single-command" title="Permalink to this headline">¶</a></h2>
<p>If you are already familiar with the AI Engine and Vitis kernel compilation flows, you can build the entire design for each case of <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS</span></code> with one command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make run <span class="o">(</span>default hardware emulation, <span class="m">1</span> instance, <span class="nv">iterations</span><span class="o">=</span><span class="m">8</span>, matrix dimentions <span class="nv">rows</span><span class="o">=</span><span class="m">1024</span> and <span class="nv">columns</span><span class="o">=</span><span class="m">2048</span>, no trace-profiling <span class="o">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make run <span class="nv">TARGET</span><span class="o">=</span>hw <span class="nv">FFT_2D_INSTS</span><span class="o">=</span><span class="m">5</span> <span class="nv">ITER_CNT</span><span class="o">=</span><span class="m">16</span> <span class="nv">EN_TRACE</span><span class="o">=</span><span class="m">1</span> <span class="nv">FFT_2D_PT</span><span class="o">=</span><span class="m">64</span> <span class="o">(</span>hardware, <span class="m">5</span> instances, <span class="m">16</span> iterations, <span class="nb">enable</span> trace profiling, matrix dimentions <span class="nv">rows</span><span class="o">=</span><span class="m">32</span> and <span class="nv">columns</span><span class="o">=</span><span class="m">64</span> <span class="o">)</span>
</pre></div>
</div>
<p>This command runs the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">kernels</span></code>,<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">graph</span></code>,<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">xclbin</span></code>,<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">application</span></code>,<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">package</span></code>, and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">run_emu</span></code> for hardware emulation or to run on hardware (VCK190 board) depending on the <code class="docutils literal notranslate"><span class="pre">TARGET</span></code> you specify. The settings also apply to the individual make steps listed below.</p>
<p>The generated files for each <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS</span></code> are placed under an individual directory: <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/</span></code>. Each <code class="docutils literal notranslate"><span class="pre">make</span></code> step to build the design is specified in the following sections. These sections also detail the options used and the location of input and output files in each case.</p>
</details><details>
<summary>make kernels: Compiling PL Kernels</summary> </div>
<div class="section" id="make-kernels-compiling-pl-kernels">
<h2>make kernels: Compiling PL Kernels<a class="headerlink" href="#make-kernels-compiling-pl-kernels" title="Permalink to this headline">¶</a></h2>
<p>In this step, the Vitis compiler takes any Vitis compiler kernels (RTL or HLS C) in the PL region of the target platform (<code class="docutils literal notranslate"><span class="pre">xilinx_vck190_base_202110_1</span></code>) and the AI Engine kernels and graph and compiles them into their respective XO files. The following commands compile the kernels (default <code class="docutils literal notranslate"><span class="pre">TARGET=hw_emu</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>, <code class="docutils literal notranslate"><span class="pre">ITER_CNT=8</span></code>, and <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT=2048</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">kernels</span>
</pre></div>
</div>
<p>The expanded command is as follows (for <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir -p $(BUILD_TARGET_DIR); \

cd $(BUILD_TARGET_DIR); \

v++ --target hw_emu --hls.clock 250000000:dma_hls --platform xilinx_vck190_base_202110_1 \
   --save-temps --temp_dir $(BUILD_TARGET_DIR)/_x --verbose -g -c -k dma_hls \
   $(DESIGN_REPO)/pl_src/dma_hls.cpp -o $(BUILD_TARGET_DIR)/dma_hls.hw_emu.xo
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/vitiscommandcompiler.html#wrj1504034328013">this page</a> for a detailed description of all Vitis compiler switches. The following table provides a summary of the switches used.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--target | -t [hw|hw_emu]</td>
<td>Specifies the build target.</td>
</tr>
<tr>
<td>--platform | -f</td>
<td>Specifies the name of a supported acceleration platform as specified by the $PLATFORM_REPO_PATHS environment variable or the full path to the platform XPFM file.</td>
</tr>
<tr>
<td>--save-temps | -s</td>
<td>Directs the Vitis compiler command to save intermediate files/directories created during the compilation and link process. Use the <code>--temp_dir</code> option to specify a location to write the intermediate files to.</td>
</tr>
<tr>
<td>--temp_dir <string></td>
<td>This allows you to manage the location where the tool writes temporary files created during the build process. The temporary results are written by the Vitis compiler, and then removed, unless the <code>--save-temps</code> option is also specified.</td>
</tr>
<tr>
<td>--verbose</td>
<td>Display verbose/debug information.</td>
</tr>
<tr>
<td>--compile | -c</td>
<td>Required for compilation to generate XO files from kernel source files.</td>
</tr>
<tr>
<td>--kernel \&lt;arg>|-k \&lt;arg></td>
<td>Compile only the specified kernel from the input file. Only one -k option is allowed per Vitis compiler command.</td>
</tr>
<tr>
<td>--output | -o</td>
<td>Specifies the name of the output file generated by the V++ command. The DMA HLS kernels output should be XO.</td>
</tr>
</tbody>
</table><table border="1" class="docutils">
<thead>
<tr>
<th>Input</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(PL_SRC_REPO)/dma_hls.cpp</td>
<td>Defines the data mover PL kernel.</td>
</tr>
</tbody>
</table><table border="1" class="docutils">
<thead>
<tr>
<th>Output</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(BUILD_TARGET_DIR)/dma_hls.hw_emu.xo</td>
<td>The data mover kernel object file.</td>
</tr>
</tbody>
</table></details><details>
<summary>make graph: Creating the AI Engine ADF Graph for the Vitis Compiler Flow</summary> </div>
<div class="section" id="make-graph-creating-the-ai-engine-adf-graph-for-vitis-compiler-flow">
<h2>make graph: Creating the AI Engine ADF Graph for Vitis Compiler Flow<a class="headerlink" href="#make-graph-creating-the-ai-engine-adf-graph-for-vitis-compiler-flow" title="Permalink to this headline">¶</a></h2>
<p>An ADF graph can be connected to an extensible Vitis platform (the graph I/Os can be connected either to platform ports or to ports on Vitis kernels through Vitis compiler connectivity directives).</p>
<ul class="simple">
<li><p>The AI Engine ADF C++ graph of the design contains AI Engine kernels and PL kernels.</p></li>
<li><p>All interconnects between kernels are defined in the C++ graph</p></li>
<li><p>All interconnections to external I/O are fully specified in the C++ simulation testbench (<code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code>) that instantiates the C++ ADF graph object.</p></li>
</ul>
<p>To compile the graph using the Makefile flow type (default <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>, <code class="docutils literal notranslate"><span class="pre">ITER_CNT=8</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT=2048</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">graph</span>
</pre></div>
</div>
<p>The following AI Engine compiler command compiles the AI Engine design graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $(BUILD_TARGET_DIR); \

aiecompiler -include=$(AIE_SRC_REPO) -include=&lt;DSPLIB_ROOT&gt;/L1/include/aie \
   -include=&lt;DSPLIB_ROOT&gt;/L1/src/aie \
   -include=&lt;DSPLIB_ROOT&gt;/L1/tests/aie/inc \
   -include=&lt;DSPLIB_ROOT&gt;/L1/tests/aie/src \
   -include=&lt;DSPLIB_ROOT&gt;/L2/include/aie \
   -include=&lt;DSPLIB_ROOT&gt;/L2/tests/aie/common/inc \
   --verbose --Xpreproc=&quot;-DFFT2D_INSTS=1&quot; --Xpreproc=&quot;-DMAT_ROWS=1024&quot; --Xpreproc=&quot;-DMAT_COLS=2048&quot; \
   --platform=&lt;PLATFORM_REPO_PATHS/xilinx_vck190_base_202110_1&gt;/xilinx_vck190_base_202110_1.xpfm \
   --log-level=5 --test-iterations=2 --dataflow --heapsize=7000 \
   --Xchess=&quot;main:bridge.llibs=softfloat m&quot; --workdir=Work $(AIE_SRC_REPO)/graph.cpp 2&gt;&amp;1 | tee -a aiecompiler.log 
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/vjv1611769393894.html">this page</a> for full AI Engine programming environment documentation.</p>
<p>The following table provides a summary of the switches used.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--include=\&lt;string></td>
<td>Specify compile-time include directory (zero or more).</td>
</tr>
<tr>
<td>--verbose|-v</td>
<td>Verbose output of the AI Engine compiler emits compiler messages at various stages of compilation. These debug and tracing logs provide useful messages on the compilation process.</td>
</tr>
<tr>
<td>--Xpreproc="-D\&lt;Pre-processor Macro String>"</td>
<td>Specify compile time macro.</td>
</tr>
<tr>
<td>--Xchess="\&lt;Chess Make Options>"</td>
<td>Specify compile time chess make options; "main:bridge.llibs=softfloat m" enables floating point operations.</td>
</tr>
<tr>
<td>--heapsize=\&lt;int></td>
<td>Heap size in bytes.</td>
</tr>
<tr>
<td>--log-level=\&lt;int></td>
<td>Log level for verbose logging (default=1).</td>
</tr>
<tr>
<td>--workdir=\&lt;string></td>
<td>By default, the compiler writes all outputs to a sub-directory of the current directory, called Work. Use this option to specify a different output directory.</td>
</tr>
</tbody>
</table><p>The following is a description of the output objects that results from executing the AI Engine compiler (<code class="docutils literal notranslate"><span class="pre">aiecompiler</span></code>) command.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Inputs Sources</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(AIE_SRC_REPO)/graph.cpp</td>
<td>Defines the row wise and col wise FFT graph objects.</td>
</tr>
</tbody>
</table><table border="1" class="docutils">
<thead>
<tr>
<th>Output Objects</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(BUILD_TARGET_DIR)/libadf.a</td>
<td>Compiled AI Engine design graph.</td>
</tr>
<tr>
<td>$(BUILD_TARGET_DIR)/Work/</td>
<td>Directory that contains all outputs of the AI Engine compiler.</td>
</tr>
<tr>
<td></details></td>
<td></td>
</tr>
</tbody>
</table><details>
<summary>make xclbin: Using the Vitis Tools to Link AI Engine and HLS Kernels with the Platform</summary> </div>
<div class="section" id="make-xclbin-using-the-vitis-tools-to-link-ai-engine-and-hls-kernels-with-the-platform">
<h2>make xclbin: Using the Vitis Tools to Link AI Engine and HLS Kernels with the Platform<a class="headerlink" href="#make-xclbin-using-the-vitis-tools-to-link-ai-engine-and-hls-kernels-with-the-platform" title="Permalink to this headline">¶</a></h2>
<p>After the AI Engine kernels and graph and PL HLS kernels have been compiled, you can use the Vitis compiler to link them with the platform to generate a XCLBIN file.</p>
<p>The Vitis tools allow you to integrate the AI Engine, HLS, and RTL kernels into an existing extensible platform. This is an automated step from a software developer perspective where the platform chosen is provided by the hardware designer. Alternatively, you can opt to use one of the many extensible base platforms provided by Xilinx, and use the Vitis tools to build the hardware design and integrate the AI Engine and PL kernels into it.</p>
<p>To test this feature in this tutorial, use the base VCK190 platform to build the design. The command to run this step is shown in the following example (default <code class="docutils literal notranslate"><span class="pre">TARGET=hw_emu</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>, <code class="docutils literal notranslate"><span class="pre">ITER_CNT=8</span></code>, <code class="docutils literal notranslate"><span class="pre">EN_TRACE=0</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT=2048</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">xclbin</span>
</pre></div>
</div>
<p>The expanded command is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $(BUILD_TARGET_DIR);	\

v++ -l --platform xilinx_vck190_base_202110_1 --save-temps \
   --temp_dir $(BUILD_TARGET_DIR)/_x --verbose -g --clock.freqHz 250000000:dma_hls_0 \
   --clock.defaultTolerance 0.001 --config $(SYSTEM_CONFIGS_REPO)/x1.cfg \
   --vivado.prop fileset.sim_1.xsim.simulate.log_all_signals=true \
   -t hw_emu -o $(BUILD_TARGET_DIR)/vck190_aie_fft_2d.hw_emu.xclbin \
   $(BUILD_TARGET_DIR)/dma_hls.hw_emu.xo \
   $(BUILD_TARGET_DIR)/libadf.a
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">EN_TRACE</span></code> is enabled, the following Vitis compiler flags are also set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="o">--</span><span class="n">profile</span><span class="o">.</span><span class="n">data</span> <span class="n">dma_hls</span><span class="p">:</span><span class="nb">all</span><span class="p">:</span><span class="nb">all</span> <span class="ow">or</span> <span class="n">profile</span><span class="o">.</span><span class="n">data</span> <span class="n">dma_hls</span><span class="p">:</span><span class="nb">all</span><span class="p">:</span><span class="n">strmInp_from_colwiseFFT</span> <span class="p">(</span><span class="k">for</span> <span class="n">higher</span> <span class="n">instances</span><span class="p">)</span> \
   <span class="o">--</span><span class="n">profile</span><span class="o">.</span><span class="n">trace_memory</span> <span class="n">DDR</span>
</pre></div>
</div>
<p>For higher values of <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS</span></code>, only the <code class="docutils literal notranslate"><span class="pre">strmInp_from_colwiseFFT</span></code> port is profiled to avoid too much data.</p>
<p>See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/buildingdevicebinary.html#mjs1528399150499">this page</a> for a detailed description of Vitis linking options.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--platform | -f</td>
<td>Specifies the name of a supported acceleration platform as specified by the $PLATFORM_REPO_PATHS environment variable or the full path to the platform XPFM file.</td>
</tr>
<tr>
<td>--save-temps | -s</td>
<td>Directs the V++ command to save intermediate files/directories created during the compilation and link process. Use the <code>--temp_dir</code> option to specify a location to write the intermediate files to.</td>
</tr>
<tr>
<td>--temp_dir <string></td>
<td>This allows you to manage the location where the tool writes temporary files created during the build process. The temporary results are written by the Vitis compiler, and then removed, unless the <code>--save-temps</code> option is also specified.</td>
</tr>
<tr>
<td>--verbose</td>
<td>Display verbose/debug information.</td>
</tr>
<tr>
<td>--config <config_file></td>
<td>Specifies a configuration file containing V++ switches.</td>
</tr>
<tr>
<td>--output | -o</td>
<td>Specifies the name of the output file generated by the V++ command. In this design the outputs of the DMA HLS kernels and the PL kernels interfacing with the AI Engine are in XO files.</td>
</tr>
<tr>
<td>--profile.data [<kernel_name>|all]:[<cu_name>|all]:[<interface_name>|all](:[counters|all])</td>
<td>Enables monitoring of data ports through the monitor IPs. This option needs to be specified during linking. See <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/vitiscommandcompiler.html#lpy1600804966354">this page</a> for detailed profiling options.</td>
</tr>
<tr>
<td>--profile.trace_memory \&lt;FIFO>:\&lt;size>|\&lt;MEMORY>[\&lt;n>]</td>
<td>When building the hardware target (-t=hw), use this option to specify the type and amount of memory to use for capturing trace data. See <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/vitiscommandcompiler.html#lpy1600804966354">this page</a> for detailed profiling options.</td>
</tr>
</tbody>
</table><p>The information to tell the linker how to connect the AI Engine and PL kernels together is described in a configuration file, <code class="docutils literal notranslate"><span class="pre">system_configs/x$(FFT_2D_INSTS).cfg</span></code>. The file describes the overall connection scheme of the system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">connectivity</span><span class="p">]</span>
<span class="n">nk</span><span class="o">=</span><span class="n">dma_hls</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">dma_hls_0</span>

<span class="c1">#Connections For FFT-2D Insts 0...</span>
<span class="n">stream_connect</span><span class="o">=</span><span class="n">dma_hls_0</span><span class="o">.</span><span class="n">strmOut_to_rowiseFFT</span><span class="p">:</span><span class="n">ai_engine_0</span><span class="o">.</span><span class="n">DataIn0</span>
<span class="n">stream_connect</span><span class="o">=</span><span class="n">ai_engine_0</span><span class="o">.</span><span class="n">DataOut0</span><span class="p">:</span><span class="n">dma_hls_0</span><span class="o">.</span><span class="n">strmInp_from_rowiseFFT</span>
<span class="n">stream_connect</span><span class="o">=</span><span class="n">dma_hls_0</span><span class="o">.</span><span class="n">strmOut_to_colwiseFFT</span><span class="p">:</span><span class="n">ai_engine_0</span><span class="o">.</span><span class="n">DataIn1</span>
<span class="n">stream_connect</span><span class="o">=</span><span class="n">ai_engine_0</span><span class="o">.</span><span class="n">DataOut1</span><span class="p">:</span><span class="n">dma_hls_0</span><span class="o">.</span><span class="n">strmInp_from_colwiseFFT</span>

<span class="p">[</span><span class="n">advanced</span><span class="p">]</span>
<span class="c1"># Disable Profiling in hw_emu so that it is faster...</span>
<span class="n">param</span><span class="o">=</span><span class="n">hw_emu</span><span class="o">.</span><span class="n">enableProfiling</span><span class="o">=</span><span class="n">false</span>

<span class="c1"># Export the xsa of the design..</span>
<span class="n">param</span><span class="o">=</span><span class="n">compiler</span><span class="o">.</span><span class="n">addOutputTypes</span><span class="o">=</span><span class="n">hw_export</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/vitiscommandcompiler.html?hl=--config#pni1524163195211">this page</a> for a detailed description of the Vitis compiler configuration file.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>--connectivity.nk</td>
<td>Number of kernels. <code>dma_hls:1:dma_hls_0</code> means that the Vitis compiler should instantiate one dma_hls kernel and name the instance <code>dma_hls_0</code>.</td>
</tr>
<tr>
<td>--connectivity.stream_connect</td>
<td>How the kernels will connect to IPs, platforms, or other kernels. The output of the AI Engine compiler tells you the interfaces that need to be connected. <code>dma_hls_0.strmOut_to_rowiseFFT:ai_engine_0.DataIn0</code> means that the Vitis compiler should connect the port <code>strmOut_to_rowiseFFT</code> of the <code>dma_hls</code> PL kernel to the shim channel of the AI Engine with the logical name <code>DataIn0</code>, defined in <code>$(AIE_SRC_REPO)/graph.cpp</code> as part of the PLIO instantiation.</td>
</tr>
<tr>
<td>param=compiler.addOutputTypes=hw_export</td>
<td>This option tells the Vitis compiler that besides creating an XCLBIN file, it also outputs an XSA file which is needed to create a post-Vivado fixed platform for Vitis software development.</td>
</tr>
</tbody>
</table><p>The Vitis compiler calls the Vivado® IP integrator under the hood to build the design. The platform and kernels are input to the Vivado Design Suite, which produces a simulation XSA or an XSA after running place and route on the design. The point at which the XSA is produced from Vivado depends on the <code class="docutils literal notranslate"><span class="pre">-target</span></code> option set on the Vitis compiler command line.</p>
<p>You can now view the Vivado project, which is located in the <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/_x/link/vivado/vpl/prj</span></code> directory. You have now have generated the XCLBIN file that will be used to execute your design on the platform.</p>
</details><details>
<summary>make application: Compiling the Host Application</summary> </div>
<div class="section" id="make-application-compiling-the-host-application">
<h2>make application: Compiling the Host Application<a class="headerlink" href="#make-application-compiling-the-host-application" title="Permalink to this headline">¶</a></h2>
<p>You can compile the host application by following the typical cross-compilation flow for the Cortex A72. To build the application, run the following command (default <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>, <code class="docutils literal notranslate"><span class="pre">ITER_CNT=8</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT=2048</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">application</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $(BUILD_TARGET_DIR);	\

aarch64-xilinx-linux-g++ -mcpu=cortex-a72.cortex-a53 -march=armv8-a+crc -fstack-protector-strong\
   -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=$(SDKTARGETSYSROOT) -O -c\
   -std=c++14 -D__linux__ -D__PS_ENABLE_AIE__ -DXAIE_DEBUG -DFFT2D_INSTS=1 -DITER_CNT=8\
   -DMAT_ROWS=1024 -DMAT_COLS=2048 -I$(SDKTARGETSYSROOT)/usr/include/xrt -I$(XILINX_VITIS)/aietools/include/\
   -I$(SDKTARGETSYSROOT)/usr/include -I$(SDKTARGETSYSROOT)/usr/lib -I$(AIE_SRC_REPO) -I$(HOST_APP_SRC)\
   -I$(DSPLIB_ROOT)/L1/include/aie -I$(DSPLIB_ROOT)/L1/src/aie -I$(DSPLIB_ROOT)/L1/tests/aie/inc\
   -I$(DSPLIB_ROOT)/L1/tests/aie/src -I$(DSPLIB_ROOT)/L2/include/aie -I$(DSPLIB_ROOT)/L2/tests/aie/common/inc\
   $(BUILD_TARGET_DIR)/$(WORK_DIR)/ps/c_rts/aie_control_xrt.cpp -o $(BUILD_TARGET_DIR)/app_control.o

aarch64-xilinx-linux-g++ -mcpu=cortex-a72.cortex-a53 -march=armv8-a+crc -fstack-protector-strong\
   -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=$(SDKTARGETSYSROOT) -O -c\
   -std=c++14 -D__linux__ -D__PS_ENABLE_AIE__ -DXAIE_DEBUG -DFFT2D_INSTS=1 -DITER_CNT=8\
   -DMAT_ROWS=1024 -DMAT_COLS=2048 -I$(SDKTARGETSYSROOT)/usr/include/xrt -I$(XILINX_VITIS)/aietools/include/\
   -I$(SDKTARGETSYSROOT)/usr/include -I$(SDKTARGETSYSROOT)/usr/lib -I$(AIE_SRC_REPO) -I$(HOST_APP_SRC)\
   -I$(DSPLIB_ROOT)/L1/include/aie -I$(DSPLIB_ROOT)/L1/src/aie -I$(DSPLIB_ROOT)/L1/tests/aie/inc\
   -I$(DSPLIB_ROOT)/L1/tests/aie/src -I$(DSPLIB_ROOT)/L2/include/aie -I$(DSPLIB_ROOT)/L2/tests/aie/common/inc\
   $(HOST_APP_SRC)/fft_2d_aie_app.cpp -o $(BUILD_TARGET_DIR)/fft_2d_aie_app.o -L$(SDKTARGETSYSROOT)/usr/lib\
   -L$(XILINX_VITIS)/aietools/lib/aarch64.o -L$(XILINX_VITIS)/aietools/lib/lnx64.o -ladf_api_xrt -lxrt_coreutil

aarch64-xilinx-linux-g++ -mcpu=cortex-a72.cortex-a53 -march=armv8-a+crc -fstack-protector-strong
   -D_FORTIFY_SOURCE=2 -Wformat -Wformat-security -Werror=format-security --sysroot=$(SDKTARGETSYSROOT)\
   $(BUILD_TARGET_DIR)/app_control.o $(BUILD_TARGET_DIR)/fft_2d_aie_app.o -L$(SDKTARGETSYSROOT)/usr/lib\
   -L$(XILINX_VITIS)/aietools/lib/aarch64.o -L$(XILINX_VITIS)/aietools/lib/lnx64.o\
   -ladf_api_xrt -lxrt_coreutil -o $(BUILD_TARGET_DIR)/fft_2d_aie_xrt.elf
</pre></div>
</div>
<p>See <a class="reference external" href="https://xilinx.github.io/XRT/2021.1/html/index.html">this page</a> for XRT documentation. See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/devhostapp.html#vpy1519742402284">this page</a> for details of host application programming.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-O | Optimize.</td>
<td>Optimizing compilation takes more time and a lot more memory for a large function. With -O, the compiler tries to reduce code size and execution time, without performing any of the optimizations that can take a great deal of compilation time.</td>
</tr>
<tr>
<td>-D__linux__</td>
<td></td>
</tr>
<tr>
<td>-DXAIE_DEBUG</td>
<td>Enable debug interface capabilities where certain core status, event status, or stack trace can be dumped out.</td>
</tr>
<tr>
<td>-D\&lt;Pre-processor Macro String>=\&lt;value></td>
<td>Pass pre-processor macro definitions to the cross-compiler.</td>
</tr>
<tr>
<td>-I \&lt;dir></td>
<td>Add the directory <code>dir</code> to the list of directories to be searched for header files.</td>
</tr>
<tr>
<td>-o \&lt;file></td>
<td>Place output in file <code>&lt;file&gt;</code>. This applies regardless of the output being produced, whether it be an executable file, an object file, an assembler file, or preprocessed C code.</td>
</tr>
<tr>
<td>--sysroot=\&lt;dir></td>
<td>Use <code>dir</code> as the logical root directory for headers and libraries. For example, if the compiler normally searches for headers in <code>/usr/include</code> and libraries in <code>/usr/lib</code>, it instead searches <code>dir/usr/include</code> and <code>dir/usr/lib</code>. This is automatically set by the <code>env_setup.sh</code> script.</td>
</tr>
<tr>
<td>-l\&lt;library></td>
<td>Search the library named <code>library</code> when linking. The 2D-FFT tutorial requires the <code>adf_api_xrt</code> and <code>xrt_coreutil</code> libraries.</td>
</tr>
<tr>
<td>-L \&lt;dir></td>
<td>Add directory <code>&lt;dir&gt;</code> to the list of directories to be searched for <code>-l</code>.</td>
</tr>
</tbody>
</table><p>The following is a description of the input sources compiled by the AI Engine compiler command.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Inputs Sources</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(HOST_APP_SRC)/fft_2d_aie_app.cpp</td>
<td>Source application file for the <code>fft_2d_aie_xrt.elf</code> that will run on an A72 processor.</td>
</tr>
<tr>
<td>$(BUILD_TARGET_DIR)/Work/ps/c_rts/aie_control_xrt.cpp</td>
<td>This is the AI Engine control code generated implementing the graph APIs for the Lenet graph.</td>
</tr>
</tbody>
</table><p>The following is a description of the output objects that results from executing the AI Engine compiler command with the above inputs and options.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Output Objects</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(BUILD_TARGET_DIR)/fft_2d_aie_xrt.elf</td>
<td>The executable that will run on an A72 processor.</td>
</tr>
</tbody>
</table></details><details>
<summary>make package: Packaging the Design</summary> </div>
<div class="section" id="make-package-packaging-the-design">
<h2>make package: Packaging the Design<a class="headerlink" href="#make-package-packaging-the-design" title="Permalink to this headline">¶</a></h2>
<p>With the AI Engine outputs created, as well as the new platform, you can now generate the programmable device image (PDI) and a package to be used on an SD card. The PDI contains all the executables, bitstreams, and configurations of the device. The packaged SD card directory contains everything to boot Linux, the generated applications, and the XCLBIN.</p>
<p>The command to run this step is as follows (default <code class="docutils literal notranslate"><span class="pre">TARGET=hw_emu</span></code>, <code class="docutils literal notranslate"><span class="pre">EN_TRACE=0</span></code>, <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>, and <code class="docutils literal notranslate"><span class="pre">FFT_2D_PT=2048</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">package</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cp $(PROJECT_REPO)/run_script.sh $(BUILD_TARGET_DIR)/
cd$(BUILD_TARGET_DIR);	\

v++ -p -t hw --save-temps --temp_dir $(BUILD_TARGET_DIR)/_x -f xilinx_vck190_base_202110_1\
   --package.rootfs $(XLNX_VERSAL)/rootfs.ext4\
   --package.kernel_image $(XLNX_VERSAL)/Image --package.boot_mode=sd\
   --package.out_dir $(BUILD_TARGET_DIR)/package --package.image_format=ext4\
   --package.sd_file $(BUILD_TARGET_DIR)/fft_2d_aie_xrt.elf \
   $(BUILD_TARGET_DIR)/vck190_aie_fft_2d.hw.xclbin $(BUILD_TARGET_DIR)/libadf.a \
   --package.defer_aie_run \
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">EN_TRACE</span></code> is enabled, the following Vitis compiler flags are also set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   --package.sd_file $(PROFILING_CONFIGS_REPO)/xrt.ini
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">XRT_ROOT</span></code> is set, the following Vitis compiler flags are also set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   --package.sd_dir $(XRT_ROOT)
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/packagesystem1.html#cwq1586366344968">this page</a> for more details about packaging the system.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>--target | -t [hw|hw_emu]</td>
<td>Specifies the build target.</td>
</tr>
<tr>
<td>--package | -p</td>
<td>Packages the final product at the end of the Vitis compile and link build process.</td>
</tr>
<tr>
<td>--package.rootfs \&lt;arg></td>
<td>Where \&lt;arg> specifies the absolute or relative path to a processed Linux root file system file. The platform RootFS file is available for download from xilinx.com. Refer to the <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/acceleration_installation.html">Vitis Software Platform Installation</a> for more information.</td>
</tr>
<tr>
<td>--package.kernel_image \&lt;arg></td>
<td>Where \&lt;arg> specifies the absolute or relative path to a Linux kernel image file. Overrides the existing image available in the platform. The platform image file is available for download from xilinx.com. Refer to the <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/acceleration_installation.html">Vitis Software Platform Installation</a> for more information.</td>
</tr>
<tr>
<td>--package.boot_mode \&lt;arg></td>
<td>Where \&lt;arg> specifies <ospi\|qspi\|sd>. Boot mode used for running the application in emulation or on hardware.</td>
</tr>
<tr>
<td>--package.image_format</td>
<td>Where \&lt;arg> specifies the \&lt;ext4|fat32> output image file format. <code>ext4</code> is the Linux file system and <code>fat32</code> is the Windows file system.</td>
</tr>
<tr>
<td>--package.sd_file</td>
<td>Where \&lt;arg> specifies an ELF or other data file to package into the <code>sd_card</code> directory/image. This option can be used repeatedly to specify multiple files to add to the <code>sd_card</code> directory.</td>
</tr>
<tr>
<td>--package.defer_aie_run</td>
<td>Load the AI Engine application with the ELF file, but wait to run it until graph run directs it. This is required in the PS based AI Engine flow.</td>
</tr>
</tbody>
</table><table border="1" class="docutils">
<thead>
<tr>
<th>Inputs Sources</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(PLATFORM_REPO_PATHS)/sw/versal/xrt</td>
<td>The PS host application needs the XRT headers in this folder to execute.</td>
</tr>
<tr>
<td>$(PLATFORM_REPO_PATHS)/sw/versal/xilinx-versal/rootfs.ext4</td>
<td>The root filesystem file for PetaLinux.</td>
</tr>
<tr>
<td>$(PLATFORM_REPO_PATHS)/sw/versal/xilinx-versal/Image</td>
<td>The pre-built PetaLinux image that the processor boots from.</td>
</tr>
<tr>
<td>$(BUILD_TARGET_DIR)/fft_2d_aie_xrt.elf</td>
<td>The PS host application executable created in the <code>make application</code> step.</td>
</tr>
<tr>
<td>$(BUILD_TARGET_DIR)/vck190_aie_fft_2d.hw_emu.xclbin</td>
<td>The XCLBIN file created in the <code>make xclbin</code> step.</td>
</tr>
<tr>
<td>$(BUILD_TARGET_DIR)/libadf.a</td>
<td>The compiled AI Engine design graph created in the <code>make graph</code> step.</td>
</tr>
</tbody>
</table><p>The output of the Vitis compiler package step is the package directory that contains the contents to run hardware emulation.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Output Objects</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>$(BUILD_TARGET_DIR)/package</td>
<td>The hardware emulation package that contains the boot file, hardware emulation launch script, PLM and PMC boot files, PMC and QEMU command argument specification files, and Vivado simulation folder.</td>
</tr>
</tbody>
</table></details><details>
<summary>make run_emu: Running Hardware Emulation</summary></div>
<div class="section" id="make-run-emu-running-hardware-emulation">
<h2>make run_emu: Running Hardware Emulation<a class="headerlink" href="#make-run-emu-running-hardware-emulation" title="Permalink to this headline">¶</a></h2>
<p>After packaging, everything is set to run hardware emulation. To run emulation, use the following command (default <code class="docutils literal notranslate"><span class="pre">TARGET=hw_emu</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run_emu</span> 
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>###########################################################################
Hardware Emulation Goto:
$(BUILD_TARGET_DIR)/package

and do:
./launch_hw_emu.sh or ./launch_hw_emu.sh -g (for waveform viewer)...
</pre></div>
</div>
<p>When hardware emulation is launched, you will see the QEMU simulator load. Wait for the autoboot countdown to go to zero. After a few minutes, the root Linux prompt comes up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root@versal-rootfs-common-2021.1:~#
</pre></div>
</div>
<p>After the root prompt comes up, run the following commands to run the design:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p1</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="o">./</span><span class="n">fft_2d_aie_xrt</span><span class="o">.</span><span class="n">elf</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fft_2d_aie_xrt.elf</span></code> executes. After a few minutes, you should see the output with <code class="docutils literal notranslate"><span class="pre">TEST</span> <span class="pre">PASSED</span></code> on the console. When this is shown, run the following keyboard command to exit the QEMU instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#To exit QEMU Simulation</span>
<span class="n">Press</span> <span class="n">CtrlA</span><span class="p">,</span> <span class="n">let</span> <span class="n">go</span> <span class="n">of</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">press</span> <span class="n">x</span> 
</pre></div>
</div>
<p>To run with waveform, do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $(BUILD_TARGET_DIR)/package
./launch_hw_emu.sh -g
</pre></div>
</div>
<p>The XSIM Waveform Viewer is launched. Drag and drop the signals into the viewer and click <strong>Play</strong> to start the emulation. Go back to the terminal and wait for the Linux prompt to show up. In the XSIM Waveform Viewer, you will see the signals you added to the waveform adjusting over the execution of the design. When this is done, hit the pause button and close the window to end the emulation.</p>
<p>The following figure shows a waveform view of the 32x64 - 1x design.</p>
<p><img alt="Image of 2D-FFT AIE HW_EMU Run Waveform View For 32x64-1x Design" src="../../../../../_images/fft_2d_aie_hw_emu_waveform_view_32x64_x1.PNG" /></p>
</details><details>
<summary>TARGET=hw: Running on Hardware</summary></div>
<div class="section" id="running-on-hardware">
<h2>Running on Hardware<a class="headerlink" href="#running-on-hardware" title="Permalink to this headline">¶</a></h2>
<p>To run the design in hardware, rerun the following <code class="docutils literal notranslate"><span class="pre">make</span></code> steps with <code class="docutils literal notranslate"><span class="pre">TARGET=hw</span></code> and other applicable options (see the preceding <code class="docutils literal notranslate"><span class="pre">make</span></code> steps specified above).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">kernels</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span>
<span class="n">make</span> <span class="n">xclbin</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> 
<span class="n">make</span> <span class="n">package</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> 
</pre></div>
</div>
<p>These commands create a <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)</span></code> folder with the kernels, XCLBIN, and <code class="docutils literal notranslate"><span class="pre">package</span></code> for a hardware run.</p>
<p>Run the following step to set up the execution file, generated images, and base images (<code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/package/sd_card</span></code> and <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/package/sd_card.img</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run_emu</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> 
</pre></div>
</div>
<p>These commands create a <code class="docutils literal notranslate"><span class="pre">build/hw</span></code> folder with the kernels, XCLBIN, and <code class="docutils literal notranslate"><span class="pre">package</span></code> for a hardware run. Follow steps 1-9 to run the <code class="docutils literal notranslate"><span class="pre">fft_2d_aie_xrt.elf</span></code> executable on your VCK190 board.</p>
<p><strong>Step 1.</strong> Ensure your board is powered off.</p>
<p><strong>Step 2.</strong> Use an SD card writer (such as balenaEtcher) to flash the <code class="docutils literal notranslate"><span class="pre">sd_card.img</span></code> file to an SD card.</p>
<p><strong>Step 3.</strong> Plug the flashed SD card into the top slot of the VCK190 board.</p>
<p><strong>Step 4.</strong> Set the switch (<code class="docutils literal notranslate"><span class="pre">SW1</span> <span class="pre">Mode\[3:0\]=1110</span> <span class="pre">=</span> <span class="pre">OFF</span> <span class="pre">OFF</span> <span class="pre">OFF</span> <span class="pre">ON</span></code>).</p>
<p><strong>Step 5.</strong> Connect your computer to the VCK190 board using the USB cable included with the board.</p>
<p><strong>Step 6.</strong> Open a TeraTerm terminal and select the correct COM port. Set the port settings to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Port</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">COMMXX</span><span class="o">&gt;</span>
<span class="n">Speed</span><span class="p">:</span> <span class="mi">115200</span>
<span class="n">Data</span><span class="p">:</span> <span class="mi">8</span> <span class="n">bit</span>
<span class="n">Parity</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Stop</span> <span class="n">Bits</span><span class="p">:</span> <span class="mi">1</span> <span class="n">bit</span>
<span class="n">Flow</span> <span class="n">control</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Transmit</span> <span class="n">delay</span><span class="p">:</span> <span class="mi">0</span> <span class="n">msec</span><span class="o">/</span><span class="n">char</span> <span class="mi">0</span> <span class="n">msec</span><span class="o">/</span><span class="n">line</span>
</pre></div>
</div>
<p><strong>Step 7.</strong> Power on the board.</p>
<p><strong>Step 8.</strong> Wait until you see the <code class="docutils literal notranslate"><span class="pre">root&#64;versal-rootfs-common-2021_1</span></code> Linux command prompt. Press <strong>Enter</strong> a few times to get past any <code class="docutils literal notranslate"><span class="pre">xinit</span></code> errors.</p>
<p><strong>Step 9.</strong> Run the following commands in the TeraTerm terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">sd</span><span class="o">-</span><span class="n">mmcblk0p1</span>
<span class="n">export</span> <span class="n">XILINX_XRT</span><span class="o">=/</span><span class="n">usr</span>
<span class="o">./</span><span class="n">init</span><span class="o">.</span><span class="n">sh</span>

<span class="o">./</span><span class="n">fft_2d_aie_xrt</span><span class="o">.</span><span class="n">elf</span> <span class="n">a</span><span class="o">.</span><span class="n">xclbin</span>
</pre></div>
</div>
</details></div>
</div>
<div class="section" id="hardware-design-details">
<h1>Hardware Design Details<a class="headerlink" href="#hardware-design-details" title="Permalink to this headline">¶</a></h1>
<details>
<summary>2D-FFT AI Engine Implementation Architecture and AI Engine/PL Function Partitioning</summary><div class="section" id="d-fft-ai-engine-implementation-architecture-and-ai-engine-pl-function-partitioning">
<h2>2D-FFT AI Engine Implementation Architecture and AI Engine/PL Function Partitioning<a class="headerlink" href="#d-fft-ai-engine-implementation-architecture-and-ai-engine-pl-function-partitioning" title="Permalink to this headline">¶</a></h2>
<p>The following figure shows a high-level block diagram of the design. The test harness consists of the AI Engine and data mover HLS kernels (<code class="docutils literal notranslate"><span class="pre">dma_hls</span></code>). In this setup, there is an AXI4-Stream interface between the data mover kernels and AI Engines, with a data width of 128 bits. The data mover kernels and the AI Engine array interface are running at 250 MHz.</p>
<p>The data mover is a PL-based data generator and checker. It generates impulse input and checks the output of the row-wise FFT core for its response. It then generates the transposed pattern of the row-wise FFT output and feeds that to the col-wise FFT core and checks its output.</p>
<p><img alt="Image of 2D-FFT AIE Implementation Architecture" src="../../../../../_images/fft_2d_aie_block_diagram.PNG" /></p>
</details><details>
<summary>Design Details</summary></div>
<div class="section" id="design-details">
<h2>Design Details<a class="headerlink" href="#design-details" title="Permalink to this headline">¶</a></h2>
<p>The design in this tutorial starts with a base platform containing the control interface and processing system (CIPS), NoC, AI Engine, and the interfaces among them. The Vitis compiler linker step builds on top of the base platform by adding the AI Engine graphs and PL kernels. To add the various functions in a system-level design, PL kernels are added to the base platform depending on the application (that is, the PL kernels present in each design might vary). An ADF graph is connected to an extensible Vitis platform where the graph I/Os are connected either to the platform ports or to ports on Vitis kernels through the Vitis compiler connectivity directives. In the design, the components are added by the Vitis compiler <code class="docutils literal notranslate"><span class="pre">-l</span></code> step (see <a class="reference external" href="#make-xclbin-using-the-vitis-tools-to-link-ai-engine-and-hls-kernels-with-the-platform">make XCLBIN</a>) and include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">libadf.a</span></code></p></li>
<li><p>Data mover kernel (<code class="docutils literal notranslate"><span class="pre">dma_hls.[hw|hw_emu].xo</span></code>)</p></li>
<li><p>Connection interfaces defined in the system configuration file</p></li>
</ul>
<p>To see a schematic view of the design with the extended platform as shown in the following figure, open the following in Vivado:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`build/fft2d_$(MAT_ROWS)x$(MAT_COLS)/x$(FFT_2D_INSTS)/[hw|hw_emu]/_x/link/vivado/vpl/prj/prj.xpr`
</pre></div>
</div>
<p><img alt="Image of 2D-FFT AIE 1x Vivado BD" src="../../../../../_images/fft_2d_aie_1x_vivado_bd.PNG" /></p>
<p>In this design, the 2D FFT computation happens in two stages: the first compute is across the row vectors and the second stage is performed across the column vectors.The input data is accessed linearly and streamed to the AI Engines which perform <code class="docutils literal notranslate"><span class="pre">MAT_COLS(</span> <span class="pre">default</span> <span class="pre">2048</span> <span class="pre">)</span></code> point FFT. The data coming out of the AI Engines is streamed to a PL kernel where it is checked against the expected pattern (the first row should be 1 and the remaining should be 0). If there is a mismatch, it is recorded in the variable <code class="docutils literal notranslate"><span class="pre">stage0_errCnt</span></code>. The transposed pattern of the output of the row vectors is then linearly streamed into another AI Engine which performs <code class="docutils literal notranslate"><span class="pre">MAT_ROWS(</span> <span class="pre">default</span> <span class="pre">1024</span> <span class="pre">)</span></code> point FFT. The output is streamed into a data mover kernel again and is checked against the expected pattern (all values should be 1). If there is a mismatch, it is stored in the variable <code class="docutils literal notranslate"><span class="pre">stage1_errCnt</span></code>. Finally, the sum of <code class="docutils literal notranslate"><span class="pre">stage0_errCnt</span></code> and <code class="docutils literal notranslate"><span class="pre">stage1_errCnt</span></code> is returned from the kernel, which is read in the host app to determine whether the test has passed or failed.</p>
<p>The system debugging and profiling IP (DPA) is added to the PL region of the device to capture AI Engine runtime trace data if the <code class="docutils literal notranslate"><span class="pre">EN_TRACE</span></code> option is enabled in the design. The <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel and the AI Engine array interface are both operating at 250 MHz. Unlike the HLS/DSP implementation, there is no clock domain crossing in the PL region in this design.</p>
</details><details>
<summary>AI Engine and PL Kernels</summary></div>
<div class="section" id="ai-engine-and-pl-kernels">
<h2>AI Engine and PL Kernels<a class="headerlink" href="#ai-engine-and-pl-kernels" title="Permalink to this headline">¶</a></h2>
<p>The top-level AI Engine graph, <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code>, contains two sub-graphs: <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> and <code class="docutils literal notranslate"><span class="pre">FFTcols_graph</span></code>. Each sub-graph contains the individual AI Engine kernel, <code class="docutils literal notranslate"><span class="pre">*FFTrow_gr.getKernels()</span></code>, and <code class="docutils literal notranslate"><span class="pre">*FFTcol_gr.getKernels()</span></code>, which performs <code class="docutils literal notranslate"><span class="pre">MAT_COLS</span></code> and <code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span></code> point FFT respectively.</p>
<div class="section" id="dma-hls">
<h3>dma_hls<a class="headerlink" href="#dma-hls" title="Permalink to this headline">¶</a></h3>
<p>The PL-based data movers consist of the <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel, which generates impulse input and checks the output of each FFT stage for the expected pattern.</p>
<ul class="simple">
<li><p>It internally comprises four loops (<code class="docutils literal notranslate"><span class="pre">mm2s0</span></code>, <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code>, <code class="docutils literal notranslate"><span class="pre">mm2s1</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code>), with <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code> - <code class="docutils literal notranslate"><span class="pre">mm2s1</span></code> sequenced one after the other and wrapped into the <code class="docutils literal notranslate"><span class="pre">dmaHls_rowsToCols</span></code> function. <code class="docutils literal notranslate"><span class="pre">mm2s0</span></code>, <code class="docutils literal notranslate"><span class="pre">dmaHls_rowsToCols</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code> are concurrently scheduled.</p></li>
<li><p>The data width is 128 bits at both the AXI4-stream I/O sides, running at 250 MHz.</p></li>
</ul>
</details></div>
</div>
</div>
<div class="section" id="software-design-details">
<h1>Software Design Details<a class="headerlink" href="#software-design-details" title="Permalink to this headline">¶</a></h1>
<p>The software design in the AI Engine 2D-FFT tutorial consists of the following sections:</p>
<details>
<summary>Methodology</summary><div class="section" id="methodology">
<h2>Methodology<a class="headerlink" href="#methodology" title="Permalink to this headline">¶</a></h2>
<p>The following figure elaborates on the AI Engine implementation methodology.</p>
<p><img alt="Image of 2D-FFT AIE Implementation Methodology" src="../../../../../_images/fft_2d_aie_block_diagram_methodology.PNG" /></p>
<div class="section" id="ai-engine">
<h3>AI Engine<a class="headerlink" href="#ai-engine" title="Permalink to this headline">¶</a></h3>
<div class="section" id="independent-cores">
<h4>Independent Cores<a class="headerlink" href="#independent-cores" title="Permalink to this headline">¶</a></h4>
<p>Both AI Engine graphs for <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> and <code class="docutils literal notranslate"><span class="pre">FFTcols_graph</span></code> are to be configured to be independent, with runtime ratios set to &gt;= 0.6 so that each can be run independently of the other.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">FFTrow_gr</span><span class="o">.</span><span class="n">getKernels</span><span class="p">())</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
<span class="o">...</span>
<span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">FFTcol_gr</span><span class="o">.</span><span class="n">getKernels</span><span class="p">())</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="window-streaming-buffer-config">
<h4>Window Streaming Buffer Config<a class="headerlink" href="#window-streaming-buffer-config" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> graph performs <code class="docutils literal notranslate"><span class="pre">MAT_COLS</span></code> point FFT and runs for <code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span></code> number of iterations. For the <code class="docutils literal notranslate"><span class="pre">FFTcols_graph</span></code> graph, increase the <code class="docutils literal notranslate"><span class="pre">TP_WINDOW_VSIZE</span></code> to <code class="docutils literal notranslate"><span class="pre">MAT_COLS</span></code> instead of <code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span></code> and it does <code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span></code> point FFT, but runs for <code class="docutils literal notranslate"><span class="pre">MAT_ROWS</span></code> number of iterations instead of <code class="docutils literal notranslate"><span class="pre">MAT_COLS</span></code>. This reduces the ping-pong overhead which improves the overall throughput.</p>
<p>Large windows may result in mapper errors due to excessive memory usage. The increased <code class="docutils literal notranslate"><span class="pre">TP_WINDOW_VSIZE</span></code> reduces ping-pong overhead, but increases the utilization of AIE cores and thereby the power consumption. In this design due to rows to cols ratio being 1:2 the <code class="docutils literal notranslate"><span class="pre">TP_WINDOW_VSIZE</span></code> of both graphs are also in the same ratio. Which gives an additional increase in throughput with minimal increase in utilization.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="o">//</span> <span class="n">TP_WINDOW_VSIZE</span> <span class="k">for</span> <span class="n">FFTrows_graph</span><span class="o">...</span>
<span class="c1">#define FFT_ROW_TP_WINDOW_VSIZE MAT_COLS</span>

<span class="o">//</span> <span class="n">TP_WINDOW_VSIZE</span> <span class="k">for</span> <span class="n">FFTcols_graph</span>
<span class="o">//</span> <span class="n">Increasing</span> <span class="n">the</span> <span class="s2">&quot;TP__WINDOW _VSIZE&quot;</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">ping</span><span class="o">-</span><span class="n">pong</span> <span class="n">overhead</span> <span class="ow">is</span> <span class="n">less</span>
<span class="o">//</span> <span class="n">Assigning</span> <span class="n">it</span> <span class="k">as</span> <span class="n">MAT_COLS</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">MAT_ROWS</span><span class="o">...</span>
<span class="c1">#define FFT_COL_TP_WINDOW_VSIZE MAT_COLS</span>
<span class="o">...</span>
<span class="o">//</span> <span class="n">FFTrows_graph</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">WINDOW</span> <span class="n">BUFF</span> <span class="n">SIZE</span> <span class="n">IN</span> <span class="n">BYTES</span><span class="o">...</span>
<span class="c1">#define FFT_ROW_WINDOW_BUFF_SIZE (FFT_ROW_TP_WINDOW_VSIZE * 4)</span>
<span class="o">//</span> <span class="n">FFTcols_graph</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">WINDOW</span> <span class="n">BUFF</span> <span class="n">SIZE</span> <span class="n">IN</span> <span class="n">BYTES</span><span class="o">...</span>
<span class="c1">#define FFT_COL_WINDOW_BUFF_SIZE (FFT_COL_TP_WINDOW_VSIZE * 4)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-mover">
<h3>Data Mover<a class="headerlink" href="#data-mover" title="Permalink to this headline">¶</a></h3>
<div class="section" id="data-generation-checking-and-sequencing">
<h4>Data Generation/Checking and Sequencing<a class="headerlink" href="#data-generation-checking-and-sequencing" title="Permalink to this headline">¶</a></h4>
<p>The data mover comprises four loops: <code class="docutils literal notranslate"><span class="pre">mm2s0</span></code>, <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code>, <code class="docutils literal notranslate"><span class="pre">mm2s1</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code>. The <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code> and <code class="docutils literal notranslate"><span class="pre">mm2s1</span></code> functions are wrapped into a single function, <code class="docutils literal notranslate"><span class="pre">dmaHls_rowsToCols</span></code>. Within that the execution sequence, <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code> is followed by <code class="docutils literal notranslate"><span class="pre">mm2s1</span></code>. The <code class="docutils literal notranslate"><span class="pre">s2mm0</span></code> and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code> functions check the output of the row-wise and col-wise FFT respectively against the expected golden output.</p>
</div>
<div class="section" id="concurrent-scheduling">
<h4>Concurrent Scheduling<a class="headerlink" href="#concurrent-scheduling" title="Permalink to this headline">¶</a></h4>
<p>Concurrent scheduling is required so that each function runs independently and the execution of one function is not blocking the other. The concurrent scheduling of the three functions <code class="docutils literal notranslate"><span class="pre">mm2s0</span></code>, <code class="docutils literal notranslate"><span class="pre">dmaHls_rowsToCols</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code> is achieved using <code class="docutils literal notranslate"><span class="pre">#pragma</span> <span class="pre">HLS</span> <span class="pre">DATAFLOW</span></code> as shown in the following example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma HLS DATAFLOW</span>
<span class="o">...</span>
<span class="n">LOOP_ITER_MM2S0</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
   <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
   
   <span class="n">mm2s0</span><span class="p">(</span><span class="n">strmOut_to_rowiseFFT</span><span class="p">,</span> <span class="n">matSz</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">LOOP_ITER_S2MM0_TO_MM2S1</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
   <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
   
   <span class="n">dmaHls_rowsToCols</span><span class="p">(</span><span class="n">strmInp_from_rowiseFFT</span><span class="p">,</span> <span class="n">strmOut_to_colwiseFFT</span><span class="p">,</span> \
                     <span class="n">matSz</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">stg0_errCnt</span><span class="p">,</span> <span class="n">goldenVal</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">LOOP_ITER_S2MM1</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
   <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
   
   <span class="n">s2mm1</span><span class="p">(</span><span class="n">strmInp_from_colwiseFFT</span><span class="p">,</span> <span class="n">matSz</span><span class="p">,</span> <span class="n">stg1_errCnt</span><span class="p">,</span> <span class="n">goldenVal</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="vitis-hls-scheduling-and-dataflow-view">
<h4>Vitis HLS Scheduling and Dataflow View<a class="headerlink" href="#vitis-hls-scheduling-and-dataflow-view" title="Permalink to this headline">¶</a></h4>
<p>The following figure shows the data mover scheduler view.</p>
<p><img alt="Image of Datamover Scheduler View" src="../../../../../_images/dma_hls_scheduler_view.PNG" /></p>
<p>The following figure shows the data mover dataflow view.</p>
<p><img alt="Image of Datamover Dataflow View" src="../../../../../_images/dma_hls_dataflow_view.PNG" /></p>
</div>
</div>
<div class="section" id="streaming-interface-data-width">
<h3>Streaming Interface Data Width<a class="headerlink" href="#streaming-interface-data-width" title="Permalink to this headline">¶</a></h3>
<p>The streaming interface data width is kept at 128 bits to reduce read/write overhead while processing data.</p>
</div>
<div class="section" id="frequency-selection">
<h3>Frequency Selection<a class="headerlink" href="#frequency-selection" title="Permalink to this headline">¶</a></h3>
<p>AI Engine kernels are configured for <code class="docutils literal notranslate"><span class="pre">cint16</span> <span class="pre">/</span> <span class="pre">4bytes</span></code> and the streaming interface is at <code class="docutils literal notranslate"><span class="pre">128bit</span> <span class="pre">/</span> <span class="pre">16bytes</span></code>. The frequency of the AI Engine array is 1000 MHz and the data mover is kept at 250 MHz, maintaining a 1:4 ratio.</p>
</details><details>
<summary>AI Engine Kernels and Graph Representation</summary></div>
</div>
<div class="section" id="ai-engine-kernels-and-graph-representation">
<h2>AI Engine Kernels and Graph Representation<a class="headerlink" href="#ai-engine-kernels-and-graph-representation" title="Permalink to this headline">¶</a></h2>
<p>An AI Engine kernel is a C/C++ program written using specialized intrinsic calls that target the VLIW vector processor. The AI Engine compiler compiles the kernel code to produce an executable ELF file for each of the AI Engines being used in the design. Review the <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/yii1603912637443.html">AI Engine Kernel Programming</a> section in the AI Engine documentation for a high-level overview of kernel programming. These kernels can be stitched together to function as AI Engine graphs written in C++. In this design, the AI Engine compiler writes a summary of compilation results. You can view the graph by running the following command:</p>
<p><code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span> <span class="pre">$(BUILD_TARGET_DIR)/Work/graph.aiecompile_summary</span></code></p>
<p>The following figures show the graph representation of the AI Engine kernels (default FFT 2048 point and FFT 1024 point, <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS=1</span></code>). In addition to the compute units, there are also the twiddle factor LUTs (<code class="docutils literal notranslate"><span class="pre">fft_lut_tw*</span></code>) and temporary buffers for FFT stages (<code class="docutils literal notranslate"><span class="pre">fft_2048/1024_tmp*</span></code>).</p>
<p><img alt="Image of 2D-FFT AI Engine 2K point Graph" src="../../../../../_images/fft_2d_aie_fft_rows_graph_for_2kpt_1x.PNG" />
<img alt="Image of 2D-FFT AI Engine 1K point Graph" src="../../../../../_images/fft_2d_aie_fft_cols_graph_for_1kpt_1x.PNG" /></p>
</details><details>
<summary>Adaptive Data Flow (ADF) Graph</summary></div>
<div class="section" id="adaptive-data-flow-adf-graph">
<h2>Adaptive Data Flow (ADF) Graph<a class="headerlink" href="#adaptive-data-flow-adf-graph" title="Permalink to this headline">¶</a></h2>
<p>This section describes the overall data flow graph specification of the 2D-FFT design using AI Engine which is compiled by the AI Engine compiler. Refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/yii1603912637443.html">this page</a> in the AI Engine documentation for information on ADF graphs.</p>
<p>The overall graph definition of the design is contained in the <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> file. The top-level graph contains two sub-graphs, <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> and <code class="docutils literal notranslate"><span class="pre">FFTcols_graph</span></code>, each with a <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS</span></code> number of objects. The following describes the definition of the sub-graphs (the <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> is used as illustration).</p>
<div class="section" id="defining-the-graph-class">
<h3>Defining the Graph Class<a class="headerlink" href="#defining-the-graph-class" title="Permalink to this headline">¶</a></h3>
<p>Define the graph classes by using the objects defined in the appropriate name space. It must include the ADF library and <a class="reference external" href="https://xilinx.github.io/Vitis_Libraries/dsp/2021.1/user_guide/L2/2-dsp-lib-func.html#fft-ifft">Vitis DSP Library</a> for FFIT. A general specification is put in for the ADF namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma once</span>

<span class="o">//</span> <span class="n">Input</span> <span class="n">data</span> <span class="nb">type</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TT_DATA cint16</span>
<span class="o">//</span> <span class="n">Twiddle</span> <span class="n">Factor</span> <span class="n">data</span> <span class="nb">type</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TT_TWIDDLE cint16</span>

<span class="o">//</span> <span class="n">FFTrows_graph</span> <span class="n">FFT</span> <span class="n">point</span> <span class="n">size</span><span class="o">...</span>
<span class="c1">#define FFT_ROW_TP_POINT_SIZE MAT_COLS</span>
<span class="o">//</span> <span class="n">FFTcols_graph</span> <span class="n">FFT</span> <span class="n">point</span> <span class="n">size</span><span class="o">...</span>
<span class="c1">#define FFT_COL_TP_POINT_SIZE MAT_ROWS</span>

<span class="o">//</span> <span class="mi">1</span> <span class="p">(</span><span class="n">FFT</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span> <span class="p">(</span><span class="n">IFFT</span><span class="p">)</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TP_FFT_NIFFT 1</span>
<span class="o">//</span> <span class="mi">0</span> <span class="n">Bit</span> <span class="n">Shift</span> <span class="n">before</span> <span class="n">output</span><span class="p">,</span> <span class="n">will</span> <span class="n">have</span> <span class="n">to</span> <span class="n">change</span> <span class="n">based</span> <span class="n">on</span> <span class="nb">input</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TP_SHIFT 0    </span>
<span class="o">//</span> <span class="n">FFT</span> <span class="n">divided</span> <span class="n">over</span> <span class="mi">1</span> <span class="n">FFT</span> <span class="n">Kernel</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TP_CASC_LEN 1    </span>
<span class="o">//</span> <span class="n">Dynamic</span> <span class="n">FFT</span> <span class="n">Point</span> <span class="n">Size</span> <span class="ow">is</span> <span class="n">disabled</span><span class="o">...</span>
<span class="c1">#define FFT_2D_TP_DYN_PT_SIZE 0 </span>

<span class="o">//</span> <span class="n">TP_WINDOW_VSIZE</span> <span class="k">for</span> <span class="n">FFTrows_graph</span><span class="o">...</span>
<span class="c1">#define FFT_ROW_TP_WINDOW_VSIZE MAT_COLS</span>

<span class="o">//</span> <span class="n">TP_WINDOW_VSIZE</span> <span class="k">for</span> <span class="n">FFTcols_graph</span>
<span class="o">//</span> <span class="n">Increasing</span> <span class="n">the</span> <span class="s2">&quot;TP__WINDOW _VSIZE&quot;</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">ping</span><span class="o">-</span><span class="n">pong</span> <span class="n">overhead</span> <span class="ow">is</span> <span class="n">less</span>
<span class="o">//</span> <span class="n">Assigning</span> <span class="n">it</span> <span class="k">as</span> <span class="n">MAT_COLS</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">MAT_ROWS</span><span class="o">...</span>
<span class="c1">#define FFT_COL_TP_WINDOW_VSIZE MAT_COLS</span>

<span class="o">//</span> <span class="n">FFTrows_graph</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">WINDOW</span> <span class="n">BUFF</span> <span class="n">SIZE</span> <span class="n">IN</span> <span class="n">BYTES</span><span class="o">...</span>
<span class="c1">#define FFT_ROW_WINDOW_BUFF_SIZE (FFT_ROW_TP_WINDOW_VSIZE * 4)</span>
<span class="o">//</span> <span class="n">FFTcols_graph</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">WINDOW</span> <span class="n">BUFF</span> <span class="n">SIZE</span> <span class="n">IN</span> <span class="n">BYTES</span><span class="o">...</span>
<span class="c1">#define FFT_COL_WINDOW_BUFF_SIZE (FFT_COL_TP_WINDOW_VSIZE * 4)</span>

<span class="c1">#include &quot;adf.h&quot;</span>
<span class="c1">#include &quot;fft_ifft_dit_1ch_graph.hpp&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>
<span class="n">namespace</span> <span class="n">dsplib</span> <span class="o">=</span> <span class="n">xf</span><span class="p">::</span><span class="n">dsp</span><span class="p">::</span><span class="n">aie</span><span class="p">;</span>
</pre></div>
</div>
<p>All user graphs are defined from the class graph: for example, in the <code class="docutils literal notranslate"><span class="pre">FFTrows_graph</span></code> design:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FFTrows_graph</span><span class="p">:</span> <span class="n">public</span> <span class="n">graph</span>
<span class="p">{</span>
   <span class="n">public</span><span class="p">:</span>
   	<span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span>   <span class="ow">in</span><span class="p">;</span>
   	<span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">out</span><span class="p">;</span>
      
   	<span class="o">//</span> <span class="n">Constructor</span> <span class="o">-</span> <span class="k">with</span> <span class="n">Rowise</span> <span class="n">FFT</span> <span class="n">graph</span> <span class="k">class</span> <span class="nc">initialization</span><span class="o">...</span>
   	<span class="n">FFTrows_graph</span><span class="p">()</span>
      <span class="p">{</span>
         <span class="n">dsplib</span><span class="p">::</span><span class="n">fft</span><span class="p">::</span><span class="n">dit_1ch</span><span class="p">::</span><span class="n">fft_ifft_dit_1ch_graph</span><span class="o">&lt;</span><span class="n">FFT_2D_TT_DATA</span><span class="p">,</span> <span class="n">FFT_2D_TT_TWIDDLE</span><span class="p">,</span> <span class="n">FFT_ROW_TP_POINT_SIZE</span><span class="p">,</span>
         <span class="n">FFT_2D_TP_FFT_NIFFT</span><span class="p">,</span> <span class="n">FFT_2D_TP_SHIFT</span><span class="p">,</span> <span class="n">FFT_2D_TP_CASC_LEN</span><span class="p">,</span> <span class="n">FFT_2D_TP_DYN_PT_SIZE</span><span class="p">,</span> <span class="n">FFT_ROW_TP_WINDOW_VSIZE</span><span class="o">&gt;</span> <span class="n">FFTrow_gr</span><span class="p">;</span>
         
         <span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">FFTrow_gr</span><span class="o">.</span><span class="n">getKernels</span><span class="p">())</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">;</span>
         
         <span class="n">connect</span><span class="o">&lt;</span> <span class="n">window</span><span class="o">&lt;</span><span class="n">FFT_ROW_WINDOW_BUFF_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">(</span><span class="ow">in</span><span class="p">,</span>   <span class="n">FFTrow_gr</span><span class="o">.</span><span class="ow">in</span><span class="p">);</span>
         <span class="n">connect</span><span class="o">&lt;</span> <span class="n">window</span><span class="o">&lt;</span><span class="n">FFT_ROW_WINDOW_BUFF_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">FFTrow_gr</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">out</span><span class="p">);</span>
   	<span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="top-level-application">
<h3>Top-Level Application<a class="headerlink" href="#top-level-application" title="Permalink to this headline">¶</a></h3>
<p>Define a top-level application file (<code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> in this design) that contains an instance of the graph class and connect the graph to a simulation platform to provide file input and output (in the case of <code class="docutils literal notranslate"><span class="pre">FFT2D_INSTS</span> <span class="pre">=</span> <span class="pre">1</span></code> to the two sub-graphs):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;graph.h&quot;</span>

<span class="o">//</span> <span class="n">Subgraph</span> <span class="n">objects</span><span class="o">...</span>
<span class="n">FFTrows_graph</span> <span class="n">fft_rows</span><span class="p">[</span><span class="n">FFT2D_INSTS</span><span class="p">];</span>
<span class="n">FFTcols_graph</span> <span class="n">fft_cols</span><span class="p">[</span><span class="n">FFT2D_INSTS</span><span class="p">];</span>

<span class="o">//</span> <span class="n">Instantiating</span> <span class="n">PLIOs</span><span class="o">...</span>
<span class="n">PLIO</span> <span class="o">*</span><span class="n">attr_i0</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn0&quot;</span><span class="p">,</span>  <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s2">&quot;../../../../design/aie_src/aiesim_data/input0.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span> <span class="o">*</span><span class="n">attr_i1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn1&quot;</span><span class="p">,</span>  <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s2">&quot;../../../../design/aie_src/aiesim_data/input1.txt&quot;</span><span class="p">);</span>

<span class="n">PLIO</span> <span class="o">*</span><span class="n">attr_o0</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut0&quot;</span><span class="p">,</span> <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s2">&quot;data/output0.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span> <span class="o">*</span><span class="n">attr_o1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">plio_128_bits</span><span class="p">,</span> <span class="s2">&quot;data/output1.txt&quot;</span><span class="p">);</span>

<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">plat</span><span class="p">(</span> <span class="n">attr_i0</span><span class="p">,</span>
                                 <span class="n">attr_i1</span><span class="p">,</span>
                                 
                                 <span class="n">attr_o0</span><span class="p">,</span>
                                 <span class="n">attr_o1</span>
                               <span class="p">);</span>

<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">neti0</span><span class="p">(</span><span class="n">plat</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fft_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="ow">in</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">neti1</span><span class="p">(</span><span class="n">plat</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fft_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="ow">in</span><span class="p">);</span>

<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">neto0</span><span class="p">(</span><span class="n">fft_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">plat</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">neto1</span><span class="p">(</span><span class="n">fft_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="n">plat</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">main</span></code> function is called under the guard bounds of <code class="docutils literal notranslate"><span class="pre">\_\_AIESIM\_\_</span></code> as shown below, to avoid conflict with the <code class="docutils literal notranslate"><span class="pre">main</span></code> function in the host application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifdef __AIESIM__</span>

   <span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">FFT2D_INSTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="o">//</span> <span class="n">Intialise</span> <span class="n">the</span> <span class="n">graphs</span><span class="o">...</span>

         <span class="n">fft_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
         <span class="n">fft_cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">FFT2D_INSTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="o">//</span> <span class="n">Run</span> <span class="n">the</span> <span class="n">graphs</span><span class="o">...</span>

         <span class="n">fft_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">MAT_ROWS</span><span class="p">);</span>
         <span class="n">fft_cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">MAT_ROWS</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">FFT2D_INSTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="o">//</span> <span class="n">End</span> <span class="n">the</span> <span class="n">graphs</span> <span class="n">once</span> <span class="n">done</span><span class="o">...</span>

         <span class="n">fft_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
         <span class="n">fft_cols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">}</span>

<span class="c1">#endif</span>
</pre></div>
</div>
</details><details>
<summary>PL Data Mover Kernel</summary></div>
</div>
<div class="section" id="pl-data-mover-kernel">
<h2>PL Data Mover Kernel<a class="headerlink" href="#pl-data-mover-kernel" title="Permalink to this headline">¶</a></h2>
<p>In addition to the kernels operating in the AI Engine array, this design specifies a data mover kernel to run in the PL region of the device (written in HLS C++). The data mover kernel is brought into the design during the Vitis kernel compilation, which is further replicated based on the <code class="docutils literal notranslate"><span class="pre">FFT_2D_INSTS</span></code> value. The software design of the data mover kernel is described in the following sections.</p>
<div class="section" id="dma-hls-dma-hls-cpp">
<h3>dma_hls (dma_hls.cpp)<a class="headerlink" href="#dma-hls-dma-hls-cpp" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel reads data from a memory mapped AXI4 (MM-AXI4) interface and writes it to an AXI4-Stream interface.</p>
<div class="section" id="top-function-declaration">
<h4>Top Function Declaration<a class="headerlink" href="#top-function-declaration" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel takes the following arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">dma_hls</span><span class="p">(</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmOut_to_rowiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmInp_from_rowiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmOut_to_colwiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmInp_from_colwiseFFT</span><span class="p">,</span>
      <span class="nb">int</span> <span class="n">matSz</span><span class="p">,</span> <span class="nb">int</span> <span class="n">rows</span><span class="p">,</span> <span class="nb">int</span> <span class="n">cols</span><span class="p">,</span> <span class="nb">int</span> <span class="n">iterCnt</span>
     <span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ap_int&lt;N&gt;</span></code> is an arbitrary precision integer data type defined in <code class="docutils literal notranslate"><span class="pre">ap_int.h</span></code> where <code class="docutils literal notranslate"><span class="pre">N</span></code> is a bit size from 1-1024. In this design, the bit size is set to 128.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hls::stream&lt;qdma_axis&lt;D,0,0,0&gt;&gt;</span></code> is a data type defined in <code class="docutils literal notranslate"><span class="pre">ap_axi_sdata.h</span></code>. It is a special data class used for data transfer when using a streaming platform. The parameter <code class="docutils literal notranslate"><span class="pre">&lt;D&gt;</span></code> is the data width of the streaming interface, which is set to 128. The remaining three parameters should be set to 0.</p></li>
</ul>
</div>
<div class="section" id="top-function-definition">
<h4>Top Function Definition<a class="headerlink" href="#top-function-definition" title="Permalink to this headline">¶</a></h4>
<p>Use the <code class="docutils literal notranslate"><span class="pre">dataflow</span></code> pragma for concurrently scheduling the three functions <code class="docutils literal notranslate"><span class="pre">mm2s0</span></code>, <code class="docutils literal notranslate"><span class="pre">dmaHls_rowsToCols</span></code>, and <code class="docutils literal notranslate"><span class="pre">s2mm1</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">dma_hls</span><span class="p">(</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmOut_to_rowiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmInp_from_rowiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmOut_to_colwiseFFT</span><span class="p">,</span>
      <span class="n">hls</span><span class="p">::</span><span class="n">stream</span><span class="o">&lt;</span><span class="n">qdma_axis</span><span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">strmInp_from_colwiseFFT</span><span class="p">,</span>
      <span class="nb">int</span> <span class="n">matSz</span><span class="p">,</span> <span class="nb">int</span> <span class="n">rows</span><span class="p">,</span> <span class="nb">int</span> <span class="n">cols</span><span class="p">,</span> <span class="nb">int</span> <span class="n">iterCnt</span>
     <span class="p">)</span>
<span class="p">{</span>
   <span class="c1">#pragma HLS INTERFACE axis port=strmOut_to_rowiseFFT</span>
   <span class="c1">#pragma HLS INTERFACE axis port=strmInp_from_rowiseFFT</span>
   <span class="c1">#pragma HLS INTERFACE axis port=strmOut_to_colwiseFFT</span>
   <span class="c1">#pragma HLS INTERFACE axis port=strmInp_from_colwiseFFT</span>
   
   <span class="c1">#pragma HLS INTERFACE s_axilite port=matSz bundle=control</span>
   <span class="c1">#pragma HLS INTERFACE s_axilite port=rows bundle=control</span>
   <span class="c1">#pragma HLS INTERFACE s_axilite port=cols bundle=control</span>
   <span class="c1">#pragma HLS INTERFACE s_axilite port=iterCnt bundle=control</span>
   <span class="c1">#pragma HLS INTERFACE s_axilite port=return bundle=control  </span>
   
   <span class="c1">#pragma HLS DATAFLOW</span>
   
   <span class="nb">int</span> <span class="n">stg0_errCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stg1_errCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   
   <span class="n">ap_uint</span><span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">goldenVal</span><span class="p">;</span>

   <span class="n">goldenVal</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000000100000001</span><span class="p">;</span>
   <span class="n">goldenVal</span><span class="o">.</span><span class="n">range</span><span class="p">(</span> <span class="mi">63</span><span class="p">,</span>  <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x0000000100000001</span><span class="p">;</span>
   

   <span class="n">LOOP_ITER_MM2S0</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
      
      <span class="n">mm2s0</span><span class="p">(</span><span class="n">strmOut_to_rowiseFFT</span><span class="p">,</span> <span class="n">matSz</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="n">LOOP_ITER_S2MM0_TO_MM2S1</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
      
      <span class="n">dmaHls_rowsToCols</span><span class="p">(</span><span class="n">strmInp_from_rowiseFFT</span><span class="p">,</span> <span class="n">strmOut_to_colwiseFFT</span><span class="p">,</span> \
                        <span class="n">matSz</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">stg0_errCnt</span><span class="p">,</span> <span class="n">goldenVal</span><span class="p">);</span>
   <span class="p">}</span>
   
   <span class="n">LOOP_ITER_S2MM1</span><span class="p">:</span><span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">iterCnt</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="c1">#pragma HLS loop_tripcount min=1 max=8</span>
      
      <span class="n">s2mm1</span><span class="p">(</span><span class="n">strmInp_from_colwiseFFT</span><span class="p">,</span> <span class="n">matSz</span><span class="p">,</span> <span class="n">stg1_errCnt</span><span class="p">,</span> <span class="n">goldenVal</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="p">(</span><span class="n">stg0_errCnt</span> <span class="o">+</span> <span class="n">stg1_errCnt</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel also specifies HLS pragmas to help optimize the kernel code and adhere to interface protocols. See <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/hls_pragmas.html?hl=hls%2Cpragmas">this page</a> for detailed documentation of all HLS pragmas. A summary of the HLS pragmas used in the kernel is provided in the following table.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Switch</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>#pragma HLS INTERFACE</td>
<td>In C/C++ code, all input and output operations are performed, in zero time, through formal function arguments. In a RTL design, these same input and output operations must be performed through a port in the design interface and typically operate using a specific input/output (I/O) protocol. For more information, see <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/hls_pragmas.html#jit1504034365862">this page</a>.</td>
</tr>
<tr>
<td>#pragma HLS PIPELINE II=1</td>
<td>Reduces the initiation interval (II) for a function or loop by allowing the concurrent execution of operations. The default type of pipeline is defined by the config_compile -pipeline_style command, but can be overridden in the PIPELINE pragma or directive. For more information, see <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/hls_pragmas.html#fde1504034360078">this page</a>.</td>
</tr>
<tr>
<td>#pragma HLS dataflow</td>
<td>The DATAFLOW pragma enables task-level pipelining, allowing functions and loops to overlap in their operation, increasing the concurrency of the RTL implementation and increasing the overall throughput of the design. See <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/hls_pragmas.html#sxx1504034358866">this page</a> for more information.</td>
</tr>
<tr>
<td>#pragma HLS loop_tripcount</td>
<td>When manually applied to a loop, specifies the total number of iterations performed by a loop. The <code>LOOP_TRIPCOUNT</code> pragma or directive is for analysis only, and does not impact the results of synthesis. See <a href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/hls_pragmas.html#sty1504034367099">this page</a> for more information.</td>
</tr>
</tbody>
</table>
</details><details>
<summary>PS Host Application</summary></div>
</div>
</div>
<div class="section" id="ps-host-application">
<h2>PS Host Application<a class="headerlink" href="#ps-host-application" title="Permalink to this headline">¶</a></h2>
<p>The 2D-FFT AI Engine tutorial uses the embedded processing system (PS) as an external controller to control the AI Engine graph and data mover PL kernels. Review the <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/yii1603912637443.html">Programming the PS Host Application</a> section in the AI Engine documentation to understand the process to create a host application.</p>
<p>In addition to the PS host application (<code class="docutils literal notranslate"><span class="pre">fft_2d_aie_app.cpp</span></code>), the AI Engine control code must also be compiled. This control code (<code class="docutils literal notranslate"><span class="pre">aie_control_xrt.cpp</span></code>) is generated by the AI Engine compiler when compiling the AI Engine design graph and kernel code. The AI Engine control code is used by the PS host application for the following purposes:</p>
<ul class="simple">
<li><p>Controlling the initial loading of the AI Engine kernels.</p></li>
<li><p>Running the graph for several iterations, updating the runtime parameters associated with the graph, exiting, and resetting the AI Engine tiles.</p></li>
</ul>
<p>The steps to run the A72 application are as follows:</p>
<ol>
<li><p>Include <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> and other required headers. Define the required macros. The <code class="docutils literal notranslate"><span class="pre">graph.cpp</span></code> AI Engine application file contains the instantiation of the AI Engine 2D-FFT data flow graph object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;graph.cpp&quot;</span>

<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;stdint.h&gt;</span>
<span class="c1">#include &lt;fstream&gt;</span>
<span class="c1">#include &lt;iostream&gt;</span>
<span class="c1">#include &lt;string&gt;</span>

<span class="c1">#include &quot;adf/adf_api/XRTConfig.h&quot;</span>

<span class="c1">#include &quot;experimental/xrt_aie.h&quot;</span>
<span class="c1">#include &quot;experimental/xrt_kernel.h&quot;</span>
<span class="c1">#include &quot;experimental/xrt_bo.h&quot;</span>

<span class="c1">#define MAT_SIZE (MAT_ROWS * MAT_COLS)</span>

<span class="o">/////////////////////////////////////////////////</span>
<span class="o">//</span> <span class="n">Due</span> <span class="n">to</span> <span class="mi">128</span><span class="n">bit</span> <span class="n">Data</span> <span class="n">Transfer</span> <span class="nb">all</span> <span class="n">dimensions</span><span class="p">,</span>
<span class="o">//</span> <span class="n">to</span> <span class="n">be</span> <span class="n">given</span> <span class="k">as</span> <span class="n">by</span> <span class="mf">4.</span><span class="o">.</span> 
<span class="o">/////////////////////////////////////////////////</span>
<span class="c1">#define MAT_SIZE_128b (MAT_SIZE / 4)</span>
<span class="c1">#define MAT_ROWS_128b (MAT_ROWS / 4)</span>
<span class="c1">#define MAT_COLS_128b (MAT_COLS / 4)</span>
</pre></div>
</div>
</li>
<li><p>Check the command line argument. The beginning of the A72 application is represented by the <code class="docutils literal notranslate"><span class="pre">main</span></code> function. It takes in one command line argument: an XCLBIN file.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</pre></div>
</div>
<ol>
<li><p>Open the XCLBIN and create data mover kernel handles. The A72 application loads the XCLBIN binary file and creates the data mover kernels to be executed on the device. The steps are:</p>
<ul class="simple">
<li><p>Open the device and load the XCLBIN:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">dhdl</span> <span class="o">=</span> <span class="n">xrtDeviceOpen</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">auto</span> <span class="n">xclbin</span> <span class="o">=</span> <span class="n">load_xclbin</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">xclbinFilename</span><span class="p">);</span>
<span class="n">auto</span> <span class="n">top</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">const</span> <span class="n">axlf</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">xclbin</span><span class="o">.</span><span class="n">data</span><span class="p">());</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open the data mover kernel and obtain handles to start the HLS PL kernels (see the following example for the <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> PL kernel):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrtKernelHandle</span> <span class="n">dma_hls_khdl</span><span class="p">;</span>
<span class="n">xrtRunHandle</span> <span class="n">dma_hls_rhdl</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Open</span> <span class="n">kernel</span> <span class="n">handle</span> <span class="n">exclusively</span> <span class="n">to</span> <span class="n">read</span> <span class="n">the</span> <span class="n">ap_return</span> <span class="n">register</span> <span class="n">later</span> <span class="k">for</span> <span class="n">reporting</span> <span class="n">error</span><span class="o">...</span>
<span class="n">dma_hls_khdl</span> <span class="o">=</span> <span class="n">xrtPLKernelOpenExclusive</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">m_header</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">dma_hls_obj</span><span class="p">);</span>
<span class="n">dma_hls_rhdl</span> <span class="o">=</span> <span class="n">xrtRunOpen</span><span class="p">(</span><span class="n">dma_hls_khdl</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Open the graph, obtain the handle, and execute the graph:</p>
<ul class="simple">
<li><p>The A72 processor opens and obtains its handle using the <code class="docutils literal notranslate"> <span class="pre">xrtGraphOpen</span></code> function.</p></li>
<li><p>The A72 processor resets the graph using the <code class="docutils literal notranslate"><span class="pre">xrtGraphReset</span></code> function and runs the graph execution using the <code class="docutils literal notranslate"><span class="pre">xrtGraphRun</span></code> function for both the 2K point and 1K point sub-graphs.</p></li>
</ul>
</li>
<li><p>Execute the data mover kernels and generate the output results:</p>
<ul class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernel arguments using the <code class="docutils literal notranslate"><span class="pre">xrtRunSetArg</span></code> function.</p></li>
<li><p>Start the <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> kernels using the <code class="docutils literal notranslate"><span class="pre">xrtRunStart</span></code> function.</p></li>
<li><p>Wait for <code class="docutils literal notranslate"><span class="pre">dma_hls</span></code> execution to finish using the <code class="docutils literal notranslate"><span class="pre">xrtRunWait</span></code> runction.</p></li>
</ul>
</li>
<li><p>Verify the output results by reading the <code class="docutils literal notranslate"><span class="pre">ap_return</span></code> in <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/_x/dma_hls.$(TARGET)/dma_hls/dma_hls/ip/drivers/dma_hls_v1_0/src/xdma_hls_hw.h</span></code> using the <code class="docutils literal notranslate"><span class="pre">xrtKernelRegister</span></code> API, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void golden_check(uint32_t *errCnt)
{
   //////////////////////////////////////////
   // Compare results
   //////////////////////////////////////////

   // Reading the error count for the ap_return reg of the hls kernel...
   xrtKernelReadRegister(dma_hls_khdl, 0x10, &amp;instance_errCnt);
   std::cout &lt;&lt; &quot;fft_2d_&quot; &lt;&lt; instsNo &lt;&lt; &quot; &quot; &lt;&lt; (instance_errCnt ? &quot;Failed!...&quot; : &quot;Passed!...&quot;) &lt;&lt; &quot;\n&quot; &lt;&lt; std::endl;

   // Adding instance error to the total error count...
   *errCnt += instance_errCnt;
}
</pre></div>
</div>
</li>
<li><p>Release allocated resources. After post-processing the data, release the allocated objects and handles using the <code class="docutils literal notranslate"><span class="pre">xrtRunClose</span></code>, <code class="docutils literal notranslate"><span class="pre">xrtKernelClose</span></code>, <code class="docutils literal notranslate"><span class="pre">xrtGraphClose</span></code>, and <code class="docutils literal notranslate"><span class="pre">xrtDeviceClose</span></code> functions.</p></li>
</ol>
</details></div>
</div>
<div class="section" id="performance-details">
<h1>Performance Details<a class="headerlink" href="#performance-details" title="Permalink to this headline">¶</a></h1>
<p>For all applications, designers must work to predefined specifications and build a system for their specific deployment by meeting their system requirements with respect to their available resources, latency, throughput, performance, and power. In this section, it is outlined how to measure those characteristics for the AI Engine implementation in this tutorial.</p>
<details>
<summary>Resource Utilization and Power</summary> <div class="section" id="resource-utilization-and-power">
<h2>Resource Utilization and Power<a class="headerlink" href="#resource-utilization-and-power" title="Permalink to this headline">¶</a></h2>
<p>Resource utilization and power are measured using Vivado, vcdanalyze, and Xilinx Power Estimator (XPE) for Versal (2020.3 version) tools.</p>
<p>The registers and CLB LUT utilization information can be found in the Vivado project if you perform the following steps:</p>
<ol class="simple">
<li><p>Open the Vivado project: <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/_x/link/vivado/vpl/prj/prj.xpr</span></code>.</p></li>
<li><p>Go to <strong>Open Implemented Design</strong> then click <strong>Report Utilization</strong>. In the Utilization tab shown in the following figure, select <strong>ai_engine_0</strong> and view the <strong>Registers</strong> and <strong>CLB LUTs</strong> for the 1024 x 2048 point 1-instance design:</p></li>
</ol>
<p><img alt="Image of 2D-FFT AIE Utilization" src="../../../../../_images/fft_2d_aie_vivado_resources.PNG" /></p>
<p>The vcdanalyze tool is used to generate a <code class="docutils literal notranslate"><span class="pre">graph.xpe</span></code> file which can be input to XPE for viewing the AI Engine resource utilization and power. The steps are as follows:</p>
<ol class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">vcd</span></code> (recipe expanded below) to create the <code class="docutils literal notranslate"><span class="pre">graph.xpe</span></code> file under <code class="docutils literal notranslate"><span class="pre">$(BUILD_TARGET_DIR)/aiesim_xpe/</span></code>:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $(BUILD_TARGET_DIR); \
aiesimulator --pkg-dir $(WORK_DIR)/ --dump-vcd x$(FFT_2D_INSTS) 2&gt;&amp;1 | tee -a vcd.log
cd $(BUILD_TARGET_DIR); \
vcdanalyze --vcd x$(FFT_2D_INSTS).vcd --xpe
</pre></div>
</div>
<ol class="simple">
<li><p>If you do not already have it installed, download and install <a class="reference external" href="https://www.xilinx.com/products/technology/power/xpe.html">XPE for Versal Version 2020.3</a>. For full documentation of XPE, see <a class="reference external" href="https://www.xilinx.com/support/documentation/sw_manuals/xilinx2021_1/ug1275-xilinx-power-estimator-versal.pdf">this page</a>.</p></li>
<li><p>Follow the steps below to load the <code class="docutils literal notranslate"><span class="pre">graph.xpe</span></code> into XPE to see the AI Engine power comsumption and resource utilization (step 5 and 6 in the below images) for the 1024 x 2048 point 1-instance design:</p></li>
</ol>
<p><img alt="Image of 2D-FFT AIE XPE Intro" src="../../../../../_images/fft_2d_aie_xpe_intro_step1_2and3.PNG" />
<img alt="Image of 2D-FFT AIE XPE Util and Power Measurement" src="../../../../../_images/fft_2d_aie_xpe_Pow_nUtil_step4_5and6.PNG" /></p>
<p>A summary of resource utilization and power for all variations is given in the following table.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">No. of Instances</th>
<th align="center">FFT Configuration</th>
<th align="center">Number of Compute Cores</th>
<th align="center">Vector Load</th>
<th align="center">Number of Active Memory Banks</th>
<th align="center">Mem R/W Rate</th>
<th align="center">Active AI Engine Tiles</th>
<th align="center">Interconnect Load</th>
<th align="center">FF (Regs)</th>
<th align="center">CLB LUTS</th>
<th align="center">Dynamic Power<br/>(in mW)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">2</td>
<td align="center">8%</td>
<td align="center">28</td>
<td align="center">4%</td>
<td align="center">6</td>
<td align="center">5%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">695</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">2</td>
<td align="center">17%</td>
<td align="center">28</td>
<td align="center">7%</td>
<td align="center">6</td>
<td align="center">5%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">730</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">2</td>
<td align="center">32%</td>
<td align="center">28</td>
<td align="center">13%</td>
<td align="center">6</td>
<td align="center">5%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">786</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">2</td>
<td align="center">50%</td>
<td align="center">30</td>
<td align="center">18%</td>
<td align="center">6</td>
<td align="center">5%</td>
<td align="center">1172</td>
<td align="center">415</td>
<td align="center">855</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">2</td>
<td align="center">76%</td>
<td align="center">42</td>
<td align="center">19%</td>
<td align="center">6</td>
<td align="center">5%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">950</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">10</td>
<td align="center">9%</td>
<td align="center">132</td>
<td align="center">5%</td>
<td align="center">25</td>
<td align="center">6%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1456</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">10</td>
<td align="center">18%</td>
<td align="center">132</td>
<td align="center">8%</td>
<td align="center">27</td>
<td align="center">5%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1680</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">10</td>
<td align="center">32%</td>
<td align="center">132</td>
<td align="center">13%</td>
<td align="center">25</td>
<td align="center">6%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1893</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">10</td>
<td align="center">50%</td>
<td align="center">142</td>
<td align="center">19%</td>
<td align="center">27</td>
<td align="center">6%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">2271</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">10</td>
<td align="center">76%</td>
<td align="center">202</td>
<td align="center">19%</td>
<td align="center">28</td>
<td align="center">5%</td>
<td align="center">5860</td>
<td align="center">2091</td>
<td align="center">2781</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">20</td>
<td align="center">8%</td>
<td align="center">264</td>
<td align="center">4%</td>
<td align="center">48</td>
<td align="center">6%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">2369</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">20</td>
<td align="center">18%</td>
<td align="center">264</td>
<td align="center">8%</td>
<td align="center">52</td>
<td align="center">6%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">2820</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">20</td>
<td align="center">32%</td>
<td align="center">272</td>
<td align="center">13%</td>
<td align="center">50</td>
<td align="center">6%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">3302</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">20</td>
<td align="center">50%</td>
<td align="center">284</td>
<td align="center">19%</td>
<td align="center">52</td>
<td align="center">6%</td>
<td align="center">11720</td>
<td align="center">4150</td>
<td align="center">4021</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">20</td>
<td align="center">76%</td>
<td align="center">396</td>
<td align="center">20%</td>
<td align="center">56</td>
<td align="center">6%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">5081</td>
</tr>
</tbody>
</table></details><details>
<summary>Throughput and Latency</summary> </div>
<div class="section" id="throughput-and-latency">
<h2>Throughput and Latency<a class="headerlink" href="#throughput-and-latency" title="Permalink to this headline">¶</a></h2>
<p>Throughput is measured in mega-samples transferred per second (MSPS). Latency is defined as the time between the first sample being sent by the data mover into the row-wise FFT kernel and the first sample from the col-wise FFT kernel being received by the data mover. It is measured by viewing the runtime generated trace texts using Vitis analyzer. The steps to measure throughput and latency are listed below:</p>
<ol>
<li><p>Compile the design using <code class="docutils literal notranslate"><span class="pre">EN_TRACE=1</span></code>. It automatically includes a <code class="docutils literal notranslate"><span class="pre">xrt.ini</span></code> file while packaging, which comprises the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Debug</span><span class="p">]</span>
<span class="n">xrt_trace</span><span class="o">=</span><span class="n">true</span>
<span class="n">data_transfer_trace</span><span class="o">=</span><span class="n">fine</span>
<span class="n">trace_buffer_size</span><span class="o">=</span><span class="mi">500</span><span class="n">M</span>
</pre></div>
</div>
<p>Refer to the <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/xrtini.html#tpi1504034339424">xrt.ini</a> documentation for more information.</p>
</li>
<li><p>After execution on the board, transfer the generated <code class="docutils literal notranslate"><span class="pre">device_trace_0.csv</span></code>, <code class="docutils literal notranslate"><span class="pre">hal_host_trace.csv</span></code>, and <code class="docutils literal notranslate"><span class="pre">xclbin.run_summary</span></code> files back to your system.</p></li>
<li><p>Open <code class="docutils literal notranslate"><span class="pre">xclbin.ex.run_summary</span></code> using <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span></code>: <code class="docutils literal notranslate"><span class="pre">vitis_analyzer</span> <span class="pre">xclbin.ex.run_summary</span></code>.</p></li>
<li><p>The snapshot of the timeline trace for the AI Engine 1024 x 2048 point 1-instance design run with <code class="docutils literal notranslate"><span class="pre">ITER_CNT=8</span></code> is shown in the following figure:</p></li>
</ol>
<p><img alt="Image of 2D-FFT AI Engine implementation 1x Timeline Trace" src="../../../../../_images/fft_2d_aie_trace_1kx2k_1x_iter8.PNG" /></p>
<ol class="simple">
<li><p>The profiling setup in the Makefile measures the execution time and all the interfaces. For higher instance designs only, <code class="docutils literal notranslate"><span class="pre">strmInp_from_colwiseFFT</span></code> is profiled.</p></li>
</ol>
<p>The throughput and latency calculations for the 1024 x 2048 point 1-instance design based on the <code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> run is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Execution Time:
   = Difference in execution timeline trace
   = (End of Execution Timestamp of Stream `strmInp_from_rowiseFFT`) -
     (Start of Execution Timestamp of Stream `strmOut_to_rowiseFFT`)
   = 4210.95us

Latency:
   = Difference between strmInp_from_colwiseFFT beginning and execution beginning
   = (Start of Execution Timestamp of Stream `strmOut_to_colwiseFFT`) -
     (Start of Execution Timestamp of Stream `strmOut_to_rowiseFFT`)
   = 4210.6us

Throughput = (Samples transferred) / execution time
           = (MAT_ROWS x MAT_COLS) / execution time
           = (1024 x 2048) / 4210.95us
           = 498 MSamples/s
           = 498 x 4 MB/s (As each sample is 4bytes)
           = 1992 MB/s
</pre></div>
</div>
<p>A summary of throughput and latency for all variations is shown in the following table.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">No. of Instances</th>
<th align="center">FFT Configuration</th>
<th align="center">Data Transfer Size</th>
<th align="center">Aggregate Throughput<br/>(in MSPS)</th>
<th align="center">Average Throughput<br/>(in MSPS)</th>
<th align="center">Average Latency<br/>(in μs)</th>
<th align="center">Minimum Latency<br/>(in μs)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">16384</td>
<td align="center">235.402</td>
<td align="center">235.402</td>
<td align="center">8.7</td>
<td align="center">8.7</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">65536</td>
<td align="center">362.478</td>
<td align="center">362.478</td>
<td align="center">22.6</td>
<td align="center">22.6</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">262144</td>
<td align="center">468.114</td>
<td align="center">468.114</td>
<td align="center">70.0</td>
<td align="center">70.0</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">1048576</td>
<td align="center">559.420</td>
<td align="center">559.420</td>
<td align="center">234.3</td>
<td align="center">234.3</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">16777216</td>
<td align="center">498.065</td>
<td align="center">498.065</td>
<td align="center">4210.6</td>
<td align="center">4210.6</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">16384</td>
<td align="center">1177.011</td>
<td align="center">235.402</td>
<td align="center">8.7</td>
<td align="center">8.7</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">65536</td>
<td align="center">1812.389</td>
<td align="center">362.478</td>
<td align="center">22.6</td>
<td align="center">22.6</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">262144</td>
<td align="center">2340.571</td>
<td align="center">468.114</td>
<td align="center">70.0</td>
<td align="center">70.0</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">1048576</td>
<td align="center">2797.098</td>
<td align="center">559.420</td>
<td align="center">234.3</td>
<td align="center">234.3</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">16777216</td>
<td align="center">2490.324</td>
<td align="center">498.065</td>
<td align="center">4210.6</td>
<td align="center">4210.6</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">64 point<br/>(32 x 64)</td>
<td align="center">16384</td>
<td align="center">2327.273</td>
<td align="center">232.727</td>
<td align="center">8.8</td>
<td align="center">8.8</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">128 point<br/>(64 x 128)</td>
<td align="center">65536</td>
<td align="center">3175.194</td>
<td align="center">317.519</td>
<td align="center">25.8</td>
<td align="center">25.8</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">256 point<br/>(128 x 256)</td>
<td align="center">262144</td>
<td align="center">4920.120</td>
<td align="center">492.012</td>
<td align="center">66.6</td>
<td align="center">66.6</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">512 point<br/>(256 x 512)</td>
<td align="center">1048576</td>
<td align="center">5594.195</td>
<td align="center">559.420</td>
<td align="center">234.3</td>
<td align="center">234.3</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">2048 point<br/>(1024 x 2048)</td>
<td align="center">16777216</td>
<td align="center">6012.822</td>
<td align="center">601.282</td>
<td align="center">3487.8</td>
<td align="center">3487.8</td>
</tr>
</tbody>
</table></details><details>
<summary>Performance per Watt</summary> </div>
<div class="section" id="performance-per-watt">
<h2>Performance per Watt<a class="headerlink" href="#performance-per-watt" title="Permalink to this headline">¶</a></h2>
<p>Performance per Watt is represented as throughput in MSPS/power in Watts. The following example shows the calculation for the 1024 x 2048 point 1-instance design:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Performance</span> <span class="n">per</span> <span class="n">Watt</span> <span class="o">=</span> <span class="n">Throughput</span><span class="p">(</span><span class="n">MSPS</span><span class="p">)</span> <span class="o">/</span> <span class="n">Power</span><span class="p">(</span><span class="n">Watt</span><span class="p">)</span>
                     <span class="o">=</span> <span class="p">(</span><span class="mf">498.065</span> <span class="o">/</span> <span class="mf">0.950</span><span class="p">)</span> <span class="n">MSPS</span><span class="o">/</span><span class="n">Watt</span>
                     <span class="o">=</span> <span class="mf">524.279</span> <span class="n">MSPS</span><span class="o">/</span><span class="n">Watt</span>
</pre></div>
</div>
<p>A summary of performance per Watt for all variations is shown in the following table.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">No. of Instances</th>
<th align="center">FFT Configuration</th>
<th align="center">Performance per Watt (in MSPS/Watt)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">64 point (32 x 64)</td>
<td align="center">338.708</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">128 point (64 x 128)</td>
<td align="center">496.545</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">256 point (128 x 256)</td>
<td align="center">595.565</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">512 point (256 x 512)</td>
<td align="center">654.292</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2048 point (1024 x 2048)</td>
<td align="center">524.279</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">64 point (32 x 64)</td>
<td align="center">808.387</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">128 point (64 x 128)</td>
<td align="center">1078.803</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">256 point (128 x 256)</td>
<td align="center">1236.435</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">512 point (256 x 512)</td>
<td align="center">1231.659</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">2048 point (1024 x 2048)</td>
<td align="center">895.478</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">64 point (32 x 64)</td>
<td align="center">982.385</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">128 point (64 x 128)</td>
<td align="center">1125.955</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">256 point (128 x 256)</td>
<td align="center">1490.042</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">512 point (256 x 512)</td>
<td align="center">1391.245</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">2048 point (1024 x 2048)</td>
<td align="center">1183.393</td>
</tr>
</tbody>
</table></details><details>
<summary>Consolidated Summary</summary> </div>
<div class="section" id="consolidated-summary">
<h2>Consolidated Summary<a class="headerlink" href="#consolidated-summary" title="Permalink to this headline">¶</a></h2>
<p>A consolidated summary of observations for all the point sizes and all the corresponding instance variations is shown in the following table.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="center">FFT Configuration - No. of Instances</th>
<th align="center">Aggregate Throughput<br/>(in MSPS)</th>
<th align="center">Average Latency<br/>(in μs)</th>
<th align="center">No. of Compute Cores</th>
<th align="center">Vector Load</th>
<th align="center">No. of Active Memory Banks</th>
<th align="center">Mem R/W Rate</th>
<th align="center">FF (Regs)</th>
<th align="center">CLB LUTs</th>
<th align="center">Dynamic Power<br/>(in mW)</th>
<th align="center">Performance per Watt<br/>(in MSPS/Watt)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">64 point<br/>(32 x 64)<br/> - x1</td>
<td align="center">235.402</td>
<td align="center">8.7</td>
<td align="center">2</td>
<td align="center">8%</td>
<td align="center">28</td>
<td align="center">4%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">695</td>
<td align="center">338.708</td>
</tr>
<tr>
<td align="center">128 point<br/>(64 x 128)<br/> - x1</td>
<td align="center">362.478</td>
<td align="center">22.6</td>
<td align="center">2</td>
<td align="center">17%</td>
<td align="center">28</td>
<td align="center">7%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">730</td>
<td align="center">496.545</td>
</tr>
<tr>
<td align="center">256 point<br/>(128 x 256)<br/> - x1</td>
<td align="center">468.114</td>
<td align="center">70.0</td>
<td align="center">2</td>
<td align="center">32%</td>
<td align="center">28</td>
<td align="center">13%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">786</td>
<td align="center">595.565</td>
</tr>
<tr>
<td align="center">512 point<br/>(256 x 512)<br/> - x1</td>
<td align="center">559.420</td>
<td align="center">234.3</td>
<td align="center">2</td>
<td align="center">50%</td>
<td align="center">30</td>
<td align="center">18%</td>
<td align="center">1172</td>
<td align="center">415</td>
<td align="center">855</td>
<td align="center">654.292</td>
</tr>
<tr>
<td align="center">2048 point<br/>(1024 x 2048)<br/> - x1</td>
<td align="center">498.065</td>
<td align="center">4210.6</td>
<td align="center">2</td>
<td align="center">76%</td>
<td align="center">42</td>
<td align="center">19%</td>
<td align="center">1172</td>
<td align="center">413</td>
<td align="center">950</td>
<td align="center">524.279</td>
</tr>
<tr>
<td align="center">64 point<br/>(32 x 64)<br/> - x5</td>
<td align="center">1177.011</td>
<td align="center">8.7</td>
<td align="center">10</td>
<td align="center">9%</td>
<td align="center">132</td>
<td align="center">5%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1456</td>
<td align="center">808.387</td>
</tr>
<tr>
<td align="center">128 point<br/>(64 x 128)<br/> - x5</td>
<td align="center">1812.389</td>
<td align="center">22.6</td>
<td align="center">10</td>
<td align="center">18%</td>
<td align="center">132</td>
<td align="center">8%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1680</td>
<td align="center">1078.803</td>
</tr>
<tr>
<td align="center">256 point<br/>(128 x 256)<br/> - x5</td>
<td align="center">2340.571</td>
<td align="center">70.0</td>
<td align="center">10</td>
<td align="center">32%</td>
<td align="center">132</td>
<td align="center">13%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">1893</td>
<td align="center">1236.435</td>
</tr>
<tr>
<td align="center">512 point<br/>(256 x 512)<br/> - x5</td>
<td align="center">2797.098</td>
<td align="center">234.3</td>
<td align="center">10</td>
<td align="center">50%</td>
<td align="center">142</td>
<td align="center">19%</td>
<td align="center">5860</td>
<td align="center">2079</td>
<td align="center">2271</td>
<td align="center">1231.659</td>
</tr>
<tr>
<td align="center">2048 point<br/>(1024 x 2048)<br/> - x5</td>
<td align="center">2490.324</td>
<td align="center">4210.6</td>
<td align="center">10</td>
<td align="center">76%</td>
<td align="center">202</td>
<td align="center">19%</td>
<td align="center">5860</td>
<td align="center">2091</td>
<td align="center">2781</td>
<td align="center">895.478</td>
</tr>
<tr>
<td align="center">64 point<br/>(32 x 64)<br/> - x10</td>
<td align="center">2327.273</td>
<td align="center">8.8</td>
<td align="center">20</td>
<td align="center">8%</td>
<td align="center">264</td>
<td align="center">4%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">2369</td>
<td align="center">982.385</td>
</tr>
<tr>
<td align="center">128 point<br/>(64 x 128)<br/> - x10</td>
<td align="center">3175.194</td>
<td align="center">25.8</td>
<td align="center">20</td>
<td align="center">18%</td>
<td align="center">264</td>
<td align="center">8%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">2820</td>
<td align="center">1125.955</td>
</tr>
<tr>
<td align="center">256 point<br/>(128 x 256)<br/> - x10</td>
<td align="center">4920.120</td>
<td align="center">66.6</td>
<td align="center">20</td>
<td align="center">32%</td>
<td align="center">272</td>
<td align="center">13%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">3302</td>
<td align="center">1490.042</td>
</tr>
<tr>
<td align="center">512 point<br/>(256 x 512)<br/> - x10</td>
<td align="center">5594.195</td>
<td align="center">234.3</td>
<td align="center">20</td>
<td align="center">50%</td>
<td align="center">284</td>
<td align="center">19%</td>
<td align="center">11720</td>
<td align="center">4150</td>
<td align="center">4021</td>
<td align="center">1391.245</td>
</tr>
<tr>
<td align="center">2048 point<br/>(1024 x 2048)<br/> - x10</td>
<td align="center">6012.822</td>
<td align="center">3487.8</td>
<td align="center">20</td>
<td align="center">76%</td>
<td align="center">396</td>
<td align="center">20%</td>
<td align="center">11720</td>
<td align="center">4154</td>
<td align="center">5081</td>
<td align="center">1183.393</td>
</tr>
</tbody>
</table><p>From these observations it can be seen that with the increase in the FFT point size, the window buffer size used in the AI Engines increases, and with that the throughput increases as well. By increasing the <code class="docutils literal notranslate"><span class="pre">TP_WINDOW_VSIZE</span></code> parameter in the FFT AI Engine graph, the throughput can be further increased, especially for the lower point sizes, but the AI Engine mapper/router could encounter issues due to the higher memory requirement.</p>
<p>Furthermore, the FFT point sizes increase, the power does <em>not</em> increase proportionately, so the performance per Watt maintains an increasing trend in the beginning and saturates towards the end.</p>
</details></div>
</div>
<div class="section" id="support">
<h1>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h1>
<p>GitHub issues will be used for tracking requests and bugs. For questions go to <a class="reference external" href="http://forums.xilinx.com/">forums.xilinx.com</a>.</p>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"> XD073 | &copy; Copyright 2021 Xilinx, Inc.</p></div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on February 10, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>