


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../../../../../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../../../../../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/linkid.js"></script>
	    <script type="text/javascript" src="../../../../../_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="../../../../../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../../../../../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Vitis_Platform_Creation/Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../../../../../_sources/docs/AI_Engine_Development/Design_Tutorials/08-n-body-simulator/Module_02_aie/README.md.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Vitis™ Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Build the Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/docs/AI_Engine_Development/Design_Tutorials/08-n-body-simulator/Module_02_aie/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>Versal™ ACAP AI Engine Tutorials</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    <a href="https://www.xilinx.com/products/design-tools/vitis/vitis-ai.html">See Vitis-AI™ Development Environment on xilinx.com</a>
    </td>
 </tr>
</table><div class="section" id="build-the-design">
<h1>Build the Design<a class="headerlink" href="#build-the-design" title="Permalink to this headline">¶</a></h1>
<p><em>Estimated time: 2 hours</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">aie</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aiecompiler</span> <span class="o">-</span><span class="n">v</span>  <span class="o">--</span><span class="n">target</span><span class="o">=</span><span class="n">hw</span> 					\
                <span class="o">--</span><span class="n">stacksize</span><span class="o">=</span><span class="mi">2000</span> 				\
                <span class="o">-</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;$(XILINX_VITIS)/aietools/include&quot;</span> 	\
	        <span class="o">-</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;./&quot;</span> 					\
	        <span class="o">-</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;./src&quot;</span> 				\
	        <span class="o">-</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;../data&quot;</span> 				\
	        <span class="n">nbody_x4_100</span><span class="o">.</span><span class="n">cpp</span> 				\
	        <span class="o">-</span><span class="n">workdir</span><span class="o">=</span><span class="n">work</span>
</pre></div>
</div>
<div class="section" id="ai-engine-design">
<h2>AI Engine Design<a class="headerlink" href="#ai-engine-design" title="Permalink to this headline">¶</a></h2>
<p>The following AI Engine features are used in this design:</p>
<ul class="simple">
<li><p>single precision floating-point compute of the N-Body gravity equations on 12,800 particles</p></li>
<li><p>400 tile design with 400 parallel accelerators</p></li>
<li><p>1:400 broadcast stream</p></li>
<li><p>1:4 packet split</p></li>
<li><p>4:1 packet merge</p></li>
<li><p>PL Kernels designed to support packet switching in AI Engine</p></li>
</ul>
</div>
<div class="section" id="a-single-nbody-kernel">
<h2>A Single Nbody() Kernel<a class="headerlink" href="#a-single-nbody-kernel" title="Permalink to this headline">¶</a></h2>
<p>Review the <code class="docutils literal notranslate"><span class="pre">src/nbody.cc</span></code> file. It contains the implementation of a single AI Engine kernel mapped to a single AI Engine tile called <code class="docutils literal notranslate"><span class="pre">nbody()</span></code>. This kernel takes in the <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">vx</span> <span class="pre">vy</span> <span class="pre">vz</span> <span class="pre">m</span></code> values for 32 particles, computes the N-Body gravity equations for a single timestep, and outputs the new <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">vx</span> <span class="pre">vy</span> <span class="pre">vz</span> <span class="pre">m</span></code> values for the 32 particles. This kernel takes in two inputs: <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> and <code class="docutils literal notranslate"><span class="pre">w_input_j</span></code>. The <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> window contains the <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">vx</span> <span class="pre">vy</span> <span class="pre">vz</span> <span class="pre">m</span></code> floating point values for 32 particles. The <code class="docutils literal notranslate"><span class="pre">w_input_j</span></code> window contains the only <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">m</span></code> floating-point values for the same 32 particles. This kernel produces one output: <code class="docutils literal notranslate"><span class="pre">w_output_i</span></code> which contains the new <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">vx</span> <span class="pre">vy</span> <span class="pre">vz</span> <span class="pre">m</span></code> floating-point values for the 32 particles in the next timestep.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>name</th>
<th>number of 32-bit data values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>w_input_i</code></td>
<td>32 * 7 = 224</td>
</tr>
<tr>
<td><code>w_input_j</code></td>
<td>32 * 4 = 128</td>
</tr>
<tr>
<td><code>w_output_i</code></td>
<td>32 * 7 = 224</td>
</tr>
</tbody>
</table><p><img alt="alt text" src="../../../../../_images/data_formats.png" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel is sectioned into two major <code class="docutils literal notranslate"><span class="pre">for</span></code> loops. The first major <code class="docutils literal notranslate"><span class="pre">for</span></code> loop (around lines 38-61) calculates the new <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span></code> positions for the 32 particles. The second major <code class="docutils literal notranslate"><span class="pre">for</span></code> loop (around lines 64-202) calculates the new <code class="docutils literal notranslate"><span class="pre">vx</span> <span class="pre">vy</span> <span class="pre">vz</span></code> velocities for the 32 particles. The output mass (<code class="docutils literal notranslate"><span class="pre">m</span></code>) values remain the same as the inputs. The <code class="docutils literal notranslate"><span class="pre">w_output_i</span></code> window is then sent to the <code class="docutils literal notranslate"><span class="pre">transmit_new_i</span></code> kernel (source: <code class="docutils literal notranslate"><span class="pre">src/transmit_new_i.cc</span></code>) to be written to the final output window.</p>
</div>
<div class="section" id="four-nbody-kernels-packet-switched">
<h2>Four NBody() Kernels Packet Switched<a class="headerlink" href="#four-nbody-kernels-packet-switched" title="Permalink to this headline">¶</a></h2>
<p>Next, review the <code class="docutils literal notranslate"><span class="pre">src/nbody_subsystem.h</span></code> graph. This graph creates four N-Body kernels, a packet splitter kernel, and a packet merger kernel. Review the packet switching feature tutorial to learn more about the packet switching feature in the AI Engine: <a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/master/AI_Engine_Development/Feature_Tutorials/04-packet-switching">04-packet-switching</a>.</p>
<p><img alt="alt text" src="docs/AI_Engine_Development/Design_Tutorials/08-n-body-simulator/Module_02_aie/images/nbody_subsystem%20(1).PNG" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph has two inputs: <code class="docutils literal notranslate"><span class="pre">input_i</span></code> and <code class="docutils literal notranslate"><span class="pre">input_j</span></code>. The <code class="docutils literal notranslate"><span class="pre">input_i</span></code> port is a packet stream that connects to the packet splitter. The packet splitter redirects packets of data to the <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> port of each <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel. Each <code class="docutils literal notranslate"><span class="pre">input_i</span></code> packet contains a packet header, 224 32-bit data values, and TLAST asserted with the <code class="docutils literal notranslate"><span class="pre">m31</span></code> data value. The <code class="docutils literal notranslate"><span class="pre">input_j</span> </code> port is a data stream that is broadcast to all the <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels (i.e., all <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels receive the same <code class="docutils literal notranslate"><span class="pre">input_j</span></code> data). The <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels perform their computations and generate the new <code class="docutils literal notranslate"><span class="pre">w_output_i</span></code> data which is merged into a single stream of packets, resulting in the output of the <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph <code class="docutils literal notranslate"><span class="pre">output_i</span></code>.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Name</th>
<th>Number of 32-bit Data Values</th>
<th>Window Size (bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td>input_i</td>
<td>224 * 4 = 896</td>
<td>896 * 4 = 3584 bytes</td>
</tr>
<tr>
<td>input_j</td>
<td>128</td>
<td>128 * 4 = 512 bytes</td>
</tr>
<tr>
<td>output_i</td>
<td>224 * 4 = 896</td>
<td>896 * 4 = 3584 bytes</td>
</tr>
</tbody>
</table><p>A single instance of the <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph can simulate 128 particles using four AI Engine tiles.</p>
<div class="section" id="workload-distribution-and-input-j">
<h3>Workload Distribution and input_j<a class="headerlink" href="#workload-distribution-and-input-j" title="Permalink to this headline">¶</a></h3>
<p>To calculate the N-Body gravity equations for 128 particles, each <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel calculates the N-Body gravity equations for 32 particles. However, in order to calculate acceleration and the new velocities, an <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel needs to know the data in the other kernels. For example, if particle 0 is mapped to <code class="docutils literal notranslate"><span class="pre">nbody_kernel[0]</span></code> and particle 32 is mapped to <code class="docutils literal notranslate"><span class="pre">nbody_kernel[1]</span></code>,  then <code class="docutils literal notranslate"><span class="pre">nbody_kernel[0]</span></code> needs to know the data in <code class="docutils literal notranslate"><span class="pre">nbody_kernel[1]</span></code> to accurately calculate the summation equation for acceleration and then calculate the new velocity of particle 0.</p>
<p>This is where the <code class="docutils literal notranslate"><span class="pre">input_j</span></code> stream plays a vital role in data sharing. Even though the <code class="docutils literal notranslate"><span class="pre">input_j</span></code> data stream has a window size for 32 particles worth of data, the <code class="docutils literal notranslate"><span class="pre">LOOP_COUNT_J</span></code> value can be set to allow the <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels to take in any number of 32 particles worth of data at a time. For a single instance of the <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph, the <code class="docutils literal notranslate"><span class="pre">LOOP_COUNT_J</span></code> should be set to 4 to stream in data for all four kernels. For the final AI Engine graph, which contains 100 instances of the <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph, the <code class="docutils literal notranslate"><span class="pre">LOOP_COUNT_J</span></code> value is set to 400 to stream in data for all 400 kernels to each <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel.</p>
<p><img alt="alt text" src="../../../../../_images/input_j_description.png" /></p>
<p>For example, to calculate the new velocity of particle 0 mapped in <code class="docutils literal notranslate"><span class="pre">nbody_kernel[0]</span></code>, the <code class="docutils literal notranslate"><span class="pre">nbody_kernel[0]</span></code> can retrieve the data value of particle 32 from the <code class="docutils literal notranslate"><span class="pre">input_j</span></code> stream. This way, all <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels will have the data values for all other particles mapped in the other <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels through data streaming from <code class="docutils literal notranslate"><span class="pre">input_j</span></code>.</p>
</div>
</div>
<div class="section" id="n-body-subsystems">
<h2>100 N-Body Subsystems<a class="headerlink" href="#n-body-subsystems" title="Permalink to this headline">¶</a></h2>
<p>Review the <code class="docutils literal notranslate"><span class="pre">nbody_x4_x100.h</span></code>. It contains the definition of the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> graph which contains 100 instances of the <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph. Each <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> is mapped to four AI Engine tiles which each contain an <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel. Therefore, the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> graph contains 400 <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels using up all of the 400 available AI Engine tiles. Since each <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel simulates 32 particles, the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> simulates 12,800 particles (32 particles * 400 kernels). There are 100 <code class="docutils literal notranslate"><span class="pre">input_i</span></code> ports (<code class="docutils literal notranslate"><span class="pre">input_i0-99</span></code>) and a single <code class="docutils literal notranslate"><span class="pre">input_j</span></code> port. For 1 iteration, the <code class="docutils literal notranslate"><span class="pre">input_i</span></code> ports receive 4 packetized <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> data which are distributed to 4 <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels in each <code class="docutils literal notranslate"><span class="pre">nbody_subsystem</span></code> graph. The <code class="docutils literal notranslate"><span class="pre">input_j</span></code> is a 1:400 broadcast stream to the 400 <code class="docutils literal notranslate"><span class="pre">w_input_j</span></code> ports in the 400 <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernels.</p>
<p>Review the <code class="docutils literal notranslate"><span class="pre">nbody_x4_100.cpp</span></code> file. It contains an instance of the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> graph and simulates it for one iteration. Also, review the data files in the data folder where you will find the input data files for the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> (<code class="docutils literal notranslate"><span class="pre">input_i0-99.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">input_j.txt</span></code>) used by the <code class="docutils literal notranslate"><span class="pre">nbodySystem</span></code> graph.</p>
<p><img alt="alt text" src="../../../../../_images/x100_design.png" /></p>
<p>Below is the implementation of the 100 compute unit on all 400 AI Engine tiles viewed on the Vitis Analyzer tool.
<img alt="alt text" src="../../../../../_images/aie_impl_1_cu_highlighted.PNG" /></p>
<p>The red highlighted region encompasses four AI Engine tiles which contain a single compute unit.</p>
<p>Following is the graph visualization of a single compute unit on the Vitis Analyzer tool.
<img alt="alt text" src="../../../../../_images/aie_single_cu.PNG" /></p>
</div>
<div class="section" id="why-packet-switching">
<h2>Why Packet Switching?<a class="headerlink" href="#why-packet-switching" title="Permalink to this headline">¶</a></h2>
<p>You might be curious about the need to implement the packet switching scheme 1:4/4:1. This was done to circumvent an AI Engine architecture limitation on the number of simultaneous input and output AXI-Streams allowed per AI Engine column. There are 50 AI Engine columns in the AI Engine array. Each column contains 8 AI Engine tiles. Each AI Engine column is allowed a maximum of 6 32-bit AXI-Stream inputs and 4 32-bit AXI-Stream outputs.</p>
<p>In the design, each <code class="docutils literal notranslate"><span class="pre">nbody()</span></code> kernel is mapped to an AI Engine tile. Meaning each column of 8 AI Engine tiles has 9 inputs streams and 8 output streams, violating these constraints.</p>
<ul class="simple">
<li><p>8 <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> input streams</p></li>
<li><p>1 <code class="docutils literal notranslate"><span class="pre">w_intput_j</span></code> input stream</p></li>
<li><p>8 <code class="docutils literal notranslate"><span class="pre">w_output_i</span></code> output streams</p></li>
</ul>
<p>With the 1:4/4:1 packet switching scheme, you can combine 4 streams into 1. Because packet switching is applied on the <code class="docutils literal notranslate"><span class="pre">w_input_i</span></code> ports, the number of input streams into a single AI Engine column is reduced to three:</p>
<ul class="simple">
<li><p>1 <code class="docutils literal notranslate"><span class="pre">input_i</span></code> stream that goes to tiles 0-3 in a column</p></li>
<li><p>1 <code class="docutils literal notranslate"><span class="pre">input_i</span></code> stream that goes to tiles 4-7 in a column</p></li>
<li><p>1 <code class="docutils literal notranslate"><span class="pre">input_j</span></code> stream that is broadcasted to all the columns</p></li>
</ul>
<p>On the output side, the number of output streams is reduced to two:</p>
<ul class="simple">
<li><p>1 <code class="docutils literal notranslate"><span class="pre">output_i</span></code> stream coming from tiles 0-3 in a column</p></li>
<li><p>1 <code class="docutils literal notranslate"><span class="pre">output_i</span></code> stream coming from tiles 4-7 in a column</p></li>
</ul>
</div>
<div class="section" id="optional-simulate-the-ai-engine-design">
<h2>(Optional) Simulate the AI Engine Design<a class="headerlink" href="#optional-simulate-the-ai-engine-design" title="Permalink to this headline">¶</a></h2>
<p><em>Estimated time: a few days</em></p>
<p>Run the following make command to invoke the aiesimulator.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">sim</span>
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/tree/master/AI_Engine_Development/Feature_Tutorials/04-packet-switching">Packet Switching AI Engine Tutorial</a></p></li>
<li><p><a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1076-ai-engine-environment/Explicit-Packet-Switching">AI Engine Documentation - Explicit Packet Switching</a></p></li>
<li><p><a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1076-ai-engine-environment/Compiling-an-AI-Engine-Graph-Application">Compiling an AI Engine Graph Application</a></p></li>
<li><p><a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1076-ai-engine-environment/Simulating-an-AI-Engine-Graph-Application">Simulating an AI Engine Graph Application</a></p></li>
</ul>
</div>
<div class="section" id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>After compiling the 100 compute unit N-Body Simulator design, you are ready to create the PL datamover kernels in the next module, <a class="reference external" href="../Module_03_pl_kernels">Module 03 - PL Design</a>.</p>
</div>
</div>
<div class="section" id="support">
<h1>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h1>
<p>GitHub issues will be used for tracking requests and bugs. For questions go to <a class="reference external" href="http://support.xilinx.com/">support.xilinx.com</a>.</p>
</div>
<div class="section" id="license">
<h1>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h1>
<p>Licensed under the Apache License, Version 2.0 (the “License”); you may not use this file except in compliance with the License.</p>
<p>You may obtain a copy of the License at <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
<p align="center"> XD068 | &copy; Copyright 2021 Xilinx, Inc.</p></div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on January 18, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2019-2022, Xilinx, Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>