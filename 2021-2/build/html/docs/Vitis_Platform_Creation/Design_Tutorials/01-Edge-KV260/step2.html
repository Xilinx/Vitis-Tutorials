<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Step 2: Create the Software Components &mdash; Vitis™ Tutorials 2021.2 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2021.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Step 2: Create the Software Components</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Vitis_Platform_Creation/Design_Tutorials/01-Edge-KV260/step2.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--
# Copyright 2021 Xilinx Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
--><section id="step-2-create-the-software-components">
<h1>Step 2: Create the Software Components<a class="headerlink" href="#step-2-create-the-software-components" title="Permalink to this heading">¶</a></h1>
<table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>2021.1 Vitis™ Platform Creation Tutorials</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    </td>
 </tr>
</table><p>Due to the boot flow differences between KV260 and base platforms for Xilinx evaluation boards like ZCU104, platform developer needs to prepare one additional DTBO file besides the normal software components for Vitis platforms because application developers needs to add this DTBO file to the application deployment package. The other software components generation flow is similar to the flow described in the <a class="reference internal" href="../../Introduction/02-Edge-AI-ZCU104/step2.html"><span class="doc">ZCU104 tutorial</span></a>. Since KV260 provides its BSP, we can use the PetaLinux BSP to generate Linux kernel, root file system and boot components, or do more customization based on the BSP.</p>
</section>
<section id="step-2-create-the-software-components-with-petalinux">
<h1>Step 2: Create the Software Components with PetaLinux<a class="headerlink" href="#step-2-create-the-software-components-with-petalinux" title="Permalink to this heading">¶</a></h1>
<p>KV260 provides an off-the-shelf boot image and has its enhanced boot sequence. Since the image can boot successfully out of the box, Vitis platform developers can skip some software component preparation steps for Linux booting.</p>
<section id="generating-normal-software-components-from-the-kv260-starter-kit-bsp">
<h2>Generating Normal Software Components from the KV260 Starter Kit BSP<a class="headerlink" href="#generating-normal-software-components-from-the-kv260-starter-kit-bsp" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Check <a class="reference external" href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/1641152513/Kria+K26+SOM">Kria K26 SOM wiki</a>. Download the <strong>Starter Kit SOM BSP</strong> that matches your tool version under <strong>PetaLinux Board Support Package</strong> section.</p>
<p>For example, https://www.xilinx.com/member/forms/download/xef.html?filename=xilinx-k26-starterkit-v2021.1-final.bsp</p>
<p>Save it to your working directory.</p>
</li>
<li><p>Setup PetaLinux environment</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;petaLinux_tool_install_dir&gt;/settings.sh
</pre></div>
</div>
</li>
<li><p>Update PetaLinux eSDK to enable the recipes needed by the Starter Kit SOM BSP.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-upgrade -u <span class="s1">&#39;http://petalinux.xilinx.com/sswreleases/rel-v2021/sdkupdate/2021.1_update1/&#39;</span> -p <span class="s1">&#39;aarch64&#39;</span>
</pre></div>
</div>
</li>
<li><p>Create PetaLinux with the Starter Kit SOM BSP and the XSA export from step 1.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-create --type project -s xilinx-k26-starterkit-v2021.1-final.bsp
<span class="nb">cd</span> xilinx-k26-starterkit-v2021.1
petalinux-config --get-hw-description<span class="o">=</span>&lt;vivado_design_dir&gt;
</pre></div>
</div>
</li>
<li><p>Add XRT to rootfs</p>
<p>KV260 PetaLinux BSP doesn’t enable XRT because it installs XRT with overlay. To create sysroot for application developer cross compiling, we enable XRT in the rootfs.</p>
<ul class="simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">petalinux-config</span> <span class="pre">-c</span> <span class="pre">rootfs</span></code> to launch rootfs configruation window.</p></li>
<li><p>Go to <strong>Filesystem packages -&gt; libs -&gt; xrt</strong></p></li>
<li><p>Enable <code class="docutils literal notranslate"><span class="pre">xrt</span></code></p></li>
<li><p>Press Exit to exit configrution. Press Save to save the configuration.</p></li>
</ul>
</li>
<li><p>Build PetaLinux and generate SDK</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>petalinux-build
petalinux-build --sdk
</pre></div>
</div>
<p>The PetaLinux image files and sysroot sdk.sh will be generated in <PetaLinux Project>/images/linux directory. We will use them in the next step.</p>
</li>
</ol>
</section>
<section id="generate-device-tree-overlay">
<h2>Generate Device Tree Overlay<a class="headerlink" href="#generate-device-tree-overlay" title="Permalink to this heading">¶</a></h2>
<p>Since KV260 loads PL after Linux boots up, the PL IP information in the platform needs to be loaded dynamicly as device tree overlay. So one additional requirement for KV260 acceleration platform software is to generate the device tree overlay for the platform PL IPs. This device tree overlay serves two purposes:</p>
<ol class="simple">
<li><p>It needs to have ZOCL node so that XRT driver can be loaded properly</p></li>
<li><p>It can include any configurations of the PL IP in the platform logic designed in step 1.</p></li>
</ol>
<p>The device tree information for PL in your application is loaded after Linux boot together with the PL bitstream. A device tree overlay (DTBO) can be loaded and unloaded in Linux. For more information about DTBO, please refer to https://lkml.org/lkml/2012/11/5/615.</p>
<p>Xilinx provides Device Tree Generator (DTG) to generate device tree from XSA file exported from Vivado. DTG is configurable for which information to be generated. According to our requirement, we will use these two options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG.dt_zocl</span></code>: Generate ZOCL device tree node for XRT</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG.dt_overlay</span></code>: Add overlay properties in dtsi for DTBO generation</p></li>
</ul>
<p>Run the following steps to generate DTBO from XSA</p>
<ol>
<li><p>Install DTG</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/Xilinx/device-tree-xlnx
<span class="nb">cd</span> device-tree-xlnx
git checkout xlnx_rel_v2021.1
</pre></div>
</div>
</li>
<li><p>Generate DTS from XSA with XSCT.</p>
<ul class="simple">
<li><p>Launch XSCT</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>xsct
</pre></div>
</div>
<ul class="simple">
<li><p>Use XSCT HSI commands to read XSA and generate DTS.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hsi open_hw_design &lt;design_name.xsa&gt;
hsi set_repo_path &lt;path to device-tree-xlnx repository&gt;
hsi create_sw_design device-tree -os device_tree -proc psu_cortexa53_0
hsi set_property CONFIG.dt_overlay <span class="nb">true</span> <span class="o">[</span>hsi::get_os<span class="o">]</span>
hsi set_property CONFIG.dt_zocl <span class="nb">true</span> <span class="o">[</span>hsi::get_os<span class="o">]</span>
hsi generate_target -dir &lt;desired_dts_filename&gt;
hsi close_hw_design <span class="o">[</span>hsi current_hw_design<span class="o">]</span>
</pre></div>
</div>
</li>
<li><p>Compile the dtsi to dtbo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dtc -@ -O dtb -o pl.dtbo pl.dtsi
</pre></div>
</div>
</li>
</ol>
<section id="next-step">
<h3>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Note:  Now HW platform and SW platform are all generated. Next we would <a class="reference internal" href="step3.html"><span class="doc">package the Vitis Platform</span></a>.</p>
</div></blockquote>
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2021 Xilinx</sup></p></section>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on July 27, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>