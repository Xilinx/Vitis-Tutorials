<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Step 1: Create the Vivado Hardware Design and Generate XSA &mdash; Vitis™ Tutorials 2021.2 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../index.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2021.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/index.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis-Getting-Started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Acceleration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Acceleration/Hardware-Acceleration.html">Hardware Acceleration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">AI Engine</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../AI_Engine_Development/AI_Engine_Development.html">AI Engine Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Vitis_Platform_Creation.html">Vitis Platform Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-2/docs/index.html">2020.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">2020.1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Step 1: Create the Vivado Hardware Design and Generate XSA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Vitis_Platform_Creation/Design_Tutorials/01-Edge-KV260/step1.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <!--
# Copyright 2021 Xilinx Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
--><table class="sphinxhide" width="100%">
 <tr width="100%">
    <td align="center"><img src="https://raw.githubusercontent.com/Xilinx/Image-Collateral/main/xilinx-logo.png" width="30%"/><h1>2021.1 Vitis™ Platform Creation Tutorials</h1>
    <a href="https://www.xilinx.com/products/design-tools/vitis.html">See Vitis™ Development Environment on xilinx.com</br></a>
    </td>
 </tr>
</table><section id="step-1-create-the-vivado-hardware-design-and-generate-xsa">
<h1>Step 1: Create the Vivado Hardware Design and Generate XSA<a class="headerlink" href="#step-1-create-the-vivado-hardware-design-and-generate-xsa" title="Permalink to this heading">¶</a></h1>
<p>In this step, we will create the hardware design for the KV260 Vitis acceleration platform. We will start from a KV260 preset design, add platform required peripherals and configure them. After everything is set, we will export the hardware design to XSA.</p>
<section id="create-base-vivado-project-from-preset">
<h2>Create Base Vivado Project from Preset<a class="headerlink" href="#create-base-vivado-project-from-preset" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Launch Vivado</p>
<p>Run the following commands in Linux console.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> &lt;Vitis_Install_Directory&gt;/settings64.sh
vivado <span class="p">&amp;</span>
</pre></div>
</div>
</li>
<li><p>Create a Vivado project named <strong>kv260_custom_platform</strong>.</p>
<ul class="simple">
<li><p>Select <strong>File-&gt;Project-&gt;New</strong>, Click <strong>Next</strong>.</p></li>
<li><p>In Project Name dialog set Project name to <strong>kv260_custom_platform</strong>. Click <strong>Next</strong>.</p></li>
<li><p>Enable <strong>Project is an extensible Vitis platform</strong>. Click <strong>Next</strong>.</p></li>
</ul>
<p><img alt="vivado_project_type.png" src="../../../../_images/vivado_project_type.png" /></p>
<ul class="simple">
<li><p>Select <strong>Boards</strong> tab</p></li>
<li><p>Click <strong>Refresh</strong> button to load the latest list of boards.</p></li>
<li><p>Select <strong>Kria KV260 Vision AI Starter Kit</strong>.</p></li>
<li><p>Click <strong>Next</strong>.</p></li>
<li><p>Review project summary and click <strong>Finish</strong></p></li>
</ul>
<blockquote>
<div><p>Note: If you need to change an existing Vivado project to an extensible platform project, you can go to <strong>Settings</strong> in <strong>Flow Navigator</strong> in an opened Vivado design, go to <strong>General</strong> and enable <strong>project is an extensible Vitis platform</strong></p>
</div></blockquote>
</li>
<li><p>Create a block design.</p>
<ul class="simple">
<li><p>In <strong>Project Manager</strong>, under <strong>IP INTEGRATOR</strong>, select <strong>Create Block Design</strong>.</p></li>
<li><p>(Optional) Change the design name to <strong>system</strong>.</p></li>
<li><p>Click <strong>OK</strong>.</p></li>
</ul>
</li>
<li><p>Add MPSoC IP and run block automation to configure it.</p>
<ul class="simple">
<li><p>Right click Diagram view and select <strong>Add IP</strong>.</p></li>
<li><p>Search for <code class="docutils literal notranslate"><span class="pre">zynq</span></code> and then double-click the <strong>Zynq UltraScale+ MPSoC</strong> from the IP search results.</p></li>
<li><p>Click the <strong>Run Block Automation</strong> link to apply the board presets.
In the Run Block Automation dialog, ensure the following is check marked:</p>
<ul>
<li><p>All Automation</p></li>
<li><p>Zynq_ultra_ps_e_0</p></li>
<li><p>Apply Board Presets</p></li>
</ul>
</li>
<li><p>Click <strong>OK</strong>. You should get MPSoC block configured like below:</p></li>
</ul>
<p><img alt="block_automation_result.png" src="../../../../_images/block_automation_result.png" /></p>
</li>
</ol>
<p><strong>What Just Happened?</strong></p>
<p>At this stage, the Vivado block automation has added a Zynq UltraScale+ MPSoC block and applied all board presets for the KV260. The presets includes MPSoC PS block configurations and pin assignments.</p>
<section id="customize-system-design-for-clock-and-reset">
<h3>Customize System Design for Clock and Reset<a class="headerlink" href="#customize-system-design-for-clock-and-reset" title="Permalink to this heading">¶</a></h3>
<p>V++ linker can automatically link the clock signals between kernel and platform. The available clock signals in the platform are exported by <strong>PFM.CLK</strong> property.</p>
<p>For simple designs, interrupt signals can be sourced by processor’s <strong>pl_clk</strong>. The limitation is that the processor has maximum 4 pl_clks and their phase is not aligned.</p>
<p>To supply more interrupt signals, or to supply phase aligned clocks, we can use <strong>Clocking Wizard</strong>.</p>
<p>We will add the <strong>Clocking Wizard</strong> to the block diagram and enable clock signals for the platform. Here are the detailed steps.</p>
<ol>
<li><p>Add the clocking wizard block to generate three clocks:</p>
<ul class="simple">
<li><p>Right click Diagram view and select <strong>Add IP</strong>.</p></li>
<li><p>Search for and add a <strong>Clocking Wizard</strong> from the IP Search dialog.</p></li>
<li><p>Double-click the <strong>clk_wiz_0</strong> IP block to open the Re-Customize IP dialog box.</p></li>
<li><p>Click the <strong>Output Clocks</strong> tab.</p></li>
<li><p>Enable clk_out1 through clk_out3 in the Output Clock column. Set the <strong>Requested Output Freq</strong> as follows:</p>
<ul>
<li><p><strong>clk_out1</strong> to <strong>100</strong> MHz</p></li>
<li><p><strong>clk_out2</strong> to <strong>200</strong> MHz</p></li>
<li><p><strong>clk_out3</strong> to <strong>400</strong> MHz</p></li>
</ul>
</li>
<li><p>At the bottom of the dialog box set the <strong>Reset Type</strong> to <strong>Active Low</strong>.</p></li>
</ul>
<p><img alt="clock_settings.png" src="../../../../_images/clock_settings.png" /></p>
<ul class="simple">
<li><p>Click <strong>OK</strong> to close the dialog.</p></li>
</ul>
<p><strong>Note: So now we have set up the clock system for our design. This clock wizard uses the pl_clk as input clock and generates clocks needed for the whole logic design. In this straightforward design, we would use 100MHz clock as the axi_lite control bus clock. 200MHz and 400MHz clocks are reserved for DPU AXI interface clock and DPU core clock during design linking phase. You are free to change the clock quantities and frequency to fit your target design. We will setup the clock export in future steps. Before that, we need to create reset signals for each clock because they are needed in clock export setup.</strong></p>
</li>
<li><p>Add three Processor System Reset blocks corresponding to the three clocks:</p>
<ul class="simple">
<li><p>Right click Diagram view and select <strong>Add IP</strong>.</p></li>
<li><p>Search for and add a <strong>Processor System Reset</strong> from the IP Search dialog</p></li>
<li><p>Rename the reset block to <strong>proc_sys_reset_1</strong> so that it is easy to understand the relationship between reset modules and the clock signals.</p></li>
<li><p>Select the <strong>proc_sys_reset_1</strong> block, type Ctrl-C and Ctrl-V to replicate two modules. They are named as <strong>proc_sys_reset_2</strong> and <strong>proc_sys_reset_3</strong> by default.</p></li>
</ul>
</li>
<li><p>Connect Clocks and Resets:</p>
<ul class="simple">
<li><p>Click <strong>Run Connection Automation</strong>, which will open a dialog that will help connect the proc_sys_reset blocks to the clocking wizard clock outputs.</p></li>
<li><p>Enable All Automation on the left side of the Run Connection Automation dialog box.</p></li>
<li><p>Select <strong>clk_in1</strong> on clk_wiz_0 and set the Clock Source to <strong>/zynq_ultra_ps_e_0/pl_clk0</strong>.</p></li>
<li><p>For each <strong>proc_sys_reset</strong> instance, select the <strong>slowest_sync_clk</strong>, and set the Clock Source as follows:</p>
<ul>
<li><p><strong>proc_sys_reset_1</strong> with <strong>/clk_wiz_0/clk_out1</strong></p></li>
<li><p><strong>proc_sys_reset_2</strong> with <strong>/clk_wiz_0/clk_out2</strong></p></li>
<li><p><strong>proc_sys_reset_3</strong> with <strong>/clk_wiz_0/clk_out3</strong></p></li>
</ul>
</li>
<li><p>On each proc_sys_reset instance, select the <strong>ext_reset_in</strong>, set <strong>Board Part Interface</strong> to <strong>Custom</strong> and set the <strong>Select Manual Source</strong> to <strong>/zynq_ultra_ps_e_0/pl_resetn0</strong>.</p></li>
<li><p>Make sure all checkboxes are enabled and click <strong>OK</strong> to close the dialog and create the connections.</p></li>
<li><p>Connect all the <strong>dcm_locked</strong> signals on each proc_sys_reset instance to the locked signal on <strong>clk_wiz_0</strong>.</p></li>
</ul>
<p><img alt="clk_rst_connection.png" src="../../../../_images/clk_rst_connection.png" /></p>
</li>
<li><p>Enable clocks for the platform</p>
<ul class="simple">
<li><p>Go to <strong>Platform Setup</strong> tab. If it is not opened yet, use menu <strong>Window -&gt; Platform Setup</strong> to open it.</p></li>
<li><p>Click <strong>Clock</strong> tab</p></li>
<li><p>Enable all clocks under clk_wiz_0: <strong>clk_out1</strong>, <strong>clk_out2</strong>, <strong>clk_out3</strong></p></li>
<li><p>Change their ID to <strong>0</strong>, <strong>1</strong> and <strong>2</strong></p></li>
<li><p>Set a default clock: click <strong>Is Default</strong> for <strong>clk_out2</strong></p></li>
<li><p>After everything is setup, it should report <strong>Info: No problem with Clock interface</strong>.</p></li>
</ul>
<p><img alt="Platform Setup - Clock" src="../../../../_images/platform_clock.png" /></p>
<p><strong>Note</strong>:</p>
<ul class="simple">
<li><p>There should be one and only one default clock in the platform. During v++ linker will use the default clock to connect the IP blocks if there are no user assignments for link configuration.</p></li>
</ul>
</li>
</ol>
</section>
<section id="add-interrupt-support">
<h3>Add Interrupt Support<a class="headerlink" href="#add-interrupt-support" title="Permalink to this heading">¶</a></h3>
<p>V++ linker can automatically link the interrupt signals between kernel and platform. The available interrupt signals in the platform are exported by <strong>PFM.IRQ</strong> property.</p>
<p>For simple designs, interrupt signals can be sourced by processor’s <strong>pl_ps_irq</strong>. The limitation is that it can only supply maximum 16 interrupt signals. To supply more interrupt signals, we can use <strong>AXI Interrupt Controller</strong>. We will enable <strong>AXI HPM0 LPD</strong> to control the <strong>AXI Interrupt Controller</strong>, add the <strong>AXI Interrupt Controller</strong> and enable interrupt signals for <strong>PFM.IRQ</strong>. Here are the detailed steps.</p>
<ol>
<li><p>Enable <strong>AXI HPM0 LPD</strong> to control the <strong>AXI Interrupt Controller</strong></p>
<ul class="simple">
<li><p>In the block diagram, double-click the <strong>Zynq UltraScale+ MPSoC</strong> block.</p></li>
<li><p>Select <strong>PS-PL Configuration &gt; PS-PL interfaces &gt; Master interface</strong>.</p></li>
<li><p>Enable the <strong>AXI HPM0 LPD</strong> option.</p></li>
<li><p>Expand the arrow before <strong>AXI HPM0 LPD</strong>. Check the <strong>AXI HPM0 LPD Data width</strong> settings and keep it as default <strong>32</strong>.</p></li>
<li><p>Disable <strong>AXI HPM0 FPD</strong> and <strong>AXI HPM1 FPD</strong></p></li>
<li><p>Click <strong>OK</strong> to finish the configuration.</p></li>
</ul>
<p><strong>Note</strong>:</p>
<ul class="simple">
<li><p>We use <strong>AXI HPM0 LPD</strong> for controlling purpose. It would read and write 32-bit control registers. If the interface is more than 32, AXI Interconnect or SmartConnect will do AXI bus width conversion using PL logic. It would cost logic resource and introduce unnecessary latency.</p></li>
<li><p>We reserve <strong>AXI HPM0 FPD</strong> and <strong>AXI HPM1 FPD</strong> for kernel usage. Disabling them from the block diagram can prevent auto connection to use it by accident. We can export the unused AXI interfaces in Platform Setup, no matter it is visible in the block diagram or not.</p></li>
</ul>
</li>
<li><p>Add the <strong>AXI Interrupt Controller</strong> and configure it</p>
<ul class="simple">
<li><p>Right click Diagram view and select <strong>Add IP</strong>, search and add <strong>AXI Interrupt Controller</strong> IP. It is instantiated as <strong>axi_intc_0</strong>.</p></li>
<li><p>Double click the AXI Interrupt Controller block, change <strong>Interrupt Output Connection</strong> to <strong>Single</strong> so that it can be connected to PS IRQ interface.</p></li>
<li><p>Click <strong>OK</strong>.</p></li>
</ul>
</li>
<li><p>Connect AXI Interfaces of axi_intc_0 to AXI HPM0 LPD of PS</p>
<ul class="simple">
<li><p>Click <strong>Run Connection Automation</strong></p></li>
<li><p>Review the settings (<strong>axi_intc_0</strong> is enabled, <strong>s_axi</strong> Master interface is to be connect to <strong>/zynq_ultra_ps_e_0/M_AXI_HPM0_LPD</strong>)</p></li>
<li><p>Set <strong>Clock Source for Slave Interface</strong> and <strong>Clock Source for Master Interface</strong> to <strong>/clk_wiz_0/clk_out2(200 MHz)</strong></p></li>
<li><p>Click <strong>OK</strong></p></li>
</ul>
<p>Note:</p>
<ul class="simple">
<li><p>We wish interrupt controller and most kernel IRQ signals are synchronous to one clock. It is best for stability. But do not worry about the asynchronous IRQ if kernels are running at different clocks. The interrupt controller can manage asynchronous IRQ with level interrupt signals as well.</p></li>
</ul>
</li>
<li><p>Connect irq of the Interrupt Controller</p>
<ul class="simple">
<li><p>Connect <strong>axi_intc_0.irq</strong> to <strong>zynq_ultra_ps_e_0.pl_ps_irq[0:0]</strong></p></li>
</ul>
<p>Note:</p>
<ul class="simple">
<li><p>If you have more than one irq signals to connect to pl_ps_irq of PS, use a <strong>concat</strong> IP to concatenate them to a bus and then connect the bus to pl_ps_irq.</p></li>
</ul>
</li>
<li><p>Enable interrupt signals for the platform.</p>
<ul class="simple">
<li><p>Go to Platform Setup tab</p></li>
<li><p>Go to Interrupt tab</p></li>
<li><p>Enable intr under axi_intc_0</p></li>
<li><p>Tcl console shows the corresponding tcl command for this setup:</p></li>
</ul>
</li>
</ol>
<p>The IPI design connection would like below till now:</p>
<p><img alt="ipi_fully_connection.png" src="../../../../_images/ipi_fully_connection.png" /></p>
</section>
<section id="enable-axi-interfaces-for-the-platform">
<h3>Enable AXI Interfaces for the Platform<a class="headerlink" href="#enable-axi-interfaces-for-the-platform" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>Enable AXI Master interfaces from PS</p>
<ul class="simple">
<li><p>Go to <strong>Platform Setup</strong> tab</p></li>
<li><p>Go to <strong>AXI Port</strong> tab in Platform Setup</p></li>
<li><p>Under <strong>zynq_ultra_ps_e_0</strong>, enable <strong>M_AXI_HPM0_FPD</strong> and <strong>M_AXI_HPM1_FPD</strong>. Keep the Memport and sptag default to M_AXI_GP and empty.</p></li>
</ul>
<p>Note:</p>
<ul class="simple">
<li><p>M_AXI_GP means general purpose AXI Master interface</p></li>
<li><p>sptag is only applicable to AXI slave interfaces.</p></li>
<li><p>v++ linker will instantiate AXI Interconnect automatically to connect between PS AXI Master interfaces and slave interfaces of acceleration kernels. One AXI Master interface will connect up to 16 kernels.</p></li>
</ul>
</li>
<li><p>Enable AXI Master interfaces from AXI Interconnect</p>
<ul class="simple">
<li><p>Under ps8_0_axi_periph, click M01_AXI, press Shift and click M07_AXI to multi-select master interfaces from M01_AXI to M07_AXI.</p></li>
<li><p>Right click the selection and click on <strong>Enable</strong>.</p></li>
<li><p>Keep the Memport and sptag default to M_AXI_GP and empty.</p></li>
</ul>
<p>Note:</p>
<ul class="simple">
<li><p>v++ will not cascade another level of AXI Interconnect if the AXI master interface is exported from AXI Interconnect IP.</p></li>
<li><p>AXI Master interfaces from PS and AXI Interconnect are functionally equivalent to the platform.</p></li>
<li><p>In general, platform designer should export as many as AXI interfaces to the platform. Application developer should decide which interface to use.</p></li>
</ul>
</li>
<li><p>Enable AXI Slave interfaces from PS to allow kernels access DDR memory</p>
<ul class="simple">
<li><p>Under zynq_ultra_ps_e_0, multi-select all AXI slave interfaces: press <strong>Ctrl</strong> and click <strong>S_AXI_HPC0_FPD</strong>, <strong>S_AXI_HPC1_FPD</strong>, <strong>S_AXI_HP0_FPD</strong>, <strong>S_AXI_HP1_FPD</strong>, <strong>S_AXI_HP2_FPD</strong>, <strong>S_AXI_HP3_FPD</strong>.</p></li>
<li><p>Right click the selections and select <strong>enable</strong>.</p></li>
<li><p>Change Memport of <strong>S_AXI_HPC0_FPD</strong> and <strong>S_AXI_HPC1_FPD</strong> to <strong>S_AXI_HP</strong> because we will not use any coherent features for these interfaces.</p></li>
<li><p>Type in simple sptag names for these interfaces so that they can be selected by v++ configuration during linking phase. <strong>HPC0</strong>, <strong>HPC1</strong>, <strong>HP0</strong>, <strong>HP1</strong>, <strong>HP2</strong>, <strong>HP3</strong>.</p></li>
</ul>
<p><img alt="Platform Setup - AXI Ports" src="../../../../_images/platform_setup_interfaces.png" /></p>
</li>
</ol>
</section>
<section id="emulation-setup-optional">
<h3>Emulation Setup (Optional)<a class="headerlink" href="#emulation-setup-optional" title="Permalink to this heading">¶</a></h3>
<p>This step is only needed when creating an emulation-capable platform.</p>
<p>When a component comes with multiple types of simulation models, selecting SystemC TLM (Transaction-level Modeling) model would run much faster than RTL model. For Processing System component, it is mandatory to use TLM for Hardware Emulation.</p>
<ol class="simple">
<li><p>Change PS simulation model to tlm</p>
<ul class="simple">
<li><p>Select the PS instance <strong>zynq_ultra_ps_e_0</strong> in the block diagram</p></li>
<li><p>check the <strong>Block Properties</strong> window.</p></li>
<li><p>In <strong>Properties</strong> tab, it shows <code class="docutils literal notranslate"><span class="pre">ALLOWED_SIM_MODELS=tlm,rtl</span></code>. It means this component supports two types of simulation models.</p></li>
<li><p>Scroll down to <code class="docutils literal notranslate"><span class="pre">SELECTED_SIM_MODEL</span></code> property. Change it from <strong>rtl</strong> to <strong>tlm</strong> to select to use TLM model.</p></li>
</ul>
</li>
</ol>
</section>
<section id="export-hardware-xsa">
<h3>Export Hardware XSA<a class="headerlink" href="#export-hardware-xsa" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>Validate the block design</p>
<ul class="simple">
<li><p>Click the <strong>Validate Design</strong> button in the block design Diagram window</p></li>
</ul>
<p><strong>Note</strong>: During validation, Vivado reports a critical warning that <strong>/axi_intc_0/intr</strong> is not connected. This warning can be safely ignored because v++ linker will link kernel interrupt signals to this floating intr signal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CRITICAL WARNING: [BD 41-759] The input pins (listed below) are either not connected or do not have a source port, and they do not have a tie-off specified. These pins are tied-off to all 0&#39;s to avoid error in Implementation flow.
Please check your design and connect them as needed: 
/axi_intc_0/intr
</pre></div>
</div>
</li>
<li><p>Create a top module wrapper for the block design</p>
<ul class="simple">
<li><p>In <strong>Source</strong> tab, right click <strong>system.bd</strong> in Design Sources group</p></li>
<li><p>Select <strong>Create HDL Wrapper…</strong></p></li>
<li><p>Select <strong>Let Vivado manage wrapper and auto-update</strong>.</p></li>
<li><p>Click <strong>OK</strong> to generate wrapper for block design.</p></li>
</ul>
</li>
<li><p>Generate the design</p>
<ul class="simple">
<li><p>Select <strong>Generate Block Design</strong> from Flow Navigator</p></li>
<li><p>Select <strong>Synthesis Options</strong> to <strong>Global</strong>. It will skip IP synthesis during generation.</p></li>
<li><p>Click <strong>Generate</strong>.</p></li>
<li><p>Click <strong>Generate Bitstream</strong> in Flow Navigator window.</p></li>
<li><p>Click <strong>Yes</strong>.</p></li>
</ul>
</li>
<li><p>Export the platform</p>
<ul class="simple">
<li><p>Click menu <strong>File -&gt; Export -&gt; Export Platform</strong> to launch the <strong>Export Hardware Platform</strong> wizard. This wizard can also be launched by <strong>Export Platform</strong> button in <strong>Flow Navigator</strong> or <strong>Platform Setup</strong> window.</p></li>
<li><p>Click Next in the first information page.</p></li>
<li><p>Select Platform Type: <strong>Hardware and Hardware Emulation</strong>, click Next. If you skipped the emulation setup previously, select <strong>Hardware</strong> here.</p></li>
<li><p>Select Platform State: <strong>Pre-synthesis</strong>, enable <strong>Include Bitstream</strong>, click Next</p></li>
<li><p>Input Platform Properties and click <strong>Next</strong>. For example,</p>
<ul>
<li><p>Name: kv260_custom_platform</p></li>
<li><p>Vendor: xilinx</p></li>
<li><p>Board: kv260</p></li>
<li><p>Version: 0.0</p></li>
<li><p>Description: This platform provides high PS DDR bandwidth and three clocks: 100MHz, 200MHz and 400MHz.</p></li>
</ul>
</li>
<li><p>Fill in XSA file name: <strong>kv260_custom_platform</strong> and keep the export directory as default.</p></li>
<li><p>Click <strong>Finish</strong>.</p></li>
<li><p><strong>kv260_custom_platform.xsa</strong> will be generated. The export path is reported in the Tcl console.</p></li>
</ul>
<blockquote>
<div><p>Note: We enable Include Bitstream to fulfill the requirement of the fpga-manager-util package in PetaLinux.</p>
</div></blockquote>
<p>Alternatively, the above export can be done in Tcl scripts</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c"># Setting platform properties</span>
<span class="nv">set_property</span><span class="w"> </span>platform.default_output_type<span class="w"> </span><span class="s2">&quot;sd_card&quot;</span><span class="w"> </span><span class="k">[</span><span class="nv">current_project</span><span class="k">]</span>
<span class="nv">set_property</span><span class="w"> </span>platform.design_intent.embedded<span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="k">[</span><span class="nv">current_project</span><span class="k">]</span>
<span class="nv">set_property</span><span class="w"> </span>platform.design_intent.server_managed<span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="k">[</span><span class="nv">current_project</span><span class="k">]</span>
<span class="nv">set_property</span><span class="w"> </span>platform.design_intent.external_host<span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="k">[</span><span class="nv">current_project</span><span class="k">]</span>
<span class="nv">set_property</span><span class="w"> </span>platform.design_intent.datacenter<span class="w"> </span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="k">[</span><span class="nv">current_project</span><span class="k">]</span>
<span class="c"># Write pre-synthesis expandable XSA</span>
<span class="nv">write_hw_platform</span><span class="w"> </span><span class="o">-</span>include_bit<span class="w"> </span><span class="o">-</span>force<span class="w"> </span><span class="o">-</span>file<span class="w"> </span>.<span class="o">/</span>kv260_custom_platform.xsa
</pre></div>
</div>
</li>
</ol>
</section>
<section id="next-step">
<h3>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h3>
<p>Now we finish the Hardware platform creation flow, then we should go to the <a class="reference internal" href="step2.html"><span class="doc">Step2: Software platform creation</span></a></p>
<p class="sphinxhide" align="center"><sup>Copyright&copy; 2021 Xilinx</sup></p></section>
</section>
</section>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on July 27, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="https://pages.gitenterprise.xilinx.com/techdocs/Test/vvas/build/html/index.html#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>