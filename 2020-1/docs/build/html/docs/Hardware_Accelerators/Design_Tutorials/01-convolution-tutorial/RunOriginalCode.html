<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>1. Evaluating the Original Application &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../README.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../README.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../README.html" class="icon icon-home"></a> &raquo;</li>
      <li>1. Evaluating the Original Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/RunOriginalCode.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2019.2 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="evaluating-the-original-application">
<h1>1. Evaluating the Original Application<a class="headerlink" href="#evaluating-the-original-application" title="Permalink to this heading">¶</a></h1>
<p>The C application used in this tutorial performs a 2D convolution of a given set of filter coefficients and an RGBA video.
The application uses FFmpeg to create input and output video streams that are used as a pipe for reading each frame of the input video and writing out the corresponding processed frame.</p>
<p><img alt="../../../../_images/ffmpeg_usage.png" src="../../../../_images/ffmpeg_usage.png" /></p>
<p>In this step, you build and run this application to create baseline performance data for the original, non-accelerated application. You also save the output of the original application as golden data to compare with and verify the output of the hardware accelerated application.</p>
<div class="section" id="build-the-c-application">
<h2>Build the C Application<a class="headerlink" href="#build-the-c-application" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">cpu_src</span></code> directory for the original application code.</p></li>
<li><p>Execute the following <code class="docutils literal notranslate"><span class="pre">make</span></code> command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">convolution</span><span class="o">-</span><span class="n">tutorial</span><span class="o">/</span><span class="n">design</span><span class="o">/</span><span class="n">cpu_src</span>
<span class="n">make</span>
</pre></div>
</div>
</li>
</ol>
<p>The command compiles the C source code and builds the <code class="docutils literal notranslate"><span class="pre">convolve</span></code> executable. The executable requires the path to a video file; in this case, one is in the project root directory.</p>
<blockquote>
<div><p><strong>TIP:</strong> The Makefile used in this lab is detailed and contains many steps and variables. For a discussion of the structure and contents of the Makefile, refer to <a class="reference internal" href="HowToRunTutorial.html"><span class="doc">Understanding the Makefile</span></a>.</p>
</div></blockquote>
</div>
<div class="section" id="run-the-c-application-and-generate-the-golden-result">
<h2>Run the C Application and Generate the Golden Result<a class="headerlink" href="#run-the-c-application-and-generate-the-golden-result" title="Permalink to this heading">¶</a></h2>
<p>In this step, run the original C application with a specified input video file in different formats, and generate the corresponding golden output files for comparison purposes using the following commands.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">convolution</span><span class="o">-</span><span class="n">tutorial</span><span class="o">/</span><span class="n">design</span><span class="o">/</span><span class="n">cpu_src</span>
<span class="n">make</span> <span class="n">golden</span>
</pre></div>
</div>
<p>The first output file generated, <code class="docutils literal notranslate"><span class="pre">golden_out_full.mp4</span></code> is a full movie with 132 frames. Each frame is 1980x1080 pixels. This golden output file is used for all hardware runs as applications can run very quickly on hardware. However, for emulation, you use smaller files with only one frame for a quicker turnaround.</p>
<p>Here is the summary of the generated golden output files.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">golden_out_full.mp4</span></code>: Used for testing the accelerated application when running on hardware.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">golden_out_small.mp4</span></code>: Used for testing software and hardware emulation runs, except in Step 5: Using Out-ofOrder Queues and Multiple Compute Units.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">golden_out_small_40.mp4</span></code>: Used for testing in Step 5: Using Out-of-Order Queues and Multiple Compute Units.</p></li>
</ul>
</div>
<div class="section" id="profile-the-application-and-establish-performance-goals">
<h2>Profile the Application and Establish Performance Goals<a class="headerlink" href="#profile-the-application-and-establish-performance-goals" title="Permalink to this heading">¶</a></h2>
<p>As stated in the <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2020.1%3Bt=vitis+doc%3Bd=methodologyacceleratingapplications.html">Methodology for Accelerating Applications with the Vitis Unified Software Platform</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416), you can use the <code class="docutils literal notranslate"><span class="pre">gprof</span></code> tool to profile the application and identify potential functions for acceleration.</p>
<ol>
<li><p>Add the <code class="docutils literal notranslate"><span class="pre">-pg</span></code> option in the gcc command line.</p>
<p>This is already done in the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>.</p>
</li>
<li><p>Change directory into the <code class="docutils literal notranslate"><span class="pre">cpu_src</span></code> folder and run <code class="docutils literal notranslate"><span class="pre">make</span></code> to generate the executable file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">cpu_src</span>
</pre></div>
</div>
</li>
<li><p>Run the executable file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">convolve</span> <span class="o">--</span><span class="n">gray</span> <span class="n">true</span> <span class="o">../</span><span class="n">video</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
</li>
<li><p>Extract the profile result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gprof</span> <span class="n">convolve</span> <span class="n">gmon</span><span class="o">.</span><span class="n">out</span><span class="o">&gt;</span> <span class="n">gprofresult</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</li>
<li><p>To view the Profile Summary report, open the <code class="docutils literal notranslate"><span class="pre">gprofresult.txt</span></code> file in a text editor. You should see results similar to the following table.</p>
<p>Each sample counts as 0.01 seconds.</p>
</li>
</ol>
<table border="1" class="docutils">
<thead>
<tr>
<th align="right">% Time</th>
<th align="right">Cumulative Seconds</th>
<th align="right">Self Seconds</th>
<th align="right">Total Calls</th>
<th align="right">ms/Call</th>
<th align="right">ms/Call</th>
<th align="left">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">95.29</td>
<td align="right">7.28</td>
<td align="right">7.28</td>
<td align="right">132</td>
<td align="right">55.15</td>
<td align="right">55.15</td>
<td align="left">convolve_cpu</td>
</tr>
<tr>
<td align="right">4.85</td>
<td align="right">7.65</td>
<td align="right">0.37</td>
<td align="right">132</td>
<td align="right">2.81</td>
<td align="right">2.81</td>
<td align="left">grayscale_cpu</td>
</tr>
<tr>
<td align="right">0.00</td>
<td align="right">7.65</td>
<td align="right">0.00</td>
<td align="right">132</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="left">print_progress(int, int)</td>
</tr>
<tr>
<td align="right">0.00</td>
<td align="right">7.65</td>
<td align="right">0.00</td>
<td align="right">1</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="left">GLOBAL__sub_I_default_output</td>
</tr>
</tbody>
</table><p>The report indicates that the convolve_cpu uses 95% of the execution time. Accelerating that function will significantly improve the total performance.</p>
<div class="section" id="determine-the-maximum-achievable-throughput">
<h3>Determine the Maximum Achievable Throughput<a class="headerlink" href="#determine-the-maximum-achievable-throughput" title="Permalink to this heading">¶</a></h3>
<p>In most FPGA-accelerated systems, the maximum achievable throughput is limited by the PCIe® bus. The PCIe performance is influenced by many different aspects, such as motherboard, drivers, targeted shell, and transfer sizes. The Vitis core development kit provides a utility, <code class="docutils literal notranslate"><span class="pre">xbutil</span></code>, and you can run the <code class="docutils literal notranslate"><span class="pre">xbutil</span> <span class="pre">dmatest</span></code> command to measure the maximum PCIe bandwidth it can achieve. The throughput on your design target cannot exceed this upper limit.</p>
</div>
<div class="section" id="establish-overall-acceleration-goals">
<h3>Establish Overall Acceleration Goals<a class="headerlink" href="#establish-overall-acceleration-goals" title="Permalink to this heading">¶</a></h3>
<p>On the CPU, it takes 19.25 seconds to process 132 1920x1080 frames. This means you are achieving a performance of 132/19.25 = &lt;7 frames per second (fps). You want your application to achieve a minimum real-time performance of 30 fps, so you need to accelerate it by a factor of ~5x compared to the CPU.</p>
<p>Given that the size of a frame is 1920 x 1080 x 4bytes = 8.29 MB, this means that, in absolute terms, your accelerated application must deliver a minimum throughput of 8.29 MB x 30 fps = 249 MB/s.</p>
<p>This throughput goal is well within the bounds of maximum achievable throughput of an Alveo Data Center accelerator card. This tutorial will walk you through a predictable process for achieving that goal.</p>
</div>
</div>
<div class="section" id="next-step">
<h2>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>You have identified the functions from the original application that are targets for acceleration and established the performance goals. In the following labs, you will create a baseline of the original <code class="docutils literal notranslate"><span class="pre">convolve</span></code> function running in hardware and perform a series of host and kernel code optimizations to meet your performance goals. You begin by <a class="reference internal" href="baseline.html"><span class="doc">creating a Vitis core development kit application</span></a> from the original application.</p>
<p>You will use Hardware Emulation runs for measuring performance in each step. As part of the final step, you can run all these steps in hardware to demonstrate how the performance was improved at each step.
</br></p>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/docs/vitis-getting-started/README.md">Return to Getting Started Pathway</a> — <a href="/docs/convolution-tutorial/README.md">Return to Start of Tutorial</a></b></p><p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>