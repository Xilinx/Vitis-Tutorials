<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>2. Creating a Vitis Core Development Kit Application from the C Application &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../README.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../README.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../README.html" class="icon icon-home"></a> &raquo;</li>
      <li>2. Creating a Vitis Core Development Kit Application from the C Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/baseline.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2019.2 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="creating-a-vitis-core-development-kit-application-from-the-c-application">
<h1>2. Creating a Vitis Core Development Kit Application from the C Application<a class="headerlink" href="#creating-a-vitis-core-development-kit-application-from-the-c-application" title="Permalink to this heading">¶</a></h1>
<p>In the last lab, you determined that the <code class="docutils literal notranslate"><span class="pre">convolve_cpu</span></code> function is where the bulk of time is spent in the application. To accelerate performance, you are going to move that function into a kernel to run on the FPGA accelerator card.</p>
<p>This lab discusses the process for converting a C function into a hardware kernel and evaluating its performance. You will also establish the baseline performance numbers for the accelerated application that you will use to compare to each additional optimization in the subsequent labs. You are going to take your first FPGA kernel and run it on a fixed image size. Because you will be running your kernel in hardware emulation, you will use a smaller image size. For now, set the image size to 512x10.</p>
<p>To measure the performance, you will use the Profile Summary and Timeline Trace reports. For details about these reports, refer to the <a class="reference external" href="../Pathway3/ProfileAndTraceReports">Generating Profile and Trace Reports</a> lab in the Essential Concepts for Building and Running the Accelerated Application tutorial.</p>
<div class="section" id="kernel-code-modifications">
<h2>Kernel Code Modifications<a class="headerlink" href="#kernel-code-modifications" title="Permalink to this heading">¶</a></h2>
<p>Use the following instructions to convert the C code into kernel code and convert the <code class="docutils literal notranslate"><span class="pre">convolve_cpu</span></code> function into a hardware accelerated kernel to run on the FPGA.</p>
<blockquote>
<div><p><strong>TIP:</strong> The completed kernel source file is provided in the <code class="docutils literal notranslate"><span class="pre">reference-files/baseline</span></code> folder. You can use it as a reference if needed.</p>
</div></blockquote>
<ol>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">convolve_kernel.cpp</span></code> file in the <code class="docutils literal notranslate"><span class="pre">cpu_src</span></code> folder, and make a copy called <code class="docutils literal notranslate"><span class="pre">convolve_fpga.cpp</span></code>.</p></li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">convolve_fpga.cpp</span></code> file and rename the <code class="docutils literal notranslate"><span class="pre">convolve_cpu</span></code> function to <code class="docutils literal notranslate"><span class="pre">convolve_fpga</span></code>.</p></li>
<li><p>Add the following HLS INTERFACE pragmas at the beginning of the function, within the braces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1">#pragma HLS INTERFACE s_axilite port=return bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=inFrame bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=outFrame bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=coefficient bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=coefficient_size bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=img_width bundle=control</span>
 <span class="c1">#pragma HLS INTERFACE s_axilite port=img_height bundle=control</span>
</pre></div>
</div>
<p>The FPGA kernel must have a single AXI4-Lite slave control interface (<code class="docutils literal notranslate"><span class="pre">s_axilite</span></code>) which allows the host application to configure and communicate with the kernel. All function arguments including the <em>return</em> must be mapped to this <code class="docutils literal notranslate"><span class="pre">control</span></code> interface using dedicated pragmas.</p>
</li>
<li><p>Each pointer argument must also be mapped to an AXI memory mapped master port (<code class="docutils literal notranslate"><span class="pre">m_axi</span></code>) using a dedicated pragma. Add the following pragmas to the function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="c1">#pragma HLS INTERFACE m_axi port=inFrame offset=slave bundle=gmem1</span>
 <span class="c1">#pragma HLS INTERFACE m_axi port=outFrame offset=slave bundle=gmem1</span>
 <span class="c1">#pragma HLS INTERFACE m_axi port=coefficient offset=slave bundle=gmem2</span>
</pre></div>
</div>
<p>The AXI Master ports are used by the kernel to access data in the global memory. The base address of the data (<code class="docutils literal notranslate"><span class="pre">offset</span></code>) is provided to the kernel through the previously defined control interface (<code class="docutils literal notranslate"><span class="pre">slave</span></code>). The <em>bundle</em> property of the pragma allows you to name the interface ports. In this example, the function has three pointer arguments, but the kernel will have two ports, <code class="docutils literal notranslate"><span class="pre">gmem1</span></code> and <code class="docutils literal notranslate"><span class="pre">gmem2</span></code>. The <code class="docutils literal notranslate"><span class="pre">gmem1</span></code> port will be used to read <code class="docutils literal notranslate"><span class="pre">inFrame</span></code> and write <code class="docutils literal notranslate"><span class="pre">outFrame</span></code>, and the <code class="docutils literal notranslate"><span class="pre">gmem2</span></code> port will be used to read <code class="docutils literal notranslate"><span class="pre">coefficient</span></code>.</p>
<blockquote>
<div><p><strong>NOTE:</strong> For more details about pragmas, refer to the <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2019_2/vitis_doc/yxl1556143111967.html">Vitis Environment Reference Materials</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p>
</div></blockquote>
</li>
<li><p>Save the <code class="docutils literal notranslate"><span class="pre">convolve_fpga.cpp</span></code> file.</p></li>
</ol>
</div>
<div class="section" id="run-hardware-emulation">
<h2>Run Hardware Emulation<a class="headerlink" href="#run-hardware-emulation" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Go to the <code class="docutils literal notranslate"><span class="pre">makefile</span></code> directory and use the following command to run hardware emulation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">design</span><span class="o">/</span><span class="n">makefile</span>
<span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw_emu</span> <span class="n">STEP</span><span class="o">=</span><span class="n">baseline</span> <span class="n">NUM_FRAMES</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>TIP:</strong> The modifications based on each lab can made from the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory. The completed code is also provided for all the optimizations in this lab. You do not need to modify the code if you just want to run the results. You can enable this by adding <code class="docutils literal notranslate"><span class="pre">SOLUTION=1</span></code> to the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw_emu</span> <span class="n">STEP</span><span class="o">=</span><span class="n">baseline</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span> <span class="n">NUM_FRAMES</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
<p>You should see the following text in the console both during and after the application has finished executing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Processed</span> <span class="mf">0.02</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">3241.206</span><span class="n">s</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">MBps</span><span class="p">)</span>

<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">Vitis</span><span class="o">-</span><span class="n">EM</span> <span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">Wall</span> <span class="n">clock</span> <span class="n">time</span><span class="p">:</span> <span class="mi">23</span><span class="p">:</span><span class="mi">56</span><span class="p">,</span> <span class="n">Emulation</span> <span class="n">time</span><span class="p">:</span> <span class="mf">9.17236</span> <span class="n">ms</span><span class="p">]</span> <span class="n">Data</span> <span class="n">transfer</span> <span class="n">between</span> <span class="n">kernel</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="k">global</span> <span class="n">memory</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">convolve_fpga_1</span><span class="p">:</span><span class="n">m_axi_gmem1</span><span class="o">-</span><span class="n">DDR</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">167.781</span> <span class="n">KB</span>             <span class="n">WR</span> <span class="o">=</span> <span class="mf">20.000</span> <span class="n">KB</span>
<span class="n">convolve_fpga_1</span><span class="p">:</span><span class="n">m_axi_gmem2</span><span class="o">-</span><span class="n">DDR</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">167.781</span> <span class="n">KB</span>             <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>
</pre></div>
</div>
<p>The first line prints the clock time and the emulation time of the previous run. The clock time is the current system time, and the emulation time is the time the emulator simulated for this run. The subsequent lines display the data size that was transferred between the FPGA and on-board FPGA RAM.</p>
</li>
</ol>
</div>
<div class="section" id="view-profile-summary-for-hardware-emulation">
<h2>View Profile Summary for Hardware Emulation<a class="headerlink" href="#view-profile-summary-for-hardware-emulation" title="Permalink to this heading">¶</a></h2>
<ol>
<li><p>Use the following command to view the Profile Summary report.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">view_run_summary</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw_emu</span> <span class="n">STEP</span><span class="o">=</span><span class="n">baseline</span>
</pre></div>
</div>
</li>
<li><p>Now, look at the Profile Summary report. In the <em>Kernel Execution</em> section, you can see that the kernel execution time is 3.903 ms. This number will be used to measure the performance boost after each optimization step.</p></li>
<li><p>The <em>Kernels to Global Memory</em> section shows that the average bytes per transfer is only 4 bytes, which will impact the performance.</p></li>
<li><p>Also, the number of transfers is 91024, which seems to be too much for the required data transfer times. In the next sections, you will optimize on those areas.</p></li>
<li><p>Record the performance results from the Profile Summary report and fill in the following table. Your numbers might vary.</p>
<p>For this lab, keep track of the following information:</p>
</li>
</ol>
<ul class="simple">
<li><p><strong>Time</strong>: The hardware emulation time. Retrieved from the Profile Summary report listed in the <em>Top Kernel Execution</em> section under <em>Duration</em>.</p></li>
<li><p><strong>Kernel</strong>: The name of the kernel.</p></li>
<li><p><strong>Image Size</strong>: The size and shape of the images.</p></li>
<li><p><strong>Reads</strong>: The number of bytes read from the on-board RAM. Printed in the Console window and listed in the Profile Summary report.</p></li>
<li><p><strong>Writes</strong>: The number of bytes written to the on-board RAM. Printed in the Console window and listed in the Profile Summary report.</p></li>
<li><p><strong>Avg. Read</strong>: The average read size of each memory transaction. Retrieved from the Profile Summary report in the <em>Data Transfer</em> tab under the <em>Data Transfer: Kernels and Global Memory</em> section.</p></li>
<li><p><strong>Avg. Write</strong>: The average write size of each memory transaction. Retrieved from the Profile Summary report in the <em>Data Transfer</em> tab under the <em>Data Transfer: Kernels and Global Memory</em> section.</p></li>
<li><p><strong>BW</strong>: The bandwidth is calculated by (512x10x4)/Time.</p></li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">Step</th>
<th align="left">Image Size</th>
<th align="right">Time (HW-EM)(ms)</th>
<th align="right">Reads (KB)</th>
<th align="right">Writes (KB)</th>
<th align="right">Avg. Read (KB)</th>
<th align="right">Avg. Write (KB)</th>
<th align="right">BW (MBps)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">baseline</td>
<td align="left">512x10</td>
<td align="right">3.903</td>
<td align="right">344</td>
<td align="right">20.0</td>
<td align="right">0.004</td>
<td align="right">0.004</td>
<td align="right">5.2</td>
</tr>
</tbody>
</table></div>
<div class="section" id="next-step">
<h2>Next Step<a class="headerlink" href="#next-step" title="Permalink to this heading">¶</a></h2>
<p>You have created the hardware kernel and run the application in hardware emulation mode. You will now begin to examine data transfers between the host application and the kernel and determine some good strategies for <a class="reference internal" href="localbuf.html"><span class="doc">optimizing memory transfers</span></a>.
</br></p>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/docs/vitis-getting-started/README.md">Return to Getting Started Pathway</a> — <a href="/docs/convolution-tutorial/README.md">Return to Start of Tutorial</a></b></p><p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>