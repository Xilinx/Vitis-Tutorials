<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>8. Running the Accelerator in Hardware &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../README.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../README.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../README.html" class="icon icon-home"></a> &raquo;</li>
      <li>8. Running the Accelerator in Hardware</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/RunOnHardware.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2019.2 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="running-the-accelerator-in-hardware">
<h1>8. Running the Accelerator in Hardware<a class="headerlink" href="#running-the-accelerator-in-hardware" title="Permalink to this heading">¶</a></h1>
<p>Until now, all results from the previous labs were run in Hardware Emulation mode to give you an idea of how the optimization improves performance, while reducing the compilation time needed to build the system. In this section, you will build and run each of the previous optimizations in hardware on an Alveo Data Center accelerator card.</p>
<p>After each run is finished, record the performance data printed out by host application, and fill in the table at the end of the section. Your numbers might vary.<br />Note the following data:</p>
<ul class="simple">
<li><p><strong>Total Data</strong>: Calculated by (<code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">Frames</span> <span class="pre">*</span> <span class="pre">Frame</span> <span class="pre">Size</span></code>).</p></li>
<li><p><strong>Total Time</strong>: Taken from the Timeline Trace report. For a fair comparison, this will include the data transfer and kernel execution time.</p></li>
<li><p><strong>Throughput</strong>: Calculated by <code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">Data</span> <span class="pre">Processed</span> <span class="pre">(MB)/Total</span> <span class="pre">Time(s)</span></code></p></li>
</ul>
<blockquote>
<div><p><strong>IMPORTANT</strong>: Each of the steps in this lab compiles the hardware kernel and can take significant time to complete.</p>
</div></blockquote>
<div class="section" id="run-the-baseline-application-on-hardware">
<h2>Run the Baseline Application on Hardware<a class="headerlink" href="#run-the-baseline-application-on-hardware" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>IMPORTANT</strong>: Make sure the <code class="docutils literal notranslate"><span class="pre">nk</span></code> option in <code class="docutils literal notranslate"><span class="pre">design.cfg</span></code> was set to 1.</p>
</div></blockquote>
<p>Use the following command to build and run the baseline design on hardware. At the end of execution, host application will print out the kernel execution time and throughput numbers. You will add the numbers to the table for benchmarking.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">STEP</span><span class="o">=</span><span class="n">baseline</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>The following printed out messages will display:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FPGA</span> <span class="n">Time</span><span class="p">:</span>       <span class="mf">701.888</span> <span class="n">s</span>
<span class="n">FPGA</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">1.48762</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>

<span class="n">Processed</span> <span class="mf">7.91</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">703.580</span><span class="n">s</span> <span class="p">(</span><span class="mf">1.48</span> <span class="n">MBps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-memory-transfer-lab-on-hardware">
<h2>Run the Memory Transfer Lab on Hardware<a class="headerlink" href="#run-the-memory-transfer-lab-on-hardware" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>IMPORTANT</strong>: Make sure the <code class="docutils literal notranslate"><span class="pre">nk</span></code> option in design.cfg was set to 1.</p>
</div></blockquote>
<p>Use the following commands to run the localbuf version design on the hardware.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">STEP</span><span class="o">=</span><span class="n">localbuf</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>From the performance number printed out by host application, the execution time was improved a lot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FPGA</span> <span class="n">Time</span><span class="p">:</span>       <span class="mf">86.7961</span> <span class="n">s</span>
<span class="n">FPGA</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">12.0298</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>


<span class="n">Processed</span> <span class="mf">7.91</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">91.883</span><span class="n">s</span> <span class="p">(</span><span class="mf">11.36</span> <span class="n">MBps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="run-fixed-point-lab-on-hardware">
<h2>Run Fixed Point Lab on Hardware<a class="headerlink" href="#run-fixed-point-lab-on-hardware" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>IMPORTANT</strong>: Make sure the <code class="docutils literal notranslate"><span class="pre">nk</span></code> option in design.cfg is set to 1.</p>
</div></blockquote>
<ol>
<li><p>Build and run the fixedpoint version design on hardware.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">STEP</span><span class="o">=</span><span class="n">fixedpoint</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Record the performance numbers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FPGA</span> <span class="n">Time</span><span class="p">:</span>       <span class="mf">27.2872</span> <span class="n">s</span>
<span class="n">FPGA</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">38.2649</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>


<span class="n">Processed</span> <span class="mf">7.91</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">32.290</span><span class="n">s</span> <span class="p">(</span><span class="mf">32.34</span> <span class="n">MBps</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="run-dataflow-lab-on-hardware">
<h2>Run Dataflow Lab on Hardware<a class="headerlink" href="#run-dataflow-lab-on-hardware" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>IMPORTANT</strong>: Make sure the <code class="docutils literal notranslate"><span class="pre">nk</span></code> option in design.cfg is set to 1.</p>
</div></blockquote>
<ol>
<li><p>Build and run the dataflow version design on hardware.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">STEP</span><span class="o">=</span><span class="n">dataflow</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
<li><p>Record the performance number.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FPGA</span> <span class="n">Time</span><span class="p">:</span>   <span class="mf">3.66991</span> <span class="n">s</span>
<span class="n">FPGA</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">284.514</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>

<span class="n">Processed</span> <span class="mf">7.91</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">7.996</span><span class="n">s</span> <span class="p">(</span><span class="mf">130.58</span> <span class="n">MBps</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<div class="section" id="run-multiple-compute-units-lab-on-hardware">
<h3>Run Multiple Compute Units Lab on Hardware<a class="headerlink" href="#run-multiple-compute-units-lab-on-hardware" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>Before building the hardware target, you need to set the CU number as 4. To do that, open the <code class="docutils literal notranslate"><span class="pre">design.cfg</span></code> and modify the <code class="docutils literal notranslate"><span class="pre">nk</span></code> option as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nk</span><span class="o">=</span><span class="n">convolve_fpga</span><span class="p">:</span><span class="mi">4</span>
</pre></div>
</div>
</li>
<li><p>Use the following commands to run the multiple compute units version design on hardware.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">run</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">STEP</span><span class="o">=</span><span class="n">multicu</span> <span class="n">SOLUTION</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>You should see similar numbers when host program finishes running.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FPGA</span> <span class="n">Time</span><span class="p">:</span>       <span class="mf">2.35359</span> <span class="n">s</span>
<span class="n">FPGA</span> <span class="n">Throughput</span><span class="p">:</span> <span class="mf">443.637</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>


<span class="n">Processed</span> <span class="mf">7.91</span> <span class="n">MB</span> <span class="ow">in</span> <span class="mf">7.246</span><span class="n">s</span> <span class="p">(</span><span class="mf">144.10</span> <span class="n">MBps</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="performance-table">
<h3>Performance Table<a class="headerlink" href="#performance-table" title="Permalink to this heading">¶</a></h3>
<p>The following table shows the final performance benchmarking results.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th align="left">Step</th>
<th align="left">Image Size</th>
<th align="right">Number of Frames</th>
<th align="right">Time (Hardware) (s)</th>
<th align="right">Throughput (MBps)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">baseline</td>
<td align="left">1920x1080</td>
<td align="right">132</td>
<td align="right">701.8</td>
<td align="right">1.48</td>
</tr>
<tr>
<td align="left">localbuf</td>
<td align="left">1920x1080</td>
<td align="right">132</td>
<td align="right">86.8</td>
<td align="right">12 (8.1x)</td>
</tr>
<tr>
<td align="left">fixed-point data</td>
<td align="left">1920x1080</td>
<td align="right">132</td>
<td align="right">27.3</td>
<td align="right">38.2 (3.2x)</td>
</tr>
<tr>
<td align="left">dataflow</td>
<td align="left">1920x1080</td>
<td align="right">132</td>
<td align="right">3.6</td>
<td align="right">284 (7.4x)</td>
</tr>
<tr>
<td align="left">multi-CU</td>
<td align="left">1920x1080</td>
<td align="right">132</td>
<td align="right">2.35</td>
<td align="right">443 (1.5x)</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>Congratulations! You have successfully completed all modules to convert a standard CPU-based application into an FPGA accelerated application, running with nearly 300X the throughput when running on the Alveo U200 card. You set performance objectives, and then you employed a series of optimizations to achieve your objectives.</p>
<ol class="simple">
<li><p>You created a Vitis core development kit application from a basic C application.</p></li>
<li><p>You familiarized yourself with the reports generated during software and hardware emulation.</p></li>
<li><p>You explored various methods of optimizing your HLS kernel.</p></li>
<li><p>You learned how to set an OpenCL API command queue to execute out-of-order for improved performance.</p></li>
<li><p>You enabled your kernel to run on multiple CUs.</p></li>
<li><p>You used the HLS dataflow directive and explored how it affected your application.</p></li>
<li><p>You ran the optimized application on the Alveo Data Center accelerator card to see the actual performance gains.</p></li>
</ol>
</br>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/docs/vitis-getting-started/">Return to Getting Started Pathway</a> — <a href="./README.md">Return to Start of Tutorial</a></b></p><p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>