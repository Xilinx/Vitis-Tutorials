<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Controlling Vivado Implementation &mdash; Vitis™ Tutorials 2022.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Platform Creation Overview" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html" />
    <link rel="prev" title="Using Multiple Compute Units" href="../02-using-multiple-cu/README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../README.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Controlling Vivado Implementation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-overview">Tutorial Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#before-you-begin">Before You Begin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-tutorial-reference-files">Accessing the Tutorial Reference Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-up-the-vitis-environment">Set Up the Vitis Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-vivado-synthesis-and-implementation-through-the-vitis-compiler">Controlling Vivado Synthesis and Implementation through the Vitis Compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimizing-the-design-in-the-vivado-tool">Optimizing the Design in the Vivado Tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reuse-the-optimized-checkpoint-to-create-the-device-binary">Reuse the Optimized Checkpoint to Create the Device Binary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#putting-it-all-together">Putting it All Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../README.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../README.html" class="icon icon-home"></a> &raquo;</li>
      <li>Controlling Vivado Implementation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Runtime_and_System_Optimization/Feature_Tutorials/03-controlling-vivado-implementation/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2019.2 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="controlling-vivado-implementation">
<h1>Controlling Vivado Implementation<a class="headerlink" href="#controlling-vivado-implementation" title="Permalink to this heading">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>The Vitis™ compiler creates kernel objects from the source code, links the kernels with the targeted shell, and runs the assembled design through the Vivado® tool implementation flows. It generates the platform file (<code class="docutils literal notranslate"><span class="pre">xclbin</span></code>) needed to program the FPGA-based acceleration cards. Sometimes, it is essential to use the advanced Vivado synthesis and implementation options to achieve your desired results, including timing closure. The topics discussed here are documented in <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2020.1%3Bt=vitis+doc%3Bd=buildingdevicebinary.html%3Ba=hnw1523048617934">Managing FPGA Synthesis and Implementation Results in the Vivado Tool</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p>
</div>
<div class="section" id="tutorial-overview">
<h2>Tutorial Overview<a class="headerlink" href="#tutorial-overview" title="Permalink to this heading">¶</a></h2>
<p>This tutorial shows you how to control the Vivado tool flows to implement your project and guides you through the steps in the command line flow.</p>
<p>The Vitis core development kit provides two methods to control the Vivado tool flow:</p>
<ol class="simple">
<li><p>When linking the system for the hardware build, you can pass Vivado synthesis and implementation options at the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command line or use configuration files.</p></li>
<li><p>If your application has already been compiled, then you can:</p>
<ul class="simple">
<li><p>Optimize the design with the Vivado Design Suite.</p></li>
<li><p>Generate a new routed checkpoint.</p></li>
<li><p>Reuse this checkpoint to generate a new device binary file (<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>).</p></li>
</ul>
</li>
</ol>
<blockquote>
<div><p><strong>TIP:</strong> The design used in this tutorial is taken from the <code class="docutils literal notranslate"><span class="pre">cl_gmem_2banks</span></code> example in the <code class="docutils literal notranslate"><span class="pre">ocl_kernels</span></code> category of the <a class="reference external" href="https://github.com/Xilinx/Vitis_Accel_Examples/tree/master/ocl_kernels/cl_gmem_2banks/src">Vitis Accel Examples</a> on GitHub.</p>
</div></blockquote>
</div>
<div class="section" id="before-you-begin">
<h2>Before You Begin<a class="headerlink" href="#before-you-begin" title="Permalink to this heading">¶</a></h2>
<p>This tutorial uses:</p>
<ul class="simple">
<li><p>BASH Linux shell commands</p></li>
<li><p>2020.1 Vitis core development kit release and the <em>xilinx_u200_xdma_201830_2</em> platform.
If necessary, it can be easily ported to other versions and platforms.</p></li>
</ul>
<blockquote>
<div><p><strong>IMPORTANT:</strong></p>
<ul class="simple">
<li><p>Before running any of the examples, make sure you have installed the Vitis core development kit as described in <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2020.1%3Bt=vitis+doc%3Bd=vhc1571429852245.html">Installation</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p></li>
<li><p>If you run applications on Xilinx® Alveo™ Data Center accelerator cards, ensure the card and software drivers have been correctly installed by following the instructions on the <a class="reference external" href="https://www.xilinx.com/products/boards-and-kits/alveo.html">Alveo Portfolio page</a>.</p></li>
<li><p>Before running this lab, you should be familiar with the <a class="reference external" href="../Pathway3/README">Essential Concepts for Building and Running the Accelerated Application</a> tutorial.</p></li>
</ul>
</div></blockquote>
<div class="section" id="accessing-the-tutorial-reference-files">
<h3>Accessing the Tutorial Reference Files<a class="headerlink" href="#accessing-the-tutorial-reference-files" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>To access the reference files, enter the following into a terminal: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/Xilinx/Vitis-Tutorials</span></code>.</p></li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">controlling-vivado-impl</span></code> directory, and then access <code class="docutils literal notranslate"><span class="pre">reference-files/run</span></code> directory.</p></li>
</ol>
</div>
<div class="section" id="set-up-the-vitis-environment">
<h3>Set Up the Vitis Environment<a class="headerlink" href="#set-up-the-vitis-environment" title="Permalink to this heading">¶</a></h3>
<p>Set up the Vitis core development kit by running these commands:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> <span class="c1">#setup Xilinx Vitis tools. XILINX_VITIS and XILINX_VIVADO will be set in this step.</span>
 <span class="nb">source</span> &lt;VITIS_install_path&gt;/settings64.sh
 <span class="c1">#Setup Xilinx runtime. XILINX_XRT will be set in this step.</span>
 <span class="nb">source</span> &lt;XRT_install_path&gt;/setup.sh
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="controlling-vivado-synthesis-and-implementation-through-the-vitis-compiler">
<h2>Controlling Vivado Synthesis and Implementation through the Vitis Compiler<a class="headerlink" href="#controlling-vivado-synthesis-and-implementation-through-the-vitis-compiler" title="Permalink to this heading">¶</a></h2>
<blockquote>
<div><p><strong>NOTE:</strong> In this tutorial, run all instructions from the <code class="docutils literal notranslate"><span class="pre">reference-files/run</span></code> directory.</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">–-vivado</span></code> switch is paired with properties or parameters to configure the Vivado tools. For instance, the <code class="docutils literal notranslate"><span class="pre">--vivado</span></code> switch  can configure optimization, placement, and timing, or set up emulation and compile options. In the command line flow, properties are specified as <code class="docutils literal notranslate"><span class="pre">--vivado.prop</span> <span class="pre">&lt;object_type&gt;.&lt;object_name&gt;.&lt;prop_name&gt;</span></code> where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prop</span></code>: Required keyword that signifies the specified property.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_type</span></code>: Defines the first class object type to assign the property to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_name</span></code>: Specifies the object instance to attach to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prop_name</span></code>: Defines the property_name/value pair which defines both the name and the value to assign.</p></li>
</ul>
<p>While you can use <code class="docutils literal notranslate"><span class="pre">--vivado</span></code> options from the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command line, it makes more sense to do some from configuration files specified by the <code class="docutils literal notranslate"><span class="pre">--config</span></code> option. This is explained in <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2020.1%3Bt=vitis+doc%3Bd=vitiscommandcompiler.html%3Ba=pni1524163195211">Vitis Compiler Configuration File</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416). In this tutorial, you will use the following options as examples to see how to control Vivado synthesis and implementation:</p>
<ul class="simple">
<li><p>Completely flatten the hierarchy during RTL synthesis by specifying the <code class="docutils literal notranslate"><span class="pre">FLATTEN_HIERARCHY=full</span></code> property.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--vivado.prop</span> <span class="pre">run.my_rm_synth_1.{STEPS.SYNTH_DESIGN.ARGS.FLATTEN_HIERARCHY}={full}</span></code></p></li>
</ul>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">NoTimingRelaxation</span></code> directive during the Vivado routing step by using the <code class="docutils literal notranslate"><span class="pre">STEPS.ROUTE_DESIGN</span></code> property.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--vivado.prop</span> <span class="pre">run.impl_1.{STEPS.ROUTE_DESIGN.ARGS.DIRECTIVE}={NoTimingRelaxation}</span></code></p></li>
</ul>
</li>
</ul>
<p>In this tutorial, the <code class="docutils literal notranslate"><span class="pre">-–vivado</span></code> command options are defined in the <code class="docutils literal notranslate"><span class="pre">design.cfg</span></code> file, which will be used during the hardware build process.</p>
<blockquote>
<div><p><strong>TIP:</strong> Because it is running Vivado synthesis and implementation, the hardware build process (<code class="docutils literal notranslate"><span class="pre">t=hw</span></code>) can take a significant amount of time to run.</p>
</div></blockquote>
<ol>
<li><p>Compile the kernel with the Vitis compiler and link it with the platform file to produce the device binary (<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>) using the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>v++ -t hw --config design.cfg -c -k apply_watermark -o apply_watermark.hw.xilinx_u200_xdma_201830_2.xo ../src/krnl_watermarking.cl
v++ -t hw -s --config design.cfg -R2 -l -o apply_watermark.hw.xilinx_u200_xdma_201830_2.xclbin apply_watermark.hw.xilinx_u200_xdma_201830_2.xo
</pre></div>
</div>
</li>
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">design.cfg</span></code> file and get familiar with different options. The following list describes some of the command options.</p>
<blockquote>
<div><p><strong>Command Options Descriptions</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">hw</span></code>: Build target is hardware</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">platform=xilinx_u200_xdma_201830_2</span></code>: Specify the xilinx_u200 platform</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug=1</span></code>: Generate debug info</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_memory_ports=apply_watermark</span></code>: Generate a separate AXI4 interface for each port</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span></code>: Compile the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">apply_watermark</span></code>: Name the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">../src/krnl_watermarking.cl</span></code>: Specify source files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sp=apply_watermark_1.m_axi_gmem0:DDR[0]</span></code>: Specify DDR bank connection</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">design.cfg</span></code>: Set the Vivado Synthesis and Implementation options</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-R2</span></code>: Set Report Level to 2 to generate DCPs for each implementation step</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code>: Link the kernel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nk=apply_watermark:1:apply_watermark_1</span></code>: Specify kernel instance number and name</p></li>
</ul>
</div></blockquote>
</li>
<li><p>To check that the Vivado synthesis and implementation options are applied, open <code class="docutils literal notranslate"><span class="pre">_x/logs/link/vivado.log</span></code>, and search for <em>flatten_hierarchy</em> and <em>NoTimingRelaxation</em>. You will find following lines indicating that the options have taken effect:</p>
<ul class="simple">
<li><p><strong>Command</strong>: <code class="docutils literal notranslate"><span class="pre">synth_design</span> <span class="pre">-top</span> <span class="pre">pfm_dynamic</span> <span class="pre">-part</span> <span class="pre">xcu200-fsgd2104-2-e</span> <span class="pre">-flatten_hierarchy</span> <span class="pre">full</span> <span class="pre">-mode</span> <span class="pre">out_of_context</span></code></p></li>
<li><p><strong>Command</strong>: <code class="docutils literal notranslate"><span class="pre">route_design</span> <span class="pre">-directive</span> <span class="pre">NoTimingRelaxation</span></code></p></li>
</ul>
</li>
</ol>
<p>You have successfully applied properties to manage or influence the results of synthesis and implementation in the Vivado Design Suite.</p>
</div>
<div class="section" id="optimizing-the-design-in-the-vivado-tool">
<h2>Optimizing the Design in the Vivado Tool<a class="headerlink" href="#optimizing-the-design-in-the-vivado-tool" title="Permalink to this heading">¶</a></h2>
<p>You can optimize the Vivado implementation results to achieve your goal using various optimization techniques, to achieve timing closure for example, or to improve performance. After working with the Vivado tool to optimize your design, write a design checkpoint (DCP) from the routed design to reuse in the Vitis compiler link process (<code class="docutils literal notranslate"><span class="pre">v++</span> <span class="pre">--link</span></code>).</p>
<blockquote>
<div><p><strong>IMPORTANT:</strong> Ensure that the Vitis tools and Vivado tools use the same release version.</p>
</div></blockquote>
<p>For information on specific Vivado tool usage and optimization, refer to the <em>Vivado Design Suite Implementation User Guide</em> (<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd=ug904-vivado-implementation.pdf">UG904</a>) and the <em>UltraFast Design Methodology Guide for the Vivado Design Suite</em> (<a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=latest%3Bd=ug949-vivado-design-methodology.pdf">UG949</a>).</p>
<p>You can run the Vivado tool in batch mode using a Tcl script or run it interactively. In this tutorial, you will run it interactively, and then source a Tcl script inside the tool to achieve your optimization. This will give you an opportunity to familiarize yourself with the Vivado IDE.</p>
<ol>
<li><p>From the <code class="docutils literal notranslate"><span class="pre">/reference-file/run</span></code> folder, launch the Vivado IDE.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vivado
</pre></div>
</div>
</li>
<li><p>When the Vivado IDE is open, enter the following command in the Tcl console.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> ./opt.tcl
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">opt.tcl</span></code> file includes the following Tcl commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#DCP files in different stages of Vivado have been written by v++ linker automatically with option &quot;-R2&quot;</span>
open_checkpoint ./_x/link/vivado/vpl/prj/prj.runs/impl_1/pfm_top_wrapper_routed.dcp
<span class="c1">#Run post-route physical optimization</span>
phys_opt_design -directive AggressiveExplore
write_checkpoint -force ./_x/link/vivado/routed.dcp
</pre></div>
</div>
<p>After the <code class="docutils literal notranslate"><span class="pre">opt.tcl</span></code> script completes, if you are not familiar with the tool, spend some time looking around the Vivado IDE. Examine the Tcl console at the bottom of the IDE to see what commands have been run.</p>
</li>
<li><p>Select  <strong>File &gt; Exit</strong>.</p></li>
</ol>
<div class="section" id="reuse-the-optimized-checkpoint-to-create-the-device-binary">
<h3>Reuse the Optimized Checkpoint to Create the Device Binary<a class="headerlink" href="#reuse-the-optimized-checkpoint-to-create-the-device-binary" title="Permalink to this heading">¶</a></h3>
<p>Next, reuse the <code class="docutils literal notranslate"><span class="pre">routed.dcp</span></code> checkpoint file generated by the <code class="docutils literal notranslate"><span class="pre">opt.tcl</span></code> script to generate a new platform file (<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>). To do this, add the <code class="docutils literal notranslate"><span class="pre">--reuse_impl</span></code> option to the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command. This reruns the <code class="docutils literal notranslate"><span class="pre">--link</span></code> process using the already implemented Vivado design checkpoint file (<code class="docutils literal notranslate"><span class="pre">.dcp</span></code>). It runs in much less time than the initial hardware build required.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>v++ -t hw --config design.cfg -l -o <span class="s1">&#39;apply_watermark.hw.xilinx_u200_xdma_201830_2.xclbin&#39;</span> apply_watermark.hw.xilinx_u200_xdma_201830_2.xo --reuse_impl ./_x/link/vivado/routed.dcp
</pre></div>
</div>
<p>From the transcript in the command shell, you can see that the steps to generate the implemented design have been skipped, and the bitstream generation starts.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>INFO: <span class="o">[</span>VPL <span class="m">60</span>-423<span class="o">]</span>   Target device: xilinx_u200_xdma_201830_2
<span class="o">[</span><span class="m">11</span>:22:58<span class="o">]</span> Run vpl: Step interactive: Started
Starting FPGA bitstream generation.
</pre></div>
</div>
</div>
</div>
<div class="section" id="putting-it-all-together">
<h2>Putting it All Together<a class="headerlink" href="#putting-it-all-together" title="Permalink to this heading">¶</a></h2>
<p>The following section summarizes all the steps to control the Vivado tool implementation with the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command, optimize design with the Vivado tools, and reuse implemented DCP to generate the platform file. You might use it as a quick reference for commands.</p>
<ol>
<li><p>Set up the core development kit and working directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> <span class="c1">#setup Xilinx Vitis tools. XILINX_VITIS and XILINX_VIVADO will be set in this step.</span>
 <span class="nb">source</span> &lt;VITIS_install_path&gt;/settings64.sh
 <span class="c1">#Setup Xilinx runtime. XILINX_XRT will be set in this step.</span>
 <span class="nb">source</span> &lt;XRT_install_path&gt;/setup.sh
</pre></div>
</div>
</li>
<li><p>Generate the platform file (<code class="docutils literal notranslate"><span class="pre">xclbin</span></code>) with <code class="docutils literal notranslate"><span class="pre">v++</span></code> commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>v++ -t hw --config design.cfg -c -k apply_watermark -o apply_watermark.hw.xilinx_u200_xdma_201830_2.xo ../src/krnl_watermarking.cl
v++ -t hw -s --config design.cfg -R2 -l -o apply_watermark.hw.xilinx_u200_xdma_201830_2.xclbin apply_watermark.hw.xilinx_u200_xdma_201830_2.xo
</pre></div>
</div>
</li>
<li><p>Optimize the design with the Vivado tool, and rewrite the routed DCP.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vivado -mode batch -source opt.tcl
</pre></div>
</div>
</li>
<li><p>Reuse the routed DCP to generate the device binary file (<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>v++ -t hw --config design.cfg -l -o apply_watermark.hw.xilinx_u200_xdma_201830_2.xclbin apply_watermark.hw.xilinx_u200_xdma_201830_2.xo --reuse_impl ./_x/link/vivado/routed.dcp
</pre></div>
</div>
</li>
<li><p>This tutorial has provided host code to make it complete to run through various flows. The following commands are references to build the host and run the application.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#Generate the host executable.</span>
g++ -I<span class="nv">$XILINX_XRT</span>/include/ -I<span class="nv">$XILINX_VIVADO</span>/include/ -Wall -O0 -g -std<span class="o">=</span>c++11 -L<span class="nv">$XILINX_XRT</span>/lib/ -lOpenCL -lpthread -lrt -lstdc++ -o <span class="s1">&#39;host&#39;</span> <span class="s1">&#39;../src/host.cpp&#39;</span>
<span class="c1">#Please set correct XCL_EMULATION_MODE manually if running sw_emu and hw_emu modes</span>
./host apply_watermark.hw.xilinx_u200_xdma_201830_2.xclbin ../src/inputImage.bmp ../src/golden.bmp
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h2>
<p>This tutorial illustrated how to use the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command <code class="docutils literal notranslate"><span class="pre">--vivado</span></code> option to control Vivado synthesis and implementation, using a simple example to optimize the design with the Vivado tool. It also showed the steps to reuse an implemented DCP to generate the device binary file (<code class="docutils literal notranslate"><span class="pre">.xclbin</span></code>), building the Vitis accelerated application from the optimized Vivado implementation.
</br></p>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/README.md">Return to Main Page</a></b></p>
<p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../02-using-multiple-cu/README.html" class="btn btn-neutral float-left" title="Using Multiple Compute Units" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html" class="btn btn-neutral float-right" title="Platform Creation Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on May 16, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>