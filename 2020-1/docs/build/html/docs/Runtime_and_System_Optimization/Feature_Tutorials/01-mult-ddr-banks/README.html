<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
  <title>Using Multiple DDR Banks &mdash; Vitis™ Tutorials 2020.1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Using Multiple Compute Units" href="../02-using-multiple-cu/README.html" />
    <link rel="prev" title="IVAS ZCU104 ML Acceleration Reference Release" href="../../Design_Tutorials/02-ivas-ml/README.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../../README.html" class="icon icon-home"> Vitis™ Tutorials
            <img src="../../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2020.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">日本語版</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/master/docs-jp/README.html">Master</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis/README.html">Vitis Flow 101 Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting_Started/Vitis_HLS/README.html">Vitis HLS Analysis and Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware Accelerators</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/02-bloom/README.html">Optimizing Accelerated FPGA Applications: Bloom Filter Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/01-convolution-tutorial/README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Design_Tutorials/03-rtl_stream_kernel_integration/README.html">Mixed Kernels Design Tutorial with AXI Stream and Vitis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/01-rtl_kernel_workflow/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Hardware_Accelerators/Feature_Tutorials/02-mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime and System Optimization</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Design_Tutorials/01-host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Design_Tutorials/02-ivas-ml/README.html">IVAS ZCU104 ML Acceleration Reference Release</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using Multiple DDR Banks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-overview">Tutorial Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#before-you-begin">Before You Begin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accessing-the-tutorial-reference-files">Accessing the Tutorial Reference Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial-setup">Tutorial Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#set-v-linker-options">Set v++ Linker Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../02-using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-controlling-vivado-implementation/README.html">Controlling Vivado Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Vitis Platform Creation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/01-Overview/README.html">Platform Creation Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vitis_Platform_Creation/Introduction/02-Edge-AI-ZCU104/README.html">Vitis Custom Embedded Platform Creation Example on ZCU104</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/">Main</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-2/build/html/index.html">2021.2</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2021-1/build/html/index.html">2021.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/build/html/index.html">2020.2</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../README.html">Vitis™ Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../README.html" class="icon icon-home"></a> &raquo;</li>
      <li>Using Multiple DDR Banks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/docs/Runtime_and_System_Optimization/Feature_Tutorials/01-mult-ddr-banks/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2020.1 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="using-multiple-ddr-banks">
<h1>Using Multiple DDR Banks<a class="headerlink" href="#using-multiple-ddr-banks" title="Permalink to this heading">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>By default, in the Vitis™ core development kit, the data transfer between the kernel and the DDR is achieved using a single DDR bank. In some applications, data movement is a performance bottleneck. In cases where the kernels need to move large amounts of data between the global memory (DDR) and the FPGA, you can use multiple DDR banks. This enables the kernels to access multiple memory banks simultaneously. As a result, the application performance increases.</p>
<p>The System Port mapping option using the <code class="docutils literal notranslate"><span class="pre">v++</span></code> command <code class="docutils literal notranslate"><span class="pre">--sp</span></code> switch allows the designer to map kernel ports to specific global memory banks, such as DDR or PLRAM. This tutorial shows you how to map kernel ports to multiple DDR banks.</p>
</div>
<div class="section" id="tutorial-overview">
<h2>Tutorial Overview<a class="headerlink" href="#tutorial-overview" title="Permalink to this heading">¶</a></h2>
<p>This tutorial uses a simple example of vector addition. It shows the <code class="docutils literal notranslate"><span class="pre">vadd</span></code> kernel reading data from <code class="docutils literal notranslate"><span class="pre">in1</span></code> and <code class="docutils literal notranslate"><span class="pre">in2</span></code> and producing the result, <code class="docutils literal notranslate"><span class="pre">out</span></code>.</p>
<p>In this tutorial, you implement the vector addition application using three DDR banks.</p>
<p>Because the default behavior of the Vitis core development kit is to use a single DDR bank for data exchange between kernels and global memory, all data access through ports <code class="docutils literal notranslate"><span class="pre">in1</span></code>, <code class="docutils literal notranslate"><span class="pre">in2</span></code>, and <code class="docutils literal notranslate"><span class="pre">out</span></code> will be done through the default DDR bank for the platform.</p>
<p><img alt="../../../../_images/mult-ddr-banks_fig_01.png" src="../../../../_images/mult-ddr-banks_fig_01.png" /></p>
<p>Assume that in the application, you want to access:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in1</span></code> through <code class="docutils literal notranslate"><span class="pre">Bank0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in2</span></code> through <code class="docutils literal notranslate"><span class="pre">Bank1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> through <code class="docutils literal notranslate"><span class="pre">Bank2</span></code></p></li>
</ul>
<p><img alt="../../../../_images/mult-ddr-banks_fig_02.png" src="../../../../_images/mult-ddr-banks_fig_02.png" /></p>
<p>To achieve the desired mapping, instruct the Vitis core development kit to connect each kernel argument to the desired bank.</p>
<p>The example in this tutorial uses a C++ kernel; however, the steps described are also the same for RTL and OpenCL™ API kernels.</p>
</div>
<div class="section" id="before-you-begin">
<h2>Before You Begin<a class="headerlink" href="#before-you-begin" title="Permalink to this heading">¶</a></h2>
<p>The labs in this tutorial use:</p>
<ul class="simple">
<li><p>BASH Linux shell commands.</p></li>
<li><p>2020.1 Vitis core development kit release and the <em>xilinx_u200_xdma_201830_2</em> platform. If necessary, it can be easily extended to other versions and platforms.</p></li>
</ul>
<blockquote>
<div><p><strong>IMPORTANT:</strong></p>
<ul class="simple">
<li><p>Before running any of the examples, make sure you have installed the Vitis core development kit as described in <a class="reference external" href="https://www.xilinx.com/cgi-bin/docs/rdoc?v=2020.1%3Bt=vitis+doc%3Bd=vhc1571429852245.html">Installation</a> in the Application Acceleration Development flow of the Vitis Unified Software Platform Documentation (UG1416).</p></li>
<li><p>If you run applications on Xilinx® Alveo™ Data Center accelerator cards, ensure the card and software drivers have been correctly installed by following the instructions on the <a class="reference external" href="https://www.xilinx.com/products/boards-and-kits/alveo.html">Alveo Portfolio page</a>.</p></li>
</ul>
</div></blockquote>
<div class="section" id="accessing-the-tutorial-reference-files">
<h3>Accessing the Tutorial Reference Files<a class="headerlink" href="#accessing-the-tutorial-reference-files" title="Permalink to this heading">¶</a></h3>
<ol class="simple">
<li><p>To access the reference files, type the following into a terminal: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/Xilinx/Vitis-Tutorials</span></code>.</p></li>
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">mult-ddr-banks</span></code> directory, and then access the <code class="docutils literal notranslate"><span class="pre">reference-files</span></code> directory.</p></li>
</ol>
</div>
<div class="section" id="tutorial-setup">
<h3>Tutorial Setup<a class="headerlink" href="#tutorial-setup" title="Permalink to this heading">¶</a></h3>
<ol>
<li><p>To set up the Vitis core development kit, run the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  <span class="c1">#setup Xilinx Vitis tools, XILINX_VITIS and XILINX_VIVADO will be set in this step. source &lt;VITIS install path&gt;/settings64.sh. for example:</span>
  <span class="nb">source</span> /opt/Xilinx/Vitis/2019.2/settings64.sh
  <span class="c1">#Setup runtime. XILINX_XRT will be set in this step</span>
  <span class="nb">source</span> /opt/xilinx/xrt/setup.sh
</pre></div>
</div>
</li>
<li><p>Execute the makefile to build the design for HW-Emulation.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> reference-files
make all
</pre></div>
</div>
<blockquote>
<div><p><strong>Makefile Options Descriptions</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MODE</span> <span class="pre">:=</span> <span class="pre">hw_emu</span></code>: Set the build configuration mode to HW Emulation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PLATFORM</span> <span class="pre">:=</span> <span class="pre">xilinx_u200_xdma_201830_2</span></code>: Select the target platform</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">KERNEL_SRC</span> <span class="pre">:=</span> <span class="pre">src/vadd.cpp</span></code>: List the kernel source files</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HOST_SRC</span> <span class="pre">:=</span> <span class="pre">src/host.cpp</span></code>: List the host source files</p></li>
</ul>
</div></blockquote>
<p>As previously mentioned, the default implementation of the design uses a single DDR bank. Observe the messages in the Console view during the link step; you should see messages similar to the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip_name</span><span class="p">:</span> <span class="n">vadd</span>
<span class="n">Creating</span> <span class="n">apsys_0</span><span class="o">.</span><span class="n">xml</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2226</span><span class="p">]</span> <span class="n">Inferring</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in1</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2226</span><span class="p">]</span> <span class="n">Inferring</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in2</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2226</span><span class="p">]</span> <span class="n">Inferring</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">out</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>This confirms the mapping is automatically inferred by the Vitis core development kit for each of the kernel arguments in the absence of explicit <code class="docutils literal notranslate"><span class="pre">--sp</span></code> options being specified.</p>
</li>
<li><p>Run HW-Emulation by executing the makefile with the <code class="docutils literal notranslate"><span class="pre">check</span></code> option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make check
</pre></div>
</div>
<p>After the simulation is complete, the following memory connections for the kernel data transfer are reported.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span> <span class="n">PASSED</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">Vitis</span><span class="o">-</span><span class="n">EM</span> <span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">Wall</span> <span class="n">clock</span> <span class="n">time</span><span class="p">:</span> <span class="mi">22</span><span class="p">:</span><span class="mi">51</span><span class="p">,</span> <span class="n">Emulation</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.0569014</span> <span class="n">ms</span><span class="p">]</span> <span class="n">Data</span> <span class="n">transfer</span> <span class="n">between</span> <span class="n">kernel</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="k">global</span> <span class="n">memory</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem0</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem1</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem2</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>
</pre></div>
</div>
</li>
</ol>
<p>Now, you will explore how the data transfers can be split across the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DDR</span> <span class="pre">Bank</span> <span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DDR</span> <span class="pre">Bank</span> <span class="pre">1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DDR</span> <span class="pre">Bank</span> <span class="pre">2</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="set-v-linker-options">
<h2>Set v++ Linker Options<a class="headerlink" href="#set-v-linker-options" title="Permalink to this heading">¶</a></h2>
<p>You will instruct the <code class="docutils literal notranslate"><span class="pre">v++</span></code> Kernel Linker to connect the kernel arguments to the corresponding banks. Use the <code class="docutils literal notranslate"><span class="pre">sp</span></code> option to map kernel ports or kernel arguments.</p>
<ul>
<li><p><strong>Kernel args</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">sp</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">kernel_cu_name</span><span class="o">&gt;.&lt;</span><span class="n">kernel_arg</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">sptag</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;kernel_cu_name&gt;</span></code>: The compute unit (CU) based on the kernel name, followed by <code class="docutils literal notranslate"><span class="pre">_</span></code> and <code class="docutils literal notranslate"><span class="pre">index</span></code>, starting from the value <code class="docutils literal notranslate"><span class="pre">1</span></code>. For example, the computer unit name of the vadd kernel will be <code class="docutils literal notranslate"><span class="pre">vadd_1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;kernel_arg&gt;</span></code>: The function argument of the CU. For the vadd kernel, the kernel argument can be found in the <code class="docutils literal notranslate"><span class="pre">vadd.cpp</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;sptag&gt;</span></code>: Represents a memory resource available on the target platform. Valid sptag names include DDR and PLRAM. In this tutorial, target <code class="docutils literal notranslate"><span class="pre">DDR[0]</span></code>, <code class="docutils literal notranslate"><span class="pre">DDR[1]</span></code>, and <code class="docutils literal notranslate"><span class="pre">DDR[2]</span></code>. You can also do ranges: <code class="docutils literal notranslate"><span class="pre">&lt;sptag&gt;[min:max]</span></code>.</p></li>
</ul>
</li>
</ul>
<ol>
<li><p>Define the <code class="docutils literal notranslate"><span class="pre">sp</span></code> command options for the vadd kernel and add this to the Makefile.</p>
<p>The kernel instance name will be: <code class="docutils literal notranslate"><span class="pre">vadd_1</span></code>.
The arguments for the vadd kernel are specified in the <code class="docutils literal notranslate"><span class="pre">vadd.cpp</span></code> file. The kernel argument (<code class="docutils literal notranslate"><span class="pre">in1</span></code>, <code class="docutils literal notranslate"><span class="pre">in2</span></code>, and <code class="docutils literal notranslate"><span class="pre">out</span></code>) should be connected to <code class="docutils literal notranslate"><span class="pre">DDR[0]</span></code>, <code class="docutils literal notranslate"><span class="pre">DDR[1]</span></code>, and <code class="docutils literal notranslate"><span class="pre">DDR[2]</span></code>.
Therefore, the <code class="docutils literal notranslate"><span class="pre">sp</span></code> options should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sp</span> <span class="o">=</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in1</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in2</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">out</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Argument <code class="docutils literal notranslate"><span class="pre">in1</span></code> accesses DDR Bank0</p></li>
<li><p>Argument <code class="docutils literal notranslate"><span class="pre">in2</span></code> accesses DDR Bank1</p></li>
<li><p>Argument <code class="docutils literal notranslate"><span class="pre">out</span></code> accesses DDR Bank2.</p></li>
</ul>
<p>The three <code class="docutils literal notranslate"><span class="pre">sp</span></code> options are added in <code class="docutils literal notranslate"><span class="pre">connectivity.cfg</span></code> file and you need to modify the Makefile to use that config file.</p>
</li>
<li><p>Open the Makefile and uncomment line 18 to add the config file into <code class="docutils literal notranslate"><span class="pre">v++</span></code> linker options.</p>
<p>Using config files is the new feature for the Vitis software platform. You can put options into different files and use <code class="docutils literal notranslate"><span class="pre">--config</span></code> to specify them.</p>
</li>
<li><p>After you have saved the changes, complete a clean build of the design in HW Emulation mode.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> make clean
 make all
</pre></div>
</div>
<p>Again, observe the messages in the Console view during the link step; a message similar to the following displays.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ip_name</span><span class="p">:</span> <span class="n">vadd</span>
<span class="n">Creating</span> <span class="n">apsys_0</span><span class="o">.</span><span class="n">xml</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span> <span class="n">Port</span> <span class="n">Specs</span><span class="p">:</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span>   <span class="n">kernel</span><span class="p">:</span> <span class="n">vadd_1</span><span class="p">,</span> <span class="n">k_port</span><span class="p">:</span> <span class="n">in1</span><span class="p">,</span> <span class="n">sptag</span><span class="p">:</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span>   <span class="n">kernel</span><span class="p">:</span> <span class="n">vadd_1</span><span class="p">,</span> <span class="n">k_port</span><span class="p">:</span> <span class="n">in2</span><span class="p">,</span> <span class="n">sptag</span><span class="p">:</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">0</span><span class="p">]</span>   <span class="n">kernel</span><span class="p">:</span> <span class="n">vadd_1</span><span class="p">,</span> <span class="n">k_port</span><span class="p">:</span> <span class="n">out</span><span class="p">,</span> <span class="n">sptag</span><span class="p">:</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2228</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in1</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">directive</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in1</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2228</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in2</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">directive</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">in2</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">CFGEN</span> <span class="mi">83</span><span class="o">-</span><span class="mi">2228</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">mapping</span> <span class="k">for</span> <span class="n">argument</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">out</span> <span class="n">to</span> <span class="n">DDR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">directive</span> <span class="n">vadd_1</span><span class="o">.</span><span class="n">out</span><span class="p">:</span><span class="n">DDR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>This confirms that the Vitis core development kit has correctly mapped the kernel arguments to the specified DDR banks from the <code class="docutils literal notranslate"><span class="pre">--sp</span></code> options provided.</p>
</li>
<li><p>Run HW-Emulation, and verify the correctness of the design.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make check
</pre></div>
</div>
</li>
</ol>
<p>After the simulation is complete, you can see the memory connections for the kernel data transfer reported as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST</span> <span class="n">PASSED</span>
<span class="n">INFO</span><span class="p">:</span> <span class="p">[</span><span class="n">Vitis</span><span class="o">-</span><span class="n">EM</span> <span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="n">Wall</span> <span class="n">clock</span> <span class="n">time</span><span class="p">:</span> <span class="mi">23</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span> <span class="n">Emulation</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.054906</span> <span class="n">ms</span><span class="p">]</span> <span class="n">Data</span> <span class="n">transfer</span> <span class="n">between</span> <span class="n">kernel</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="k">global</span> <span class="n">memory</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem0</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem1</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>
<span class="n">vadd_1</span><span class="p">:</span><span class="n">m_axi_gmem2</span><span class="o">-</span><span class="n">DDR</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>          <span class="n">RD</span> <span class="o">=</span> <span class="mf">0.000</span> <span class="n">KB</span>               <span class="n">WR</span> <span class="o">=</span> <span class="mf">0.391</span> <span class="n">KB</span>
</pre></div>
</div>
<p>You can also open the Profile Summary report, <code class="docutils literal notranslate"><span class="pre">profile_summary.html</span></code> and look at the Memory Resources in the Kernel to Global Memory section showing data transfers. You will see the DDR banks assigned to each of the kernel arguments along with the traffic on each of the interfaces during HW-Emulation.</p>
<p><img alt="../../../../_images/mult-ddr-banks_img_vitis.png" src="../../../../_images/mult-ddr-banks_img_vitis.png" /></p>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">¶</a></h3>
<p>This tutorial showed you how to change the default mapping of ports <code class="docutils literal notranslate"><span class="pre">in1</span></code>, <code class="docutils literal notranslate"><span class="pre">in2</span></code>, and <code class="docutils literal notranslate"><span class="pre">out</span></code> of kernel vadd from a single DDR bank to multiple DDR banks. You also learned how to:</p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">v++</span></code> linker options using the <code class="docutils literal notranslate"><span class="pre">--sp</span></code> switch to bind kernel arguments to multiple DDR banks.</p></li>
<li><p>Build the application, and verify DDR mapping.</p></li>
<li><p>Run HW-Emulation and observe the transfer rate and bandwidth utilization for each port.</p></li>
</ul>
</br>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/README.md">Return to Main Page</a></b></p>
<p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../Design_Tutorials/02-ivas-ml/README.html" class="btn btn-neutral float-left" title="IVAS ZCU104 ML Acceleration Reference Release" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../02-using-multiple-cu/README.html" class="btn btn-neutral float-right" title="Using Multiple Compute Units" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2022, Xilinx, Inc. Xilinx is now a part of AMD.
      <span class="lastupdated">Last updated on August 23, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>